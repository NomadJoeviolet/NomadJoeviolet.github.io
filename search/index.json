[{"content":"ğŸ® æ¸¸æˆä»‹ç»ï¼šChip Tanks (èŠ¯ç‰‡å¦å…‹) Chip TanksÂ æ˜¯ä¸€æ¬¾è¿è¡Œåœ¨ STM32 åµŒå…¥å¼å¹³å°ä¸Šçš„ Roguelike ä¿¯è§†è§†è§’å¼¹å¹•å°„å‡»æ¸¸æˆã€‚ç©å®¶å°†æ“æ§ä¸€è¾†å¾®å‹å¦å…‹ï¼Œåœ¨ OLED å±å¹•å‘ˆç°çš„æˆ˜åœºä¸Šï¼Œè¿æˆ˜æºè‡ªã€Šå±±æµ·ç»ã€‹ä¸ä¸­å›½ä¸Šå¤ç¥è¯çš„æœºæ¢°åŒ–å‡¶å…½ã€‚\né€šè¿‡å‡»è´¥æ•Œäººè·å–ç»éªŒï¼Œå‡çº§å¹¶æŠ½å–å¼ºåŠ›çš„ PerkCardï¼ˆå¤©èµ‹å¡ï¼‰ï¼Œæ„å»ºå±äºä½ çš„æˆ˜æ–—æµæ´¾ï¼ŒæŒ‘æˆ˜å¼ºå¤§çš„å…³å¡ BOSSï¼\nğŸ•¹ï¸ æ¸¸æˆç±»å‹ä¸æ ¸å¿ƒæœºåˆ¶ ç±»å‹ï¼šRoguelike / å¼¹å¹•å°„å‡» (STG) / åµŒå…¥å¼æ¸¸æˆ æ ¸å¿ƒå¾ªç¯ï¼šæˆ˜æ–— -\u0026gt; ç§¯ç´¯ç»éªŒ -\u0026gt; å‡çº§ -\u0026gt;Â ä¸‰é€‰ä¸€æŠ½å¡ (Perk)Â -\u0026gt; æŒ‘æˆ˜ BOSS -\u0026gt; è¿›å…¥ä¸‹ä¸€ç« ã€‚ çƒ­é‡ç³»ç»Ÿ (Heat System)ï¼š å¦å…‹çš„å°„å‡»å—åˆ°â€œçƒ­é‡â€é™åˆ¶ã€‚ æ™®é€šå­å¼¹ã€ç«çƒã€é—ªç”µé“¾ä¼šäº§ç”Ÿä¸åŒç¨‹åº¦çš„çƒ­é‡ã€‚ å½“çƒ­é‡è¾¾åˆ°ä¸Šé™æ—¶ï¼Œå¦å…‹å°†è¿‡çƒ­æ— æ³•å°„å‡»ï¼Œå¿…é¡»ç­‰å¾…å†·å´ã€‚ ç­–ç•¥ç‚¹ï¼šç©å®¶éœ€è¦åœ¨è¾“å‡ºç«åŠ›å’Œæ§åˆ¶çƒ­é‡ä¹‹é—´å¯»æ‰¾å¹³è¡¡ã€‚ è‡ªåŠ¨å›è¡€ï¼šå¦å…‹å…·å¤‡è‡ªæˆ‘ä¿®å¤åŠŸèƒ½ï¼Œåœ¨ä¸å—ä¼¤å®³ä¸€æ®µæ—¶é—´åä¼šç¼“æ…¢æ¢å¤ç”Ÿå‘½å€¼ã€‚ ğŸ® æ“ä½œæŒ‡å— æ¸¸æˆé€šè¿‡æŒ‰é”®è¿›è¡Œæ“ä½œï¼š\nç§»åŠ¨æ§åˆ¶ï¼š Key 10ï¼šå‘ä¸Šç§»åŠ¨ (UP) / èœå•ä¸Šé€‰ Key 11ï¼šå‘ä¸‹ç§»åŠ¨ (DOWN) / èœå•ä¸‹é€‰ Key 15ï¼šå‘å·¦ç§»åŠ¨ (LEFT) Key 7ï¼šå‘å³ç§»åŠ¨ (RIGHT) åŠŸèƒ½æ§åˆ¶ï¼š Key 3ï¼šç¡®è®¤é€‰æ‹© (Select) â€”â€” ç”¨äºåœ¨å‡çº§ç•Œé¢é€‰æ‹© PerkCardã€‚ æ”»å‡»ï¼š å¦å…‹ä¼šè‡ªåŠ¨é”å®šå¹¶æ”»å‡»ï¼Œè‡ªåŠ¨åˆ¤å®šå†·å´å’Œçƒ­é‡ã€‚ ğŸƒ PerkCard (å¤©èµ‹å¡) ç³»ç»Ÿè¯¦è§£ PerkCard æ˜¯æ¸¸æˆçš„æ ¸å¿ƒ Roguelike å…ƒç´ ã€‚æ¯å½“ç©å®¶å‡çº§ï¼ˆç‰¹å®šç­‰çº§ï¼‰æ—¶ï¼Œç³»ç»Ÿä¼šéšæœºæä¾› 3 å¼ å¡ç‰‡ä¾›ç©å®¶é€‰æ‹©ã€‚\nä»¥ä¸‹æ˜¯æ‰€æœ‰å¡ç‰‡çš„æ•ˆæœè¯´æ˜ï¼š\nğŸ›¡ï¸ ç”Ÿå­˜ä¸æ¢å¤ç±» HEAL_SPEED_UP (å›å¤é€Ÿåº¦æå‡) æ•ˆæœï¼šåŠ å¿«è‡ªåŠ¨å›è¡€çš„é¢‘ç‡ã€‚è®©ä½ åœ¨å—æŸåèƒ½æ›´å¿«å¼€å§‹ä¿®å¤ã€‚ HEAL_AMOUNT_UP (å›å¤é‡æå‡) æ•ˆæœï¼šå¢åŠ æ¯æ¬¡å›è¡€æ¢å¤çš„ç”Ÿå‘½å€¼æ•°å€¼ã€‚ HEALTH_UP (ç”Ÿå‘½ä¸Šé™æå‡) æ•ˆæœï¼šå¤§å¹…æå‡å¦å…‹çš„æœ€å¤§ç”Ÿå‘½å€¼ï¼Œå¹¶ä¸”ç¬é—´å›æ»¡æ‰€æœ‰ç”Ÿå‘½å€¼ã€‚æ•‘å‘½ç¥å¡ã€‚ âš”ï¸ æ”»å‡»ä¸ç«åŠ›ç±» ATTACK_UP (æ”»å‡»åŠ›æå‡) æ•ˆæœï¼šç›´æ¥å¢åŠ æ‰€æœ‰å­å¼¹çš„åŸºç¡€ä¼¤å®³ã€‚ ATTACK_SPEED_UP (æ”»é€Ÿæå‡) æ•ˆæœï¼šå‡å°‘å°„å‡»çš„å†·å´æ—¶é—´ï¼Œè®©ä½ èƒ½æ›´é¢‘ç¹åœ°å‘å°„å­å¼¹ï¼ˆéœ€é…åˆçƒ­é‡å¡ä½¿ç”¨ï¼Œå¦åˆ™å®¹æ˜“è¿‡çƒ­ï¼‰ã€‚ UNLOCK_FIREBALL (è§£é”ï¼šç«çƒå¼¹) æ•ˆæœï¼šè§£é”å‰¯æ­¦å™¨ç«çƒã€‚ç«çƒå‡»ä¸­æ•Œäººåä¼šé€ æˆèŒƒå›´çˆ†ç‚¸ä¼¤å®³ï¼ˆAOEï¼‰ï¼Œé€‚åˆæ¸…ç†æˆç¾¤çš„å°æ€ªã€‚ UNLOCK_LIGHTNING (è§£é”ï¼šé—ªç”µé“¾) æ•ˆæœï¼šè§£é”å‰¯æ­¦å™¨é—ªç”µé“¾ã€‚é—ªç”µå…·æœ‰æé«˜çš„å•ä½“ä¼¤å®³å€ç‡ï¼Œæ˜¯å‡»æ€ BOSS çš„åˆ©å™¨ã€‚ FIREBALL_RANGE_UP (ç«çƒèŒƒå›´æå‡) æ•ˆæœï¼šæ‰©å¤§ç«çƒçˆ†ç‚¸çš„ä¼¤å®³åŠå¾„ï¼Œå¢å¼º AOE èƒ½åŠ›ã€‚ LIGHTNING_MULTIPLIER_UP (é—ªç”µä¼¤å®³å€ç‡æå‡) æ•ˆæœï¼šå¤§å¹…æå‡é—ªç”µé“¾çš„ä¼¤å®³å€æ•°ï¼Œä½¿å…¶æˆä¸ºç»ˆææ€ä¼¤æ­¦å™¨ã€‚ ğŸ”¥ çƒ­é‡ç®¡ç†ç±» (æ ¸å¿ƒæœºåˆ¶) HEAT_CAPACITY_UP (çƒ­å®¹ä¸Šé™æå‡) æ•ˆæœï¼šæå‡çƒ­é‡æ§½ä¸Šé™ã€‚å…è®¸ä½ åœ¨è¿‡çƒ­å‰è¿ç»­å‘å°„æ›´å¤šå­å¼¹ã€‚ HEAT_COOL_DOWN_UP (æ•£çƒ­é€Ÿåº¦æå‡) æ•ˆæœï¼šåŠ å¿«çƒ­é‡çš„è‡ªç„¶å†·å´é€Ÿåº¦ã€‚è®©ä½ åœ¨åœæ­¢å°„å‡»åèƒ½æ›´å¿«æ¢å¤å¼€ç«èƒ½åŠ›ã€‚ ğŸš€ æœºåŠ¨ç±» MOVE_SPEED_UP (ç§»é€Ÿæå‡) æ•ˆæœï¼šæå‡å¦å…‹çš„ç§»åŠ¨é€Ÿåº¦ï¼Œæ›´åˆ©äºèº²é¿å¯†é›†çš„å¼¹å¹•å’Œæ•Œäººçš„å†²æ’ã€‚ ğŸ‘¾ æ•Œäººå›¾é‰´ (å±±æµ·ç»æœºæ¢°å…½) ä½ å°†é¢å¯¹å½¢æ€å„å¼‚çš„æ•Œäººï¼Œå®ƒä»¬æ‹¥æœ‰ä¸åŒçš„æ”»å‡»æ¨¡å¼ï¼š\næ™®é€šæ•Œäºº é£å»‰ (Feilian)ï¼šå°å‹æ•Œäººã€‚ç§»åŠ¨é€Ÿåº¦æå¿«ï¼Œè½¨è¿¹é£˜å¿½ä¸å®šï¼Œé€šå¸¸æˆç¾¤ç»“é˜Ÿå‡ºç°è¿›è¡Œéªšæ‰°ã€‚ è›Šé›• (Gudiao)ï¼šä¸­å‹æ•Œäººã€‚æ“…é•¿è¿œç¨‹ä¼å‡»ï¼Œä»èº«ä½“ä¸¤ä¾§å‘å°„é«˜ä¼¤å­å¼¹ï¼Œæ­»äº¡æ—¶ä¼šå‘å°„ä¸€é¢—å¤ä»‡ç«çƒã€‚ é­‘é­… (ChiMei)ï¼šæå°æ•Œäººã€‚åªä¼šè¿›è¡Œè‡ªæ€å¼å†²æ’ï¼Œé€Ÿåº¦æå¿«ï¼Œä¸€æ—¦æ¥è§¦é€ æˆå¤§é‡ä¼¤å®³ã€‚ ç²¾è‹±æ•Œäºº é©³ (Bo)ï¼šé©¬å½¢ç¥å…½ï¼Œç™½èº«é»‘å°¾ï¼Œå¤´ç”Ÿç‹¬è§’ã€‚ä¼šä½¿ç”¨å†²é”‹è·µè¸ç›´æ‰‘ç©å®¶ï¼Œå‘å°„æ‰‡å½¢è™çˆªå¼¹å¹•ï¼Œä»¥åŠé‡Šæ”¾é¼“éŸ³éœ‡è¡æ³¢ã€‚ èƒœé‡ (Shengyu)ï¼šèµ¤è‰²é‡é¸¡çŠ¶å‡¶å…½ï¼Œæ“…é•¿å¹²æ‰°ã€‚ä¼šåœ¨åœºåœ°ç”Ÿæˆé®æŒ¡è§†é‡çš„æ°´é›¾ï¼Œæ¨å‡ºè¿·é›¾å±éšœï¼Œå¹¶å‘å°„è¿ç»­é›·é¸£å­å¼¹ã€‚ ç‹¸åŠ› (Lili)ï¼šçŒªå½¢ç¥å…½ï¼Œä¸åœŸç³»èƒ½åŠ›ç»‘å®šã€‚ä¼šå‘å°„åœŸæ¶Œç«çƒï¼Œé‡Šæ”¾ç å æ‰‡å½¢éœ‡æ³¢ï¼Œå¹¶åœ¨éšæœºä½ç½®åŸ‹è®¾å»¶æ—¶çˆ†ç‚¸é™·é˜±ã€‚ å…³å¡ BOSS é¥•é¤® (Taotie)ï¼šè´ªå©ªå·¨å…½ï¼Œå››å‡¶ä¹‹ä¸€ã€‚è¡€é‡æåšï¼Œä¼šä½¿ç”¨åå™¬æŠ€èƒ½å°†ç©å®¶å¸å‘è‡ªå·±ï¼Œæˆ–å‘èµ·çŒ›çƒˆçš„å†²æ’å’Œç¢¾å‹ã€‚ æ¢¼æŒ (Taowu)ï¼šå‡¶æš´å·¨å…½ï¼Œå››å‡¶ä¹‹ä¸€ã€‚æ“…é•¿é—ªç°ç§»åŠ¨ï¼Œèƒ½é‡Šæ”¾è¦†ç›–å…¨å±çš„éšæœºå¼¹å¹•å’Œè¯¡é›·ã€‚ ç›¸æŸ³ (Xiangliu)ï¼šç¾éš¾å·¨å…½ã€‚ä¹å¤´è›‡èº«ï¼Œèƒ½åŒæ—¶å‘å°„ä¹æ’å¼¹å¹•ï¼Œé‡Šæ”¾é—ªç”µä¸ç«çƒï¼Œå¹¶èƒ½å¬å”¤å¤§é‡å°æ€ªååŒä½œæˆ˜ã€‚ æ··æ²Œ (Hundun)ï¼šå››å‡¶ä¹‹é¦–ï¼Œæ— é¢ç›®çš„åŸå§‹å·¨å…½ã€‚è¡€é‡æœ€é«˜ï¼Œä¼šéšæœºé—ªçƒç§»åŠ¨å¹¶å‘å°„å…«æ–¹å‘å¼¹å¹•ï¼Œç”Ÿæˆä¸ƒçªå°å°å¹²æ‰°è§†é‡ï¼Œä½¿ç”¨è™šç©ºç‰µå¼•å°†ç©å®¶æ‹‰å‘è‡ªèº«ï¼Œé‡Šæ”¾èºæ—‹å¼æ··æ²Œæ¼©æ¶¡å’Œæ—¶ç©ºè£‚éš™å¼¹å¹•å¢™ï¼Œä»¥åŠç»ˆææŠ€èƒ½å½’äºæ··æ²Œâ€”â€”å…¨å±å¼¹å¹•æ”»å‡»ï¼ˆè¡€é‡è¶Šä½ç¼ºå£è¶Šå°ï¼‰ã€‚ æœ€åï¼Œç¥æ‚¨åœ¨ Chip Tanks çš„ä¸–ç•Œä¸­æ­¦è¿æ˜Œéš†\n","date":"2026-02-12T18:23:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/chiptanks-%E7%8E%A9%E6%B3%95%E4%BB%8B%E7%BB%8D/","title":"ChipTanks-ç©æ³•ä»‹ç»"},{"content":"å‰è¨€ éå¸¸é€‚åˆé›†æˆå„ç±»åº“åå»é›•ç¢ï¼Œç»ƒä¹  C\u0026amp;C++æ··ç¼–å’Œè®¾è®¡æ¨¡å¼ï¼ŒC++åŠ¨æ€å†…å­˜åˆ†é…ç­‰ï¼Œå¾ˆçˆ½çš„ç»ƒæ‰‹é¡¹ç›®\nä»“åº“ï¼šNomadJoeviolet/ChipTanks: OLEDå±å¹•çš„Rouglikeå¼¹å¹•å°„å‡»æ¸¸æˆ\né¡¹ç›®ä»£ç çŠ¶å†µ\n1 2 3 4 5 6 7 8 9 10 11 12 13 Top-level groups: Bullet Raw= 378 NonEmpty= 304 Code= 266 Data Raw= 301 NonEmpty= 252 Code= 186 gameEntityManager.hpp Raw= 412 NonEmpty= 362 Code= 300 gamePerkCardManager.hpp Raw= 171 NonEmpty= 145 Code= 128 gameProgressManager.hpp Raw= 410 NonEmpty= 359 Code= 307 Peripheral Raw= 1624 NonEmpty= 1495 Code= 905 PerkCard Raw= 67 NonEmpty= 56 Code= 54 reload_new_delete.cpp Raw= 61 NonEmpty= 52 Code= 33 Role Raw= 3314 NonEmpty= 2865 Code= 2349 threads.cpp Raw= 259 NonEmpty= 219 Code= 140 Totals: RawLines=6997 NonEmptyLines=6109 CodeLines=4668 æ¸¸æˆè®¾è®¡ ç©æ³•ä»‹ç»ï¼šChipTanks-ç©æ³•ä»‹ç»\næ¸¸æˆè®¾è®¡ï¼šChipTanks-æ¸¸æˆè®¾è®¡\nç¡¬ä»¶é€‰å‹ ä½¿ç”¨çš„OLEDå±çš„æ˜¾ç¤ºé©±åŠ¨ä¸ºSSD1306 ä¸»æ§æ¿ä¸ºstm32f103c8t6 ä½¿ç”¨4 * 4 çŸ©é˜µé”®ç›˜\nå¼€å‘å·¥å…·é“¾ ä½¿ç”¨ VSCode+Intellisence+CubeMX+CMake+Ninja+arm-none-eabi+Ozone+Jlinkçš„é«˜è‡ªå®šä¹‰å¼€å‘å·¥å…·é“¾\nä»£ç ç¼–è¾‘å™¨é‡‡ç”¨VSCodeï¼Œè¯­è¨€æœåŠ¡å™¨ä½¿ç”¨VSCodeçš„Intellisenceæ¥å®ç°æ™ºèƒ½ä»£ç è¡¥å…¨å’Œç†è§£åŠŸèƒ½ï¼Œç”¨CubeMXç”Ÿæˆç¡¬ä»¶æŠ½è±¡å±‚ä»£ç ï¼ŒCMakeå’ŒNinjaä½œä¸ºé¡¹ç›®æ„å»ºå·¥å…·ï¼Œä½¿ç”¨arm-none-eabiç¼–è¯‘å™¨ï¼Œçƒ§å½•å’Œè°ƒè¯•ä½¿ç”¨Ozoneï¼Œç¡¬ä»¶çƒ§å½•å™¨ä½¿ç”¨Jlink\nCubeMXä½¿ç”¨çš„ç‰ˆæœ¬ä¸º6.15.0 CMakeä½¿ç”¨çš„ç‰ˆæœ¬ä¸º4.1.0 ç¼–è¯‘å™¨arm-none-eabiä½¿ç”¨çš„ç‰ˆæœ¬ä¸º14.3 rel1\nå¼€å‘æ–¹å¼é‡‡ç”¨C\u0026amp;C++æ··ç¼–ï¼Œä½¿ç”¨exter \u0026quot;C\u0026quot; { }è§£å†³C++åè¯ä¿®é¥°å¯¼è‡´Cæ— æ³•é“¾æ¥çš„é—®é¢˜ï¼Œextern \u0026quot;C\u0026quot;çš„ä½œç”¨å°±æ˜¯å‘Šè¯‰C++ç¼–è¯‘å™¨ä¿®æ”¹ç¬¦å·è¡¨ç”Ÿæˆæ–¹å¼ï¼Œå°†C++ç¬¦å·çš„ç”Ÿæˆæ–¹å¼æ¢æˆäº†çš„ç”Ÿæˆæ–¹å¼ã€‚\nå®è·µä¸Šå°†FreeRTOSçš„çº¿ç¨‹å‡½æ•°å…¥å£å£°æ˜ å®šä¹‰ä¸ºAs external\nç„¶ååœ¨cppæ–‡ä»¶ä¸­å»å®ç°ï¼Œå®ç°çš„å‡½æ•°ç”¨extern \u0026quot;C\u0026quot;åŒ…è£¹å³å¯ï¼Œè¿™æ ·void keyScanThread(void *argument)ç»è¿‡C++ç¼–è¯‘å™¨ç¼–è¯‘åçš„ç¬¦å·å°±å¯ä»¥è¢«Cé“¾æ¥\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 #ifdef __cplusplus extern \u0026#34;C\u0026#34; { #endif void keyScanThread(void *argument) { for(){ //... osDelay(10); } } #ifdef __cplusplus } #endif ç¬¬ä¸‰æ–¹åº“å¼•å…¥ å¼•å…¥FreeRTOSå’Œdspåº“ä»¥åŠetlåº“\nå¼•å…¥FreeRTOSç”¨æ¥å¤„ç†å¤šçº¿ç¨‹ä»»åŠ¡ï¼Œå¼•å…¥dspåº“ç”¨æ¥åŠ é€Ÿéƒ¨åˆ†è¿ç®—ï¼ˆä¸»è¦æƒ³ç”¨æ¥åŠ é€Ÿ æ¸¸æˆå®ä½“ ç¢°æ’æ£€æµ‹ï¼‰ï¼ˆå®é™…åŸºæœ¬ä¸Šæ²¡ç”¨ï¼Œå½“åšç»ƒæ‰‹äº†ï¼‰ï¼Œå¼•å…¥etlåº“æ¥åšåˆ° é›¶å¼€é”€çš„ä½¿ç”¨ C++ å®¹å™¨ æé«˜å¼€å‘æ•ˆç‡ï¼Œå…¶ç¡®å®šæ€§å†…å­˜ç®¡ç† (Deterministic Memory)åœ¨æ ˆä¸Šæˆ–é™æ€åŒºåˆ†é…å›ºå®šå¤§å°çš„å†…å­˜ï¼Œè€Œä¸æ˜¯åœ¨å †ä¸ŠåŠ¨æ€æ‰©å®¹ï¼Œèƒ½å®Œå…¨é¿å…äº†å†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œä¸”å†…å­˜å ç”¨åœ¨ç¼–è¯‘æœŸå°±æ˜¯å·²çŸ¥çš„ï¼Œéå¸¸é€‚åˆ RAM æœ‰é™çš„ STM32ï¼ŒåŒæ—¶æœ‰å®¹å™¨å»å®ç°è®¾è®¡æ¨¡å¼ç­‰ä¼šæ›´åŠ é«˜æ•ˆã€‚\nä»£ç å®ç° åŠ¨æ€å†…å­˜åˆ†é…åœ¨åµŒå…¥å¼å¹³å°ä¸Šçš„è§£å†³ å› åµŒå…¥å¼å¹³å°çš„å†…å­˜èµ„æºéå¸¸æœ‰é™ï¼ŒåŒæ—¶è¿˜è¦ä¿è¯FreeRTOSçš„çº¿ç¨‹å®‰å…¨ï¼Œéœ€è¦å¯¹C++çš„åŠ¨æ€å†…å­˜åˆ†é…ï¼ˆnewå’Œdeleteï¼‰è¿›è¡Œé‡è½½ï¼Œé‡è½½ä¸ºpvPortMalloc(size)å’ŒvPortFree(ptr)ï¼ŒFreeRTOSçº¿ç¨‹å®‰å…¨çš„åˆ†é…æ–¹å¼ï¼Œä»FreeRTOSçš„å †é‡Œé¢åˆ†é…\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 #include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; // pvPortMalloc and vPortFree are defined here #include \u0026lt;stddef.h\u0026gt; // Use C header for size_t in embedded environments void* operator new(size_t size) { void* ptr = pvPortMalloc(size); return ptr; } void operator delete(void* ptr) noexcept { if (ptr) { vPortFree(ptr); } } void* operator new[](size_t size) { void* ptr = pvPortMalloc(size); return ptr; } void operator delete[](void* ptr) noexcept { if (ptr) { vPortFree(ptr); } } void operator delete(void* ptr, size_t size) noexcept { (void)size; // The size parameter is often unused in custom deallocations. if (ptr) { vPortFree(ptr); } } void operator delete[](void* ptr, size_t size) noexcept { (void)size; if (ptr) { vPortFree(ptr); } } è¿™æ ·é‡è½½åï¼ŒåŠ¨æ€åˆ†é…çš„å†…å­˜ä¸ä¼šä» ç³»ç»Ÿå †é‡Œé¢åˆ†é…ï¼Œè€Œæ˜¯ä»FreeRTOSçš„ é™æ€ å †ï¼ˆå†…å­˜æ± ï¼‰ ï¼ˆæ­¤å¤„é™æ€æŒ‡ ç¼–è¯‘æœŸæœ€å¤§å®¹é‡ç¡®å®šï¼‰é‡Œé¢åˆ†é…ï¼Œä»è€Œé¿å…å¯èƒ½çš„å †æ ˆæº¢å‡ºï¼ŒFreeRTOSçš„å †æ ˆç®¡ç†æ–¹æ¡ˆé‡‡ç”¨ å®‰å…¨ ä¸” æœ‰é«˜æ•ˆå†…å­˜ç¢ç‰‡åŒ–å¤„ç† çš„heap4 å³å¯\nä¸ºä»€ä¹ˆä¸ä½¿ç”¨ç³»ç»Ÿå †ï¼Ÿ\nå› ä¸ºåœ¨åµŒå…¥å¼å®æ—¶æ“ä½œç³»ç»Ÿä¸­ï¼Œè°ƒç”¨Cæ ‡å‡†åº“ä¸­ malloc() å’Œ free() æ˜¯å±é™©çš„ï¼ŒC++ä¸­çš„ new å’Œ delete ä¹Ÿä¸€æ ·ï¼š è¿™äº›å‡½æ•°åœ¨å°å‹åµŒå…¥å¼ç³»ç»Ÿä¸­å¹¶ä¸æ€»æ˜¯å¯ç”¨çš„ï¼Œå°å‹åµŒå…¥å¼è®¾å¤‡ä¸­çš„RAMä¸è¶³ã€‚ å®ƒä»¬çš„å®ç°å¯èƒ½éå¸¸çš„å¤§ï¼Œå æ®äº†ç›¸å½“å¤§çš„ä¸€å—ä»£ç ç©ºé—´ã€‚ ä»–ä»¬å‡ ä¹éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å®ƒä»¬å¹¶ä¸æ˜¯ç¡®å®šçš„ï¼Œæ¯æ¬¡è°ƒç”¨è¿™äº›å‡½æ•°æ‰§è¡Œçš„æ—¶é—´å¯èƒ½éƒ½ä¸ä¸€æ ·ã€‚ å®ƒä»¬æœ‰å¯èƒ½äº§ç”Ÿå†…å­˜ç¢ç‰‡ã€‚ è¿™ä¸¤ä¸ªå‡½æ•°ä¼šä½¿å¾—é“¾æ¥å™¨é…ç½®å¾—å¤æ‚ã€‚ ç³»ç»Ÿå†…å­˜åˆ†é…\nç”±æ­¤å¯ä»¥ç›´æ¥çœ‹å‡ºé‡è½½ååŠ¨æ€å†…å­˜åˆ†é…å¯ä»¥ä¿è¯ç³»ç»Ÿæ ˆå’Œçº¿ç¨‹çš„å®‰å…¨\né¡¹ç›®æ–‡ä»¶ç»“æ„ æ•´ä½“ç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 ChipTanks/ â”œâ”€â”€ App/ // æ¸¸æˆåº”ç”¨é€»è¾‘å±‚ â”‚ â”œâ”€â”€ Bullet/ // å­å¼¹æ¨¡å— â”‚ â”œâ”€â”€ Data/ // åŸºç¡€æ•°æ®å®šä¹‰ â”‚ â”œâ”€â”€ Peripheral/ // å¤–è®¾é©±åŠ¨ï¼ˆOLED, KEYï¼‰ â”‚ â”œâ”€â”€ PerkCard/ // å¤©èµ‹å¡ç‰‡æ¨¡å— â”‚ â”œâ”€â”€ Role/ // è§’è‰²æ¨¡å—ï¼ˆç©å®¶ä¸æ•Œäººï¼‰ â”‚ â”œâ”€â”€ gameEntityManager.hpp // å®ä½“ç®¡ç†å™¨ â”‚ â”œâ”€â”€ gamePerkCardManager.hpp // Perkç®¡ç†å™¨ â”‚ â”œâ”€â”€ gameProgressManager.hpp // è¿›åº¦ç®¡ç†å™¨ â”‚ â”œâ”€â”€ reload_new_delete.cpp // å†…å­˜ç®¡ç†é‡è½½ â”‚ â””â”€â”€ threads.cpp // FreeRTOSä»»åŠ¡å®šä¹‰ â”œâ”€â”€ ChipTanksPic/ // é¡¹ç›®å›¾ç‰‡èµ„æºï¼ˆå¯èƒ½ä¸ºç©ºæˆ–å­˜æ”¾è®¾è®¡å›¾ï¼‰ â”œâ”€â”€ Core/ // STM32CubeMX ç”Ÿæˆçš„æ ¸å¿ƒä»£ç  â”‚ â”œâ”€â”€ Inc/ // æ ¸å¿ƒå¤´æ–‡ä»¶ (main.h, FreeRTOSConfig.h ç­‰) â”‚ â””â”€â”€ Src/ // æ ¸å¿ƒæºæ–‡ä»¶ (main.c, freertos.c, stm32f1xx_it.c ç­‰) â”œâ”€â”€ Drivers/ // ç¡¬ä»¶é©±åŠ¨åº“ â”‚ â”œâ”€â”€ CMSIS/ // ARM Cortex å¾®æ§åˆ¶å™¨è½¯ä»¶æ¥å£æ ‡å‡† â”‚ â”‚ â”œâ”€â”€ Core/ // æ ¸å¿ƒå¤–è®¾è®¿é—®å±‚ â”‚ â”‚ â”œâ”€â”€ DSP/ // æ•°å­—ä¿¡å·å¤„ç†åº“ (DSP Lib) â”‚ â”‚ â””â”€â”€ ... â”‚ â””â”€â”€ STM32F1xx_HAL_Driver/ // STM32F1ç³»åˆ— HAL åº“é©±åŠ¨ â”œâ”€â”€ Lib/ // ç¬¬ä¸‰æ–¹åº“ â”‚ â””â”€â”€ etl/ // Embedded Template Library (åµŒå…¥å¼æ¨¡æ¿åº“) â”œâ”€â”€ Middlewares/ // ä¸­é—´ä»¶ â”‚ â””â”€â”€ Third_Party/ â”‚ â””â”€â”€ FreeRTOS/ // FreeRTOS å®æ—¶æ“ä½œç³»ç»Ÿæºç  â”œâ”€â”€ build/ // ç¼–è¯‘è¾“å‡ºç›®å½• (Debug/Release) â”œâ”€â”€ cmake/ // CMake æ„å»ºè„šæœ¬ä¸å·¥å…·é“¾é…ç½® â”œâ”€â”€ CMakeLists.txt // é¡¹ç›®æ ¹ CMake é…ç½®æ–‡ä»¶ â””â”€â”€ STM32F103C8Tx_FLASH.ld // é“¾æ¥è„šæœ¬ Appç»“æ„ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 ChipTanks/App â”œâ”€â”€ gameEntityManager.hpp // æ¸¸æˆå®ä½“ç®¡ç†å™¨ï¼ˆç®¡ç†æ‰€æœ‰è§’è‰²å’Œå­å¼¹ï¼‰ â”œâ”€â”€ gamePerkCardManager.hpp // Perkå¡ç‰‡ç®¡ç†å™¨ï¼ˆç®¡ç†å‡çº§æŠ½å¡é€»è¾‘ï¼‰ â”œâ”€â”€ gameProgressManager.hpp // æ¸¸æˆè¿›åº¦ç®¡ç†å™¨ï¼ˆç®¡ç†å…³å¡æµç¨‹ï¼‰ â”œâ”€â”€ reload_new_delete.cpp // é‡è½½C++å†…å­˜åˆ†é…ï¼ˆé€‚é…FreeRTOSï¼‰ â”œâ”€â”€ threads.cpp // FreeRTOSä»»åŠ¡å®šä¹‰ä¸è°ƒåº¦ â”œâ”€â”€ Bullet/ // å­å¼¹æ¨¡å— â”‚ â”œâ”€â”€ bullet.cpp // å­å¼¹é€»è¾‘å®ç° â”‚ â””â”€â”€ bullet.hpp // å­å¼¹åŸºç±»ä¸æ´¾ç”Ÿç±»å®šä¹‰ â”œâ”€â”€ Data/ // æ•°æ®æ¨¡å— â”‚ â””â”€â”€ basicData.hpp // åŸºç¡€æ•°æ®ç»“æ„ä¸æšä¸¾å®šä¹‰ â”œâ”€â”€ Peripheral/ // å¤–è®¾é©±åŠ¨æ¨¡å— â”‚ â”œâ”€â”€ KEY/ â”‚ â”‚ â”œâ”€â”€ key.cpp // æŒ‰é”®æ‰«æå®ç° â”‚ â”‚ â””â”€â”€ key.hpp // æŒ‰é”®æ¥å£å®šä¹‰ â”‚ â””â”€â”€ OLED/ â”‚ â”œâ”€â”€ font.c // å­—åº“æ•°æ® â”‚ â”œâ”€â”€ font.h // å­—åº“å£°æ˜ â”‚ â”œâ”€â”€ oled.c // OLEDé©±åŠ¨å®ç° â”‚ â””â”€â”€ oled.h // OLEDæ¥å£å®šä¹‰ â”œâ”€â”€ PerkCard/ // å¤©èµ‹å¡ç‰‡æ¨¡å— â”‚ â””â”€â”€ prekCard.hpp // Perkå¡ç‰‡ç±»å®šä¹‰ â””â”€â”€ Role/ // è§’è‰²æ¨¡å— â”œâ”€â”€ enemyRole.cpp // æ•Œäººé€»è¾‘å®ç° â”œâ”€â”€ enemyRole.hpp // æ•Œäººæ´¾ç”Ÿç±»å®šä¹‰ â”œâ”€â”€ leadingrole.cpp // ä¸»è§’é€»è¾‘å®ç° â”œâ”€â”€ leadingRole.hpp // ä¸»è§’æ´¾ç”Ÿç±»å®šä¹‰ â”œâ”€â”€ role.cpp // è§’è‰²åŸºç±»é€»è¾‘å®ç° â””â”€â”€ role.hpp // è§’è‰²åŸºç±»å®šä¹‰ æ¶æ„ä¸è®¾è®¡æ€è·¯ ä¸»è¦é‡‡ç”¨ é¢å‘å¯¹è±¡ï¼ˆOOPï¼‰ çš„è®¾è®¡æ€è·¯ï¼Œç»“åˆFreeRTOSå®æ—¶æ“ä½œç³»ç»Ÿï¼Œæ„å»ºç®€å•çš„åµŒå…¥å¼æ¸¸æˆæ¡†æ¶ã€‚\nä¸»è¦åˆ†ä¸º5å„å±‚çº§ï¼š\nç¡¬ä»¶æŠ½è±¡å±‚ï¼šåŸºäºHALåº“çš„å¯¹åº•å±‚ç¡¬ä»¶çš„æŠ½è±¡ï¼Œå¯¹å¤–è®¾ç¡¬ä»¶æ“ä½œè¿›è¡Œå†æ¬¡å°è£… æ ¸å¿ƒæ•°æ®å±‚ï¼ˆDataï¼‰ï¼šå®šä¹‰æ¸¸æˆé€šç”¨çš„æ•°æ®ç»“æ„å’Œæšä¸¾ æ¸¸æˆå®ä½“å±‚ï¼ˆEntity/Roleï¼‰ï¼šå®šä¹‰è§’è‰²(Role)åŸºç±»å’Œå­å¼¹(Bullet)åŸºç±» åŠå…¶æ´¾ç”Ÿç±» ç®¡ç†å™¨å±‚ï¼ˆManagerï¼‰ï¼šè´Ÿè´£å®ä½“ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œç¢°æ’æ£€æµ‹ï¼Œè¿›åº¦æ§åˆ¶å’ŒPerkSelectionç³»ç»Ÿ åº”ç”¨é€»è¾‘å±‚ï¼ˆApp Logicï¼‰ï¼šå¤šçº¿ç¨‹ä»»åŠ¡å¤„ç†ï¼Œæ¸¸æˆä¸šåŠ¡é€»è¾‘ ç¡¬ä»¶æŠ½è±¡å±‚ åœ¨HALåº“åŸºç¡€ä¸Šï¼Œå¯¹å¤–è®¾è¿›è¡Œé¢å‘å¯¹è±¡çš„è¿›ä¸€æ­¥å°è£…\nOLED(ä½¿ç”¨çš„keyskingçš„å¼€æºåº“): æä¾›OLED_DrawImageï¼ŒOLED_PrintString ç­‰ç»˜å›¾ APIã€‚ åŒ…å«å­—åº“ (font.c)ï¼Œæ”¯æŒæ–‡æœ¬æ˜¾ç¤ºã€‚ ä½œä¸ºæ¸¸æˆçš„è¾“å‡ºè®¾å¤‡ï¼Œè´Ÿè´£å°†æ¸¸æˆçŠ¶æ€å¯è§†åŒ–ã€‚ KEY: æä¾›æŒ‰é”®æ‰«æé€»è¾‘ã€‚ ä½œä¸ºæ¸¸æˆçš„è¾“å…¥è®¾å¤‡ï¼Œå°†ç‰©ç†æŒ‰é”®æ˜ å°„ä¸ºæ¸¸æˆå†…çš„æ§åˆ¶ä¿¡å·\næ ¸å¿ƒæ•°æ®å±‚ å®šä¹‰äº†æ‰€æœ‰æ¸¸æˆå®ä½“å…±ç”¨çš„æ•°æ®ç»“æ„ï¼Œå¦‚Â HealthDataï¼ˆè¡€é‡ï¼‰ã€AttackDataï¼ˆæ”»å‡»ï¼‰ã€SpatialDataï¼ˆä½ç½®ä¸å¤§å°ï¼‰ã€HeatDataï¼ˆçƒ­é‡ï¼‰ç­‰ã€‚ ä½¿ç”¨Â structÂ ç»„åˆæ•°æ®ï¼Œä¾¿äºåœ¨ä¸åŒç±»ä¹‹é—´ä¼ é€’å’Œç®¡ç†çŠ¶æ€ã€‚ å®šä¹‰äº†Â RoleIdentityï¼ˆèº«ä»½ï¼‰ã€ï¼ˆå­å¼¹ç±»å‹ï¼‰ç­‰å…³é”®æšä¸¾ã€‚\næ¸¸æˆå®ä½“å±‚ è¿™æ˜¯æ¸¸æˆé€»è¾‘çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œé‡‡ç”¨äº†ç»§æ‰¿ä¸å¤šæ€çš„è®¾è®¡ã€‚\nåŸºç±»è®¾è®¡: IRoleÂ ï¼ˆrole.hppï¼‰: æ‰€æœ‰è§’è‰²ï¼ˆç©å®¶å’Œæ•Œäººï¼‰çš„åŸºç±»ã€‚åŒ…å«Â RoleDataÂ æŒ‡é’ˆï¼Œç®¡ç†è§’è‰²çš„æ‰€æœ‰å±æ€§ã€‚ å®šä¹‰äº†è™šå‡½æ•°æ¥å£ï¼šinit(),Â think(),Â doAction(),Â drawRole(),Â die(),Â shoot()ã€‚ å®ç°äº†é€šç”¨çš„ç‰©ç†é€»è¾‘ï¼šmove()ï¼ˆç§»åŠ¨ä¸è¾¹ç•Œæ£€æŸ¥ï¼‰ã€update()ï¼ˆçŠ¶æ€æ›´æ–°ï¼‰ã€createBullet()ã€‚\nIBulletÂ (bullet.hpp): æ‰€æœ‰å­å¼¹çš„åŸºç±»ã€‚ å®šä¹‰äº†Â move(),Â update(),Â drawBullet(),Â die()Â ç­‰æ¥å£ã€‚\næ´¾ç”Ÿç±»è®¾è®¡: LeadingRoleÂ (leadingRole.cpp): ç©å®¶æ§åˆ¶çš„ä¸»è§’ã€‚ å®ç°äº†å¤æ‚çš„å‡çº§é€»è¾‘ (levelUp)ã€çƒ­é‡æ§åˆ¶å’Œå¤šæ­¦å™¨åˆ‡æ¢ã€‚ å•ä¾‹æ¨¡å¼æˆ–å…¨å±€å¯¹è±¡ç®¡ç†ï¼ˆé€šå¸¸ä½œä¸ºå”¯ä¸€ä¸»è§’å­˜åœ¨ï¼‰ã€‚\nEnemyRoleÂ (enemyRole.hpp): å„ç§æ•Œäººçš„å®ç°ã€‚ FeilianEnemy: é«˜é€Ÿéªšæ‰°å‹ï¼Œåªå‘æ™®é€šå¼¹ã€‚ TaotieEnemyÂ (BOSS): çŠ¶æ€æœºæ§åˆ¶çš„å¤æ‚è¡Œä¸ºï¼ˆåå™¬ã€å†²æ’ï¼‰ã€‚ XiangliuEnemyÂ (BOSS): å¬å”¤ä¸å…¨å±å¼¹å¹•ã€‚\nBasicBulletÂ /Â FireBallBulletÂ /Â LightningLineBullet: ä¸åŒç±»å‹çš„å­å¼¹å®ç°ï¼Œå…·æœ‰ä¸åŒçš„ä¼¤å®³é€»è¾‘å’Œç‰¹æ•ˆã€‚\nç®¡ç†å™¨å±‚ 1.GameEntityManager (gameEntityManager.hpp): æ ¸å¿ƒèŒè´£: ç»´æŠ¤æ‰€æœ‰æ´»è·ƒçš„è§’è‰²å’Œå­å¼¹å®¹å™¨ï¼Œä½¿ç”¨å›ºå®šå®¹é‡çš„åµŒå…¥å¼å‘é‡ã€‚åŒ…å«è§’è‰²æ± ï¼ˆæœ€å¤š20ä¸ªï¼‰å’Œå­å¼¹æ± ï¼ˆæœ€å¤š100ä¸ªï¼‰ï¼Œä»¥åŠæ¸¸æˆç»“æŸæ ‡è®°ã€‚æä¾›æ³¨å†Œæ–°å¢å®ä½“ã€åˆ†é˜¶æ®µçš„è¡Œä¸ºä¸çŠ¶æ€æ›´æ–°ã€ç¢°æ’ä¸èŒƒå›´ä¼¤å®³æ£€æµ‹ã€ç»Ÿä¸€æ¸²æŸ“ã€å¤±æ•ˆå®ä½“æ¸…ç†ã€è·å–ä¸»è§’æŒ‡é’ˆå’Œç»éªŒæŠ•é€’ç­‰åŠŸèƒ½ã€‚è¡Œä¸ºä¸çŠ¶æ€åˆ†ç¦»ï¼Œæ›´æ–°é¡ºåºé€šå¸¸ä¸ºï¼šè§’è‰²è¡Œä¸ºã€å­å¼¹è¡Œä¸ºã€è§’è‰²çŠ¶æ€ã€å­å¼¹çŠ¶æ€ã€æ¸…ç†ã€æ¸²æŸ“ã€‚ç¢°æ’ä½¿ç”¨è½´å¯¹é½åŒ…å›´ç›’ï¼Œå­å¼¹ç¢°æ’å…è®¸ç©¿é€ï¼›èŒƒå›´ä¼¤å®³ä½¿ç”¨åœ†å½¢è·ç¦»åˆ¤å®šã€‚æ‰€æœ‰å®¹å™¨æ“ä½œä½¿ç”¨ä¸´ç•ŒåŒºä¿æŠ¤ä»¥ç¡®ä¿ä¸€è‡´æ€§ã€‚\n1 2 etl::vector\u0026lt;IRole *, 20\u0026gt; m_roles; //è§’è‰²æ± ï¼Œå­˜æ”¾æ‰€æœ‰è§’è‰²æŒ‡é’ˆ etl::vector\u0026lt;IBullet *, 100\u0026gt; m_bullets; //å­å¼¹æ± ï¼Œå­˜æ”¾æ‰€æœ‰å­å¼¹æŒ‡é’ˆ åŠŸèƒ½:\naddRole(), addBullet(): æ³¨å†Œæ–°å®ä½“ã€‚ updateAllRolesActions(): æ¯å¸§è°ƒç”¨æ‰€æœ‰è§’è‰²çš„ doAction()ã€‚ updateAllRolesState()ï¼šæ¯å¸§è°ƒç”¨æ‰€æœ‰è§’è‰²çš„ update()ã€‚ checkxxxxCollision(): è¿›è¡Œç¢°æ’æ£€æµ‹ï¼ˆAABB ç¢°æ’ç›’ï¼‰ï¼Œå¤„ç†ä¼¤å®³ç»“ç®—ã€‚ drawAllRoles()å’ŒdrawAllBullets: ç»Ÿä¸€æ¸²æŸ“æ‰€æœ‰å®ä½“ã€‚ cleanUpInvalidRoles()å’ŒcleanupInvalidBullets(): å›æ”¶éæ´»è·ƒå®ä½“çš„å†…å­˜ï¼Œå¤„ç†ä¸»è§’ç»éªŒå€¼è·å–ã€‚ getPlayerRole()ï¼šè·å–ä¸»è§’çš„æŒ‡é’ˆ 2.GamePerkCardManagerÂ (gamePerkCardManager.hpp) æ ¸å¿ƒèŒè´£ï¼š ç®¡ç† Rogue-like çš„éšæœºå¼ºåŒ–æµç¨‹ï¼ŒåŒ…æ‹¬å¡ç‰‡ä»“åº“ç®¡ç†ã€æŠ½å–å¾…é€‰å¡ã€é€‰æ‹©åº”ç”¨ä»¥åŠæœªé€‰å¡å›åº“ã€‚ä½¿ç”¨ä¸¤ä¸ªå›ºå®šå®¹é‡çš„åµŒå…¥å¼å‘é‡å­˜å‚¨å¡ç‰‡ä»“åº“ä¸é€‰å¡æ§½ï¼Œå¹¶ç»´æŠ¤é€‰å¡çŠ¶æ€ã€é€‰ä¸­ç´¢å¼•ä¸æ•°é‡ã€‚åˆå§‹åŒ–æ—¶æŒ‰é…ç½®è¡¨ç”Ÿæˆå¡ç‰‡ï¼›è§¦å‘é€‰å¡ä¼šéšæœºæŠ½å–æœ€å¤šä¸‰å¼ å¹¶è¿›å…¥é€‰å¡çŠ¶æ€ï¼›é€‰æ‹©åå°†æ•ˆæœåº”ç”¨åˆ°ç©å®¶ï¼ˆå¦‚æé«˜ç”Ÿå‘½ã€æ”»å‡»ã€æ”»é€Ÿã€ç§»åŠ¨é€Ÿåº¦ã€æ•£çƒ­æ•ˆç‡ï¼Œæˆ–è§£é”ç«çƒä¸é—ªç”µï¼Œæˆ–æå‡èŒƒå›´ä¸ä¼¤å®³å€ç‡ï¼‰ï¼Œéšåå°†æœªé€‰å¡é€€å›ä»“åº“å¹¶é€€å‡ºé€‰å¡çŠ¶æ€ã€‚é€‰å¡ç•Œé¢æ˜¾ç¤ºå¡åå¹¶æœ‰é€‰ä¸­æŒ‡ç¤ºå™¨ã€‚\n1 2 etl::vector\u0026lt;PerkCard, MAX_CARD_COUNT\u0026gt; m_cardWarehouse; // å¡ç‰‡ä»“åº“ï¼ˆå­˜æ‰€æœ‰å¡ç‰‡ï¼‰ etl::vector\u0026lt;PerkCard, SELECTION_SLOT_COUNT\u0026gt; m_selectionSlots; // é€‰å¡æ§½ï¼ˆä¸´æ—¶å­˜3å¼ å¾…é€‰ï¼‰ åŠŸèƒ½\ninitWarehouse()ï¼šåˆå§‹åŒ–å¡ç‰‡ä»“åº“ triggerPerkSelection()ï¼šè§¦å‘PerkSelection selectCardï¼šé€‰æ‹©å¡ç‰‡ï¼ŒåŒæ—¶å°†å¡ç‰‡æ•ˆæœåº”ç”¨ drawSelectionUIï¼šç»˜åˆ¶é€‰å¡ç•Œé¢çš„UI 3.GameProgressManagerÂ (gameProgressManager.hpp) æ ¸å¿ƒèŒè´£ï¼š æ§åˆ¶æ¸¸æˆæ•´ä½“æµç¨‹ï¼ŒåŒ…æ‹¬å…³å¡æ¨è¿›ã€æ³¢æ¬¡åˆ·æ–°ã€Boss è§¦å‘ä¸å±•ç¤ºã€èƒœåˆ©/å¤±è´¥åˆ¤å®šï¼Œä»¥åŠå¼€åœº/é€šå…³/è­¦å‘Šç­‰è¿‡åœºçš„å±•ç¤ºä¸è®¡æ—¶ã€‚ä¸å®ä½“ç®¡ç†å™¨å’Œå¡ç‰‡ç®¡ç†å™¨åä½œï¼Œé©±åŠ¨æ¯ä¸€æ³¢æ•Œäººç”Ÿæˆä¸é€‰å¡èŠ‚ç‚¹çš„è§¦å‘ã€‚ åŠŸèƒ½\nresetGameProgress()ï¼šé‡ç½®æ•´å±€æµç¨‹ï¼Œåˆ›å»ºç©å®¶å®ä½“å¹¶åŠ å…¥å®ä½“ç®¡ç†å™¨ï¼Œåˆå§‹åŒ–å¡ç‰‡ç®¡ç†å™¨ä»“åº“ updateGameProgress()ï¼šæ¨è¿›æ³¢æ¬¡/å…³å¡ä¸é€‰å¡è§¦å‘ï¼Œç‰¹å®šæ¡ä»¶è°ƒç”¨Â AddWaveEnemies()Â ç”Ÿæˆæ–°çš„ä¸€æ³¢æ•Œäºº AddWaveEnemies()ï¼šæ ¹æ®å½“å‰å…³å¡ä¸æ³¢æ¬¡ç”Ÿæˆæ•Œäººé˜µå‹æˆ– Boss drawOpeningCG()ï¼šç»˜åˆ¶å¼€åœºè¿‡åœºåŠ¨ç”» drawClearCG()ï¼šç»˜åˆ¶é€šå…³åŠ¨ç”» drawShowBoss()ï¼šç»˜åˆ¶ Boss æµ·æŠ¥æˆ–æŒ‘æˆ˜è­¦å‘Š åº”ç”¨é€»è¾‘å±‚ threads.cpp: æœ‰ä¸‰ä¸ªæ ¸å¿ƒä»»åŠ¡çº¿ç¨‹æ¥é©±åŠ¨æ•´ä½“é€»è¾‘\noledTaskThread: è´Ÿè´£æ¸²æŸ“æ—¶åºã€‚æ ¹æ®çŠ¶æ€ï¼ˆå¼€åœºã€é€šå…³ã€Boss å±•ç¤ºã€é€‰å¡ã€æ­£å¸¸æˆ˜æ–—ï¼‰é€‰æ‹©å¯¹åº”ç»˜åˆ¶è·¯å¾„ï¼›æœ€ç»ˆè¾“å‡ºå¸§å¹¶æ§åˆ¶åˆ·æ–°é¢‘ç‡ã€‚ keyScanThread: è´Ÿè´£è¾“å…¥é‡‡é›†ä¸åˆ†å‘ã€‚éé€‰å¡çŠ¶æ€ä¸‹æ›´æ–°ç©å®¶åŠ¨ä½œï¼ˆä¸Šä¸‹å·¦å³ï¼‰ï¼›é€‰å¡çŠ¶æ€ä¸‹ç§»åŠ¨ UI å…‰æ ‡å¹¶æ‰§è¡Œé€‰ä¸­æ“ä½œï¼›æ ¹æ®æ¸¸æˆ/è¿‡åœºçŠ¶æ€å†³å®šæ˜¯å¦å“åº”æŒ‰é”®ã€‚ gameControlThread: è´Ÿè´£ä¸»æ§æµç¨‹ä¸æ ¸å¿ƒæ—¶åºã€‚Game Over æ—¶é‡ç½®æ¸¸æˆï¼›æ­£å¸¸çŠ¶æ€ä¸‹åœ¨éé€‰å¡ä¸éè¿‡åœºæ—¶æ¨è¿›è¿›åº¦ã€æ‰§è¡Œå®ä½“è¡Œä¸ºä¸çŠ¶æ€æ›´æ–°ã€æ¸…ç†æ— æ•ˆå®ä½“ã€‚\nå„å±‚çº§å’ŒåŠŸèƒ½çš„ä»£ç å®ç°ä¸è§£æ ç¡¬ä»¶æŠ½è±¡å±‚ KEY å½“å‰æŒ‰é”®é‡‡ç”¨â€œå·¦å³å„ 4 ç‹¬ç«‹é”®ï¼Œä½ç”µå¹³æŒ‰ä¸‹â€æ–¹æ¡ˆï¼Œä¸å†æ˜¯ 4x4 çŸ©é˜µã€‚CubeMX å·²å°†å¼•è„šé…ç½®ä¸ºä¸Šæ‹‰è¾“å…¥ï¼Œæ‰«æç›´æ¥è¯»ç”µå¹³å³å¯ã€‚å·¦å³å„æœ‰ç‹¬ç«‹çŠ¶æ€ç¼“å­˜ï¼Œæ–¹å‘æšä¸¾åœ¨ä¸Šå±‚åšæ˜ å°„ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 #ifndef KEY_HPP #define KEY_HPP #include \u0026#34;gpio.h\u0026#34; typedef struct { GPIO_TypeDef* GPIOx; uint16_t GPIO_Pin; } KeyGPIO; enum class LeftKeyState { KEY_DOWN = 0, KEY_UP = 1, KEY_RIGHT= 2, KEY_LEFT = 3 }; enum class RightKeyState { KEY_DOWN = 0, KEY_LEFT = 1, KEY_RIGHT= 2, KEY_UP = 3 }; class Key { public: uint8_t m_leftKeyButton[4] = {0}; // å·¦æ‰‹4é”®ï¼Œä½ç”µå¹³æŒ‰ä¸‹ uint8_t m_rightKeyButton[4] = {0}; // å³æ‰‹4é”®ï¼Œä½ç”µå¹³æŒ‰ä¸‹ KeyGPIO* m_rightInput = nullptr; KeyGPIO* m_leftInput = nullptr; public: Key(KeyGPIO* rightInput, KeyGPIO* leftInput) : m_rightInput(rightInput), m_leftInput(leftInput) {} ~Key() {}; void init() { // å¼•è„šå·²åœ¨ MX_GPIO_Init é…ä¸ºä¸Šæ‹‰è¾“å…¥ï¼Œæ— éœ€é‡å¤é…ç½® } void scan() { for (uint8_t i = 0; i \u0026lt; 4; i++) { m_rightKeyButton[i] = (HAL_GPIO_ReadPin(m_rightInput[i].GPIOx, m_rightInput[i].GPIO_Pin) == GPIO_PIN_RESET); } for (uint8_t i = 0; i \u0026lt; 4; i++) { m_leftKeyButton[i] = (HAL_GPIO_ReadPin(m_leftInput[i].GPIOx, m_leftInput[i].GPIO_Pin) == GPIO_PIN_RESET); } } }; extern Key key; #endif // KEY_HPP 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 #include \u0026#34;key.hpp\u0026#34; KeyGPIO keyRightOutput[4] = { {KEY_R1_GPIO_Port, KEY_R1_Pin}, {KEY_R2_GPIO_Port, KEY_R2_Pin}, {KEY_R3_GPIO_Port, KEY_R3_Pin}, {KEY_R4_GPIO_Port, KEY_R4_Pin} }; KeyGPIO keyLeftInput[4] = { {KEY_C1_GPIO_Port, KEY_C1_Pin}, {KEY_C2_GPIO_Port, KEY_C2_Pin}, {KEY_C3_GPIO_Port, KEY_C3_Pin}, {KEY_C4_GPIO_Port, KEY_C4_Pin} }; Key key(keyRightOutput, keyLeftInput); OLED ä½¿ç”¨çš„æ˜¯keyskingçš„å¼€æºï¼Œè¯¥ä»£ç ä¸­æä¾›OLEDçš„é©±åŠ¨å’Œç»˜ç”»æ¸²æŸ“çš„APIï¼Œç›´æ¥ä½¿ç”¨å³å¯\næ ¸å¿ƒæ•°æ®å±‚ æ¦‚è§ˆ å®šä¹‰äº†æ¸¸æˆæ‰€éœ€çš„åŸºç¡€æ•°æ®ç±»å‹ï¼šèº«ä»½ã€å­å¼¹ç±»å‹ã€åŠ¨ä½œ/ç§»åŠ¨/æ”»å‡»/æ­»äº¡/ç©ºé—´ç­‰æ•°æ®ç»“æ„ï¼Œä»¥åŠè§’è‰²ä¸å­å¼¹çš„æ•°æ®èšåˆä½“ã€‚ â€œçº¯æ•°æ®è½½ä½“â€ï¼Œä¸å«è¡Œä¸ºæ–¹æ³•ï¼›è¡Œä¸ºç”±ä¸Šå±‚å®ä½“ç±»ä¸ç®¡ç†å™¨é©±åŠ¨ã€‚ æ—¶é—´ä¸æ•°å€¼å•ä½é‡‡ç”¨â€œæ¯«ç§’ + å°æ•´å‹â€ä¸ºä¸»ï¼Œæ»¡è¶³åµŒå…¥å¼ MCU èµ„æºçº¦æŸã€‚ æšä¸¾ç±»å‹ RoleIdentity: æ ‡è¯†é˜µè¥ä¸èº«ä»½ï¼ˆUNKNOWN/ENEMY/Playerï¼‰ã€‚ç”¨äºä¼¤å®³äº’æ–¥ã€ç»éªŒç»“ç®—ç­‰ã€‚\n1 2 3 4 5 enum class RoleIdentity { UNKNOWN = 0, ENEMY = 1, Player = 2, }; BulletType: å­å¼¹ç§ç±»ï¼ˆBASIC/FIRE_BALL/LIGHTNING_LINEï¼‰ã€‚å½±å“ç¢° æ’ã€ç©¿è¶Šã€èŒƒå›´ä¸å€ç‡ç­‰æœŸæœ›è¡Œä¸ºã€‚\n1 2 3 4 5 enum class BulletType { BASIC = 0, FIRE_BALL = 1, LIGHTNING_LINE = 2, }; ActionState: åŠ¨ä½œæ€ï¼ˆIDLE/MOVING/ATTACKINGï¼‰ã€‚ç”±è¾“å…¥æˆ– AI æ§åˆ¶ï¼Œé©±åŠ¨ç§»åŠ¨/æ”»å‡»å†³ç­–ã€‚\n1 enum class ActionState { IDLE = 0, MOVING = 1, ATTACKING = 2 }; AttackMode: é¢„ç•™çš„æ”»å‡»å½¢æ€æšä¸¾ï¼ˆMODE_1â€¦MODE_6ï¼‰ï¼Œå¯ç”¨äºå¤šæ®µæˆ–å¤šå¼æ”»å‡»åˆ‡æ¢ã€‚\n1 enum class AttackMode { NONE = 0, MODE_1 = 1, MODE_2 = 2, MODE_3 = 3 , MODE_4 = 4 , MODE_5 = 5 , MODE_6 = 6 }; MoveMode: ç§»åŠ¨æ–¹å‘ï¼ˆNONE/UP/DOWN/LEFT/RIGHTï¼‰ã€‚ CollisionDirection: ç¢°æ’æ–¹å‘ï¼ˆNONE/LEFT/RIGHT/UP/DOWNï¼‰ï¼Œä¾›çŠ¶æ€å“åº”/å›é€€ä½¿ç”¨ã€‚\n1 enum class MoveMode { NONE = 0, UP = 1, DOWN = 2, LEFT = 3, RIGHT = 4 }; HeatDataï¼ˆçƒ­é‡æ•°æ®ï¼‰ å˜é‡ï¼šcurrentHeatï¼ŒmaxHeatï¼ŒheatCoolDownRateï¼ŒheatCoolDownTimerï¼ŒheatPerShotã€‚ æ„é€ ï¼šå¯ç”¨æ„é€ å‡½æ•°è®¾ç½®â€œåˆå€¼ã€ä¸Šé™ã€å†·å´é€Ÿç‡ã€æ¯æªå¢é‡â€ã€‚é»˜è®¤ä¸æ˜¾å¼åˆå§‹åŒ–Â heatCoolDownTimerï¼ˆä¿æŒ 0 å³å¯ï¼‰ã€‚ ç”¨æ³•ï¼šå¼€ç«å‰æ£€æŸ¥Â currentHeat + heatPerShot \u0026lt;= maxHeatï¼›æ¯å¸§/æ¯å‘¨æœŸæŒ‰Â heatCoolDownRateÂ é™æ¸©ï¼ˆå—Â heatCoolDownTimerÂ å’ŒèŠ‚æ‹æ§åˆ¶ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 class HeatData { public: uint8_t currentHeat{}; uint8_t maxHeat{}; uint8_t heatCoolDownRate{}; uint8_t heatCoolDownTimer{}; uint8_t heatPerShot{}; public: HeatData() = default; HeatData(uint8_t current, uint8_t max, uint8_t coolDownRate, uint8_t perShot) : currentHeat(current) , maxHeat(max) , heatCoolDownRate(coolDownRate) , heatPerShot(perShot) { } }; HealthDataï¼ˆç”Ÿå‘½ä¸å›å¤ï¼‰ å˜é‡ï¼šcurrentHealthï¼ŒmaxHealthï¼ŒhealValueï¼ŒhealTimeCounterï¼ŒhealResetTimeï¼ŒhealSpeedã€‚ è¯­ä¹‰ï¼šæ¯Â healResetTime / healSpeedÂ æ¯«ç§’å›å¤Â healValueÂ ç‚¹ï¼›healTimeCounterÂ ä¸ºå†…éƒ¨ç´¯åŠ è®¡æ—¶ã€‚ é»˜è®¤å€¼ï¼šæœ€å¤§/å½“å‰ 100ï¼ŒhealValue=3ï¼ŒhealResetTime=15000msï¼ŒhealSpeed=5ï¼ˆç­‰æ•ˆæ›´é«˜é¢‘ç‡ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 // è¡€é‡æ•°æ®ç»“æ„ä½“ // æ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨å›å¤ä¸€å®šé‡çš„è¡€é‡ // æ¯ healResetTime/healSpeed æ¯«ç§’å›å¤ healValue ç‚¹è¡€é‡ class HealthData { public: uint16_t currentHealth{}; uint16_t maxHealth{}; uint8_t healValue = 3; uint16_t healTimeCounter = 0; uint16_t healResetTime = 15000; uint8_t healSpeed = 5; }; SpatialMovementDataï¼ˆç©ºé—´ä¸ç§»åŠ¨ï¼‰ å˜é‡ï¼šcanCrossBorderï¼ŒconsecutiveCollisionCountï¼ŒmoveSpeedï¼ˆint8ï¼‰ï¼ŒcurrentPosX/Yï¼ŒrefPosX/Yï¼ŒsizeX/Yã€‚ æ„é€ ï¼šå¯ä¸€æ¬¡æ€§è®¾ç½®â€œæ˜¯å¦å¯è¶Šç•Œã€é€Ÿåº¦ã€å½“å‰ä½ç½®/å‚è€ƒä½ç½®ã€å°ºå¯¸â€ã€‚ è¯­ä¹‰ï¼š currentPosï¼šå®é™…æ˜¾ç¤º/ç¢°æ’åçš„ç”Ÿæ•ˆä½ç½®ã€‚ refPosï¼šé¢„æœŸä½ç½®ï¼ˆç”¨äºå…ˆè®¡ç®—å†åšç¢°æ’å›é€€ï¼‰ã€‚ consecutiveCollisionCountï¼šè¿ç»­ç¢°æ’è®¡æ•°ï¼Œå¯ç”¨äºå¡è¾¹/å¼¹è·³ç­‰å¤„ç†ã€‚ canCrossBorderï¼šæ˜¯å¦å…è®¸è¶Šç•Œé£è¡Œï¼ˆé—ªç”µçº¿ä¹‹ç±»ç‰¹ç§å¼¹å¯å¼€å¯ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 /** * @brief ç©ºé—´ç§»åŠ¨æ•°æ®ç»“æ„ä½“ * @note åŒ…å«ä½ç½®å°ºå¯¸å’Œç§»åŠ¨é€Ÿåº¦ * @param moveSpeed ç§»åŠ¨é€Ÿåº¦ * @param currentPosX åˆå§‹Xä½ç½®ï¼Œæ˜¯ç‰©ä½“å·¦ä¸Šè§’çš„Xåæ ‡ * @param currentPosY åˆå§‹Yä½ç½®ï¼Œæ˜¯ç‰©ä½“å·¦ä¸Šè§’çš„Yåæ ‡ * @param refPosX å‚è€ƒXä½ç½®ï¼Œç”¨äºç¢°æ’æ£€æµ‹åçš„å›é€€ * @param refPosY å‚è€ƒYä½ç½®ï¼Œç”¨äºç¢°æ’æ£€æµ‹åçš„å›é€€ * @param sizeX å®½åº¦ * @param sizeY é«˜åº¦ */ class SpatialMovementData { public: //èƒ½å¦ç©¿è¶Šè¾¹ç•Œ bool canCrossBorder = false; //è¿ç»­è§¦å‘ç¢°æ’æ¬¡æ•°ï¼ˆç”¨æ¥ç¢°æ’æ£€æµ‹åçš„å¤„ç†ï¼‰ uint8_t consecutiveCollisionCount = 0; //ç§»åŠ¨é€Ÿåº¦ int8_t moveSpeed{}; //ä½ç½®å°ºå¯¸ int16_t currentPosX{}; int16_t currentPosY{}; int16_t refPosX{}; int16_t refPosY{}; uint8_t sizeX{}; uint8_t sizeY{}; public: SpatialMovementData() = default; /** * @brief æ„é€ å‡½æ•° * @param speed ç§»åŠ¨é€Ÿåº¦ï¼Œå¯ä»¥å–è´Ÿå€¼è¡¨ç¤ºåæ–¹å‘ç§»åŠ¨ * @param currentPosX ç°åœ¨Xä½ç½® * @param currentPosY ç°åœ¨Yä½ç½® * @param refPosX æœŸæœ›Xä½ç½® * @param refPosY æœŸæœ›Yä½ç½® * @param sx å®½åº¦ * @param sy é«˜åº¦ */ SpatialMovementData( bool canCrossBorder, int8_t speed, uint8_t currentPosX, uint8_t currentPosY, uint8_t refPosX, uint8_t refPosY, uint8_t sx, uint8_t sy ) : canCrossBorder(canCrossBorder) , moveSpeed(speed) , currentPosX(currentPosX) , currentPosY(currentPosY) , refPosX(refPosX) , refPosY(refPosY) , sizeX(sx) , sizeY(sy) { } }; RoleAttackDataï¼ˆæ”»å‡»å‚æ•°ï¼‰ å­—æ®µï¼šshootSpeedï¼ŒshootCooldownTimerï¼ŒshootCooldownResetTimeï¼ŒshootCooldownSpeedï¼ŒattackPowerï¼ŒcollisionPowerï¼ŒbulletSpeedï¼ŒbulletRangeï¼ŒbulletDamageMultiplierã€‚ è¯­ä¹‰ï¼š å†·å´ä½“ç³»ï¼šå¼€ç«å°†Â shootCooldownTimerÂ ç½®ä¸ºÂ shootCooldownResetTimeï¼ŒéšåæŒ‰å¸§å‡é€Ÿï¼ˆå—Â shootCooldownSpeedÂ å½±å“ï¼‰ï¼›è®¡æ—¶è‡³ 0 æ‰å¯å†å¼€ç«ã€‚ attackPowerï¼šå­å¼¹/æŠ€èƒ½çš„åŸºç¡€ä¼¤å®³ã€‚ collisionPowerï¼šå®ä½“ä½“æ’é€ æˆçš„ä¼¤å®³ã€‚ bulletSpeed/bulletRange/bulletDamageMultiplierï¼šå­å¼¹é£è¡Œé€Ÿåº¦ã€èŒƒå›´ï¼ˆç«çƒç±»æœ‰æ•ˆï¼‰ã€ä¼¤å®³å€ç‡ï¼ˆé—ªç”µé“¾ç±»æœ‰æ•ˆï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 class RoleAttackData { public: //æ”»å‡»é€Ÿåº¦ uint8_t shootSpeed; uint16_t shootCooldownTimer; uint16_t shootCooldownResetTime; uint8_t shootCooldownSpeed; //æ”»å‡»åŠ› uint8_t attackPower; uint8_t collisionPower; //å­å¼¹é€Ÿåº¦ int8_t bulletSpeed; //å­å¼¹ä¼¤å®³èŒƒå›´ uint8_t bulletRange;//åªå¯¹ç«çƒå¼¹ç”Ÿæ•ˆ //å­å¼¹ä¼¤å®³å€ç‡ float bulletDamageMultiplier;//åªå¯¹é—ªç”µé“¾å¼¹ç”Ÿæ•ˆ }; InitDataï¼ˆåˆå§‹åŒ–ï¼‰ å˜é‡ï¼šisInitedï¼ŒposX/posYï¼Œinit_countã€‚ ç”¨æ³•ï¼šå®ä½“é¦–æ¬¡åŠ å…¥åœºæ™¯æ—¶ä»æ­¤è¯»å–å‡ºç”Ÿç‚¹/åˆå§‹çŠ¶æ€ï¼›isInitedæ§åˆ¶æ˜¯å¦è¿›å…¥æ­£å¸¸é€»è¾‘ã€‚\nActionDataï¼ˆåŠ¨ä½œæ§åˆ¶ï¼‰ å˜é‡ï¼šcurrentStateï¼ŒattackModeï¼ŒmoveModeã€‚ ç”¨æ³•ï¼šç”±è¾“å…¥æˆ– AI å†™å…¥ï¼›é€»è¾‘å±‚ä¾æ®å…¶é©±åŠ¨è¿åŠ¨ä¸æ”»å‡»ã€‚\nDeathDataï¼ˆæ­»äº¡ä¿¡æ¯ï¼‰ å˜é‡ï¼šisDeadï¼ŒdeathTimerï¼ˆé»˜è®¤ 500msï¼‰ï¼ŒdropExperiencePointsã€‚ ç”¨æ³•ï¼šæ­»äº¡åå€’è®¡æ—¶æ’­æ”¾åŠ¨ç”»ï¼›æ¸…ç†é˜¶æ®µæ ¹æ®é˜µè¥å‘ç»éªŒï¼ˆç”±ç®¡ç†å™¨å¤„ç†ï¼‰ã€‚\nRoleDataï¼ˆè§’è‰²èšåˆä½“ï¼‰ èšåˆï¼šInitDataã€RoleIdentityã€isActiveã€DeathDataã€ActionDataã€HealthDataã€levelã€HeatDataã€RoleAttackDataã€SpatialMovementDataã€imgã€‚ é»˜è®¤æ„é€ åˆå§‹åŒ–è¦ç‚¹ï¼š èº«ä»½ UNKNOWNã€isActive=falseã€level=1ã€‚ ç”Ÿå‘½/çƒ­é‡/æ”»å‡»å‚æ•°è®¾äº†åˆç†åˆå€¼ï¼šæœ€å¤§ç”Ÿå‘½ 100ï¼›çƒ­é‡ä¸Šé™ 100ã€æ¯æª+10ã€å†·å´é€Ÿç‡ 10ï¼›å†·å´é‡ç½® 1000msï¼›æ”» 10/æ’ 5ï¼›å­å¼¹é€Ÿåº¦ 1ï¼›ç«çƒèŒƒå›´ 1ï¼›é—ªç”µå€ç‡ 1.5ã€‚ ç©ºé—´æ•°æ®åˆå§‹ç§»åŠ¨é€Ÿåº¦ 1ï¼Œä½ç½®/å°ºå¯¸ 0ã€‚ img=nullptrï¼ˆæ³¨é‡Šæ˜ç¡®â€œæ­¤å¤„æ˜“å‡ºé”™ï¼Œè‹¥æœ‰é—®é¢˜ä¼˜å…ˆæ£€æŸ¥â€ï¼‰ã€‚ å…¸å‹äº¤äº’ï¼š ç®¡ç†å™¨åœ¨æ›´æ–°çŠ¶æ€å‰ç”¨Â refPosÂ åšç¢°æ’æ¢æµ‹ï¼Œç»“æœå†æ›´æ–°Â currentPosã€‚ ç©å®¶å‡çº§é€»è¾‘åœ¨ç®¡ç†å™¨çš„çŠ¶æ€æ›´æ–°é˜¶æ®µä¸»åŠ¨è°ƒç”¨ï¼ˆåŸºäºÂ experiencePointsÂ ç­‰å¤–éƒ¨å­—æ®µï¼Œéæ­¤å¤„ï¼‰ã€‚ Perk å¡ç‰‡ç›´æ¥ä¿®æ”¹Â RoleDataå†…å­æ®µï¼ˆä¾‹å¦‚è¡€é‡ä¸Šé™ã€å°„é€Ÿã€çƒ­é‡ã€ç§»åŠ¨ç­‰ï¼‰ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 class RoleData { public: //åˆå§‹åŒ–ä½ç½® InitData initData; //åŸºæœ¬ä¿¡æ¯ RoleIdentity identity; bool isActive = false; //æ­»äº¡çŠ¶æ€ä¿¡æ¯ DeathData deathData; //åŠ¨ä½œä¿¡æ¯ ActionData actionData; //è¡€é‡ä¿¡æ¯ HealthData healthData; //ç­‰çº§ä¿¡æ¯ uint8_t level; //çƒ­é‡ä¿¡æ¯ HeatData heatData; //æ”»å‡»ä¿¡æ¯ RoleAttackData attackData; //ç©ºé—´ç§»åŠ¨ä¿¡æ¯ SpatialMovementData spatialData; //å›¾ç‰‡ä¿¡æ¯ const Image *img = nullptr; //æ˜“å‡ºé”™çš„åœ°æ–¹ï¼Œæœ‰é—®é¢˜ä¼˜å…ˆæ£€æŸ¥ //è§’è‰²å›¾ç‰‡ï¼ŒæŒ‡å‘åŒä¸€ç‰‡å†…å­˜ï¼Œåˆ©ç”¨æµ…æ‹·è´çš„ç‰¹æ€§ public: RoleData() { identity = RoleIdentity::UNKNOWN; //åˆå§‹åŒ–ä¿¡æ¯ initData.posX = 0; initData.posY = 0; initData.init_count = 0; //è¡€é‡ä¿¡æ¯åˆå§‹åŒ– healthData.currentHealth = 100; healthData.maxHealth = 100; healthData.healValue = 3; healthData.healTimeCounter = 0; healthData.healResetTime = 15000; healthData.healSpeed = 5; //ç­‰çº§åˆå§‹åŒ– level = 1; //çƒ­é‡ä¿¡æ¯åˆå§‹åŒ– heatData = HeatData(0, 100, 10, 10); //å°„å‡»åï¼Œcooldownè®¡æ—¶å™¨å¢åŠ ï¼Œåªæœ‰å½“è®¡æ—¶å™¨è¾¾åˆ°0æ—¶æ‰èƒ½å†æ¬¡å°„å‡» attackData.shootSpeed = 5; attackData.shootCooldownTimer = 0; attackData.shootCooldownSpeed = 5; attackData.attackPower = 10; attackData.collisionPower = 5; attackData.shootCooldownResetTime = 1000; // Added initialization for shootCooldownResetTime //å­å¼¹é€Ÿåº¦ attackData.bulletSpeed = 1; //ç«çƒå¼¹ä¼¤å®³èŒƒå›´ attackData.bulletRange = 1; //é—ªç”µé“¾ä¼¤å®³å€ç‡ attackData.bulletDamageMultiplier = 1.5f; //ç©ºé—´ç§»åŠ¨ä¿¡æ¯åˆå§‹åŒ– spatialData = SpatialMovementData(0, 1, 0, 0, 0, 0, 0, 0); //æ­»äº¡çŠ¶æ€ä¿¡æ¯åˆå§‹åŒ– deathData.deathTimer = 500; deathData.isDead = false; deathData.dropExperiencePoints = 0; //å›¾ç‰‡ä¿¡æ¯åˆå§‹åŒ– img = nullptr; } }; BulletDataï¼ˆå­å¼¹èšåˆä½“ï¼‰ èšåˆï¼šfromIdentityï¼ˆé»˜è®¤ UNKNOWNï¼‰ã€DeathDataã€SpatialMovementDataã€damageã€rangeã€typeã€isActiveã€imgã€‚ æ„é€ å‡½æ•°ï¼ˆé‡è½½äºŒï¼‰ï¼š é»˜è®¤æ„é€ ï¼šä¸åšåˆå§‹åŒ–ã€‚ å‚æ•°æ„é€ ï¼š å‚æ•°ï¼šspeedï¼ŒcurrentPosX/Yï¼Œdmgï¼Œrgï¼Œtypeï¼ŒdmgMultiplier=1.0fã€‚ é€»è¾‘ï¼šæŒ‰Â typeÂ åˆ†æ”¯è®¾ç½®Â damageã€spatialDataã€isActive=trueã€range=rgï¼›LIGHTNING_LINEÂ è®¾ä¸ºÂ canCrossBorder=trueã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 class BulletData { public: //æ¥è‡ª RoleIdentity fromIdentity{RoleIdentity::UNKNOWN}; //æ­»äº¡ä¿¡æ¯ DeathData deathData; //ç©ºé—´ç§»åŠ¨ä¿¡æ¯ SpatialMovementData spatialData; //ä¼¤å®³å€¼ uint8_t damage{}; uint8_t range{}; //å­å¼¹ç±»å‹ BulletType type{}; //æ˜¯å¦æ¿€æ´» bool isActive{true}; //å›¾ç‰‡ä¿¡æ¯ const Image *img = nullptr; public: BulletData() = default; BulletData(int8_t speed, uint8_t currentPosX, uint8_t currentPosY, uint8_t dmg, uint8_t rg, BulletType type , float dmgMultiplier = 1.0f) { //æ ¹æ®ç±»å‹è¿›è¡Œåˆå§‹åŒ– this-\u0026gt;type = type; switch (this-\u0026gt;type) { case BulletType::BASIC: //img = \u0026amp;bulletImg; damage = dmg; spatialData = SpatialMovementData(false, speed, currentPosX, currentPosY, currentPosX, currentPosY, img-\u0026gt;w, img-\u0026gt;h); isActive = true; range = rg; break; case BulletType::FIRE_BALL: //img = \u0026amp;fireBallImg; damage = dmg; spatialData = SpatialMovementData(false, speed, currentPosX, currentPosY, currentPosX, currentPosY, img-\u0026gt;w, img-\u0026gt;h); isActive = true; range = rg; break; case BulletType::LIGHTNING_LINE: //img = \u0026amp;lightningLineImg; damage = dmg; spatialData = SpatialMovementData(true, speed, currentPosX, currentPosY, currentPosX, currentPosY, img-\u0026gt;w, img-\u0026gt;h); isActive = true; range = rg; break; } } }; æ¸¸æˆå®ä½“å±‚ å®ä½“å±‚ä»¥æŠ½è±¡çš„è§’è‰²åŸºç±»ä¸ºæ ¸å¿ƒï¼Œæ‰€æœ‰è§’è‰²å…±äº«ä¸€å¥—æ•°æ®é©±åŠ¨çš„çŠ¶æ€ä¸è¡Œä¸ºæµç¨‹ï¼šåˆå§‹åŒ–ã€å†³ç­–ã€æ‰§è¡Œã€æ¨è¿›ä¸æ¸²æŸ“ã€‚\nç©å®¶ä¸æ•Œäººåˆ†åˆ«åœ¨å…¶æ´¾ç”Ÿç±»ä¸­å®ç°å…·ä½“çš„æ€è€ƒä¸è¡ŒåŠ¨â€”â€”ç©å®¶ç”±è¾“å…¥é©±åŠ¨ï¼Œæ•Œäººç”±å®šæ—¶ä¸æ¨¡å¼åˆ‡æ¢é©±åŠ¨ã€‚å½“è§’è‰²éœ€è¦å¼€ç«æ—¶ï¼Œé€šè¿‡è§’è‰²åŸºç±»æä¾›çš„å­å¼¹å·¥å‚æŒ‰ç±»å‹ç”Ÿæˆä¸åŒæœºåˆ¶çš„å¼¹è¯ï¼šæ™®é€šå¼¹ä»¥åŸºç¡€ä¼¤å®³ç›´å‡»ï¼Œç«çƒå¼¹åœ¨ç›´å‡»ä¹‹å¤–å åŠ èŒƒå›´æº…å°„ï¼Œé—ªç”µé“¾ä»¥å€æ•°åŠ æˆçš„ç©¿é€ä¼¤å®³å½¢æˆå‹åˆ¶ã€‚\nè§’è‰²æ¨è¿›é‡‡ç”¨â€œå‚è€ƒä½ç½® + ç¢°æ’å›é€€â€çš„æ¨¡å¼ï¼šå…ˆæ ¹æ®ç§»åŠ¨æ„å›¾è®¡ç®—å‚è€ƒåæ ‡ï¼Œå†ç”¨è½´å¯¹é½åŒ…å›´ç›’æ£€æµ‹å¹¶æŒ‰ç¢°æ’æ–¹å‘å’Œè¿ç»­ç¢°æ’æ¬¡æ•°é€æ­¥å›é€€ï¼Œé¿å…å¡è¾¹ã€‚\næ•°å€¼ç³»ç»Ÿå›´ç»•å†·å´ã€çƒ­é‡å’Œå›è¡€ä¸‰æ¡ç‹¬ç«‹çš„æ—¶åºé€šé“è¿è¡Œï¼šå†·å´æŒ‰æ­¥é•¿ä¸é€Ÿåº¦é€’å‡è‡³é›¶æ–¹å¯å†æ¬¡å°„å‡»ï¼Œçƒ­é‡æ¯å›ºå®šå‘¨æœŸæŒ‰æ•£çƒ­é€Ÿç‡è¡°å‡ï¼Œå›è¡€ä»¥è®¡æ—¶å™¨è§¦å‘ç¦»æ•£æ¢å¤ã€‚\næ‰€æœ‰å®ä½“çš„åˆ›å»ºã€æ›´æ–°ã€ç¢°æ’ä¸å›æ”¶ç”±å®ä½“ç®¡ç†å™¨ç»Ÿä¸€ç¼–æ’ï¼Œç®¡ç†å™¨åœ¨è¡Œä¸ºä¸çŠ¶æ€é˜¶æ®µä¹‹é—´æ˜ç¡®åˆ†ç¦»èŒè´£ï¼šå…ˆè®©è§’è‰²ä¸å­å¼¹å„è‡ªåšå†³ç­–ä¸åŠ¨ä½œï¼Œå†æ¨è¿›ä½ç½®ä¸ä¼¤å®³ç»“ç®—ï¼Œéšåæ¸…ç†å¤±æ•ˆå¯¹è±¡å¹¶ä¸ºç©å®¶ç»“ç®—ç»éªŒï¼Œæœ€åæ¸²æŸ“ç”»é¢ã€‚\næ•´ä½“ä»¥å›ºå®šå®¹é‡çš„åµŒå…¥å¼å®¹å™¨ä¸ä¸´ç•ŒåŒºä¿æŠ¤ä¿è¯åœ¨èµ„æºå—é™ä¸å¤šä»»åŠ¡ç¯å¢ƒä¸‹çš„ç¡®å®šæ€§ä¸å®‰å…¨æ€§ï¼ŒåŒæ—¶é€šè¿‡å°†æœºåˆ¶è½åœ¨æ•°æ®ç»“æ„ä¸Šï¼Œä¿ç•™è¶³å¤Ÿçš„å¯è°ƒæ€§ä¸æ‰©å±•ç©ºé—´ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 #ifndef ROLE_HPP #define ROLE_HPP #include \u0026#34;basicData.hpp\u0026#34; #include \u0026#34;bullet.hpp\u0026#34; #include \u0026#34;etl/algorithm.h\u0026#34; extern uint8_t controlDelayTime ; /** * @brief è§’è‰²æ¥å£ç±» * @note æ‰€æœ‰è§’è‰²ç±»å‡éœ€ç»§æ‰¿è¯¥æ¥å£ç±» * @note think()å‡½æ•°ç”¨äºå®ç°AIé€»è¾‘ï¼Œå†³å®šActionçŠ¶æ€ */ class IRole { protected: RoleData* m_pdata = nullptr ; public: IRole() { if(m_pdata == nullptr) m_pdata = new RoleData(); } virtual ~IRole() { if(m_pdata != nullptr) delete [] m_pdata; m_pdata = nullptr; } public: RoleData* getData() { return m_pdata; } virtual void shoot(uint8_t x , uint8_t y , BulletType type) = 0; virtual void doAction() = 0; virtual void init() = 0; virtual void die() = 0; virtual void think() = 0; virtual void drawRole() = 0; // ç”»è§’è‰²å‡½æ•°å£°æ˜ IBullet* createBullet(uint8_t x , uint8_t y , BulletType type ) ; void move(int8_t dirX, int8_t dirY , bool ignoreSpeed = false) ; void update(CollisionResult collisionResult) ; void takeDamage(uint8_t damage) ; bool isActive() ; }; #endif // ROLE_HPP å®ç°ä¸Šä»…é‡ç‚¹å±•ç¤ºupdate()å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šåœ¨GameEntityManagerä¸­è°ƒç”¨ï¼Œ\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 void IRole::update(CollisionResult collisionResult) { //åˆå§‹åŒ– if (!m_pdata-\u0026gt;initData.isInited) { //é¦–æ¬¡åˆå§‹åŒ– init(); return; } if (m_pdata-\u0026gt;deathData.isDead) { die(); return; } //ä½ç½®æ›´æ–° if (!collisionResult.isCollision) { m_pdata-\u0026gt;spatialData.currentPosX = m_pdata-\u0026gt;spatialData.refPosX; m_pdata-\u0026gt;spatialData.currentPosY = m_pdata-\u0026gt;spatialData.refPosY; } else { m_pdata-\u0026gt;spatialData.refPosX = m_pdata-\u0026gt;spatialData.currentPosX; m_pdata-\u0026gt;spatialData.refPosY = m_pdata-\u0026gt;spatialData.currentPosY; } //ç¢°æ’å¤„ç† //ç¢°æ’å¤„ç†åœ¨ä½ç½®æ›´æ–°åè¿›è¡Œ if (collisionResult.isCollision) { //ç”¨æ¥é¿å…å•æ¬¡ç¢°æ’ä¸€æ¬¡é€€å›çš„æ— æ³•è§£å†³ç¢°æ’çš„é—®é¢˜ m_pdata-\u0026gt;spatialData.consecutiveCollisionCount++; //ç¢°æ’åé€€å› uint8_t backStep = 2*m_pdata-\u0026gt;spatialData.consecutiveCollisionCount ; if (m_pdata-\u0026gt;identity == RoleIdentity::Player) backStep = 5*m_pdata-\u0026gt;spatialData.consecutiveCollisionCount ; if (collisionResult.direction == CollisionDirection::LEFT) m_pdata-\u0026gt;spatialData.refPosX = etl::max(m_pdata-\u0026gt;spatialData.refPosX - backStep, 0); else if (collisionResult.direction == CollisionDirection::RIGHT) m_pdata-\u0026gt;spatialData.refPosX = etl::min(m_pdata-\u0026gt;spatialData.refPosX + backStep, 128 - m_pdata-\u0026gt;spatialData.sizeX); else if (collisionResult.direction == CollisionDirection::UP) m_pdata-\u0026gt;spatialData.refPosY = etl::max(m_pdata-\u0026gt;spatialData.refPosY - backStep, 0); else if (collisionResult.direction == CollisionDirection::DOWN) m_pdata-\u0026gt;spatialData.refPosY = etl::min(m_pdata-\u0026gt;spatialData.refPosY + backStep, 64 - m_pdata-\u0026gt;spatialData.sizeY); } else { m_pdata-\u0026gt;spatialData.consecutiveCollisionCount = 0; } //å°„å‡»å†·å´å¤„ç† if (m_pdata-\u0026gt;attackData.shootCooldownTimer \u0026gt; 0) { uint8_t shootCooldownSpeed = m_pdata-\u0026gt;attackData.shootCooldownSpeed; if (controlDelayTime * shootCooldownSpeed \u0026gt;= m_pdata-\u0026gt;attackData.shootCooldownTimer) m_pdata-\u0026gt;attackData.shootCooldownTimer = 0; else m_pdata-\u0026gt;attackData.shootCooldownTimer -= controlDelayTime * shootCooldownSpeed; } //çƒ­é‡å†·å´å¤„ç† if (m_pdata-\u0026gt;heatData.currentHeat \u0026gt; 0) { m_pdata-\u0026gt;heatData.heatCoolDownTimer += controlDelayTime; if (m_pdata-\u0026gt;heatData.heatCoolDownTimer \u0026gt;= 200) //æ¯200msé™æ¸©ä¸€æ¬¡ { if (m_pdata-\u0026gt;heatData.currentHeat \u0026lt;= m_pdata-\u0026gt;heatData.heatCoolDownRate) m_pdata-\u0026gt;heatData.currentHeat = 0; else m_pdata-\u0026gt;heatData.currentHeat -= m_pdata-\u0026gt;heatData.heatCoolDownRate; m_pdata-\u0026gt;heatData.heatCoolDownTimer = 0; } } //å›è¡€å¤„ç† if (m_pdata-\u0026gt;healthData.currentHealth \u0026lt; m_pdata-\u0026gt;healthData.maxHealth) { m_pdata-\u0026gt;healthData.healTimeCounter += controlDelayTime * m_pdata-\u0026gt;healthData.healSpeed; if (m_pdata-\u0026gt;healthData.healTimeCounter \u0026gt;= m_pdata-\u0026gt;healthData.healResetTime) { if (m_pdata-\u0026gt;healthData.currentHealth + m_pdata-\u0026gt;healthData.healValue \u0026gt;= m_pdata-\u0026gt;healthData.maxHealth) m_pdata-\u0026gt;healthData.currentHealth = m_pdata-\u0026gt;healthData.maxHealth; else m_pdata-\u0026gt;healthData.currentHealth += m_pdata-\u0026gt;healthData.healValue; m_pdata-\u0026gt;healthData.healTimeCounter = 0; } } //æ£€æŸ¥è¡€é‡çŠ¶æ€ if (m_pdata-\u0026gt;healthData.currentHealth == 0 \u0026amp;\u0026amp; !m_pdata-\u0026gt;deathData.isDead) { m_pdata-\u0026gt;deathData.isDead = true; } } å…¶ä½™ä»£ç å°±ä¸å±•ç¤ºäº†ï¼ŒåŸºæœ¬å°±æ˜¯å¤åˆ¶ï¼Œåªéœ€æ ¹æ®éœ€æ±‚å¯¹è™šæ¥å£è¿›è¡Œé‡å†™å³å¯\nç®¡ç†å™¨å±‚ è¯¥å±‚çº§çš„è®¾è®¡ä¸»è¦æ˜¯é’ˆå¯¹æ•´ä¸ªæ¸¸æˆè¿è¡Œçš„èŒè´£è¿›è¡Œåˆ’åˆ†è§£è€¦ï¼ŒGameEntityManager,GameProgressManager,GamePerkCardManagerä¸‰è€…åä½œçš„å…³é”®åœ¨äºæ¸…æ™°çš„èŒè´£è¾¹ç•Œä¸çŠ¶æ€é—¨æ§ï¼šè¿›åº¦ä¸é€‰å¡æ§åˆ¶ä½•æ—¶æ¨è¿›é€»è¾‘æˆ–æš‚åœåˆ°è¿‡åœº/é€‰å¡ï¼Œå®ä½“ç®¡ç†å™¨æä¾›ç¡®å®šæ€§æ›´æ–°ä¸èµ„æºå›æ”¶ï¼Œå¡ç‰‡ç®¡ç†å™¨ä»¥æ•°æ®é©±åŠ¨æ”¹å˜ç©å®¶çš„RoleData\nGameEntityManagerç»Ÿä¸€æŒæ§è§’è‰²ä¸å­å¼¹çš„ç”Ÿå‘½å‘¨æœŸä¸æ—¶åºï¼Œé‡‡ç”¨å›ºå®šå®¹é‡çš„åµŒå…¥å¼å‘é‡å­˜å‚¨å¤šæ€æŒ‡é’ˆï¼Œæ‰€æœ‰å¢åˆ ä¸éå†åœ¨ä¸´ç•ŒåŒºå†…æ‰§è¡Œï¼ŒæŒ‰â€œè¡ŒåŠ¨â†’çŠ¶æ€â†’æ¸…ç†â†’æ¸²æŸ“â€çš„åˆ†é˜¶æ®µæµç¨‹é©±åŠ¨ï¼šè¡ŒåŠ¨é˜¶æ®µè°ƒç”¨è§’è‰²/å­å¼¹çš„æ€è€ƒä¸åŠ¨ä½œï¼ŒçŠ¶æ€é˜¶æ®µæ¨è¿›ä½ç½®ä¸AABBç¢°æ’ã€ä¼¤å®³ä¸èŒƒå›´ä¼¤å®³å¹¶å¯¹ç©å®¶æ‰§è¡Œå‡çº§æ£€æŸ¥ï¼Œæ¸…ç†é˜¶æ®µåˆ é™¤å¤±æ•ˆå®ä½“å¹¶å‘ç©å®¶ç»“ç®—ç»éªŒï¼Œæ¸²æŸ“é˜¶æ®µè¾“å‡ºå›¾åƒã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 #ifndef GAMEENTITYMANAGER_HPP #define GAMEENTITYMANAGER_HPP #include \u0026#34;math.h\u0026#34; #include \u0026#34;role.hpp\u0026#34; #include \u0026#34;leadingRole.hpp\u0026#34; #include \u0026#34;enemyRole.hpp\u0026#34; #include \u0026#34;etl/vector.h\u0026#34; #include \u0026#34;FreeRTOS.h\u0026#34; #include \u0026#34;task.h\u0026#34; // ç®¡ç†æ¸¸æˆä¸­çš„å®ä½“ï¼šè§’è‰²å’Œå­å¼¹ // ä¼šè¢«å¤šä¸ªæ¨¡å—å¼•ç”¨ // å½’gameProgressManagerç®¡ç† class GameEntityManager { public: etl::vector\u0026lt;IRole *, 20\u0026gt; m_roles; //è§’è‰²æ± ï¼Œå­˜æ”¾æ‰€æœ‰è§’è‰²æŒ‡é’ˆ etl::vector\u0026lt;IBullet *, 100\u0026gt; m_bullets; //å­å¼¹æ± ï¼Œå­˜æ”¾æ‰€æœ‰å­å¼¹æŒ‡é’ˆ bool isGameOver = false; public: GameEntityManager() = default; ~GameEntityManager() { cleanUpAllRoles(true); cleanUpAllBullets(true); } GameEntityManager(const GameEntityManager \u0026amp;) = delete; GameEntityManager \u0026amp;operator=(const GameEntityManager \u0026amp;) = delete; public: //Addæ·»åŠ /********************************************************************/ bool addRole(IRole *role) { if (role == nullptr || m_roles.full()) return false; taskENTER_CRITICAL(); m_roles.push_back(role); taskEXIT_CRITICAL(); return true; } bool addBullet(IBullet *bullet) { if (bullet == nullptr || m_bullets.full()) return false; taskENTER_CRITICAL(); m_bullets.push_back(bullet); taskEXIT_CRITICAL(); return true; } /********************************************************************/ //removeåˆ é™¤å¹¶é”€æ¯ /********************************************************************/ bool removeAndDestroyRole(IRole *role) { if (role == nullptr) return false; taskENTER_CRITICAL(); auto it = etl::find(m_roles.begin(), m_roles.end(), role); if (it != m_roles.end()) { m_roles.erase(it); delete role; taskEXIT_CRITICAL(); return true; } taskEXIT_CRITICAL(); return false; } bool removeAndDestroyBullet(IBullet *bullet) { if (bullet == nullptr) return false; taskENTER_CRITICAL(); auto it = etl::find(m_bullets.begin(), m_bullets.end(), bullet); if (it != m_bullets.end()) { m_bullets.erase(it); delete bullet; taskEXIT_CRITICAL(); return true; } taskEXIT_CRITICAL(); return false; } /********************************************************************/ //è·å–playerè§’è‰²æŒ‡é’ˆ /********************************************************************/ IRole *getPlayerRole() { taskENTER_CRITICAL(); for (auto role : m_roles) { if (role != nullptr \u0026amp;\u0026amp; role-\u0026gt;getData()-\u0026gt;identity == RoleIdentity::Player) { taskEXIT_CRITICAL(); return role; } } taskEXIT_CRITICAL(); return nullptr; } /********************************************************************/ //æ¸…é™¤éœ€è¦å›æ”¶çš„è§’è‰²å’Œå­å¼¹ /********************************************************************/ void cleanupInvalidRoles() { //... } void cleanupInvalidBullets() { //... } /********************************************************************/ //ç¢°æ’æ£€æµ‹ /********************************************************************/ CollisionResult checkRoleRefPositionCollision(IRole *role_A) { //... return collisionDetected; } bool checkBulletRefPositionCollision(IBullet *bullet_A) {\t//... return collisionDetected; } /********************************************************************/ //å­å¼¹èŒƒå›´ä¼¤å®³æ£€æµ‹ /********************************************************************/ void checkBulletRangeDamage(IBullet *bullet_A) { //.... } /********************************************************************/ //æ›´æ–°æ‰€æœ‰å®ä½“ä½ç½®å’ŒçŠ¶æ€ /********************************************************************/ /** * @brief æ›´æ–°æ‰€æœ‰è§’è‰²çŠ¶æ€å’Œä½ç½® */ void updateAllRolesState() { taskENTER_CRITICAL(); for (auto rolePtr : m_roles) { if (rolePtr != nullptr) { CollisionResult collisionResult = {false, CollisionDirection::NONE}; if (rolePtr-\u0026gt;getData()-\u0026gt;initData.isInited) { //ç¢°æ’å¤„ç† collisionResult = checkRoleRefPositionCollision(rolePtr); } rolePtr-\u0026gt;update(collisionResult); if(rolePtr-\u0026gt;getData()-\u0026gt;identity == RoleIdentity::Player) { LeadingRole* playerRole = (LeadingRole*)rolePtr; playerRole-\u0026gt;levelUp(); //æ£€æŸ¥å‡çº§ } } } taskEXIT_CRITICAL(); } /** * @brief æ›´æ–°æ‰€æœ‰å­å¼¹çŠ¶æ€å’Œä½ç½® */ void updateAllBulletsState() { taskENTER_CRITICAL(); for (auto bulletPtr : m_bullets) { if (bulletPtr != nullptr) { CollisionResult collisionResult = {false, CollisionDirection::NONE}; //ç¢°æ’å¤„ç† bool isCollision = checkBulletRefPositionCollision(bulletPtr); if (isCollision) { collisionResult.isCollision = true; checkBulletRangeDamage(bulletPtr); } bulletPtr-\u0026gt;update(collisionResult); } } taskEXIT_CRITICAL(); } /********************************************************************/ // æ›´æ–°æ‰€æœ‰è§’è‰²çš„AIè¡ŒåŠ¨å†³ç­– /********************************************************************/ void updateAllRolesActions() { taskENTER_CRITICAL(); for (auto rolePtr : m_roles) { if (rolePtr != nullptr \u0026amp;\u0026amp; rolePtr-\u0026gt;getData()-\u0026gt;initData.isInited) { rolePtr-\u0026gt;think(); rolePtr-\u0026gt;doAction(); } } taskEXIT_CRITICAL(); } void updateAllBulletsActions() { taskENTER_CRITICAL(); for (auto bulletPtr : m_bullets) { if (bulletPtr != nullptr) { bulletPtr-\u0026gt;doAction(); } } taskEXIT_CRITICAL(); } /********************************************************************/ // ç»˜åˆ¶æ‰€æœ‰å®ä½“ /********************************************************************/ void drawAllRoles() { taskENTER_CRITICAL(); for (auto rolePtr : m_roles) { if (rolePtr != nullptr \u0026amp;\u0026amp; rolePtr-\u0026gt;getData() != nullptr \u0026amp;\u0026amp; rolePtr-\u0026gt;getData()-\u0026gt;img != nullptr) { rolePtr-\u0026gt;drawRole(); } } taskEXIT_CRITICAL(); } void drawAllBullets() { taskENTER_CRITICAL(); for (auto bulletPtr : m_bullets) { if (bulletPtr != nullptr \u0026amp;\u0026amp; bulletPtr-\u0026gt;m_data != nullptr \u0026amp;\u0026amp; bulletPtr-\u0026gt;m_data-\u0026gt;img != nullptr) { bulletPtr-\u0026gt;drawBullet(); } } taskEXIT_CRITICAL(); } /********************************************************************/ //æ¸…é™¤æ‰€æœ‰å®ä½“ï¼Œèµ„æºå›æ”¶ void clearAllEntities(bool deleteObjects = true) { cleanUpAllRoles(deleteObjects); cleanUpAllBullets(deleteObjects); } private: //æ¸…é™¤æ‰€æœ‰è§’è‰²å’Œå­å¼¹ï¼Œèµ„æºå›æ”¶ /********************************************************************/ void cleanUpAllRoles(bool deleteObjects = true) { if (!deleteObjects) return; for (auto rolePtr : m_roles) { if (rolePtr != nullptr) delete rolePtr; } m_roles.clear(); } void cleanUpAllBullets(bool deleteObjects = true) { if (!deleteObjects) return; for (auto bulletPtr : m_bullets) { if (bulletPtr != nullptr) delete bulletPtr; } m_bullets.clear(); } /********************************************************************/ //ç©å®¶è§’è‰²è·å–ç»éªŒå€¼ /********************************************************************/ void gainDropExperiencePoints(uint16_t points) { LeadingRole* playerRole = (LeadingRole*)getPlayerRole(); if (playerRole != nullptr \u0026amp;\u0026amp; playerRole-\u0026gt;getData()-\u0026gt;level \u0026lt; 10) { playerRole-\u0026gt;experiencePoints += points; } } /********************************************************************/ }; #endif // GAMEENTITYMANAGER_HPP GameProgressManagerè´Ÿè´£å…³å¡ä¸æ³¢æ¬¡æ¨è¿›ä»¥åŠBossè§¦å‘å’Œè¿‡åœºå±•ç¤ºï¼šå½“æ¸…åœºï¼ˆåœºä¸Šä»…å‰©ç©å®¶ï¼‰æ—¶é€’è¿›æ³¢æ¬¡/å…³å¡ï¼Œåœ¨å…³é”®èŠ‚ç‚¹è§¦å‘é€‰å¡å¹¶æŒ‰ç« èŠ‚è§„åˆ™ç”Ÿæˆé˜µå‹æˆ–Bossï¼Œä»è€ŒæŠŠæˆ˜æ–—èŠ‚å¥å’Œæ¼”å‡ºä¸²è”èµ·æ¥ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 #ifndef GAMEPROGRESSMANAGER_HPP #define GAMEPROGRESSMANAGER_HPP #include \u0026#34;gamePerkCardManager.hpp\u0026#34; extern uint8_t controlDelayTime; // ç”± threads.cpp å®šä¹‰ extern GameEntityManager g_entityManager; extern GamePerkCardManager g_perkCardManager; enum class WaveType { //é­‘é­…é˜µå‹ CHIMEI_LINE = 0, // 10 é­‘é­…ç›´çº¿é˜µ CHIMEI_TRIANGLE, // 10 é­‘é­…ä¸‰è§’é˜µ //é£å»‰é˜µå‹ THREE_Feilian, // ä¸‰é£å»‰ FEILIAN_CLUSTER, // é£å»‰ç¾¤ //å¤é›•é˜µå‹ GUDIAO_SINGLE, GUODIAO_DOUBLE, GUDIAO_SQUARE, //æ··åˆé˜µå‹ MIXED_SMALL, // æ··åˆå°å‹é˜µå‹ 2feilian + 1Gudiao MIXED_MEDIUM, // æ··åˆä¸­å‹é˜µå‹ 5feilian +1Gudiao MIXED_LARGE, // æ··åˆå¤§å‹é˜µå‹ 5feilian + 2Gudiao }; enum class BOSS_TYPE { NONE = 0, TAO_TIE, // é¥•é¤® XIANG_LIU, // ç›¸æŸ³ TAO_WU, // æ¢¼æŒ }; class GameProgressManager { public: uint8_t currentChapter = 1; // å½“å‰æ¸¸æˆå…³å¡ uint8_t lastChapter = 4; // æœ€å¤§æ¸¸æˆå…³å¡ uint8_t currentWave = 1; // å½“å‰æ³¢æ¬¡ uint8_t maxWave = 15; // æœ€å¤§æ³¢æ¬¡ uint8_t currentChapterMaxWaves = 0; // å½“å‰å…³å¡æ€»æ³¢æ¬¡ uint8_t time_count = 0; bool isPlayingOpeningCG = false; // æ˜¯å¦æ’­æ”¾å¼€åœºåŠ¨ç”» uint16_t openingCGTimer = 0; // å¼€åœºåŠ¨ç”»è®¡æ—¶å™¨ bool isPlayingClearCG = false; // æ˜¯å¦æ’­æ”¾é€šå…³åŠ¨ç”» uint16_t clearCGTimer = 0; // é€šå…³åŠ¨ç”»è®¡æ—¶å™¨ bool chatpter4Warning = false; // ç¬¬å››ç« è­¦å‘Šæ ‡è®° BOSS_TYPE showWhichBoss = BOSS_TYPE::NONE; // å±•ç¤ºBossç±»å‹ bool showBoss = false; // æ˜¯å¦ å±•ç¤ºBossæµ·æŠ¥ uint16_t showBossTimer = 0; // å±•ç¤ºBossæµ·æŠ¥è®¡æ—¶å™¨ //æ’­æ”¾3ç§’Bossæµ·æŠ¥ bool PauseGame = false; // æš‚åœæ¸¸æˆæ ‡è®° public: GameProgressManager() = default; ~GameProgressManager() = default; GameProgressManager(const GameProgressManager \u0026amp;) = delete; GameProgressManager \u0026amp;operator=(const GameProgressManager \u0026amp;) = delete; public: // é‡ç½®æ¸¸æˆè¿›åº¦ void resetGameProgress() { // é‡ç½®å®ä½“ç®¡ç†å™¨ //... } // æ›´æ–°æ¸¸æˆè¿›åº¦ void updateGameProgress() { //... } void AddWaveEnemies() { //... } // ç»˜å›¾å±•ç¤ºåŠŸèƒ½ // ç»˜åˆ¶å¼€åœºåŠ¨ç”» void drawOpeningCG() { if (openingCGTimer \u0026gt;= 2 * controlDelayTime) openingCGTimer -= 2 * controlDelayTime; else isPlayingOpeningCG = false; // ç»˜åˆ¶åŠ¨æ€åœ†åœˆæ•ˆæœ OLED_DrawCircle(64, 32, 30 - (openingCGTimer / 100)+10, OLED_COLOR_NORMAL); OLED_DrawCircle(64, 32, 20 - (openingCGTimer / 150)+30 , OLED_COLOR_NORMAL); OLED_PrintString(30, 28, \u0026#34;CHIP TANKS\u0026#34;, \u0026amp;font8x6, OLED_COLOR_NORMAL); } void drawClearCG() { if (clearCGTimer \u0026gt;= 2 * controlDelayTime) clearCGTimer -= 2 * controlDelayTime; else { isPlayingClearCG = false; g_entityManager.isGameOver = true; // æ¸¸æˆç»“æŸ } // è‡´è°¢ OLED_PrintString(1, 28, \u0026#34;THANK YOU FOR\u0026#34;, \u0026amp;font8x6, OLED_COLOR_NORMAL); OLED_PrintString(1, 40, \u0026#34;PLAYING MY GAME\u0026#34;, \u0026amp;font8x6, OLED_COLOR_NORMAL); } // ç»˜åˆ¶å±•ç¤ºBossæµ·æŠ¥ void drawShowBoss() { //... } }; #endif // GAMEPROGRESSMANAGER_HPP GamePerkCardManagerç®¡ç†Roguelikeå¼æˆé•¿ï¼šåŸºäºé…ç½®åˆå§‹åŒ–å¡ç‰‡ä»“åº“ï¼ŒæŒ‰éœ€æŠ½å–å¾…é€‰å¡ã€åº”ç”¨æ‰€é€‰å¢ç›Šåˆ°ç©å®¶å¹¶å›åº“æœªé€‰å¡ï¼ŒåŒæ—¶æä¾›é€‰å¡ç•Œé¢æ¸²æŸ“ä¸äº¤äº’çŠ¶æ€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 #ifndef GAMEPERKCARDMANAGER_HPP #define GAMEPERKCARDMANAGER_HPP #include \u0026#34;etl/vector.h\u0026#34; #include \u0026#34;oled.h\u0026#34; #include \u0026#34;prekCard.hpp\u0026#34; #include \u0026#34;gameEntityManager.hpp\u0026#34; #include \u0026#34;leadingRole.hpp\u0026#34; // ç®¡ç†æ¸¸æˆä¸­çš„Perkå¡ç‰‡ç³»ç»Ÿ // å¼•ç”¨GameEntityManagerå®ä¾‹ // å½’gameProgressManagerç®¡ç† extern GameEntityManager g_entityManager; class GamePerkCardManager { public: GamePerkCardManager() = default; ~GamePerkCardManager() = default; GamePerkCardManager(const GamePerkCardManager \u0026amp;) = delete; GamePerkCardManager \u0026amp;operator=(const GamePerkCardManager \u0026amp;) = delete; private: static const uint8_t MAX_CARD_COUNT = 22; // æ€»å¡ç‰‡æ•°ï¼ˆ2*10 +1*2=22ï¼‰ static const uint8_t SELECTION_SLOT_COUNT = 3; // é€‰å¡æ§½æ•°é‡ï¼ˆ3å¼ ï¼‰ etl::vector\u0026lt;PerkCard, MAX_CARD_COUNT\u0026gt; m_cardWarehouse; // å¡ç‰‡ä»“åº“ï¼ˆå­˜æ‰€æœ‰å¡ç‰‡ï¼‰ etl::vector\u0026lt;PerkCard, SELECTION_SLOT_COUNT\u0026gt; m_selectionSlots; // é€‰å¡æ§½ï¼ˆä¸´æ—¶å­˜3å¼ å¾…é€‰ï¼‰ public: bool isInited = false; // æ˜¯å¦å·²åˆå§‹åŒ– bool m_isSelecting = false; // é€‰å¡çŠ¶æ€ï¼ˆæ ‡è®°æ˜¯å¦å¤„äºâ€œé€‰å¡ä¸­â€ï¼Œé¿å…é‡å¤è§¦å‘ï¼‰ uint8_t m_selectedIndex = 0; // é€‰ä¸­å¡ç‰‡ç´¢å¼•ï¼ˆé€‰å¡æ§½å†…ç´¢å¼•ï¼‰ uint8_t m_selectedSize = 0; // é€‰ä¸­å¡ç‰‡æ•°é‡ï¼ˆé€‰å¡æ§½å†…æ•°é‡ï¼‰ public: // åˆå§‹åŒ–å¡ç‰‡ä»“åº“ void initWarehouse() { m_cardWarehouse.clear(); m_selectionSlots.clear(); m_isSelecting = false; isInited = true; // éå†é…ç½®è¡¨ï¼ŒæŒ‰æ•°é‡åˆ›å»ºå¡ç‰‡å¹¶åŠ å…¥ä»“åº“ for (const auto \u0026amp;config : PERK_CARD_CONFIGS) { for (uint8_t i = 0; i \u0026lt; config.count; ++i) { PerkCard newCard(config.type, config.name, config.param); m_cardWarehouse.push_back(newCard); } } } bool triggerPerkSelection() { if (m_isSelecting || m_cardWarehouse.empty()) { return false; // å·²åœ¨é€‰å¡ä¸­æˆ–æ— å¡ç‰‡å¯é€‰ï¼Œæ‹’ç»è§¦å‘ } m_selectionSlots.clear(); // å¯ç”¨å¡ç‰‡ä¸è¶³3å¼ æ—¶ï¼Œå–å…¨éƒ¨ï¼ˆé¿å…é€‰å¡æ§½ä¸ºç©ºï¼‰ uint8_t selectCount = etl::min(SELECTION_SLOT_COUNT, (uint8_t)m_cardWarehouse.size()); if (selectCount == 0) { return false; // æ— å¯ç”¨å¡ç‰‡ } m_selectedSize = selectCount; // éšæœºæŠ½å–selectCountå¼ å¡ç‰‡ï¼Œæ”¾å…¥é€‰å¡æ§½ï¼ˆä»ä»“åº“ç§»é™¤ï¼Œé¿å…é‡å¤æŠ½ï¼‰ for (uint8_t i = 0; i \u0026lt; selectCount; ++i) { // åµŒå…¥å¼éšæœºç®—æ³•ï¼šç”¨ç³»ç»Ÿæ»´ç­”å®šæ—¶å™¨åšæ¨¡è¿ç®—ï¼ˆæ— éœ€rand()ï¼‰ uint8_t randIdx = rand() % m_cardWarehouse.size(); uint8_t warehouseIdx = randIdx; // ä»ä»“åº“ç§»åŠ¨åˆ°é€‰å¡æ§½ï¼ˆé¿å…æ‹·è´ï¼Œæå‡æ•ˆç‡ï¼‰ m_selectionSlots.push_back(m_cardWarehouse[warehouseIdx]); m_cardWarehouse.erase(m_cardWarehouse.begin() + warehouseIdx); } // æ ‡è®°ä¸ºé€‰å¡ä¸­ï¼ŒUIæç¤º m_isSelecting = true; return true; } bool selectCard(uint8_t slotIndex) { // å‰ç½®æ ¡éªŒï¼š1. åœ¨é€‰å¡ä¸­ï¼›2. æ§½ç´¢å¼•æœ‰æ•ˆ if (!m_isSelecting || slotIndex \u0026gt;= m_selectionSlots.size()) { return false; } // å¤„ç†é€‰ä¸­å¡ç‰‡ï¼ˆslotIndexï¼‰ PerkCard selectedCard = m_selectionSlots[slotIndex]; LeadingRole *player = (LeadingRole *)g_entityManager.getPlayerRole(); if (player == nullptr) { return false; // æœªæ‰¾åˆ°ç©å®¶è§’è‰²ï¼Œæ— æ³•åº”ç”¨å¡ç‰‡æ•ˆæœ } // åº”ç”¨å¡ç‰‡æ•ˆæœ switch (selectedCard.type) { case PerkCardType::HEAL_SPEED_UP: player-\u0026gt;getData()-\u0026gt;healthData.healSpeed += selectedCard.param; break; case PerkCardType::HEAL_AMOUNT_UP: player-\u0026gt;getData()-\u0026gt;healthData.healValue += selectedCard.param; break; case PerkCardType::HEALTH_UP: player-\u0026gt;getData()-\u0026gt;healthData.maxHealth += selectedCard.param; player-\u0026gt;getData()-\u0026gt;healthData.currentHealth = player-\u0026gt;getData()-\u0026gt;healthData.maxHealth; break; case PerkCardType::ATTACK_UP: player-\u0026gt;getData()-\u0026gt;attackData.attackPower += selectedCard.param; break; case PerkCardType::ATTACK_SPEED_UP: player-\u0026gt;getData()-\u0026gt;attackData.shootCooldownSpeed += selectedCard.param; break; case PerkCardType::HEAT_CAPACITY_UP: player-\u0026gt;getData()-\u0026gt;heatData.maxHeat += selectedCard.param; break; case PerkCardType::HEAT_COOL_DOWN_UP: player-\u0026gt;getData()-\u0026gt;heatData.heatCoolDownRate += selectedCard.param; break; case PerkCardType::UNLOCK_FIREBALL: player-\u0026gt;bulletTypeOwned.fireBallBulletOwed = 1; break; case PerkCardType::UNLOCK_LIGHTNING: player-\u0026gt;bulletTypeOwned.lightningLineBulletOwed = 1; break; case PerkCardType::FIREBALL_RANGE_UP: player-\u0026gt;getData()-\u0026gt;attackData.bulletRange += selectedCard.param; break; case PerkCardType::LIGHTNING_MULTIPLIER_UP: player-\u0026gt;getData()-\u0026gt;attackData.bulletDamageMultiplier += (static_cast\u0026lt;float\u0026gt;(selectedCard.param) / 10.0f); break; case PerkCardType::MOVE_SPEED_UP: player-\u0026gt;getData()-\u0026gt;spatialData.moveSpeed += selectedCard.param; break; default: break; } // ç§»é™¤é€‰ä¸­å¡ç‰‡ï¼Œæ¸…ç†æœªé€‰ä¸­å¡ç‰‡ï¼Œé‡ç½®é€‰å¡çŠ¶æ€ m_selectionSlots.erase(m_selectionSlots.begin() + slotIndex); returnUnselectedCards(); m_isSelecting = false; return true; } // è¾…åŠ©æ¥å£ï¼šæœªé€‰ä¸­çš„å¡ç‰‡å›åº“ void returnUnselectedCards() { for (uint8_t i = 0; i \u0026lt; m_selectionSlots.size(); ++i) { // è·³è¿‡é€‰ä¸­çš„å¡ç‰‡ï¼ˆslotIndexå·²å¤„ç†ï¼‰ m_cardWarehouse.push_back(m_selectionSlots[i]); } m_selectionSlots.clear(); } void drawSelectionUI() { if (!m_isSelecting) { return; // éé€‰å¡çŠ¶æ€ï¼Œæ— éœ€ç»˜åˆ¶ } // ç»˜åˆ¶é€‰å¡æ§½UIï¼ˆç®€åŒ–ç¤ºä¾‹ï¼Œå®é™…æ ¹æ®UIæ¡†æ¶å®ç°ï¼‰ for (uint8_t i = 0; i \u0026lt; m_selectionSlots.size(); ++i) { OLED_PrintString(10, 10 + (i * 20), m_selectionSlots[i].name, \u0026amp;font8x6, OLED_COLOR_NORMAL); } OLED_DrawCircle(5, 12 + (m_selectedIndex * 20), 2, OLED_COLOR_NORMAL); // ç»˜åˆ¶é€‰ä¸­æŒ‡ç¤ºå™¨ } }; #endif // GAMEPERKCARDMANAGER_HPP åº”ç”¨é€»è¾‘å±‚ æŒ‰â€œä¸»å¾ªç¯é©±åŠ¨ã€è¾“å…¥åˆ†å‘ã€æ¸²æŸ“è¾“å‡ºâ€ä¸‰ç±»èŒè´£æ‹†åˆ†æˆç‹¬ç«‹çš„ FreeRTOS ä»»åŠ¡ï¼Œå…¨å±€çŠ¶æ€ä½œä¸ºé—¨æ§ï¼Œä¿è¯åœ¨è¿‡åœºã€é€‰å¡ã€æˆ˜æ–—ä¸‰ç§æ¨¡å¼ä¹‹é—´å¹³æ»‘åˆ‡æ¢ã€‚\næ ¸å¿ƒæ•°æ®ä¸è¡Œä¸ºæ¨è¿›é›†ä¸­åœ¨Â gameControlThreadï¼Œè¾“å…¥è§£æä¸çŠ¶æ€å†™å…¥åœ¨Â keyScanThreadï¼Œç”»é¢ç»„åˆä¸è¾“å‡ºåœ¨Â oledTaskThreadã€‚\nç»™å‡ºä¼ªä»£ç å¦‚ä¸‹ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 oledTaskThread: åˆå§‹åŒ–: delay(30) â†’ OLED_Init() æ¯å¸§: OLED_NewFrame() è‹¥ !g_entityManager.isGameOver: è‹¥ g_progressManager.isPlayingOpeningCG: drawOpeningCG() å¦åˆ™è‹¥ g_progressManager.isPlayingClearCG: drawClearCG() å¦åˆ™è‹¥ g_progressManager.showBoss: drawShowBoss() å¦åˆ™è‹¥ g_perkCardManager.m_isSelecting \u0026amp;\u0026amp; g_perkCardManager.isInited: drawSelectionUI() å¦åˆ™ï¼ˆæˆ˜æ–—ç•Œé¢ï¼‰: è‹¥ç©å®¶å­˜åœ¨: drawPlayerHUD(HP, LV) g_entityManager.drawAllRoles()ï¼›g_entityManager.drawAllBullets() OLED_ShowFrame() delay(controlDelayTime * 2) keyScanThread: åˆå§‹åŒ–: scanDelay=40 â†’ key.init() æ¯è½®: key.scan() è‹¥æ¸¸æˆè¿›è¡Œä¸­ï¼ˆé GameOver/å¼€åœº/Boss å±•ç¤º/é€šå…³ï¼‰: è‹¥ !g_perkCardManager.m_isSelectingï¼ˆæˆ˜æ–—è¾“å…¥æ€ï¼‰: scanDelay=40 pLeadingRole = (LeadingRole*) g_entityManager.getPlayerRole() è‹¥ç©å®¶å­˜åœ¨: æŒ‰é”®æ˜ å°„åˆ°åŠ¨ä½œæ€ä¸æ–¹å‘ï¼ˆLEFT/DOWN/UP/RIGHT â†’ ActionState::MOVING + MoveModeï¼‰ å¦åˆ™ï¼ˆé€‰å¡è¾“å…¥æ€ï¼‰: scanDelay=100 å…‰æ ‡ç´¢å¼•åœ¨ [0, m_selectedSize-1] é—´å¤¹ç´§ keyDown â†’ ç´¢å¼•+1ï¼ˆä¸Šé™ä¿æŠ¤ï¼‰ï¼›keyUp â†’ ç´¢å¼•-1ï¼ˆä¸‹é™ä¿æŠ¤ï¼‰ keyConfirm â†’ g_perkCardManager.selectCard(m_selectedIndex) delay(scanDelay) gameControlThread: å¯åŠ¨: g_entityManager.isGameOver = trueï¼ˆå¼ºåˆ¶åˆå§‹é‡ç½®ï¼‰ æ¯è½®: è‹¥ g_entityManager.isGameOver: g_progressManager.resetGameProgress()ï¼ˆæ¸…ç©ºå®ä½“â†’æ·»åŠ ç©å®¶â†’åˆå§‹åŒ–å¡æ± â†’å¼€åœºåŠ¨ç”»è®¡æ—¶ï¼‰ å¦åˆ™è‹¥é€»è¾‘å¯æ¨è¿›ï¼ˆéå¼€åœº/éBosså±•ç¤º/éé€šå…³/éé€‰å¡ï¼‰: è¿›åº¦æ¨è¿›: g_progressManager.updateGameProgress()ï¼ˆæ¸…åœºåˆ¤å®šâ†’æ³¢æ¬¡/å…³å¡é€’è¿›â†’åŠç¨‹/è¿‡å…³è§¦å‘é€‰å¡â†’AddWaveEnemies()ï¼‰ è¡Œä¸ºé˜¶æ®µ: g_entityManager.updateAllRolesActions()ï¼›g_entityManager.updateAllBulletsActions() çŠ¶æ€é˜¶æ®µ: g_entityManager.updateAllRolesState()ï¼ˆAABBç¢°æ’â†’æ–¹å‘åˆ¤å®šâ†’ä½ç§»/å›é€€â†’å†·å´/çƒ­é‡/å›è¡€â†’ç©å®¶ levelUp()ï¼‰ g_entityManager.updateAllBulletsState()ï¼ˆå‘½ä¸­æ£€æµ‹â†’èŒƒå›´ä¼¤å®³â†’ä½ç§»/å¯¿å‘½ï¼‰ æ¸…ç†é˜¶æ®µ: cleanupInvalidRoles()ï¼ˆæ•Œäººæ­»äº¡å‘ç»éªŒã€ç©å®¶æ­»äº¡ç½® GameOverï¼‰ï¼›cleanupInvalidBullets() delay(controlDelayTime) timerå®šæ—¶å™¨çš„è®¾è®¡ ä»£ç æ¯”è¾ƒé‡ç‚¹ä¸€ä¸ªè®¾è®¡åœ¨äºtimerè®¡æ—¶å™¨ï¼Œæ¯ä¸€å¸§å¢åŠ æˆ–å‡å°‘å¸§é—´éš”çš„æ—¶é—´ï¼ˆç›¸å½“äºå†³å®šå¤šå°‘å¸§è§¦å‘æŸä¸€ä¸ªåŠ¨ä½œï¼Œå¯ä»¥ç”¨æ­¤æ¥ä½œä¸ºä¸€ä¸ªé—¨æ§ï¼‰\nshootCooldownTimerï¼šå°„å‡»å†·å´å€’è®¡æ—¶ï¼Œå½’é›¶å‰ç¦æ­¢å†æ¬¡å¼€ç«ã€‚ heatCoolDownTimerï¼šçƒ­é‡å†·å´è§¦å‘é—´éš”è®¡æ—¶ï¼Œç´¯è®¡åˆ°é˜ˆå€¼ï¼ˆ200msï¼‰é™ä½ä¸€æ¬¡çƒ­é‡ã€‚ healTimeCounterï¼šè¢«åŠ¨å›è¡€ç´¯ç§¯æ—¶é—´ï¼Œè¾¾åˆ°é˜ˆå€¼ï¼ˆhealResetTimeï¼‰å›å¤ healValueã€‚ deathTimerï¼šæ­»äº¡åä¿ç•™ä¸åŠ¨ç”»å±•ç¤ºæ—¶é—´çª—ï¼Œä¾¿äºå»¶è¿Ÿæ¸…ç†ã€‚ consecutiveCollisionCountï¼ˆè®¡æ•°å‹â€œæ—¶é—´æ›¿ä»£â€ï¼‰ï¼šè¿ç»­å¸§ç¢°æ’ç´¯è®¡ï¼Œæ‰©å¤§å›é€€æ­¥å¹…ç›´è‡³è§£é™¤ã€‚ action_timerï¼ˆæ•Œäºº/æŠ€èƒ½å†…éƒ¨ä½¿ç”¨ï¼‰ï¼šé©±åŠ¨æ”»å‡»æ¨¡å¼é˜¶æ®µåˆ‡æ¢ä¸æŠ€èƒ½èŠ‚æ‹ã€‚ openingCGTimer / clearCGTimer / showBossTimerï¼ˆè¿‡åœºç±»ï¼‰ï¼šæ§åˆ¶å¼€åœºã€é€šå…³ã€Boss å±•ç¤ºæŒç»­æ—¶é—´ã€‚ shootCooldownResetTime / healResetTime ç­‰â€œé˜ˆå€¼å‹å¸¸é‡â€ï¼šå®šä¹‰å€’è®¡æ—¶èµ·ç‚¹æˆ–è§¦å‘å‘¨æœŸé•¿åº¦ã€‚ æ ¸å¿ƒï¼šæ‰€æœ‰è®¡æ—¶å™¨æ˜¯â€œç¦»æ•£æ­¥é•¿ + é˜ˆå€¼è§¦å‘â€æ¨¡å‹ å¢åŠ æ¯ä¸€å¸§çš„controlDelayTimeï¼Œç”¨ç»Ÿä¸€å¸§æ­¥é•¿é©±åŠ¨ä¸€ç»„ç®€å•çš„çº¿æ€§è®¡æ—¶å™¨ï¼Œä»¥é—¨æ§›è§¦å‘å’ŒåŒé‡çº¦æŸå¡‘é€ èŠ‚å¥ä¸èµ„æºå¾ªç¯\næ ¸å¿ƒä½œç”¨ï¼šè§£è€¦æ—¶é—´è¿›ç¨‹å’Œè¡Œä¸ºï¼Œè®¡æ—¶å™¨åªç®¡ç†æ—¶é—´è¿›ç¨‹ï¼Œä¸ç›´æ¥è€¦åˆè¡Œä¸ºï¼›è¡Œä¸ºåœ¨è§¦å‘ç‚¹è¯»å–çŠ¶æ€æ‰§è¡Œã€‚\n","date":"2025-11-27T18:23:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/chiptanks-%E5%9F%BA%E4%BA%8Ecc-%E6%B7%B7%E7%BC%96%E7%9A%84stm32oled%E8%BF%B7%E4%BD%A0%E6%B8%B8%E6%88%8F%E6%8E%8C%E6%9C%BA%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE%E5%BC%80%E5%8F%91/","title":"ChipTanks-åŸºäºC\u0026C++æ··ç¼–çš„STM32OLEDè¿·ä½ æ¸¸æˆæŒæœºä¸ªäººé¡¹ç›®å¼€å‘"},{"content":"è®¾è®¡æ€è·¯ç®€ä»‹ æ¸¸æˆç±»å‹è®¾è®¡ åµŒå…¥å¼å¹³å°ä¸Šçš„â€œå±±æµ·ç»â€é¢˜æ Rougelite å¼¹å¹•å°„å‡»æ¸¸æˆï¼ˆSTGï¼‰\næ¨ªç‰ˆ/ç«–ç‰ˆå°„å‡» (Shoot \u0026rsquo;em up / STG)ï¼š æ¸¸æˆçš„æ ¸å¿ƒç©æ³•æ˜¯æ§åˆ¶ä¸»è§’åœ¨ OLED å±å¹•ä¸Šç§»åŠ¨ï¼Œå‘å°„å­å¼¹æ¶ˆç­æºæºä¸æ–­çš„æ•Œäººã€‚\nRoguelite (è½»åº¦è‚‰é¸½)ï¼š éšæœºæˆé•¿ï¼šåŒ…å« PerkCardÂ ç³»ç»Ÿå’Œ gamePerkCardManagerã€‚ç©å®¶å‡çº§åä¼šè§¦å‘ Perk é€‰æ‹©ï¼ˆå¦‚â€œæ”»é€Ÿæå‡â€ã€â€œè§£é”ç«çƒâ€ã€â€œè§£é”é—ªç”µâ€ï¼‰ï¼Œæ¯æ¬¡æ¸¸ç©çš„æ„å»ºï¼ˆBuildï¼‰éƒ½æ˜¯ä¸åŒçš„ã€‚ æ°¸ä¹…æ­»äº¡/å•å±€è¿›ç¨‹ï¼šé€šå¸¸æ­¤ç±»åµŒå…¥å¼æ¸¸æˆä¸ºå•å±€æŒ‘æˆ˜æ¨¡å¼ã€‚\nçƒ­é‡ç³»ç»Ÿ (Overheat System)ï¼šä¸åŒäºä¼ ç»Ÿçš„æ— é™å°„å‡»ï¼Œæ¸¸æˆå¼•å…¥äº†â€œçƒ­é‡â€æœºåˆ¶ï¼ˆheatDataï¼‰ã€‚æ™®é€šå­å¼¹ã€ç«çƒã€é—ªç”µæ¶ˆè€—ä¸åŒçš„çƒ­é‡ï¼Œè¿‡çƒ­å¯èƒ½å¯¼è‡´æ— æ³•å°„å‡»ã€‚è¿™è¦æ±‚ç©å®¶åœ¨â€œçˆ†å‘è¾“å‡ºâ€å’Œâ€œæ§æ¸©â€ä¹‹é—´åšå†³ç­–ï¼Œå¢åŠ äº†æˆ˜æœ¯æ·±åº¦ã€‚\næ¸¸æˆèƒŒæ™¯è®¾è®¡ åŸºäºä¸­å›½å¤ä»£ç¥è¯å…¸ç±ã€Šå±±æµ·ç»ã€‹ã€‚æ‰€æœ‰çš„æ•Œäººéƒ½æ˜¯å¤ä»£ç¥è¯ä¸­çš„å¦–å…½ï¼Œæ‰€æœ‰æ•Œäººçš„è®¾è®¡å…ƒç´ å‡æ¥è‡ªäºã€Šå±±æµ·ç»ã€‹ã€‚\né€šè¿‡å°†å¤è€çš„ç¥è¯ç”Ÿç‰©ä¸â€œå¦å…‹/å°„å‡»â€ã€â€œOLED æ˜¾ç¤ºâ€ã€â€œçƒ­é‡è¿‡è½½â€ç­‰ç§‘æŠ€å…ƒç´ ç»“åˆå½¢æˆåå·®ã€‚\næ•Œäººï¼š å°æ€ªï¼šé£å»‰ï¼ˆé£ç¥ï¼‰ã€è›Šé›•ï¼ˆé£Ÿäººé›•ï¼‰ã€é­‘é­…ï¼ˆå±±æ—é¬¼æ€ªï¼‰ BOSSï¼šä¸Šå¤å››å‡¶ï¼ˆé¥•é¤®ã€æ¢¼æŒï¼‰å’Œå‡¶ç¥ï¼ˆç›¸æŸ³ï¼‰ æ¸¸æˆå…·ä½“è®¾è®¡ æœºåˆ¶è®¾è®¡ æ‰€æœ‰è§’è‰²éµå¾ªä»¥ä¸‹åŸºç¡€ç‰©ç†ä¸æˆ˜æ–—å…¬å¼ï¼š\n1. åŸºç¡€æˆ˜æ–—æœºåˆ¶ å°„å‡»å†·å´ (Cooldown):Â å°„å‡»é—´éš”(ms) = resetTime / Speedã€‚ çƒ­é‡æœºåˆ¶ (Heat): å†·å´é€Ÿç‡:Â åŸºç±» IRole::update() æ¯ 500ms ç»“ç®—ä¸€æ¬¡ï¼Œå‡å°‘ heatCoolDownRate * 5 ç‚¹çƒ­é‡ï¼ˆç­‰æ•ˆæ¯ç§’ heatCoolDownRate * 10ï¼‰ã€‚ çƒ­é‡æ¶ˆè€—å€ç‡ï¼ˆä¸ heatPerShot åŸºå€¼ç›¸ä¹˜ï¼‰: æ™®é€šå­å¼¹:Â 1.0x ç«çƒå¼¹:Â 2.0x é—ªç”µé“¾:Â 2.0x ï¼ˆå½“å‰å®ç°ï¼‰ ä¼¤å®³è®¡ç®—: æ™®é€šå­å¼¹:Â Damage = attackPower ç«çƒå¼¹:Â Damage = attackPower + 10Â (ç›´æ¥ä¼¤å®³ + èŒƒå›´ä¼¤å®³)ï¼ˆé€ æˆä¸¤æ¬¡ï¼‰ é—ªç”µé“¾:Â Damage = (multiplier * attackPower) + 30Â (ç©¿é€ä¼¤å®³ æ¢å¤è®¡ç®—ï¼šæ¢å¤é—´éš”(ms) = resetTime / Speed , æ¢å¤é‡ = healValue å­å¼¹è®¾è®¡é€»è¾‘ï¼Œç«çƒå¼¹æ˜¯å¤§èŒƒå›´æ¸…æ‚å­å¼¹ï¼Œé—ªç”µé“¾æ˜¯é«˜ä¼¤å®³ç©¿é€å­å¼¹\n2.å‡çº§æœºåˆ¶ (Level-Up Mechanism) å‡çº§æ˜¯ç©å®¶æˆé•¿çš„åŸºç¡€é©±åŠ¨åŠ›ã€‚\nç»éªŒè·å– (XP Gain)\næ¥æº: å‡»æ€æ•Œäººã€‚ æ•°å€¼: æ¯ä¸ªæ•Œäººéƒ½æœ‰å®šä¹‰çš„ dropExpï¼ˆæ‰è½ç»éªŒå€¼ï¼‰ã€‚ ä¾‹å¦‚ FeilianEnemyÂ æ„é€ å‡½æ•°ä¸­ä¼ å…¥ dropExp è¿‡ç¨‹: å½“æ•Œäººæ­»äº¡ï¼ˆdie()ï¼‰æ—¶ï¼Œå…¶ dropExpÂ ä¼šè¢«åŠ åˆ°ç©å®¶ï¼ˆLeadingRoleï¼‰çš„å½“å‰ç»éªŒæ± ä¸­ å‡çº§åˆ¤å®š\né˜ˆå€¼: ç©å®¶æ‹¥æœ‰ currentExpÂ å’Œ maxExpï¼ˆå‡çº§æ‰€éœ€ç»éªŒï¼‰ é€»è¾‘: å½“ currentExp \u0026gt;= maxExpÂ æ—¶ï¼Œè§¦å‘å‡çº§ æˆé•¿æ›²çº¿: å‡çº§åï¼Œä¸‹ä¸€çº§æ‰€éœ€çš„ maxExpÂ é€šå¸¸ä¼šå¢åŠ ï¼ˆä¾‹å¦‚ï¼šmaxExp = maxExp * 1.2Â æˆ–å›ºå®šå¢é‡ï¼‰ï¼Œå¢åŠ å‡çº§éš¾åº¦ å‡çº§åçš„åŸºç¡€æå‡ (Base Stat Growth) æ¯æ¬¡å‡çº§ï¼Œç©å®¶è§’è‰²ä¼šè‡ªåŠ¨è·å¾—ä¸€äº›åŸºç¡€å±æ€§çš„æå‡ï¼Œæ— éœ€é€‰æ‹©ï¼š\nç”Ÿå‘½å€¼ä¸Šé™ (Max Health): æå‡ç”Ÿå­˜èƒ½åŠ›ï¼ˆä¾‹å¦‚ maxHealth += 10ï¼‰ã€‚ å›æ»¡è¡€: å‡çº§é€šå¸¸ä¼´éšç€çŠ¶æ€æ¢å¤ æ”»å‡»åŠ›/çƒ­é‡ä¸Šé™: å¯èƒ½ä¼´éšå¾®é‡çš„çº¿æ€§æˆé•¿ï¼ˆå–å†³äº LeadingRoleÂ çš„å…·ä½“å®ç°ï¼‰ è§¦å‘ç‰¹æ®Šäº‹ä»¶ Perk é€‰æ‹©: æ¯éš”ç‰¹å®šç­‰çº§ï¼ˆæ¯ 2 çº§ï¼‰ï¼Œè§¦å‘ä¸€æ¬¡ PerkCard é€‰æ‹© å½¢æ€å˜åŒ–: ï¼Œä¼šæ”¹å˜è§’è‰²çš„åŸºç¡€æ”»é€Ÿ 3.PerkCard æœºåˆ¶ (å¤©èµ‹å¡ç‰‡ç³»ç»Ÿ) PerkCard æ˜¯æ¸¸æˆçš„Roguelikeæ ¸å¿ƒå…ƒç´ ï¼Œå…è®¸ç©å®¶åœ¨å•å±€æ¸¸æˆä¸­æ„å»ºä¸åŒçš„æˆ˜æ–—æµæ´¾ã€‚ å¡ç‰‡å®šä¹‰ å¡ç‰‡åŒ…å«ä»¥ä¸‹å±æ€§ï¼š\nType (ç±»å‹): æšä¸¾å€¼ï¼Œå†³å®šå¡ç‰‡çš„åŠŸèƒ½ã€‚ Name (åç§°): æ˜¾ç¤ºåœ¨ OLED å±å¹•ä¸Šçš„æ–‡æœ¬ï¼ˆå¦‚ \u0026ldquo;Attack +5\u0026rdquo;ï¼‰ã€‚ Param (å‚æ•°): æ•°å€¼å¼ºåº¦ï¼ˆå¦‚åŠ  5 ç‚¹æ”»å‡»ï¼Œå‚æ•°å°±æ˜¯ 5ï¼‰ã€‚ å¡ç‰‡ç±»å‹ä¸æ•ˆæœè¯¦è§£ å¡ç‰‡ç±»å‹ æ•ˆæœæè¿° å…³è”ä»£ç å˜é‡ HEAL_SPEED_UP æå‡å›è¡€é€Ÿåº¦ healthData.healSpeed HEAL_AMOUNT_UP æå‡å•æ¬¡å›å¤é‡ healthData.healValue HEALTH_UP æå‡ç”Ÿå‘½ä¸Šé™ healthData.maxHealth ATTACK_UP æå‡åŸºç¡€æ”»å‡»åŠ› attackData.attackPower ATTACK_SPEED_UP æå‡å°„å‡»é¢‘ç‡ attackData.shootCooldownSpeed HEAT_CAPACITY_UP æå‡çƒ­é‡ä¸Šé™ heatData.maxHeat HEAT_COOL_DOWN_UP æå‡æ•£çƒ­é€Ÿåº¦ heatData.heatCoolDownRate UNLOCK_FIREBALL è§£é”æ–°æ­¦å™¨ ç©å®¶è§£é”æ–°çš„å­å¼¹ UNLOCK_LIGHTNING è§£é”æ–°æ­¦å™¨ ç©å®¶è§£é”æ–°çš„å­å¼¹ FIREBALL_RANGE_UP æå‡ç«çƒçˆ†ç‚¸èŒƒå›´ attackData.bulletRange LIGHTNING_MULTIPLIER æå‡é—ªç”µä¼¤å®³å€ç‡ attackData.bulletDamageMultiplier MOVE_SPEED_UP æå‡ç§»åŠ¨é€Ÿåº¦ spatialData.moveSpeed æµæ´¾æ„å»º é€šè¿‡å‡çº§å’Œ Perk çš„ç»„åˆï¼Œç©å®¶å¯ä»¥å½¢æˆä¸åŒçš„ç­–ç•¥ï¼š\nåŠ ç‰¹æ—æµ (é«˜æ”»é€Ÿ + é«˜æ•£çƒ­): é‡ç‚¹é€‰æ‹© ATTACK_SPEED_UPÂ å’Œ HEAT_COOL_DOWN_UPã€‚ ç»“æœï¼šå‘å°„æ™®é€šå­å¼¹åƒæ³¼æ°´ä¸€æ ·ï¼Œåˆ©ç”¨é«˜é¢‘ç‡è§¦å‘ä¼¤å®³ã€‚ é‡ç‚®æµ (ç«çƒ + çˆ†ç‚¸èŒƒå›´ + é«˜æ”»å‡»): é‡ç‚¹é€‰æ‹© UNLOCK_FIREBALL,Â ATTACK_UP,Â FIREBALL_RANGE_UPã€‚ ç»“æœï¼šæ”»é€Ÿæ…¢ï¼Œä½†ä¸€å‘ç«çƒèƒ½æ¸…ç©ºä¸€ç‰‡åŒºåŸŸã€‚ é›·ç¥æµ (é—ªç”µ + å€ç‡ + é«˜æ”»å‡» ): é‡ç‚¹é€‰æ‹© UNLOCK_LIGHTNING,Â LIGHTNING_MULTIPLIER_UPã€‚ ç»“æœï¼šåˆ©ç”¨é—ªç”µçš„ç©¿é€ç‰¹æ€§å’Œé«˜å€ç‡ä¼¤å®³ï¼Œç¬é—´ç§’æ€ç›´çº¿ä¸Šçš„æ•Œäººã€‚ å¦å…‹æµ (å›è¡€ + é«˜è¡€é‡): é‡ç‚¹é€‰æ‹© HEALTH_UP,Â HEAL_SPEED_UPã€‚ ç»“æœï¼šä¾é ä¸­çš„è‡ªåŠ¨å›è¡€é€»è¾‘ï¼ˆhealTimeCounterï¼‰ï¼Œç¡¬æŠ—æ•Œäºº æ•Œäººè®¾è®¡é£æ ¼ å®šä½ Fodder (ç‚®ç°/éªšæ‰°)ï¼šé£å»‰ï¼ˆé«˜æœºåŠ¨ä½ä¼¤ï¼‰ã€é­‘é­…ï¼ˆè‡ªçˆ†å¡è½¦ï¼‰ï¼Œä¸»è¦ç”¨äºå¹²æ‰°èµ°ä½å’Œæ¶ˆè€—ç©å®¶ç²¾åŠ›ã€‚\nElite (ç²¾è‹±/é«˜å¨èƒ)ï¼šé©³ã€èƒœé‡ã€ç‹¸åŠ›ï¼Œæ‹¥æœ‰å¤šç§æ”»å‡»æ¨¡å¼ï¼Œå¼ºè¿«ç©å®¶è¿›è¡Œç‰¹å®šèµ°ä½å’Œç­–ç•¥åº”å¯¹ã€‚è›Šé›•æ‹¥æœ‰äº¡è¯­æœºåˆ¶ï¼ˆæ­»åå‘ç«çƒï¼‰ã€‚\nBoss (é¦–é¢†)ï¼šæ‹¥æœ‰å¤šé˜¶æ®µæˆ–å¤šæŠ€èƒ½å¾ªç¯ã€‚ é¥•é¤®ï¼šè¿‘æˆ˜ç³» BOSSï¼Œå¼ºè°ƒä½ç§»æ§åˆ¶ï¼ˆæ‹‰äººã€å†²æ’ï¼‰ã€‚ æ¢¼æŒï¼šæ•æ·ç³» BOSSï¼Œå¼ºè°ƒååº”é€Ÿåº¦ï¼ˆé—ªç°ã€ç‹‚æš´å¼¹å¹•ï¼‰ã€‚ ç›¸æŸ³ï¼šæ³•å¸ˆ/å¬å”¤ç³» BOSSï¼Œå¼ºè°ƒå…¨å±èº²é¿å’Œå¤„ç†å°æ€ªï¼ˆAOEã€å¬å”¤ï¼‰ã€‚ æ··æ²Œï¼šå››å‡¶ä¹‹é¦–ï¼Œæ··ä¹±ç³» BOSSï¼Œå¼ºè°ƒè§†é‡å¹²æ‰°ã€éšæœºå¼¹å¹•å’Œç‰µå¼•ç©å®¶ã€‚\næ”»å‡»æœºåˆ¶ä¸æ•°å€¼ 1. é£å»‰ (FeilianEnemy) å®šä½ï¼šå°å‹é«˜é€Ÿéªšæ‰°è€… åŸå‹ï¼šé£ç¥ï¼Œé¹¿èº«ç¿¼è§’ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š12x12 (å°) ç§»åŠ¨ï¼šé«˜é€Ÿï¼Œè½¨è¿¹é£˜å¿½ä¸å®šï¼ˆæ¨¡æ‹Ÿé£çš„ç‰¹æ€§ï¼‰ã€‚ æ”»å‡»åŠ›ï¼šä½ã€‚ æ­»äº¡åŠ¨ç”»ï¼š250msã€‚ æ”»å‡»æ–¹å¼ï¼š æ™®é€šå°„å‡»ï¼šåªå‘å°„æ™®é€šå­å¼¹ã€‚ æˆ˜æœ¯æ„ä¹‰ï¼šå•ä½“å¨èƒå°ï¼Œä¾é æ•°é‡å’Œéš¾ä»¥é¢„æµ‹çš„ç§»åŠ¨è½¨è¿¹å¹²æ‰°ç©å®¶ï¼Œæ¶ˆè€—ç©å®¶çš„æ³¨æ„åŠ›ã€‚ 2. è›Šé›• (GudiaoEnemy) å®šä½ï¼šä¸­å‹ä¼å‡»è€… åŸå‹ï¼šé£ŸäººçŒ›ç¦½ï¼Œä¼¼é›•æœ‰è§’ï¼ŒéŸ³å¦‚å©´å„¿ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š15x15 (ä¸­) ç§»åŠ¨ï¼šä¸­é€Ÿï¼Œé£è¡Œè½¨è¿¹è¾ƒç›´æ¥ã€‚ æ”»å‡»åŠ›ï¼šè¾ƒé«˜ã€‚ æ­»äº¡åŠ¨ç”»ï¼š250msã€‚ æ”»å‡»æ–¹å¼ï¼š åŒä¾§å°„å‡»ï¼šæ¯æ¬¡ä»èº«ä½“ä¸­å¿ƒçš„ä¸¤ä¾§å‘å°„æ™®é€šå­å¼¹ï¼ˆé«˜ä¼¤å®³ï¼‰ã€‚ äº¡è¯­ï¼ˆDeath Rattleï¼‰ï¼šæ­»äº¡åä¼šå‘å°„ä¸€é¢—ç«çƒå¼¹ï¼Œå¯¹å‡»æ€è€…é€ æˆæœ€åå¨èƒã€‚ æˆ˜æœ¯æ„ä¹‰ï¼šéœ€è¦ä¼˜å…ˆå¤„ç†çš„é«˜ä¼¤å®³å•ä½ï¼Œä¸”å‡»æ€æ—¶éœ€æ³¨æ„èº²é¿äº¡è¯­å­å¼¹ã€‚ 3. é­‘é­… (ChiMeiEnemy) å®šä½ï¼šè‡ªæ€å¼å†²é”‹æ€ª åŸå‹ï¼šå±±æ—é¬¼æ€ªï¼Œè¿·æƒ‘äººå¿ƒã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š8x8 (æå°) ç§»åŠ¨ï¼šé«˜é€Ÿã€‚ æ­»äº¡åŠ¨ç”»ï¼š250msã€‚ æ”»å‡»æ–¹å¼ï¼š è‡ªæ€å†²æ’ï¼šä¸å‘å°„å­å¼¹ï¼Œé€šè¿‡é«˜é€Ÿç§»åŠ¨ç›´æ¥æ’å‡»ç©å®¶é€ æˆä¼¤å®³ã€‚ æˆ˜æœ¯æ„ä¹‰ï¼šè¿«ä½¿ç©å®¶ä¿æŒç§»åŠ¨ï¼Œä¸èƒ½åœç•™åœ¨åŸåœ°ã€‚ 4. é¥•é¤® (TaotieEnemy) å®šä½ï¼šè¿‘æˆ˜å¦å…‹å‹ BOSS åŸå‹ï¼šå››å‡¶ä¹‹ä¸€ï¼Œè´ªå©ªï¼Œåå™¬ä¸‡ç‰©ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š64x64 (å·¨å¤§) HPï¼šé«˜è¡€é‡ã€‚ æ”»å‡»åŠ›ï¼šé«˜ã€‚ ç§»åŠ¨ï¼šä½é€Ÿã€‚ æ­»äº¡åŠ¨ç”»ï¼š500msã€‚ æ”»å‡»æ–¹å¼ (5 ç§æ¨¡å¼)ï¼š åå™¬ (Devour)ï¼šå°†ç©å®¶å‘è‡ªå·±æ‹‰è¿‘ (pullDistance = 30)ï¼Œç„¶åè¿›è¡Œæ”»å‡»ã€‚ å¼¹å¹•ï¼šå‘å°„ä¸‰æ’æ™®é€šå­å¼¹ã€‚ å†²æ’ (Ram)ï¼šå‘å‰å†²é”‹ (chargeDistance = 30) è¿›è¡Œæ’å‡»ã€‚ ç¢¾å‹ (Crush)ï¼šä»ç©å®¶å·¦ä¾§å‡ºç° (crushChargeDistance = 100)ï¼Œå‘åç¢¾å‹ï¼Œå°é”èµ°ä½ã€‚ ç»„åˆæŠ€ï¼šå°†ç©å®¶æ‹‰è¿‘ï¼ŒåŒæ—¶å‘å‰å†²é”‹ (pullAndChargeDistance = 50)ã€‚ 5. æ¢¼æŒ (TaowuEnemy) å®šä½ï¼šé«˜æœºåŠ¨å¼¹å¹•å‹ BOSS åŸå‹ï¼šå››å‡¶ä¹‹ä¸€ï¼Œé¡½å›ºå‡¶æš´ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š64x64 (å·¨å¤§) HPï¼šä½è¡€é‡ï¼ˆç›¸å¯¹å…¶ä»– BOSSï¼‰ã€‚ æ”»å‡»åŠ›ï¼šé«˜ã€‚ ç§»åŠ¨ï¼šé«˜é€Ÿï¼Œæ“…é•¿é—ªç° (Blink)ã€‚ æ­»äº¡åŠ¨ç”»ï¼š500msã€‚ æ”»å‡»æ–¹å¼ (6 ç§æ¨¡å¼)ï¼š ç‹‚æš´å¼¹å¹•ï¼šé—ªç°è‡³ä¸­é—´ï¼Œéšæœºå‘å°„å¤§é‡æ™®é€šå­å¼¹ã€‚ç‹‚æš´æœºåˆ¶ï¼šè¡€é‡è¶Šä½ï¼ŒæŒç»­æ—¶é—´è¶Šé•¿ï¼ˆ3 ç§’ -\u0026gt; 6 ç§’ï¼‰ï¼Œé¢‘ç‡ 5 å‘/ç§’ã€‚ éšæœºç«çƒï¼šéšæœºä½ç½®å‘å°„ 5 ä¸ªç«çƒå¼¹ã€‚ æ··åˆå°„å‡»ï¼šä¸­é—´å‘å°„ 1 é¢—ç«çƒï¼Œä¸¤ä¾§è¾¹ç¼˜å„å‘å°„ 2 é¢—æ™®é€šå­å¼¹ã€‚ ç¼ºå£é˜µå‹ï¼šå‘å°„ä¸€æ’å­å¼¹ï¼Œä»…ä¸­é—´ç•™æœ‰ç¼ºå£ï¼ˆè¿«ä½¿ç©å®¶é’»ç¼ï¼‰ã€‚ è¯¡é›·é—ªç°ï¼šåŸåœ°ç•™ä¸‹ä¸€é¢—ç«çƒå¼¹ï¼Œæœ¬ä½“æ¶ˆå¤±ã€‚ è¿½å‡»é—ªç°ï¼šæ¶ˆé™¤å†·å´ CDï¼Œç›´æ¥é—ªç°å¯¹é½ç©å®¶ä½ç½®ã€‚ 6. ç›¸æŸ³ (XiangliuEnemy) å®šä½ï¼šå¬å”¤ä¸å…¨å±å‹åˆ¶å‹ BOSS åŸå‹ï¼šä¹å¤´è›‡æ€ªï¼Œæ‰€è¿‡ä¹‹å¤„å°½æˆæ³½å›½ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š64x64 (å·¨å¤§) HPï¼šé«˜è¡€é‡ã€‚ æ”»å‡»åŠ›ï¼šé«˜ã€‚ ç§»åŠ¨ï¼šä¸­é€Ÿã€‚ æ­»äº¡åŠ¨ç”»ï¼š500msã€‚ æ”»å‡»æ–¹å¼ (6 ç§æ¨¡å¼)ï¼š ä¹å¤´é½å°„ï¼šå‘å°„ 9 æ’Â æ™®é€šå­å¼¹ï¼ˆè¦†ç›–é¢æå¤§ï¼‰ã€‚ é›·ç‹±ï¼šå‘å°„ 3 æ’Â é—ªç”µé“¾ï¼ˆç©¿é€ä¼¤å®³ï¼‰ã€‚ ç«æµ·ï¼šå‘å°„ 3 æ’Â ç«çƒå¼¹ï¼ˆèŒƒå›´çˆ†ç‚¸ï¼‰ã€‚ å¬å”¤é­‘é­…ï¼šç”Ÿæˆ 3 åªè‡ªçˆ†æ€ª (ChiMei) ååŒä½œæˆ˜ã€‚ å¬å”¤é£å»‰ï¼šç”Ÿæˆ 2 åªé«˜é€Ÿæ€ª (Feilian) ååŒä½œæˆ˜ã€‚ å¬å”¤è›Šé›•ï¼šç”Ÿæˆ 1 åªé«˜ä¼¤æ€ª (Gudiao) ååŒä½œæˆ˜ã€‚ 7. æ··æ²Œ (HundunEnemy) - å››å‡¶ä¹‹é¦– å®šä½ï¼šæ··ä¹±ä¸å¹²æ‰°å‹ BOSSï¼ˆå››å‡¶ä¹‹é¦–ï¼‰ åŸå‹ï¼šã€Šå±±æµ·ç»ã€‹è®°è½½å…¶å½¢å¦‚é»„å›Šï¼Œèµ¤å¦‚ä¸¹ç«ï¼Œå…­è¶³å››ç¿¼ï¼Œæ— é¢ç›®ï¼›ã€Šåº„å­ã€‹æœ‰\u0026quot;ä¸ƒçªå‡¿è€Œæ··æ²Œæ­»\u0026quot;å…¸æ•…ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š64x64 (å·¨å¤§) HPï¼šæœ€é«˜è¡€é‡ï¼ˆ400 + LevelÃ—1200ï¼‰ã€‚ æ”»å‡»åŠ›ï¼šä¸­é«˜ï¼ˆ8 + LevelÃ—6ï¼‰ã€‚ ç§»åŠ¨ï¼šä½é€Ÿä½†å¯ç¬ç§»ã€‚ æ­»äº¡åŠ¨ç”»ï¼š500msã€‚ æ”»å‡»æ–¹å¼ (6 ç§æ¨¡å¼)ï¼š æ··æ²Œæ¶ŒåŠ¨ï¼šéšæœºé—ªçƒç§»åŠ¨ï¼ŒåŒæ—¶å‘ 8 ä¸ªæ–¹å‘å‘å°„æ™®é€šå­å¼¹ï¼Œä½è¡€é‡æ—¶å¤¹æ‚ç«çƒã€‚æŒç»­ 3000msï¼Œæ¯ 500ms é—ªçƒä¸€æ¬¡ã€‚ ä¸ƒçªå°å°ï¼šåœ¨å±å¹•ä¸Šç”Ÿæˆ 7 ä¸ªé—ªçƒå¹²æ‰°åŒºåŸŸé®æŒ¡è§†é‡ï¼ŒæŒç»­ 2000msï¼ˆå‘¼åº”\u0026quot;ä¸ƒçªå‡¿è€Œæ··æ²Œæ­»\u0026quot;å…¸æ•…ï¼‰ã€‚ è™šç©ºç‰µå¼•ï¼šå°†ç©å®¶å‘æ··æ²Œä½ç½®ç¼“æ…¢æ‹‰è¿‘ï¼ŒåŒæ—¶å‘å°„è¿½è¸ªç«çƒã€‚æŒç»­ 2500msï¼Œæ¯ 300ms æ‹‰è¿‘ä¸€æ¬¡ã€‚ æ··æ²Œæ¼©æ¶¡ï¼šèºæ—‹å¼å‘å°„å­å¼¹ï¼ŒYä½ç½®æŒ‰æ­£å¼¦æ³¢æ‰«å°„ã€‚æŒç»­ 2000msï¼Œæ¯ 150ms å‘å°„ä¸€å‘ã€‚ æ—¶ç©ºè£‚éš™ï¼šå¿«é€Ÿå‘å°„å¸¦éšæœºç¼ºå£çš„å¼¹å¹•å¢™ï¼Œç¼ºå£ä½ç½®æ¯è½®å˜åŒ–ã€‚æŒç»­ 2500msï¼Œæ¯ 550ms å‘å°„ä¸€è½®ã€‚ å½’äºæ··æ²Œï¼šå…¨å±å¼¹å¹•æ”»å‡»ï¼Œä¸­é—´æœ‰å®‰å…¨ç¼ºå£ï¼Œè¡€é‡è¶Šä½ç¼ºå£è¶Šå°ã€‚è­¦å‘Š 500ms åå‘å°„ã€‚ 8. é©³ (BoEnemy) å®šä½ï¼šç²¾è‹±çº§ä¸­å‹æ•Œäºº åŸå‹ï¼šã€Šå±±æµ·ç»Â·è¥¿å±±ç»ã€‹è®°è½½ï¼Œé©¬å½¢ç¥å…½ï¼Œç™½èº«é»‘å°¾ï¼Œå¤´ç”Ÿç‹¬è§’ï¼Œæœ‰è™ç‰™è™çˆªï¼Œå«å£°å¦‚é¼“ï¼Œèƒ½æ•é£Ÿè™è±¹ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š24x24 (ä¸­) HPï¼š40 + LevelÃ—200 æ”»å‡»åŠ›ï¼š6 + LevelÃ—2 ç§»åŠ¨ï¼šä¸­é€Ÿï¼ˆ2ï¼‰ã€‚ æ­»äº¡åŠ¨ç”»ï¼š300msã€‚ æ”»å‡»æ–¹å¼ (3 ç§æ¨¡å¼)ï¼š å†²é”‹è·µè¸ï¼šå‘ç©å®¶æ–¹å‘å¿«é€Ÿç›´çº¿å†²é”‹ï¼Œé€ æˆç¢°æ’ä¼¤å®³ã€‚å†²é”‹è·ç¦» 40 åƒç´ ï¼ŒæŒç»­ 800msã€‚ è™ç‰™åˆ©çˆªï¼šå‘å°„ 3 å‘å‘ˆæ‰‡å½¢çš„æ™®é€šå­å¼¹ï¼ˆå‘¼åº”\u0026quot;è™ç‰™çˆª\u0026quot;ï¼‰ã€‚æŒç»­ 200msã€‚ é¼“éŸ³éœ‡è¡ï¼šå‘å°„ä¸€æ’æ¨ªå‘å†²å‡»æ³¢å­å¼¹ï¼ˆå‘¼åº”\u0026quot;éŸ³å¦‚é¼“éŸ³\u0026quot;ï¼‰ã€‚æŒç»­ 300msã€‚ 9. èƒœé‡ (ShengyuEnemy) å®šä½ï¼šç²¾è‹±çº§å¹²æ‰°å‹æ•Œäºº åŸå‹ï¼šã€Šå±±æµ·ç»Â·è¥¿æ¬¡ä¸‰ç»ã€‹è®°è½½ï¼Œèµ¤è‰²é‡é¸¡çŠ¶å‡¶å…½ï¼Œå«å£°ç‹¬ç‰¹ï¼Œå‡ºç°é¢„ç¤ºæ´ªæ°´ç¾å„ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š20x20 (ä¸­) HPï¼š50 + LevelÃ—220 æ”»å‡»åŠ›ï¼š10 + LevelÃ—4 ç§»åŠ¨ï¼šä¸­é€Ÿï¼ˆ2ï¼‰ã€‚ æ­»äº¡åŠ¨ç”»ï¼š300msã€‚ æ”»å‡»æ–¹å¼ (3 ç§æ¨¡å¼)ï¼š æ°´é›¾å¼¥æ¼«ï¼šåœ¨åœºæ™¯ä¸­ç”Ÿæˆ 2 ä¸ªè¿·é›¾åŒºåŸŸé®æŒ¡ç©å®¶è§†çº¿ï¼ˆå‘¼åº”\u0026quot;å¤§æ°´\u0026quot;å…¸æ•…ï¼‰ã€‚æŒç»­ 3000msã€‚ æ´ªæ³¢æ¨æ¶Œï¼šå¾€å‰æ¨å‡ºä¸€é•¿æ¡è¿·é›¾å±éšœï¼Œé•¿åº¦ 110 åƒç´ ï¼Œé€æ¸æ¶ˆæ•£ã€‚æŒç»­ 2800msã€‚ èµ¤ç¾½é›·é¸£ï¼šå‘å°„ä¸€ä¸² 5 å‘æ™®é€šå­å¼¹ï¼ˆå‘¼åº”\u0026quot;èµ¤\u0026quot;è‰²ç‰¹å¾ï¼‰ã€‚æ¯ 150ms å‘å°„ä¸€å‘ï¼ŒæŒç»­ 800msã€‚ 10. ç‹¸åŠ› (LiliEnemy) å®šä½ï¼šç²¾è‹±çº§åœŸç³»æ•Œäºº åŸå‹ï¼šã€Šå±±æµ·ç»Â·å—å±±ç»ã€‹è®°è½½ï¼ŒçŒªå½¢ç¥å…½ï¼Œé•¿æœ‰åˆ©çˆªï¼Œå«å£°å¦‚ç‹—å ï¼Œå‡ºç°é¢„ç¤ºå¤§é‡åœŸæœ¨å·¥ç¨‹ã€‚ æ•°å€¼è®¾å®šï¼š ä½“å‹ï¼š22x22 (ä¸­) HPï¼š60 + LevelÃ—160 æ”»å‡»åŠ›ï¼š6 + LevelÃ—3 ç§»åŠ¨ï¼šä¸­é€Ÿï¼ˆ2ï¼‰ã€‚ æ­»äº¡åŠ¨ç”»ï¼š300msã€‚ æ”»å‡»æ–¹å¼ (3 ç§æ¨¡å¼)ï¼š åœŸæ¶Œçªåˆºï¼šåœ¨å‰æ–¹é—´éš”å‘å°„ç«çƒå¼¹ï¼ˆåœŸå—çˆ†ç‚¸ï¼Œå‘¼åº”\u0026quot;åœŸåŠŸ\u0026quot;ï¼‰ã€‚æŒç»­ 1200msï¼Œæ¯ 400ms å‘å°„ä¸€å‘ã€‚ ç å éœ‡æ³¢ï¼šå‘å°„ 5 å‘æ‰‡å½¢æ™®é€šå­å¼¹é˜µï¼ˆå‘¼åº”\u0026quot;å…¶éŸ³å¦‚ç‹—å \u0026quot;ï¼‰ã€‚æŒç»­ 400msã€‚ ç©´åœ°é™·é˜±ï¼šåœ¨éšæœºä½ç½®æ ‡è®° 2 ä¸ªé™·é˜±ï¼Œå»¶è¿Ÿ 500ms åçˆ†ç‚¸å‘å°„ç«çƒã€‚æŒç»­ 800msã€‚ æ‰€æœ‰è§’è‰²æ•°å€¼è®¾è®¡ ç©å®¶ (LeadingRole) æ•°å€¼å…¬å¼ ç©å®¶çš„æ•°å€¼å—åŸºç¡€å±æ€§ã€ç­‰çº§æˆé•¿å’Œ PerkCardï¼ˆå¤©èµ‹å¡ï¼‰å…±åŒå½±å“ã€‚\n1. åŸºç¡€å±æ€§ä¸æˆé•¿ ç”Ÿå‘½å€¼ (HP): MaxHealthÂ = åˆå§‹å€¼ (180) +Â LevelÂ æˆé•¿ (æ¯çº§+20) +Â Perk: HEALTH_UP CurrentHealth: å‡çº§æ—¶å›æ»¡ï¼›å—ä¼¤å®³å‡å°‘ï¼›å—å›è¡€æœºåˆ¶å¢åŠ ã€‚ æ”»å‡»åŠ› (Atk): AttackPowerÂ = åˆå§‹å€¼ (15) +Â LevelÂ æˆé•¿ (æ¯çº§+1) +Â Perk: ATTACK_UP ç§»åŠ¨é€Ÿåº¦: MoveSpeedÂ = åˆå§‹å€¼ (1) +Â Perk: MOVE_SPEED_UP 2. æˆ˜æ–—æœºåˆ¶å…¬å¼ å°„å‡»å†·å´ (Cooldown): å†·å´æ—¶é—´(ms)Â =Â shootCooldownResetTimeÂ (4000) /Â shootCooldownSpeed shootCooldownSpeedÂ = åˆå§‹å€¼ (4) +Â LevelÂ æˆé•¿ (æ¯ 5 çº§+2) +Â Perk: ATTACK_SPEED_UP çƒ­é‡æœºåˆ¶ (Heat): çƒ­é‡ä¸Šé™ = maxHeat (100) + Level æˆé•¿ (æ¯çº§+5) + Perk: HEAT_CAPACITY_UP å†·å´é€Ÿç‡ = æ¯ 2000ms ç»“ç®—ä¸€æ¬¡ï¼Œå‡å°‘ heatCoolDownRate * 10 ç‚¹çƒ­é‡ï¼›åˆå§‹ heatCoolDownRate = 4ï¼Œæ¯ 2 çº§ +1ï¼ŒPerk: HEAT_COOL_DOWN_UP æ¯å¼  +2ã€‚ å•å‘çƒ­é‡ = heatPerShot (åˆå§‹ 15ï¼Œæ¯ 2 çº§ -1ï¼Œæœ€ä½ä¸ä½äº 1) Ã— æªæ¢°å€ç‡ï¼ˆæ™®é€š 1.0x / ç«çƒ 2.0x / é—ªç”µ 1.5xï¼‰ã€‚ å›è¡€æœºåˆ¶ (Regen): è§¦å‘é—´éš”Â =Â healResetTimeÂ (15000) /Â healSpeedÂ (3) = 5000ms å•æ¬¡å›å¤é‡Â =Â healValueÂ (åˆå§‹ 5 + æ¯çº§+1 +Â Perk: HEAL_AMOUNT_UP) 3. ç©å®¶ä¼¤å®³è¾“å‡ºå…¬å¼ (createBullet) æ™®é€šå­å¼¹ (Basic):\nDamage=attackPowerDamage=attackPower ç«çƒå¼¹ (FireBall):\nDamage=attackPower+10Damage=attackPower+10 (æ³¨ï¼šç«çƒé€ æˆä¸€æ¬¡ç›´æ¥ä¼¤å®³ + èŒƒå›´ä¼¤å®³ï¼Œä¸¤è€…æ•°å€¼ç›¸åŒ) é—ªç”µé“¾ (Lightning):\nDamage=(attackPowerÃ—multiplier)+30Damage=(attackPowerÃ—multiplier)+30 (æ³¨ï¼šmultiplierÂ åˆå§‹ä¸º 1.5ï¼Œå¯é€šè¿‡ Perk æå‡) æ•Œäºº (Enemy) æ•°å€¼å…¬å¼ æ•Œäººçš„æ•°å€¼ä¸»è¦ç”±å…¶ç±»å‹å’Œå½“å‰æ¸¸æˆç­‰çº§ (Level) å†³å®šã€‚\n1. åŸºç¡€å±æ€§ (é€šç”¨æ¨¡æ¿) ç”Ÿå‘½å€¼ (HP):\nHP=BaseHP+(LevelÃ—HP_Growth)HP=BaseHP+(LevelÃ—HP_Growth) æ”»å‡»åŠ› (Atk):\nAtk=BaseAtk+(LevelÃ—Atk_Growth)Atk=BaseAtk+(LevelÃ—Atk_Growth) ç»éªŒæ‰è½ (XP):\nDropExp=BaseExp+(LevelÃ—Exp_Growth)DropExp=BaseExp+(LevelÃ—Exp_Growth) çƒ­é‡å†·å´: åŸºç±»åŒä¸€é€»è¾‘ï¼Œæ¯ 2000ms ç»“ç®—ä¸€æ¬¡ï¼Œå‡å°‘ heatCoolDownRate * 10 ç‚¹ï¼ˆæ•Œäººé»˜è®¤ heatCoolDownRate = 10ï¼Œè§ enemyRole.cppï¼‰ã€‚ 2. å…·ä½“æ•Œäººæ•°å€¼ (åŸºäº enemyRole.cpp) æ•Œäººç±»å‹ ç”Ÿå‘½å€¼å…¬å¼ (HP) æ”»å‡»åŠ›å…¬å¼ (Atk) ç¢°æ’ä¼¤å®³ å¤‡æ³¨ é£å»‰ (Feilian) 10 + LevelÃ—20 2 + LevelÃ—1 4 + LevelÃ—1 é«˜é€Ÿéªšæ‰°ï¼Œä½ä¼¤è„†çš® è›Šé›• (Gudiao) 20 + LevelÃ—150 8 + LevelÃ—2 4 + LevelÃ—1 è¿œç¨‹ä¼å‡»ï¼Œæ­»åå‘ç«çƒ é­‘é­… (ChiMei) 1 + LevelÃ—1 1 + LevelÃ—1 20ï¼ˆå›ºå®šï¼‰ è‡ªçˆ†å†²æ’ é©³ (Bo) 40 + LevelÃ—200 6 + LevelÃ—2 10 + LevelÃ—3 ç²¾è‹±ï¼Œå†²é”‹/æ‰‡å½¢å°„å‡» èƒœé‡ (Shengyu) 50 + LevelÃ—220 10 + LevelÃ—4 6 + LevelÃ—2 ç²¾è‹±ï¼Œæ°´é›¾å¹²æ‰°/æ´ªæ³¢ ç‹¸åŠ› (Lili) 60 + LevelÃ—160 6 + LevelÃ—3 8 + LevelÃ—2 ç²¾è‹±ï¼ŒåœŸæ¶Œ/é™·é˜± é¥•é¤® (Taotie) 50 + LevelÃ—1700 2 + LevelÃ—4 10 + LevelÃ—10 BOSSï¼Œåå™¬/å†²æ’/ç¢¾å‹ æ¢¼æŒ (Taowu) 30 + LevelÃ—1200 10 + LevelÃ—6 7 + LevelÃ—5 BOSSï¼Œé—ªç°/å¼¹å¹•çˆ†å‘ ç›¸æŸ³ (Xiangliu) 30 + LevelÃ—1300 3 + LevelÃ—5 12 + LevelÃ—4 BOSSï¼Œå…¨å±AOE/å¬å”¤ æ··æ²Œ (Hundun) 40 + LevelÃ—1400 8 + LevelÃ—6 15 + LevelÃ—8 BOSSï¼ˆå››å‡¶ä¹‹é¦–ï¼‰ï¼Œæ··ä¹±å¼¹å¹• 3. æ•Œäººä¼¤å®³è¾“å‡º æ™®é€šå°„å‡»:Â é€ æˆ AtkÂ ç‚¹ä¼¤å®³ã€‚ ç¢°æ’ä¼¤å®³:Â ç­‰äºå…¶ collisionPowerã€‚ ç‰¹æ®ŠæŠ€èƒ½:Â å¦‚ç«çƒæˆ–é—ªç”µï¼Œéµå¾ªä¸ç©å®¶ç›¸åŒçš„ä¼¤å®³å¢å¹…é€»è¾‘ï¼ˆä¾‹å¦‚ç«çƒé€šå¸¸æ¯”æ™®æ”»é«˜ï¼‰ã€‚ é€šç”¨ç‰©ç†ä¸çŠ¶æ€å…¬å¼ é€‚ç”¨äºæ‰€æœ‰è§’è‰²ï¼ˆç©å®¶ä¸æ•Œäººï¼‰ï¼š\nç§»åŠ¨å…¬å¼:\nNewPos=CurrentPos+(DirectionÃ—Speed)NewPos=CurrentPos+(DirectionÃ—Speed) ç¢°æ’å›é€€: BackStep=BaseStepÃ—ConsecutiveCollisionCountBackStep=BaseStepÃ—ConsecutiveCollisionCount (æ³¨ï¼šè¿ç»­ç¢°æ’æ¬¡æ•°è¶Šå¤šï¼Œå¼¹å¼€è·ç¦»è¶Šè¿œï¼Œé˜²æ­¢å¡æ­») å—ä¼¤å…¬å¼: CurrentHealth=maxâ¡(0,CurrentHealthâˆ’Damage)CurrentHealth=max(0,CurrentHealthâˆ’Damage) ","date":"2025-11-27T18:23:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/chiptanks-%E6%B8%B8%E6%88%8F%E8%AE%BE%E8%AE%A1/","title":"ChipTanks-æ¸¸æˆè®¾è®¡"},{"content":"RMæ­¥å…µåŸºæœ¬åŠŸèƒ½å®ç° è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº STM32G4 ç³»åˆ—å¾®æ§åˆ¶å™¨çš„è½½å…·æ§åˆ¶ä¸å¤–è®¾æµ‹è¯•å·¥ç¨‹ï¼Œé¢å‘æ­¥å…µï¼ˆInfantry Fighting Vehicleï¼‰ç›¸å…³å­ç³»ç»Ÿçš„å¼€å‘ä¸éªŒè¯ã€‚é¡¹ç›®åŒ…å«åº•ç›˜ã€äº‘å°ä¸æ•´è½¦æµ‹è¯•å·¥ç¨‹ï¼Œé›†æˆäº†ä¼ æ„Ÿå™¨èåˆç®—æ³•ã€ç”µæœºæ§åˆ¶ã€CAN/FD é€šä¿¡åŠå¤–è®¾é©±åŠ¨ï¼Œå®ç°è¿åŠ¨æ§åˆ¶ã€å§¿æ€ä¼°è®¡å’Œé€šä¿¡ç®¡ç†çš„å‚è€ƒå®ç°ä¸è°ƒè¯•ç”¨ä¾‹ã€‚\nä»“åº“ï¼šNomadJoeviolet/RM_test_Infantry_Fighting_Vehicle\nä¸ªäººç”µæœºåº“ è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº STM32 + HAL + FreeRTOS çš„åµŒå…¥å¼ç”µæœºé©±åŠ¨æµ‹è¯•åº“ï¼Œä¸»è¦ç”¨äºéªŒè¯å’Œè°ƒè¯• DJI ä¸€æ‹–å››ï¼ˆone-to-fourï¼‰ç³»åˆ— CAN ç”µæœºã€‚å®ƒæä¾›ä¸€ä¸ªä¸“ä¸º DJI åè®®è®¾è®¡çš„ CanMotorManagerï¼Œç”¨ä»¥ç»Ÿä¸€ç®¡ç†æœ€å¤š 4 ä¸ªç”µæœºçš„ CAN æ”¶å‘ä¸æ•°æ®è§£æï¼›åŒæ—¶åŒ…å«å¯å¤ç”¨çš„æ§åˆ¶ç®—æ³•ï¼ˆå¦‚ PIDï¼‰ã€å¤šçº¿ç¨‹ç¤ºä¾‹ä»¥åŠå¯¹ ETLã€CMSISâ€‘DSP å’Œ FreeRTOS çš„é›†æˆæ”¯æŒï¼Œä¾¿äºåœ¨å—é™èµ„æºä¸‹å®ç°é«˜æ•ˆã€å¯æ‰©å±•çš„ç”µæœºæ§åˆ¶ä¸æµ‹è¯•ã€‚\nä»“åº“ï¼šNomadJoeviolet/MotorsLib\nChipTanks â€”â€” STM32 OLED è¿·ä½ å°„å‡»æ¸¸æˆ è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº STM32F103 ä¸ 128Ã—64 OLED çš„è¿·ä½ å°„å‡»æ¸¸æˆï¼Œé‡‡ç”¨ C/C++ æ··ç¼–ä¸ FreeRTOS ä»»åŠ¡æ¨¡å‹ï¼Œç»“åˆ ETL å®ç°å›ºå®šå®¹é‡å®¹å™¨ä¸ç¡®å®šæ€§æ›´æ–°ã€‚æ ¸å¿ƒåŒ…æ‹¬å®ä½“ç®¡ç†ï¼ˆè§’è‰²/å­å¼¹åˆ†å±‚ã€è¡ŒåŠ¨/çŠ¶æ€/æ¸…ç†/æ¸²æŸ“å››é˜¶æ®µï¼‰ã€å…³å¡ä¸æ³¢æ¬¡æ¨è¿›ã€Roguelike é€‰å¡å¢ç›Šï¼Œä»¥åŠæŒ‰é”®è¾“å…¥ä¸æ¸²æŸ“çº¿ç¨‹åˆ†ç¦»çš„ä¸»å¾ªç¯ã€‚\nä»“åº“ï¼šNomadJoeviolet/ChipTanks\né¡¹ç›®æ€»ç»“åšå®¢ï¼šChipTanks-åŸºäºC\u0026amp;C++æ··ç¼–çš„STM32OLEDè¿·ä½ æ¸¸æˆæŒæœºä¸ªäººé¡¹ç›®å¼€å‘\n","date":"2025-11-07T23:37:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/%E4%B8%AA%E4%BA%BA%E9%A1%B9%E7%9B%AE%E5%92%8C%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/","title":"ä¸ªäººé¡¹ç›®å’Œå·¥ç¨‹å®è·µ"},{"content":"FDCAN CubeMXé…ç½®è§£æ è¿™é‡Œçš„é…ç½®ä»¥STM32G474CET6ä¸ºä¾‹ Frame-Format Classic modeï¼šæ™®é€šCAN FD mode without BitRate Switchingï¼šFDCANï¼Œæ²¡æœ‰æ³¢ç‰¹ç‡è½¬æ¢ FD mode with BitRate Switchingï¼šFDCANï¼Œå¸¦æœ‰æ³¢ç‰¹ç‡è½¬æ¢ï¼Œæ•°æ®æ®µä½¿ç”¨æ›´é«˜æ³¢ç‰¹ç‡ æ³¨æ„é€‰ç”¨FD mode with BitRate Switchingåè¿˜å¯ä»¥é€šè¿‡txheaderå»é€‰å®šæ˜¯å¦å¼€å¯BitRateSwithcingï¼Œä»¥åŠæ˜¯ é‡‡ç”¨CANçš„å¸§æ ¼å¼è¿˜æ˜¯ FDCANå¸§æ ¼å¼\nä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªå¸§æ ¼å¼é€‰æ‹©æ˜¯å†³å®š æ˜¯å¦å…è®¸æ‹¥æœ‰FDCANçš„ç‰¹æ®Šæ ¼å¼å’Œèƒ½å¦å¼€å¯BitRateSwitchingï¼Œè‡³äºå‘é€çš„å¸§å®é™…æ˜¯å¦ç”¨ï¼Œå–å†³äºtxheader\nä»è¿™ä¸€æ®µHAL_FDCAN_Initåˆå§‹åŒ–ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œåªæœ‰FD mode with BitRate Switchingæ‰ä¼šå»åˆå§‹åŒ–æ•°æ®æ®µçš„ä¼ è¾“å‚æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 HAL_StatusTypeDef HAL_FDCAN_Init(FDCAN_HandleTypeDef *hfdcan) { uint32_t tickstart; /* Check FDCAN handle */ //... /* Check function parameters */ //... if (hfdcan-\u0026gt;Init.FrameFormat == FDCAN_FRAME_FD_BRS) { assert_param(IS_FDCAN_DATA_PRESCALER(hfdcan-\u0026gt;Init.DataPrescaler)); assert_param(IS_FDCAN_DATA_SJW(hfdcan-\u0026gt;Init.DataSyncJumpWidth)); assert_param(IS_FDCAN_DATA_TSEG1(hfdcan-\u0026gt;Init.DataTimeSeg1)); assert_param(IS_FDCAN_DATA_TSEG2(hfdcan-\u0026gt;Init.DataTimeSeg2)); } //.... //... } 1. Classic Modeï¼ˆä¼ ç»Ÿæ¨¡å¼ï¼‰ æœ¬è´¨ï¼šå®Œå…¨å…¼å®¹ä¼ ç»Ÿ CAN 2.0B åè®®ï¼Œä¸å¯ç”¨ FDCAN çš„æ‰©å±•åŠŸèƒ½ æ•°æ®é•¿åº¦ï¼šæœ€å¤§ 8 å­—èŠ‚ï¼ˆDLC=0~8ï¼‰ æ³¢ç‰¹ç‡ï¼šå…¨ç¨‹ä½¿ç”¨æ ‡ç§°æ³¢ç‰¹ç‡ï¼ˆNominal Bit Rateï¼‰ï¼Œæ— é€Ÿç‡åˆ‡æ¢ å¸§ç»“æ„ï¼šä¸ä¼ ç»Ÿ CAN å¸§ä¸€è‡´ï¼Œä»…åŒ…å«ä»²è£æ®µã€æ§åˆ¶æ®µã€æ•°æ®æ®µï¼ˆâ‰¤8 å­—èŠ‚ï¼‰ã€CRC æ®µç­‰ æ ¸å¿ƒä½œç”¨ï¼šç”¨äºå¯¹æ¥ä»…æ”¯æŒä¼ ç»Ÿ CAN åè®®çš„è®¾å¤‡ï¼ˆå¦‚è€æ—§ä¼ æ„Ÿå™¨ã€æ‰§è¡Œå™¨ï¼‰ï¼Œç¡®ä¿å…¼å®¹æ€§ 2. FD mode with BitRate Switchingï¼ˆå¸¦æ³¢ç‰¹ç‡åˆ‡æ¢çš„ FD æ¨¡å¼ï¼‰ æœ¬è´¨ï¼šå¯ç”¨ FDCAN çš„æ ¸å¿ƒæ‰©å±•åŠŸèƒ½ï¼Œæ”¯æŒé«˜é€Ÿé•¿æ•°æ®ä¼ è¾“ï¼Œä¸”æ•°æ®æ®µä½¿ç”¨æ›´é«˜æ³¢ç‰¹ç‡ æ•°æ®é•¿åº¦ï¼šæœ€å¤§ 64 å­—èŠ‚ï¼ˆDLC=015ï¼Œå…¶ä¸­ DLC=915 å¯¹åº” 32~64 å­—èŠ‚ï¼‰ æ³¢ç‰¹ç‡ï¼š ä»²è£æ®µï¼ˆArbitration Phaseï¼‰ï¼šä½¿ç”¨æ ‡ç§°æ³¢ç‰¹ç‡ï¼ˆä¸ä¼ ç»Ÿæ¨¡å¼ä¸€è‡´ï¼Œç¡®ä¿ä»²è£å…¼å®¹æ€§ï¼‰ æ•°æ®æ®µï¼ˆData Phaseï¼‰ï¼šä½¿ç”¨æ›´é«˜çš„æ•°æ®æ³¢ç‰¹ç‡ï¼ˆData Bit Rateï¼‰ï¼ˆå¯é…ç½®ä¸ºæ ‡ç§°æ³¢ç‰¹ç‡çš„ 2~8 å€ï¼Œå¦‚ 8Mbpsï¼‰ 3. FD mode without BitRate Switchingï¼ˆä¸å¸¦æ³¢ç‰¹ç‡åˆ‡æ¢çš„ FD æ¨¡å¼ï¼‰ æœ¬è´¨ï¼šå¯ç”¨ FDCAN çš„é•¿æ•°æ®åŠŸèƒ½ï¼Œä½†ä¸åˆ‡æ¢æ³¢ç‰¹ç‡ï¼Œå…¨ç¨‹ä½¿ç”¨æ ‡ç§°æ³¢ç‰¹ç‡ æ•°æ®é•¿åº¦ï¼šæœ€å¤§ 64 å­—èŠ‚ï¼ˆä¸å¸¦åˆ‡æ¢çš„ FD æ¨¡å¼ä¸€è‡´ï¼‰ æ³¢ç‰¹ç‡ï¼šä»²è£æ®µå’Œæ•°æ®æ®µå‡ä½¿ç”¨æ ‡ç§°æ³¢ç‰¹ç‡ï¼Œæ— é€Ÿç‡æå‡ å¸§ç»“æ„ï¼šåŒ…å« FD å¸§æ ‡å¿—ï¼ˆFDFï¼‰ï¼Œä½†æ— æ³¢ç‰¹ç‡åˆ‡æ¢æ ‡å¿—ï¼ˆBRS=0ï¼‰ æ ¸å¿ƒä½œç”¨ï¼šç”¨äºéœ€è¦é•¿æ•°æ®ä¼ è¾“ï¼ˆï¼8 å­—èŠ‚ï¼‰ä½†æ€»çº¿ä¸Šå­˜åœ¨ä¸æ”¯æŒé«˜é€Ÿæ•°æ®æ®µçš„è®¾å¤‡åœºæ™¯ï¼Œæˆ–å› ç¡¬ä»¶é™åˆ¶ï¼ˆå¦‚çº¿ç¼†è´¨é‡å·®ï¼‰æ— æ³•ä½¿ç”¨é«˜é€Ÿç‡çš„åœºæ™¯ Mode ä¸€èˆ¬ä½¿ç”¨Normal mode Normal modeï¼ˆæ­£å¸¸æ¨¡å¼ï¼‰ Restricted operationï¼ˆå—é™æ“ä½œæ¨¡å¼ï¼‰ Bus Monitoring modeï¼ˆæ€»çº¿ç›‘å¬æ¨¡å¼ï¼‰ Internal LoopBack modeï¼ˆå†…éƒ¨å›ç¯æ¨¡å¼ï¼‰ External LoopBack modeï¼ˆå¤–éƒ¨å›ç¯æ¨¡å¼ï¼‰ Auto-Retransmission \u0026amp; Transmit-Pause \u0026amp; Protocol-Exception Auto-Retransmissionï¼šè‡ªåŠ¨é‡ä¼ ï¼Œå¦‚æœå‘é€çš„å¸§æ²¡æœ‰æ”¶åˆ°åº”ç­”ï¼Œå‡ºç°é”™è¯¯ï¼Œå°±ä¸æ–­é‡æ–°å‘é€ï¼Œåœ¨æ€»çº¿è´Ÿè½½è¾ƒé«˜çš„æ—¶å€™ä¸€å®šè¦å…³æ‰ï¼Œä¼šä¸¥é‡æ‹‰ä½æ§åˆ¶é¢‘ç‡\nTransmit-Pauseï¼šä¸€ç§ä¸´æ—¶åœæ­¢ FDCAN å‘é€åŠŸèƒ½çš„æœºåˆ¶ï¼Œç”¨äºåœ¨ç‰¹å®šåœºæ™¯ä¸‹ä¸»åŠ¨æš‚åœæ•°æ®å‘é€ï¼Œé¿å…å¹²æ‰°æ€»çº¿æˆ–ç­‰å¾…ç‰¹å®šæ¡ä»¶ï¼Œå¯ä»¥é€šè¿‡è½¯ä»¶ä¸»åŠ¨è§¦å‘ï¼Œè°ƒç”¨HALåº“å‡½æ•°\nProtocol-Exceptionï¼šæ£€æµ‹åˆ°å¼‚å¸¸æƒ…å†µï¼ˆå¸§æ ¼å¼é”™è¯¯ç­‰ï¼‰ï¼Œä¼šå»è§¦å‘å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼ˆä¾‹å¦‚å¼‚å¸¸å¤„ç†ä¸­æ–­ï¼‰\nData \u0026amp; Nominal æ­¤å¤„æä¸€ä¸‹ï¼ŒData Sync Jump Widthï¼ˆæ•°æ®æ®µåŒæ­¥è·³è½¬å®½åº¦ï¼‰æ˜¯é’ˆå¯¹æ•°æ®æ³¢ç‰¹ç‡ï¼ˆData Bit Rateï¼‰Â é…ç½®çš„å…³é”®æ—¶åºå‚æ•°\nDataï¼ˆæ•°æ®æ³¢ç‰¹ç‡ç›¸å…³ï¼‰ â€œDataâ€ ç‰¹æŒ‡ FDCAN åœ¨FD æ¨¡å¼ï¼ˆFlexible Data Rate Modeï¼‰Â ä¸‹ï¼Œå¸§çš„æ•°æ®æ®µï¼ˆData Phaseï¼‰Â æ‰€ä½¿ç”¨çš„ä¼ è¾“é€Ÿç‡ï¼Œå³æ•°æ®æ³¢ç‰¹ç‡ï¼ˆData Bit Rateï¼‰\nNominalï¼ˆæ ‡ç§°æ³¢ç‰¹ç‡ç›¸å…³ï¼‰ â€œNominalâ€ ç‰¹æŒ‡ FDCAN å¸§åœ¨ä»²è£æ®µï¼ˆArbitration Phaseï¼‰ã€æ§åˆ¶æ®µï¼ˆControl Phaseï¼‰ã€CRC æ®µï¼ˆCRC Phaseï¼‰Â å’ŒACK æ®µï¼ˆAcknowledgment Phaseï¼‰Â ä¸­ä½¿ç”¨çš„ä¼ è¾“é€Ÿç‡ï¼Œå³æ ‡ç§°æ³¢ç‰¹ç‡ï¼ˆNominal Bit Rateï¼‰\nFilter and Std-Filters-Nbr\u0026amp;Ext-Filters-Nbr Std Filters Nbrï¼ˆæ ‡å‡†å¸§è¿‡æ»¤å™¨æ•°é‡ï¼‰Â å’ŒExt Filters Nbrï¼ˆæ‰©å±•å¸§è¿‡æ»¤å™¨æ•°é‡ï¼‰Â æ˜¯é…ç½® FDCANï¼ˆFlexible Data Rate CANï¼‰æ¥æ”¶è¿‡æ»¤åŠŸèƒ½çš„æ ¸å¿ƒå‚æ•°ã€‚å®ƒä»¬åˆ†åˆ«ç”¨äºå®šä¹‰æ ‡å‡†å¸§ï¼ˆ11 ä½ IDï¼‰Â å’Œæ‰©å±•å¸§ï¼ˆ29 ä½ IDï¼‰Â çš„ç¡¬ä»¶è¿‡æ»¤å™¨æ•°é‡ï¼Œç›´æ¥å½±å“ FDCAN æ§åˆ¶å™¨èƒ½æ¥æ”¶çš„å¸§ç±»å‹å’Œæ•°é‡\nStd Filters Nbrï¼šé…ç½®æ ‡å‡†å¸§ï¼ˆ11 ä½ IDï¼‰Â çš„è¿‡æ»¤å™¨æ•°é‡ã€‚æ¯ä¸ªè¿‡æ»¤å™¨å¯åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ ‡å‡† IDï¼Œæˆ–é€šè¿‡æ©ç æ¨¡å¼åŒ¹é… ID èŒƒå›´ Ext Filters Nbrï¼šé…ç½®æ‰©å±•å¸§ï¼ˆ29 ä½ IDï¼‰Â çš„è¿‡æ»¤å™¨æ•°é‡ã€‚æ¯ä¸ªè¿‡æ»¤å™¨å¯åŒ¹é…ä¸€ä¸ªæˆ–å¤šä¸ªæ‰©å±• IDï¼Œæˆ–é€šè¿‡æ©ç æ¨¡å¼åŒ¹é… ID èŒƒå›´ è¿‡æ»¤å™¨ç±»å‹ FDCAN æ”¯æŒå¤šç§è¿‡æ»¤æ¨¡å¼ï¼Œä¸åŒæ¨¡å¼å¯¹è¿‡æ»¤å™¨æ•°é‡çš„éœ€æ±‚ä¸åŒï¼š\næ©ç æ¨¡å¼ï¼ˆMask Modeï¼‰ï¼š é€šè¿‡ ID å’Œæ©ç åŒ¹é… ID èŒƒå›´ã€‚ä¾‹å¦‚ï¼Œ1 ä¸ªæ ‡å‡†è¿‡æ»¤å™¨å¯åŒ¹é… 0x100~0x1FF èŒƒå›´å†…çš„æ‰€æœ‰ IDï¼ˆæ©ç  = 0x100ï¼ŒID=0x1FFï¼‰ åŒ ID æ¨¡å¼ï¼ˆDual ID Modeï¼‰ï¼š åŒ¹é…ä¸¤ä¸ªç‰¹å®š IDã€‚ä¾‹å¦‚ï¼Œ1 ä¸ªæ‰©å±•è¿‡æ»¤å™¨å¯åŒæ—¶åŒ¹é… 0x12345678 å’Œ 0x87654321 èŒƒå›´æ¨¡å¼ï¼ˆRange Modeï¼‰ï¼š åŒ¹é… ID åœ¨ä¸¤ä¸ªå€¼ä¹‹é—´çš„æ‰€æœ‰å¸§ã€‚ä¾‹å¦‚ï¼Œ1 ä¸ªæ ‡å‡†è¿‡æ»¤å™¨å¯åŒ¹é… 0x000~0x0FF èŒƒå›´å†…çš„ ID é…ç½®ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 // é…ç½®4ä¸ªæ‰©å±•è¿‡æ»¤å™¨ï¼Œæ¯ä¸ªåŒ¹é…1ä¸ªç‰¹å®šIDï¼ˆåŒIDæ¨¡å¼ï¼‰ FDCAN_FilterTypeDef sFilterConfig; sFilterConfig.IdType = FDCAN_EXTENDED_ID; sFilterConfig.FilterType = FDCAN_FILTER_DUAL; sFilterConfig.FilterConfig = FDCAN_FILTER_TO_RXBUFFER; // è¿‡æ»¤å™¨0åŒ¹é…ID=0x01 sFilterConfig.FilterIndex = 0; sFilterConfig.FilterID1 = 0x01; sFilterConfig.FilterID2 = 0x01; sFilterConfig.RxBufferIndex = 0; HAL_FDCAN_ConfigFilter(\u0026amp;hfdcan2, \u0026amp;sFilterConfig); // è¿‡æ»¤å™¨1åŒ¹é…ID=0x02 sFilterConfig.FilterIndex = 1; sFilterConfig.FilterID1 = 0x02; sFilterConfig.FilterID2 = 0x02; sFilterConfig.RxBufferIndex = 1; HAL_FDCAN_ConfigFilter(\u0026amp;hfdcan2, \u0026amp;sFilterConfig); // ä¾æ­¤ç±»æ¨é…ç½®è¿‡æ»¤å™¨2å’Œ3 Txheader å…³äºTxheaderçš„é…ç½®\n1 2 3 4 5 6 7 8 9 10 11 FDCAN_TxHeaderTypeDef Txheader_gimbal ; Txheader_gimbal.DataLength = 0x08 ;//æ•°æ®é•¿åº¦ Txheader_gimbal.Identifier = 0x1FF ;//æ ‡è¯†ç¬¦ Txheader_gimbal.TxFrameType = FDCAN_DATA_FRAME ; Txheader_gimbal.IdType = FDCAN_STANDARD_ID ; Txheader_gimbal.ErrorStateIndicator=FDCAN_ESI_ACTIVE;//å¼€å¯é”™è¯¯çŠ¶æ€æŒ‡ç¤º Txheader_gimbal.BitRateSwitch=FDCAN_BRS_OFF; Txheader_gimbal.FDFormat=FDCAN_CLASSIC_CAN;//ä¼ ç»Ÿçš„CANæ¨¡å¼ //Txheader_gimbal.FDFormat=FDCAN_FD_CAN;//FDCANæ¨¡å¼ Txheader_gimbal.TxEventFifoControl = FDCAN_NO_TX_EVENTS;//æ— å‘é€äº‹ä»¶ Txheader_gimbal.MessageMarker = 0; æ—¶é—´ç‰‡ ä¸åšè§£æï¼Œç¡¬ä»¶æ–¹é¢è®¡ç®—å‡ºæ¥æ‹¿æ¥ç”¨å³å¯\nä½¿ç”¨ä»£ç  FilterInit-and-FDCANStart 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 void FDCAN_IntFilterAndStart(FDCAN_HandleTypeDef *hfdcan) { //--------FDCAN1 Filter and Start--------// FDCAN_FilterTypeDef sFilterConfig; sFilterConfig.IdType = FDCAN_STANDARD_ID; sFilterConfig.FilterIndex = 0; sFilterConfig.FilterType = FDCAN_FILTER_MASK; sFilterConfig.FilterConfig = FDCAN_FILTER_TO_RXFIFO0; sFilterConfig.FilterID1 = 0x00;//0x500; sFilterConfig.FilterID2 = 0x00;//0x780; if (HAL_FDCAN_ConfigFilter(hfdcan, \u0026amp;sFilterConfig) != HAL_OK) { FDCAN_ErrorHandler(); } if (HAL_FDCAN_ConfigGlobalFilter(hfdcan, FDCAN_REJECT, FDCAN_REJECT, FDCAN_FILTER_REMOTE, FDCAN_FILTER_REMOTE) != HAL_OK) { FDCAN_ErrorHandler(); } if (HAL_FDCAN_Start(hfdcan) != HAL_OK) { FDCAN_ErrorHandler(); } if (HAL_FDCAN_ActivateNotification(hfdcan, FDCAN_IT_RX_FIFO0_NEW_MESSAGE, 0) != HAL_OK) { FDCAN_ErrorHandler(); } if (HAL_FDCAN_ActivateNotification(hfdcan, FDCAN_IT_BUS_OFF, 0) != HAL_OK) { FDCAN_ErrorHandler(); } } è§£æä¸€ä¸‹\n1 if (HAL_FDCAN_ConfigGlobalFilter(hfdcan, FDCAN_REJECT, FDCAN_REJECT, FDCAN_FILTER_REMOTE, FDCAN_FILTER_REMOTE) != HAL_OK) HAL_FDCAN_ConfigGlobalFilterç”¨äºå®šä¹‰æœªè¢«ä»»ä½•ç‰¹å®šè¿‡æ»¤å™¨åŒ¹é…çš„å¸§çš„å¤„ç†è§„åˆ™ï¼Œå‚æ•°å«ä¹‰å¦‚ä¸‹ï¼š\nç¬¬ 2 ä¸ªå‚æ•°ï¼ˆFDCAN_REJECTï¼‰ï¼šæœªåŒ¹é…çš„æ ‡å‡†å¸§è¢« â€œæ‹’ç»â€ï¼ˆä¸æ¥æ”¶ï¼‰ï¼› ç¬¬ 3 ä¸ªå‚æ•°ï¼ˆFDCAN_REJECTï¼‰ï¼šæœªåŒ¹é…çš„æ‰©å±•å¸§è¢« â€œæ‹’ç»â€ï¼ˆä¸æ¥æ”¶ï¼‰ï¼› ç¬¬ 4 ä¸ªå‚æ•°ï¼ˆFDCAN_FILTER_REMOTEï¼‰ï¼šæœªåŒ¹é…çš„æ ‡å‡†è¿œç¨‹å¸§è¢« â€œæ‹’ç»â€ï¼› ç¬¬ 5 ä¸ªå‚æ•°ï¼ˆFDCAN_FILTER_REMOTEï¼‰ï¼šæœªåŒ¹é…çš„æ‰©å±•è¿œç¨‹å¸§è¢« â€œæ‹’ç»â€ã€‚ ç»“åˆå‰é¢çš„è¿‡æ»¤å™¨é…ç½®ï¼ˆæ‰€æœ‰æ ‡å‡†å¸§éƒ½è¢«ç¬¬ 0 å·è¿‡æ»¤å™¨åŒ¹é…ï¼‰ï¼Œè¿™é‡Œçš„å…¨å±€è§„åˆ™å®é™…æ•ˆæœæ˜¯ï¼š æ‰€æœ‰æ ‡å‡†å¸§è¢«ç¬¬ 0 å·è¿‡æ»¤å™¨æ¥æ”¶ï¼ˆå­˜å…¥ FIFO0ï¼‰ï¼› æ‰©å±•å¸§ã€è¿œç¨‹å¸§ï¼ˆæ— è®ºæ ‡å‡†è¿˜æ˜¯æ‰©å±•ï¼‰å› æœªè¢«åŒ¹é…ï¼Œå…¨éƒ¨è¢«æ‹’ç»ã€‚ æ•°æ®å‘é€ å¦‚æœéœ€è¦å…¼å®¹CANï¼Œå°†FDFormatä¿®æ”¹ä¸ºFDCAN_CLASSIC_CANå³å¯\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 void FDCAN_InitTxHander(FDCAN_TxHeaderTypeDef* pheader, uint32_t id, uint32_t dlc,uint32_t baudrateswitch,uint32_t can_type){ pheader-\u0026gt;Identifier = id; if(id\u0026gt;=0x800) { pheader-\u0026gt;IdType = FDCAN_EXTENDED_ID; } else { pheader-\u0026gt;IdType = FDCAN_STANDARD_ID; } pheader-\u0026gt;TxFrameType = FDCAN_DATA_FRAME; pheader-\u0026gt;DataLength = dlc; pheader-\u0026gt;ErrorStateIndicator = FDCAN_ESI_ACTIVE;//å¼€å¯é”™è¯¯çŠ¶æ€æŒ‡ç¤º pheader-\u0026gt;BitRateSwitch = baudrateswitch; pheader-\u0026gt;FDFormat = can_type; pheader-\u0026gt;TxEventFifoControl = FDCAN_NO_TX_EVENTS; pheader-\u0026gt;MessageMarker = 0; } void FDCAN_SendMessageWithBaudSwitch(FDCAN_HandleTypeDef *hfdcan,uint8_t* pdata,uint32_t dlc,uint32_t id) { FDCAN_TxHeaderTypeDef txhead; FDCAN_InitTxHander(\u0026amp;txhead,id,dlc,FDCAN_BRS_ON,FDCAN_FD_CAN); HAL_FDCAN_AddMessageToTxFifoQ(hfdcan, \u0026amp;txhead, pdata); } void FDCAN_SendMessageWithOutBaudSwitch(FDCAN_HandleTypeDef *hfdcan,uint8_t* pdata,uint32_t dlc,uint32_t id) { FDCAN_TxHeaderTypeDef txhead; FDCAN_InitTxHander(\u0026amp;txhead,id,dlc,FDCAN_BRS_OFF,FDCAN_CLASSIC_CAN); HAL_FDCAN_AddMessageToTxFifoQ(hfdcan, \u0026amp;txhead, pdata); if(HAL_FDCAN_AddMessageToTxFifoQ(hfdcan, \u0026amp;txhead, pdata)!=HAL_OK) { FDCAN_ErrorHandler(); } } æ•°æ®æ¥æ”¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 uint8_t RxData[64]; void HAL_FDCAN_RxFifo0Callback(FDCAN_HandleTypeDef *hfdcan, uint32_t RxFifo0ITs) { if((RxFifo0ITs \u0026amp; FDCAN_IT_RX_FIFO0_NEW_MESSAGE)!=RESET)//åˆ¤æ–­æ˜¯å¦æ˜¯æ–°æ¶ˆæ¯ä¸­æ–­ { if(hfdcan-\u0026gt;Instance == FDCAN1) //Slave Arm { HAL_FDCAN_GetRxMessage(hfdcan, FDCAN_RX_FIFO0, \u0026amp;RxHeader, RxData); //... } } } CAN Cubeé…ç½® æ¨¡å¼è®¾ç½®ï¼ˆModeï¼‰ Normal modeï¼ˆæ­£å¸¸æ¨¡å¼ï¼‰ï¼šæ­£å¸¸å‘é€å’Œæ¥æ”¶å¸§ï¼Œç”¨äºå®é™…æ€»çº¿é€šä¿¡ Loopback modeï¼ˆå›ç¯æ¨¡å¼ï¼‰ï¼šå‘é€çš„å¸§ä¼šè¢«è‡ªèº«æ¥æ”¶ï¼Œæ— éœ€å¤–éƒ¨æ€»çº¿ï¼Œç”¨äºè°ƒè¯• Silent modeï¼ˆé™é»˜æ¨¡å¼ï¼‰ï¼šåªèƒ½æ¥æ”¶å¸§ï¼Œä¸èƒ½å‘é€ï¼Œç”¨äºç›‘å¬æ€»çº¿ Silent Loopback modeï¼ˆé™é»˜å›ç¯æ¨¡å¼ï¼‰ï¼šç»“åˆé™é»˜å’Œå›ç¯ï¼Œä»…å†…éƒ¨æµ‹è¯• æ³¢ç‰¹ç‡ $$æ³¢ç‰¹ç‡ = APBæ—¶é’Ÿé¢‘ç‡ / [ Prescaler Ã— (1 + TimeSeg1 + TimeSeg2) ]$$ CAN çš„æ³¢ç‰¹ç‡ç”±ä½æ—¶é—´ï¼ˆBit Timeï¼‰Â å†³å®šï¼Œä½æ—¶é—´ = 1 / æ³¢ç‰¹ç‡ï¼ˆå¦‚ 1Mbps å¯¹åº”ä½æ—¶é—´ 1Î¼sï¼‰ã€‚ä½æ—¶é—´ç”± 3 éƒ¨åˆ†ç»„æˆï¼š\nPrescalerï¼ˆé¢„åˆ†é¢‘å™¨ï¼‰ï¼šå°† APB æ—¶é’Ÿï¼ˆå¦‚ APB1=36MHzï¼‰åˆ†é¢‘ä¸ºæ—¶é—´é‡å­ï¼ˆTQï¼‰ï¼Œå…¬å¼ï¼šTQ = 1/(APBæ—¶é’Ÿé¢‘ç‡ / Prescaler) Sync Jump Width (SJW)ï¼šåŒæ­¥è·³è½¬å®½åº¦ï¼Œç”¨äºè¡¥å¿èŠ‚ç‚¹é—´æ—¶é’Ÿåå·®ï¼Œå–å€¼ 1~4TQï¼ˆé€šå¸¸è®¾ä¸º 1 æˆ– 2ï¼‰ Time Seg1ï¼šåŒ…å«ä¼ æ’­æ®µï¼ˆPropSegï¼‰å’Œç›¸ä½æ®µ 1ï¼ˆPS1ï¼‰ï¼Œå–å€¼ 4~16TQï¼ˆç”¨äºè¡¥å¿æ€»çº¿å»¶è¿Ÿï¼‰ Time Seg2ï¼šç›¸ä½æ®µ 2ï¼ˆPS2ï¼‰ï¼Œå–å€¼ 2~8TQï¼ˆç”¨äºåŒæ­¥è¡¥å¿ï¼‰ Basic-Parameters Time Triggered Communicationï¼ˆæ—¶é—´è§¦å‘é€šä¿¡ï¼‰\nAutomatic Bus-Off Managementï¼ˆè‡ªåŠ¨æ€»çº¿å…³é—­ç®¡ç†ï¼‰ å½“èŠ‚ç‚¹å› é”™è¯¯è®¡æ•°è¶…é™è¿›å…¥ â€œæ€»çº¿å…³é—­â€ çŠ¶æ€ï¼ˆæ— æ³•å‘é€å’Œæ¥æ”¶å¸§ï¼‰æ—¶ï¼Œæ˜¯å¦éœ€è¦è½¯ä»¶æ‰‹åŠ¨æ¢å¤ï¼Œè¿˜æ˜¯æ§åˆ¶å™¨è‡ªåŠ¨æ¢å¤\nAutomatic WakeUP modeï¼ˆè‡ªåŠ¨å”¤é†’æ¨¡å¼ï¼‰Â æ˜¯ä¸€ç§é’ˆå¯¹ä½åŠŸè€—åœºæ™¯çš„åŠŸèƒ½ï¼Œç”¨äºè®© CAN æ§åˆ¶å™¨åœ¨ä¼‘çœ ï¼ˆä½åŠŸè€—ï¼‰çŠ¶æ€ä¸‹ï¼Œé€šè¿‡æ£€æµ‹æ€»çº¿ä¸Šçš„æœ‰æ•ˆæ´»åŠ¨ï¼ˆå¦‚ç‰¹å®š CAN å¸§ï¼‰è‡ªåŠ¨æ¢å¤åˆ°æ­£å¸¸å·¥ä½œçŠ¶æ€ï¼Œæ— éœ€è½¯ä»¶æ‰‹åŠ¨è§¦å‘å”¤é†’\nAutomatic Retransmissionï¼ˆè‡ªåŠ¨é‡ä¼ ï¼‰\nReceive FIFO Locked Modeï¼ˆæ¥æ”¶ FIFO é”å®šæ¨¡å¼ï¼‰ å½“æ¥æ”¶ FIFOï¼ˆCAN é€šå¸¸æœ‰ 2 ä¸ªæ¥æ”¶ FIFOï¼ŒFIFO0 å’Œ FIFO1ï¼‰å­˜å‚¨çš„å¸§æ•°é‡è¾¾åˆ°æœ€å¤§æ·±åº¦ï¼ˆå¦‚ 3 ä¸ªæˆ– 6 ä¸ªï¼Œä¾èŠ¯ç‰‡å‹å·è€Œå®šï¼‰æ—¶ï¼Œæ–°æ¥æ”¶çš„å¸§æ˜¯å¦è¦†ç›–æ—§çš„å¸§\nTransmit FIFO Priorityï¼ˆå‘é€ FIFO ä¼˜å…ˆçº§ï¼‰ å½“å‘é€ FIFOï¼ˆCAN é€šå¸¸æœ‰ 1 ä¸ªå‘é€ FIFOï¼Œå¯å­˜å‚¨å¤šä¸ªå¾…å‘é€å¸§ï¼‰ä¸­æœ‰å¤šä¸ªå¸§ç­‰å¾…å‘é€æ—¶ï¼Œå¸§çš„å‘é€é¡ºåºè§„åˆ™\nä½¿ç”¨ä»£ç  FilterInit-and-FDCANStart 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 void CAN_Config(void) { CAN_FilterTypeDef sFilterConfig; /* Configure the CAN Filter */ sFilterConfig.FilterBank = 0; // è¿‡æ»¤å™¨ç¼–å·ï¼Œä½¿ç”¨ä¸€ä¸ªCANï¼Œåˆ™å¯é€‰0-13ï¼›ä½¿ç”¨ä¸¤ä¸ªCANå¯é€‰0-27 sFilterConfig.FilterMode = CAN_FILTERMODE_IDMASK; // è¿‡æ»¤å™¨æ¨¡å¼ï¼Œæ©ç æ¨¡å¼æˆ–åˆ—è¡¨æ¨¡å¼ sFilterConfig.FilterScale = CAN_FILTERSCALE_32BIT; // è¿‡æ»¤å™¨ä½å®½ sFilterConfig.FilterIdHigh = 0x0000; // è¿‡æ»¤å™¨éªŒè¯ç IDé«˜16ä½ï¼Œ0-0xFFFF sFilterConfig.FilterIdLow = 0x0000; // è¿‡æ»¤å™¨éªŒè¯ç IDä½16ä½ï¼Œ0-0xFFFF sFilterConfig.FilterMaskIdHigh = 0x0000; // è¿‡æ»¤å™¨æ©ç IDé«˜16ä½ï¼Œ0-0xFFFF sFilterConfig.FilterMaskIdLow = 0x0000; // è¿‡æ»¤å™¨æ©ç IDä½16ä½ï¼Œ0-0xFFFF sFilterConfig.FilterFIFOAssignment = CAN_FilterFIFO0; // FIFOxï¼Œ0æˆ–1 sFilterConfig.FilterActivation = ENABLE; // ä½¿èƒ½è¿‡æ»¤å™¨ sFilterConfig.SlaveStartFilterBank = 14; // ä»è¿‡æ»¤å™¨ç¼–å·ï¼Œ0-27ï¼Œå¯¹äºå•CANå®ä¾‹è¯¥å‚æ•°æ²¡æœ‰æ„ä¹‰ if (HAL_CAN_ConfigFilter(\u0026amp;hcan1, \u0026amp;sFilterConfig) != HAL_OK) { /* Filter configuration Error */ } /* Start the CAN peripheral */ if (HAL_CAN_Start(\u0026amp;hcan1) != HAL_OK) { /* Start Error */ } /* Activate CAN RX notification */ if (HAL_CAN_ActivateNotification(\u0026amp;hcan1, CAN_IT_RX_FIFO0_MSG_PENDING) != HAL_OK) { /* Notification Error */ } } å‘é€ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 uint8_t CAN_Send_Msg(uint16_t output , uint8_t len) { uint8_t message[8]; uint32_t TxMailbox; CAN_TxHeaderTypeDef CAN_TxHeader; // è®¾ç½®å‘é€å‚æ•° CAN_TxHeader.StdId = 0x200; // æ ‡å‡†æ ‡è¯†ç¬¦(12bit) //CAN_TxHeader.ExtId = 0x00; // æ‰©å±•æ ‡è¯†ç¬¦(29bit) CAN_TxHeader.IDE = CAN_ID_STD; // ä½¿ç”¨æ ‡å‡†å¸§ CAN_TxHeader.RTR = CAN_RTR_DATA; // æ•°æ®å¸§ CAN_TxHeader.DLC = 0x08; // å‘é€é•¿åº¦ CAN_TxHeader.TransmitGlobalTime = DISABLE;//å…³é—­cançš„æ—¶é—´è§¦å‘é€šä¿¡æ¨¡å¼ // è£…è½½æ•°æ® memset(message, 0, sizeof(message)); message[0] = (output \u0026gt;\u0026gt; 8) \u0026amp; 0xFF; message[1] = output \u0026amp; 0xFF; // å‘é€CANæ¶ˆæ¯ if(HAL_CAN_AddTxMessage(\u0026amp;hcan1, \u0026amp;CAN_TxHeader, message, \u0026amp;TxMailbox) != HAL_OK) { return 0; } return 1; } æ¥æ”¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 void HAL_CAN_RxFifo0MsgPendingCallback(CAN_HandleTypeDef *hcan) {// æ”¶åˆ°CANæ•°æ®ä¼šè§¦å‘æ¥æ”¶ä¸­æ–­ï¼Œè¿›å…¥è¯¥å›è°ƒå‡½æ•° uint8_t RxData[8]; CAN_RxHeaderTypeDef CAN_RxHeader; if(HAL_CAN_GetRxMessage(hcan, CAN_RX_FIFO0, \u0026amp;CAN_RxHeader, RxData) != HAL_OK) { while(1) {}; } if(hcan==\u0026amp;hcan1) // åªå¤„ç†CAN1 { // å¤„ç†CAN1æ¥æ”¶åˆ°çš„æ•°æ® switch (CAN_RxHeader.StdId) // æ ‡å‡†æ ‡è¯†ç¬¦ { case 0x201: // å¤„ç†IDä¸º0x201çš„æ¶ˆæ¯ test_motor.motor_raw_angle = (RxData[0] \u0026lt;\u0026lt; 8) | RxData[1]; test_motor.motor_angle = (float)test_motor.motor_raw_angle/8191.f*360.f; test_motor.motor_speed = (RxData[2] \u0026lt;\u0026lt; 8) | RxData[3]; test_motor.motor_current = (RxData[4] \u0026lt;\u0026lt; 8) | RxData[5]; test_motor.temp = RxData[6]; break; default: break; } } } ","date":"2025-09-20T13:04:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/stm32fdcancan/","title":"STM32â€”â€”FDCAN\u0026CAN"},{"content":"violet æ„Ÿå…¶ç”Ÿï¼Œå†å…¶å¢ƒ\nåˆæ­¥å…¥é—¨åµŒå…¥å¼å¼€å‘åï¼ˆå‡å®šå·²ç»ä¼šä½¿ç”¨Keilå’ŒCubeMXè¿›è¡Œå¼€å‘ï¼‰ï¼Œéœ€è¦å›å¤´è¡¥å……çš„åŸºç¡€ä»¥åŠæå‡ï¼Œæœ¬æŒ‡å—åªèµ·åˆ°æŠ›ç –å¼•ç‰çš„ä½œç”¨ï¼Œå¯¹æ‰€éœ€çŸ¥è¯†ä»…ä½œç²¾ç®€çš„æ¦‚è¿°ï¼Œä¸»è¦åœ¨äºå¸®åŠ©æ„å»ºçŸ¥è¯†æ¡†æ¶\nStep1 Keil+CubeMXå·¥å…·é“¾ä½¿ç”¨ï¼ŒHALåº“ä½¿ç”¨ï¼ŒåŸºæœ¬å¤–è®¾ï¼ŒåŸºæœ¬å¼€å‘å¸¸è¯† å¼€å‘å¸¸è¯† è¯¥éƒ¨åˆ†å†…å®¹æ‘˜è‡ªé˜Ÿå†…æ–‡æ¡£éƒ¨åˆ†å†…å®¹\nå¼€å‘ç¯å¢ƒ å¼€å‘ç¯å¢ƒæ˜¯è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­ä½¿ç”¨çš„è½¯ä»¶å’Œç¡¬ä»¶çš„ç»„åˆã€‚é€šå¸¸æƒ…å†µä¸‹åŒ…æ‹¬ä»£ç ç¼–è¾‘å™¨ã€ç¼–è¯‘å™¨ã€è°ƒè¯•å·¥å…·å’Œå…¶ä»–å·¥å…·ã€‚å¼€å‘ç¯å¢ƒå¸®åŠ©ç¨‹åºå‘˜ç¼–å†™ã€æµ‹è¯•å’Œè°ƒè¯•ä»£ç çš„ç¯å¢ƒã€‚\nIDEé›†æˆå¼€å‘ç¯å¢ƒ é›†æˆå¼€å‘ç¯å¢ƒæ˜¯ä¸€ç§åŒ…å«ä»£ç ç¼–è¾‘å™¨ã€ç¼–è¯‘å™¨å’Œè°ƒè¯•å™¨çš„ç»¼åˆæ€§è½¯ä»¶åº”ç”¨ç¨‹åºã€‚IDEæä¾›äº†æ–¹ä¾¿ç¼–å†™ã€æµ‹è¯•å’Œè°ƒè¯•ç¨‹åºçš„ä¸€ä½“åŒ–ç•Œé¢ã€‚ä¾‹å¦‚Keilï¼ŒClionï¼ŒRTT Studioï¼ŒCubeIDEç­‰ï¼Œæœ¬æ–‡ä¸­ä¸»è¦ä»‹ç»Keilå’ŒClion\nä»£ç ç¼–è¾‘å™¨ ä»£ç ç¼–è¾‘å™¨æ˜¯ç”¨äºç¼–å†™å’Œä¿®æ”¹ä»£ç çš„å·¥å…·ã€‚å®ƒæä¾›äº†åŸºæœ¬çš„æ–‡æœ¬ç¼–è¾‘åŠŸèƒ½ï¼Œé€šå¸¸è¿˜åŒ…æ‹¬è¯­æ³•é«˜äº®ã€ä»£ç æ ¼å¼åŒ–å’Œé”™è¯¯æ£€æŸ¥ç­‰ç‰¹æ€§ã€‚æ¯”å¦‚æˆ‘ä»¬æ‰€ä½¿ç”¨çš„VScodeã€‚ä¸€èˆ¬æ¥è®²ï¼Œå¯¹äºä¸€ä¸ªé¡¹ç›®ï¼Œä»£ç ç¼–è¾‘å™¨çš„é€‰æ‹©é€šå¸¸æ˜¯æ— æ‰€è°“çš„\nå…³äºå•ç‰‡æœº å•ç‰‡æœºæ˜¯ä¸€ç§å¾®å‹è®¡ç®—æœº\nå•ç‰‡æœºï¼ˆMicrocontroller Unitï¼Œç®€ç§°MCUï¼‰æ˜¯ä¸€ç§å°†å¾®å¤„ç†å™¨ã€å­˜å‚¨å™¨ï¼ˆåŒ…æ‹¬ç¨‹åºå­˜å‚¨å™¨å’Œæ•°æ®å­˜å‚¨å™¨ï¼‰ã€è¾“å…¥/è¾“å‡ºæ¥å£å’Œå…¶ä»–å¿…è¦çš„åŠŸèƒ½æ¨¡å—é›†æˆåœ¨å•ä¸ªèŠ¯ç‰‡ä¸Šçš„å¾®å‹è®¡ç®—æœºã€‚å®ƒé€šå¸¸ç”¨äºæ§åˆ¶åº”ç”¨ï¼Œå¯ä»¥åœ¨æ²¡æœ‰å¤–éƒ¨æ”¯æŒèŠ¯ç‰‡çš„æƒ…å†µä¸‹ç‹¬ç«‹è¿è¡Œã€‚\nå¯ä»¥ç†è§£ä¸ºå•ç‰‡æœº=å¾®å¤„ç†å™¨+å­˜å‚¨å™¨+ç‰‡ä¸Šå¤–è®¾\nå¾®å¤„ç†å™¨ä¸»è¦è´Ÿè´£è¿ç®—ä¸æ§åˆ¶é€»è¾‘çš„æ‰§è¡Œ å­˜å‚¨å™¨ç”¨äºå­˜å‚¨ä»£ç ä¸æ•°æ® å¤–è®¾ç”¨äºå®ç°å•ç‰‡æœºçš„å„ç§åŠŸèƒ½ï¼Œä¾‹å¦‚å®šæ—¶å™¨çš„å®šæ—¶ï¼Œè¾“å…¥æ•è·åŠŸèƒ½ï¼ŒUSARTçš„ä¸²å£é€šä¿¡åŠŸèƒ½ å¤–è®¾ å•ç‰‡æœºå¤–è®¾æ˜¯æŒ‡ç”¨äºæ‰©å±•å•ç‰‡æœºåŠŸèƒ½çš„è¾…åŠ©ç”µè·¯ï¼ŒåŒ…æ‹¬å†…éƒ¨å¤–è®¾å’Œå¤–éƒ¨å¤–è®¾ï¼Œèƒ½å¤Ÿä¸å•ç‰‡æœºååŒå·¥ä½œï¼Œå®ç°å„ç§æ§åˆ¶å’Œå¤„ç†ä»»åŠ¡\nä¾‹å¦‚å®šæ—¶å™¨TIMå’ŒUSARTå°±æ˜¯ä¸¤ä¸ªå¸¸è§çš„å•ç‰‡æœºçš„ç‰‡ä¸Šå¤–è®¾ å®šæ—¶å™¨å¯ä»¥ç”¨æ¥å®ç°å®šæ—¶ï¼ŒPWMè°ƒåˆ¶ï¼Œè¾“å…¥æ•è·ç­‰å¤æ‚åŠŸèƒ½ USARTå¯ä»¥ç”¨æ¥å®ç°åŒæ­¥/å¼‚æ­¥çš„ä¸²å£é€šä¿¡\nå…³äºCubeMX CubeMXæœ¬è´¨æ˜¯ä»£ç ç”Ÿæˆå™¨ï¼Œå›¾å½¢åŒ–åµŒå…¥å¼å¼€å‘è¾…åŠ©å·¥å…·ï¼Œç”¨äºå¿«é€Ÿé…ç½®STM32ç¡¬ä»¶èµ„æºå¹¶ç”Ÿæˆåˆå§‹åŒ–ä»£ç æ¡†æ¶ï¼Œé™ä½åº•å±‚å¼€å‘é—¨æ§›ï¼Œé€šè¿‡å›¾å½¢åŒ–ç•Œé¢ï¼Œè‡ªåŠ¨é…ç½®å¥½ç”¨æˆ·æ‰€éœ€çš„å¤–è®¾èµ„æº\nCubeMXç”Ÿæˆçš„ä»£ç ä¸HALåº“å¼ºç»‘å®š\nå…³äºHALåº“ HALåº“ï¼ˆHardware Abstraction Layerï¼Œç¡¬ä»¶æŠ½è±¡å±‚ï¼‰æ˜¯STå…¬å¸ä¸ºSTM32å¾®æ§åˆ¶å™¨è®¾è®¡çš„æ ‡å‡†åŒ–ç¡¬ä»¶é©±åŠ¨åº“ã€‚ä½œä¸ºåµŒå…¥å¼å¼€å‘çš„å…³é”®åŸºç¡€è®¾æ–½ï¼Œå…¶å®è´¨æ˜¯åœ¨ç¡¬ä»¶å¯„å­˜å™¨ä¸ç”¨æˆ·åº”ç”¨ä¹‹é—´æ„å»ºäº†ä¸€ä¸ªæŠ½è±¡æ¥å£å±‚ï¼Œå½»åº•æ”¹å˜äº†ä¼ ç»ŸåµŒå…¥å¼å¼€å‘æ¨¡å¼\nç”¨æˆ·åªéœ€è¦å…³æ³¨HALåº“æä¾›çš„æŠ½è±¡å±‚ï¼Œè€Œä¸ç”¨å»å…³æ³¨æŠ½è±¡å±‚ä¹‹ä¸‹çš„å¤–è®¾å¯„å­˜å™¨æ“ä½œï¼ˆè¿™ç±»è®¾è®¡æ€æƒ³å¾ˆå€¼å¾—å€Ÿé‰´ï¼‰\nHALåº“æä¾›ç»Ÿä¸€çš„æ¥å£å‡½æ•°ï¼Œä¾‹å¦‚HAL_xxxx_Transmitå‘é€æ‰§è¡Œå‡½æ•°ï¼ŒxxxxCallbackå›è°ƒå‡½æ•°ç­‰\nå¼€å‘èŒƒå¼å˜ä¸ºï¼š åº”ç”¨å±‚-\u0026gt;HALåº“çš„æŠ½è±¡å±‚-\u0026gt;å…·ä½“ç¡¬ä»¶å¹³å°\nä¸‹é¢è®¨è®ºHALåº“ï¼ŒCMSISåè®®ï¼Œä»¥åŠä¸¤è€…å…³ç³»\nHALåº“ï¼ˆHardware Abstraction Layer ç¡¬ä»¶æŠ½è±¡å±‚åº“ï¼‰ HAL åº“æ˜¯Â STMicroelectronicsï¼ˆæ„æ³•åŠå¯¼ä½“ï¼‰Â ä¸ºè‡ªå®¶Â STM32 ç³»åˆ—å¾®æ§åˆ¶å™¨ï¼ˆMCUï¼‰Â é‡èº«æ‰“é€ çš„åº•å±‚è½¯ä»¶åº“ï¼Œæ˜¯ STM32 ç”Ÿæ€ä¸­æ ¸å¿ƒçš„å¼€å‘å·¥å…·ä¹‹ä¸€ï¼ŒåŸºäº ARM çš„ CMSIS æ ‡å‡†æ„å»ºã€‚\nCMSISï¼ˆCortex Microcontroller Software Interface Standardï¼‰ CMSIS æ˜¯Â ARM å…¬å¸Â åˆ¶å®šçš„Â è¡Œä¸šç»Ÿä¸€è½¯ä»¶æ¥å£æ ‡å‡†ï¼ˆæ³¨æ„ï¼šä¸æ˜¯å…·ä½“çš„è½¯ä»¶åº“ï¼Œè€Œæ˜¯ â€œè§„èŒƒ / åè®®â€ï¼‰ï¼Œé¢å‘æ‰€æœ‰åŸºäº ARM Cortex-M å†…æ ¸ï¼ˆM0/M0+/M3/M4/M7 ç­‰ï¼‰çš„å¾®æ§åˆ¶å™¨ï¼Œæ‰€æœ‰ä¸»æµ MCU å‚å•†ï¼ˆSTã€NXPã€Microchipã€TIã€ç‘è¨ç­‰ï¼‰å‡éœ€éµå¾ªè¯¥æ ‡å‡†ã€‚\nHAL åº“ä¸ CMSIS çš„å…³ç³» å±‚çº§å…³ç³»ï¼šCMSIS æ˜¯Â åº•å±‚æ ‡å‡†ï¼ŒHAL åº“æ˜¯Â åŸºäº CMSIS æ ‡å‡†çš„å…·ä½“å®ç°â€”â€”HAL åº“çš„å†…æ ¸æ“ä½œï¼ˆå¦‚ä¸­æ–­é…ç½®ã€Systick å®šæ—¶å™¨ã€æ—¶é’Ÿåˆå§‹åŒ–ï¼‰å®Œå…¨éµå¾ª CMSIS-Core è§„èŒƒï¼Œå¤–è®¾é©±åŠ¨æ¥å£ä¹Ÿå…¼å®¹ CMSIS-Driver æ¨¡æ¿ã€‚\nç®€å•æ€»ç»“ï¼šCMSIS æ˜¯ â€œé€šç”¨æ¥å£è§„åˆ™â€ï¼ŒHAL åº“æ˜¯ ST æŒ‰è§„åˆ™ä¸º STM32 å®šåˆ¶çš„ â€œå·¥å…·åŒ…â€ï¼Œä¸¤è€…ç»“åˆæ—¢ä¿è¯äº†è·¨å¹³å°å…¼å®¹æ€§ï¼Œåˆæå‡äº† STM32 çš„å¼€å‘æ•ˆç‡ã€‚\nStep2 å·¥å…·é“¾çš„åŸºç¡€è®¤çŸ¥æ„å»ºä¸å·¥å…·é“¾æ¢æ–° å¯¹äºæ•´ä¸ªå·¥å…·é“¾çš„ç†è§£ï¼Œéœ€è¦å»ºç«‹åœ¨å¯¹å•ç‰‡æœºï¼ˆå¾®å‹è®¡ç®—æœºï¼‰çš„åŸºæœ¬å·¥ä½œæ–¹å¼æœ‰ä¸€å®šè®¤çŸ¥çš„åŸºç¡€ä¸Š\nè®¡ç®—æœºçš„è¿è¡Œéƒ½æ˜¯åŸºäºæœºå™¨è¯­è¨€ï¼Œæˆ‘ä»¬ç¼–å†™çš„Cè¯­è¨€ç¨‹åºï¼Œæœ€åç»è¿‡ç¼–è¯‘å¾—åˆ°æ±‡ç¼–ä»£ç ï¼Œå†ç»è¿‡æ±‡ç¼–ï¼Œå¾—åˆ°äºŒè¿›åˆ¶ä»£ç ï¼ˆå·²ç»æ˜¯æœºå™¨è¯­è¨€ï¼Œä½†ä¸å¯è¿è¡Œï¼‰ï¼Œæœ€åç»è¿‡é“¾æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªèƒ½è¿è¡Œäºå•ç‰‡æœºä¸Šçš„å¯æ‰§è¡Œç¨‹åº\nåŒæ—¶ï¼Œè¿˜éœ€è¦æä¸€ä¸‹çš„æ˜¯ï¼Œåœ¨ä¸€ç§è®¡ç®—æœºç¯å¢ƒä¸­è¿è¡Œçš„ç¼–è¯‘ç¨‹åºï¼Œèƒ½ç¼–è¯‘å‡ºåœ¨å¦å¤–ä¸€ç§ç¯å¢ƒä¸‹è¿è¡Œçš„ä»£ç ï¼Œè¿™ä¸ªç¼–è¯‘è¿‡ç¨‹å°±å«äº¤å‰ç¼–è¯‘ã€‚ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå¹³å°ä¸Šç”Ÿæˆå¦ä¸€ä¸ªå¹³å°ä¸Šçš„å¯æ‰§è¡Œä»£ç ï¼ŒåµŒå…¥å¼å¼€å‘çš„ç¨‹åºç¼–è¯‘å°±æ˜¯å…¸å‹çš„äº¤å‰ç¼–è¯‘ï¼Œç”¨åˆ°çš„ç¼–è¯‘å™¨ç”¨è¢«ç§°ä½œäº¤å‰ç¼–è¯‘å™¨\nç›®å‰é˜Ÿå†…çš„å¼€å‘å·¥å…·é“¾æ˜¯VScode/Clion+arm-none-eabi/armclag+CMake+Ninja+Ozone+clangd/intellisence/Clion_LSPï¼ˆç¼–è¾‘å™¨+ç¼–è¯‘å™¨+é¡¹ç›®æ„å»ºå·¥å…·+é¡¹ç›®æ„å»ºçš„æ‰§è¡Œå·¥å…·+çƒ§å½•å™¨+è¯­æ³•æœåŠ¡æ”¯æŒLSPï¼‰ï¼Œä¸ªäººè®¤ä¸ºè¿˜æ˜¯ç›¸å½“ç°ä»£åŒ–ä¸”é«˜åº¦è‡ªå®šä¹‰çš„ ä¸‹é¢ç®€å•è®²è§£Cè¯­è¨€åˆ°æœºå™¨è¯­è¨€çš„å®šä¹‰ä»¥åŠç¼–è¯‘è¿‡ç¨‹\nä»Cè¯­è¨€åˆ°æœºå™¨è¯­è¨€ æœºå™¨è¯­è¨€ è®¡ç®—æœºï¼ˆåŒ…æ‹¬å•ç‰‡æœºï¼‰æ˜¯ä¸èƒ½ç›´æ¥è¯†åˆ«æˆ‘ä»¬æ‰€ç¼–å†™çš„Cè¯­è¨€ç¨‹åºã€‚å®ƒåªèƒ½è¯†åˆ«æœºå™¨è¯­è¨€ï¼Œè€Œæœºå™¨è¯­è¨€æ˜¯ç”¨äºŒè¿›åˆ¶ä»£ç è¡¨ç¤ºçš„è®¡ç®—æœºèƒ½ç›´æ¥è¯†åˆ«å’Œæ‰§è¡Œçš„ä¸€ç§æœºå™¨æŒ‡æŒ‡ä»¤ç³»ç»Ÿä»¤çš„é›†åˆ\næ±‡ç¼–è¯­è¨€ æ±‡ç¼–è¯­è¨€æ˜¯ä¸€ç§ç”¨äºå¾®å¤„ç†å™¨ã€å¾®æ§åˆ¶å™¨æˆ–å…¶ä»–å¯ç¼–ç¨‹å™¨ä»¶çš„ä½çº§è¯­è¨€ã€‚ åœ¨ä¸åŒçš„è®¾å¤‡ä¸­ï¼Œæ±‡ç¼–è¯­è¨€å¯¹åº”ç€ä¸åŒçš„æœºå™¨è¯­è¨€æŒ‡ä»¤é›†ã€‚ ä¸€ç§æ±‡ç¼–è¯­è¨€ä¸“ç”¨äºæŸç§è®¡ç®—æœºç³»ç»Ÿç»“æ„ï¼Œè€Œä¸åƒè®¸å¤šé«˜çº§è¯­è¨€ï¼Œå¯ä»¥åœ¨ä¸åŒç³»ç»Ÿå¹³å°ä¹‹é—´ç§»æ¤ã€‚æ±‡ç¼–è¯­è¨€çš„ä¸»ä½“æ˜¯æ±‡ç¼–æŒ‡ä»¤ï¼Œæ±‡ç¼–è¯­è¨€æ˜¯äºŒè¿›åˆ¶æŒ‡ä»¤çš„æ–‡æœ¬å½¢å¼ï¼Œä¸æŒ‡ä»¤æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ã€‚æ¯”å¦‚ï¼Œæœ‰ä¸€äº›æ¶æ„çš„æ±‡ç¼–æŒ‡ä»¤ä¸­çš„åŠ æ³•æŒ‡ä»¤00000011å†™æˆæ±‡ç¼–è¯­è¨€å°±æ˜¯ Add\né€šä¿—çš„ç†è§£ï¼Œæ±‡ç¼–è¯­è¨€ä¸å¯¹åº”è®¡ç®—æœºçš„æ¶æ„ç›¸å…³ï¼Œx86å’Œarmç»“æ„çš„è®¡ç®—æœºåˆ†åˆ«æœ‰ä¸€å¥—å¯¹åº”çš„æ±‡ç¼–æŒ‡ä»¤ï¼Œè€Œæ±‡ç¼–è¯­è¨€æ˜¯æœºå™¨è¯­è¨€çš„æ–‡æœ¬åŒ–è¡¨è¾¾ï¼Œä¾‹å¦‚ æŸä¸€æ±‡ç¼–æŒ‡ä»¤ä¸­00000011å¯ä»¥ç®€è®°ä¸ºAdd\né«˜çº§è¯­è¨€ï¼ˆC\u0026amp;C++\u0026amp;Javaç­‰ï¼‰åˆ°æœºå™¨è¯­è¨€ é«˜çº§è¯­è¨€åˆ°æ±‡ç¼–è¯­è¨€éœ€è¦ç»è¿‡ç¼–è¯‘ï¼Œä¾‹å¦‚ .cæ–‡ä»¶ç»è¿‡ç¼–è¯‘åï¼Œä¼šç”Ÿæˆ .sæ–‡ä»¶\næ±‡ç¼–è¯­è¨€åˆ°æœºå™¨è¯­è¨€éœ€è¦ç»è¿‡æ±‡ç¼–ï¼Œä¾‹å¦‚ .sæ–‡ä»¶ç»è¿‡æ±‡ç¼–åï¼Œä¼šç”Ÿæˆ .oæ–‡ä»¶\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œé«˜çº§è¯­è¨€å…·æœ‰è¿ç§»æ€§ï¼Œåœ¨ä¸åŒæ¶æ„çš„è®¡ç®—æœºä¸Šé«˜çº§è¯­è¨€æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯æ±‡ç¼–è¯­è¨€å¯¹äºä¸åŒçš„æ¶æ„ä¼šæœ‰ä¸åŒçš„æŒ‡ä»¤ï¼Œ è¿™å°±éœ€è¦æˆ‘ä»¬é€‰æ‹©å¯¹åº”çš„ç¼–è¯‘å™¨ï¼Œä¾‹å¦‚stm32æ˜¯armæ¶æ„çš„èŠ¯ç‰‡ï¼Œåœ¨Cç¼–è¯‘å™¨çš„é€‰æ‹©ä¸Šéœ€è¦ é€‰æ‹©å°†Cè¯­è¨€ç¼–è¯‘ä¸ºarmæ¶æ„æ±‡ç¼–è¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œä¾‹å¦‚armccï¼Œarmclangï¼Œarm-none-eabiç­‰ç¼–è¯‘å™¨\næ‰€ä»¥åœ¨åµŒå…¥å¼å¼€å‘ä¸­ï¼Œéœ€è¦æ ¹æ®å•ç‰‡æœºçš„æ¶æ„é€‰æ‹©å¯¹åº”çš„ç¼–è¯‘å™¨\nç¼–è¯‘åŸç† Cè¯­è¨€ç¼–è¯‘åŸç†æ¶‰åŠå°†Cè¯­è¨€ä»£ç è½¬æ¢ä¸ºæœºå™¨è¯­è¨€çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–å’Œé“¾æ¥ã€‚ç¼–è¯‘å™¨åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹æºä»£ç è¿›è¡Œä¼˜åŒ–å’Œè½¬æ¢ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š\n1.Â é¢„å¤„ç†ï¼ˆPreprocessingï¼‰ ä½œç”¨ï¼šå¤„ç†æºä»£ç æ–‡ä»¶ä¸­çš„é¢„å¤„ç†æŒ‡ä»¤ï¼Œå¦‚#includeå’Œ#define è¿‡ç¨‹ï¼šæ›¿æ¢å®å®šä¹‰ï¼Œå¤„ç†æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ï¼ŒåŒ…å«å¤´æ–‡ä»¶å†…å®¹ å·¥å…·ï¼šé¢„å¤„ç†å™¨ï¼Œå¦‚cppã€armclang\n2.ç¼–è¯‘ï¼ˆCompilationï¼‰ ä½œç”¨ï¼šå°†é¢„å¤„ç†åçš„æºä»£ç è½¬æ¢æˆæ±‡ç¼–è¯­è¨€ è¿‡ç¨‹ï¼šè¿›è¡Œè¯­æ³•åˆ†æå’Œè¯­ä¹‰åˆ†æï¼Œç”Ÿæˆæ±‡ç¼–ä»£ç  å·¥å…·ï¼šç¼–è¯‘å™¨ï¼Œå¦‚GCCã€armclang\n3.æ±‡ç¼–ï¼ˆAssemblyï¼‰ ä½œç”¨ï¼šå°†æ±‡ç¼–è¯­è¨€è½¬æ¢æˆæœºå™¨è¯­è¨€ï¼Œå³ç›®æ ‡ä»£ç ï¼ˆObject Codeï¼‰ è¿‡ç¨‹ï¼šæ±‡ç¼–å™¨å°†æ±‡ç¼–æŒ‡ä»¤è½¬æ¢ä¸ºæœºå™¨ç  å·¥å…·ï¼šæ±‡ç¼–å™¨ï¼Œå¦‚asã€armasm\n4.é“¾æ¥ï¼ˆLinkingï¼‰ ä½œç”¨ï¼šå°†å¤šä¸ªç›®æ ‡ä»£ç æ–‡ä»¶å’Œåº“æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„å¯æ‰§è¡Œæ–‡ä»¶\nè¿‡ç¨‹ï¼š è§£å†³å¤–éƒ¨ç¬¦å·å¼•ç”¨ï¼Œå¦‚å‡½æ•°å’Œå…¨å±€å˜é‡ åˆå¹¶ä¸åŒæ¨¡å—ä¸­çš„ç›¸åŒæ®µï¼ˆå¦‚.textï¼Œ.dataï¼‰ ç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“æ–‡ä»¶ å·¥å…·ï¼šé“¾æ¥å™¨ï¼Œå¦‚ldã€armlink\nç¼–è¯‘å™¨ä¸é“¾æ¥å™¨ åœ¨æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨æ˜¯æ ¸å¿ƒç»„ä»¶ï¼Œä¸€èˆ¬çš„ç¯å¢ƒé…ç½®ä¹Ÿä¸»è¦é’ˆå¯¹è¿™äºŒè€…å±•å¼€ï¼š\nç¼–è¯‘å™¨ï¼ˆCompilerï¼‰ï¼šè´Ÿè´£å°†æºä»£ç è½¬æ¢æˆæ±‡ç¼–ä»£ç æˆ–ç›´æ¥ç”Ÿæˆç›®æ ‡ä»£ç ã€‚ç¼–è¯‘å™¨çš„é«˜çº§ä¼˜åŒ–åŒ…æ‹¬å¾ªç¯ä¼˜åŒ–ã€å¸¸æ•°ä¼ æ’­ã€æ­»ç åˆ é™¤ç­‰ é“¾æ¥å™¨ï¼ˆLinkerï¼‰ï¼šè´Ÿè´£å°†å¤šä¸ªç›®æ ‡ä»£ç æ–‡ä»¶æ•´åˆä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚é“¾æ¥å™¨å¤„ç†ç¬¦å·è§£æã€é‡å®šä½ç­‰ä»»åŠ¡\nå¤šæ–‡ä»¶ç¼–ç¨‹ ç®€å•æ¥è¯´å°±æ˜¯å¤´æ–‡ä»¶æä¾›å£°æ˜ï¼ˆå°±æ˜¯ç»™ç¼–è¯‘å™¨è¯´æœ‰æŸä¸€ä¸ªå‡½æ•°ï¼‰ï¼Œæºæ–‡ä»¶é‡Œé¢æœ‰å‡½æ•°çš„å…·ä½“å®šä¹‰/å®ç°\nå¤šæ–‡ä»¶ç¼–è¯‘æ—¶ä¼šç”Ÿæˆå¤šä¸ªäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œé“¾æ¥å™¨ä¼šå®ç°é‡å®šä½åç”Ÿæˆå”¯ä¸€çš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¹Ÿå°±æ˜¯æœ€åå®ç° main.cèƒ½ä½¿ç”¨usart.cé‡Œé¢çš„å‡½æ•°ï¼‰\næ ¸å¿ƒåŸç†ï¼šåˆ†ç¦»å¼ç¼–è¯‘ä¸é“¾æ¥ ç¼–è¯‘é“¾æ¥è¿‡ç¨‹ å…³é”®æ­¥éª¤\né¢„å¤„ç†é˜¶æ®µï¼šå¤„ç†#includeæŒ‡ä»¤ï¼Œå°†å¤´æ–‡ä»¶å†…å®¹å¤åˆ¶åˆ°æºæ–‡ä»¶ä¸­ ç¼–è¯‘é˜¶æ®µï¼šå°†æ¯ä¸ª.cæ–‡ä»¶ç‹¬ç«‹ç¼–è¯‘ä¸ºç›®æ ‡æ–‡ä»¶(.o) é“¾æ¥é˜¶æ®µï¼šåˆå¹¶æ‰€æœ‰ç›®æ ‡æ–‡ä»¶ï¼Œè§£æç¬¦å·å¼•ç”¨ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ ä½œç”¨åŸŸä¸é“¾æ¥å±æ€§ 1. å­˜å‚¨ç±»è¯´æ˜ç¬¦ å…³é”®å­— æ–‡ä»¶å†…ä½œç”¨ æ–‡ä»¶é—´ä½œç”¨ å…¸å‹ç”¨é€” static ç§æœ‰ ä¸å¯è®¿é—® å†…éƒ¨è¾…åŠ©å‡½æ•° extern å£°æ˜ å¯è®¿é—® å…¨å±€å˜é‡å£°æ˜ (é»˜è®¤) å®šä¹‰ å¯è®¿é—® å…¬å…±å‡½æ•° 2. ä½œç”¨åŸŸæ§åˆ¶ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 // module.c static int internal_counter = 0; // æ–‡ä»¶å†…ç§æœ‰å˜é‡ //åªæœ‰åœ¨è¯¥æ–‡ä»¶å†…çš„å‡½æ•°æ‰å¯ä»¥è®¿é—® void public_function(void) { internal_counter++; } // header.h extern int global_variable; // å£°æ˜å…¨å±€å˜é‡ //æ³¨æ„ï¼Œå£°æ˜ä¸ç­‰äºå®šä¹‰ // main.c int global_variable = 10; // å®šä¹‰å…¨å±€å˜é‡ ç¬¦å·è§£æä¸é‡å®šä½ é“¾æ¥å™¨æ ¸å¿ƒä»»åŠ¡ ç¬¦å·è§£æï¼šå°†ç¬¦å·å¼•ç”¨ä¸ç¬¦å·å®šä¹‰å…³è” é‡å®šä½ï¼šåˆå¹¶ç›®æ ‡æ–‡ä»¶ï¼Œè°ƒæ•´åœ°å€å¼•ç”¨ ç¬¦å·ç±»å‹ ç¬¦å·ç±»å‹ å®šä¹‰ä½ç½® å¼•ç”¨ä½ç½® é“¾æ¥å™¨å¤„ç† å¼ºç¬¦å· .text/.data å…¶ä»–æ–‡ä»¶ å¿…é¡»å”¯ä¸€ å¼±ç¬¦å· æœªåˆå§‹åŒ–å…¨å±€å˜é‡ å…¶ä»–æ–‡ä»¶ å¯è¦†ç›– å¤–éƒ¨å¼•ç”¨ æœªå®šä¹‰ å½“å‰æ–‡ä»¶ éœ€åœ¨å…¶å®ƒæ–‡ä»¶æ‰¾åˆ°å®šä¹‰ ç¬¦å·è§£æç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 // module.c //éœ€è¦#include \u0026#34;helper.h\u0026#34; void helper(void); // å¤–éƒ¨å¼•ç”¨ï¼ˆæœªå®šä¹‰ï¼‰ void public_func(void) { helper(); } // helper.c void helper(void) { // å¼ºç¬¦å·å®šä¹‰ /* å®ç° */ } // main.c extern void public_func(void); // å¤–éƒ¨å¼•ç”¨ int main() { public_func(); // é“¾æ¥å™¨è§£æåˆ°module.cä¸­çš„å®šä¹‰ } é“¾æ¥å™¨ç¬¦å·è¡¨å¤„ç† æ‰«ææ‰€æœ‰ç›®æ ‡æ–‡ä»¶ï¼Œæ”¶é›†ç¬¦å·å®šä¹‰ æ„å»ºå…¨å±€ç¬¦å·è¡¨ï¼š å¼ºç¬¦å·ï¼šè®°å½•åœ°å€ å¼±ç¬¦å·ï¼šæ ‡è®°ä¸ºå¯é€‰ï¼ˆweakå…³é”®å­—ï¼‰ è§£æå¼•ç”¨ï¼š æ‰¾åˆ°åŒ¹é…çš„å¼ºç¬¦å· æˆ–ä½¿ç”¨å¼±ç¬¦å·ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ æŠ¥å‘Šæœªè§£æå¼•ç”¨é”™è¯¯ æ€»ç»“ åœ¨ä¸Šè¿°å†…å®¹çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ— è®ºæ˜¯Clionè¿˜æ˜¯VScodeï¼Œå…¶æœ¬è´¨éƒ½è¿˜æ˜¯ä»£ç ç¼–è¾‘å™¨ï¼ˆè™½ç„¶Clionå†…ç½®äº†ç¼–è¯‘å™¨ï¼‰ï¼Œé…ç¯å¢ƒå®é™…ä¸Šé…çš„éƒ½è¿˜æ˜¯å¯¹åº”çš„ç¼–è¯‘å™¨ï¼ˆç°ä»£çš„ç¼–è¯‘å™¨åŒ…å«äº†ç¼–è¯‘å™¨ï¼Œæ±‡ç¼–å™¨ï¼Œé“¾æ¥å™¨ç­‰ï¼‰ï¼Œå¦‚arm-none-eabiçš„gcc/g++æˆ–è€…æ˜¯ arm-clangå’Œarm-cc\nStep3 C\u0026amp;C++æ··åˆç¼–ç¨‹ï¼ŒCMake\u0026amp;Make\u0026amp;Ninja C\u0026amp;C++æ··åˆç¼–ç¨‹ æ ¸å¿ƒåŸç† åœ¨äºCä¸C++çš„ç¬¦å·ä¿®é¥°ï¼Œå¦‚ä½•åˆ©ç”¨extern \u0026quot;C\u0026quot;å‘½ä»¤å®ç°C call C++ä»¥åŠC++ call C\nã€å…³äºCå’ŒC++æ··åˆç¼–ç¨‹ä¸­ç¼–è¯‘å’Œé“¾æ¥çš„é—®é¢˜ã€‘https://www.bilibili.com/video/BV1Zm4y1E7nm?vd_source=5a0790755035f26a67935abfbfcdfd5b\nextern \u0026ldquo;c\u0026quot;çš„ç”¨æ³•ï¼šcä¸c++çš„äº’ç›¸è°ƒç”¨ - é’å±±ç‰§äº‘äºº - åšå®¢å›­ C++\u0026ndash;åå­—ä¿®é¥°_c++çš„å‡½æ•°åä¿®é¥°æ˜¯åœ¨å“ªä¸ªé˜¶æ®µè¿›è¡Œçš„-CSDNåšå®¢ C/C++ å‡½æ•°ç­¾åä¸åå­—ä¿®é¥°ï¼ˆç¬¦å·ä¿®é¥°ï¼‰-CSDNåšå®¢ C/C++ä¸­çš„ extern å’Œexternâ€œCâ€œå…³é”®å­—çš„ç†è§£å’Œä½¿ç”¨ï¼ˆå¯¹æ¯”ä¸¤è€…çš„å¼‚åŒï¼‰_c extern c-CSDNåšå®¢\nç¬¦å·ä¿®é¥° åœ¨C/C++ä¸­ï¼Œä¸€ä¸ªç¨‹åºè¦è¿è¡Œèµ·æ¥ï¼Œéœ€è¦ç»å†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼šé¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥ã€‚\nåå­—ä¿®é¥°ï¼ˆName Manglingï¼‰æ˜¯ä¸€ç§åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå°†å‡½æ•°ã€å˜é‡çš„åç§°é‡æ–°æ”¹ç¼–çš„æœºåˆ¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç¼–è¯‘å™¨ä¸ºäº†åŒºåˆ†å„ä¸ªå‡½æ•°ï¼Œå°†å‡½æ•°é€šè¿‡ä¸€å®šç®—æ³•ï¼Œé‡æ–°ä¿®é¥°ä¸ºä¸€ä¸ªå…¨å±€å”¯ä¸€çš„åç§°ã€‚\nç”±äºC++å’ŒCçš„åå­—ä¿®é¥°è§„åˆ™ä¸åŒï¼ˆä¸åŒæ“ä½œç³»ç»Ÿä¸‹çš„ç¼–è¯‘å™¨çš„åå­—ä¿®é¥°æ–¹å¼ä¹Ÿä¼šä¸åŒï¼‰ï¼Œå¯¼è‡´C++å¯ä»¥æ”¯æŒå‡½æ•°é‡è½½ï¼Œè€ŒCä¸æ”¯æŒå‡½æ•°é‡è½½\nå¯ä»¥ç®€å•ç†è§£ä¸ºï¼Œc++ä¸­æ”¯æŒå‡½æ•°é‡è½½ï¼Œcè¯­è¨€ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œè¿™é€ æˆäº†c++å’Œcè¯­è¨€çš„å‡½æ•°åè§£æä¸åŒï¼ˆåå­—ä¿®é¥°/ç¬¦å·ä¿®é¥°ï¼‰ã€‚cè¯­è¨€å‡½æ•°åå°±æ˜¯å‡½æ•°åï¼Œc++çš„å‡½æ•°åæ˜¯å‡½æ•°å+å‚æ•°ç»„åˆèµ·æ¥çš„ã€‚\nCä¸C++ç¬¦å·ä¿®é¥°çš„å®ä¾‹ extern \u0026ldquo;c\u0026quot;çš„ç”¨æ³•ï¼šcä¸c++çš„äº’ç›¸è°ƒç”¨ - é’å±±ç‰§äº‘äºº - åšå®¢å›­ ï¼ˆç›´æ¥copyè‡ªè¯¥åšå®¢ï¼‰\næ¯”å¦‚ï¼Œå‡½æ•°void func(double a)Â åœ¨Cå’ŒC++ä¸­çš„ç¼–è¯‘é˜¶æ®µå‡½æ•°åç§°ä¼šè¢«è§£ææˆä»€ä¹ˆå‘¢ï¼Ÿ\nåœ¨Cè¯­è¨€ä¸­ï¼Œç”±äºæ²¡æœ‰åç§°ä¿®é¥°ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å‡½æ•°åç§°ä»ç„¶æ˜¯funcï¼Œä¸ä¼šå› ä¸ºå‚æ•°ç±»å‹æˆ–æ•°é‡è€Œæ”¹å˜ã€‚\nåœ¨C++ä¸­ï¼Œç”±äºåç§°ä¿®é¥°çš„å­˜åœ¨ï¼Œå‡½æ•°åç§°åœ¨ç¼–è¯‘é˜¶æ®µä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢æˆä¸€ä¸ªåŒ…å«å‡½æ•°åŸå‹ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚é€šå¸¸ä¼šæ¶‰åŠå‡½æ•°è¿”å›ç±»å‹ã€å‚æ•°ç±»å‹ä»¥åŠå‚æ•°æ•°é‡ã€‚ä»¥GCC(GNU Compiler Collection)ä¸ºä¾‹ï¼Œfunc(double a)ä¼šè¢«è½¬æ¢æˆ_Z4funcdÂ ï¼Œè¿™é‡Œï¼š\n_Zï¼šæ˜¯GCCç”¨æ¥è¡¨ç¤ºä¿®é¥°åç§°çš„å‰ç¼€ 4ï¼šè¡¨ç¤ºå‡½æ•°åç§°funcçš„çš„å­—ç¬¦æ•° dï¼šæ˜¯doubleç±»å‹çš„ç¼–ç  å› æ­¤ï¼Œç”¨c++çš„æ–¹å¼å»å¯»æ‰¾cè¯­è¨€çš„ç¬¦å·æ˜¯æ— æ³•å¯»æ‰¾åˆ°çš„ã€‚extern \u0026quot;C\u0026quot;ä¸ºä½•å¯ä»¥åšåˆ°ï¼Ÿ\nextern \u0026quot;C\u0026quot;çš„ä½œç”¨å°±æ˜¯ä¿®æ”¹äº†ç¬¦å·è¡¨çš„ç”Ÿæˆæ–¹å¼ï¼Œå°†c++ç¬¦å·çš„ç”Ÿæˆæ–¹å¼æ¢æˆäº†cçš„ç”Ÿæˆæ–¹å¼ã€‚\nå³cåº“ä¸­ç”Ÿæˆçš„ç¬¦å·æ˜¯cç¼–è¯‘å™¨çš„ç¬¦å·ï¼Œ å› æ­¤cè¯­è¨€å¯ä»¥ç›´æ¥é“¾æ¥ã€‚è€Œc++ç¨‹åºéœ€è¦ä½¿ç”¨extern \u0026quot;C\u0026quot;è®©ç¼–è¯‘å™¨ä½¿ç”¨cçš„ç¬¦å·å‘½åæ–¹å¼å»è¿›è¡Œé“¾æ¥ï¼Œè¿™æ ·æ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„ç¬¦å·ã€‚\nextern \u0026ldquo;C\u0026rdquo; C/C++ä¸­çš„ extern å’Œexternâ€œCâ€œå…³é”®å­—çš„ç†è§£å’Œä½¿ç”¨ï¼ˆå¯¹æ¯”ä¸¤è€…çš„å¼‚åŒï¼‰_c extern c-CSDNåšå®¢\nçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† çœ‹å®ä¾‹\ncppè°ƒç”¨cï¼Œcppç¼–è¯‘æ—¶ä¼šæœ‰C++çš„ç¬¦å·ä¿®é¥°ï¼Œå¯¼è‡´é“¾æ¥Cåº“çš„å‡½æ•°æ‰¾ä¸åˆ°ï¼Œéœ€è¦ç”¨extern \u0026ldquo;C\u0026quot;å‘Šè¯‰g++ç¼–è¯‘å™¨ä»¥Cè¯­è¨€çš„é£æ ¼è¿›è¡Œç¼–è¯‘ cè°ƒç”¨cppï¼ˆä¸æ¶‰åŠC++çš„ç±»å’Œæˆå‘˜å‡½æ•°ï¼‰ï¼Œè®¾è®¡ä¸€ä¸ªCçš„æ¥å£ï¼Œæ¥å£çš„å®ç°åœ¨cppä¸­ï¼Œæ¥å£å‡½æ•°å†…éƒ¨å»ä½¿ç”¨C++çš„ç‰¹æ€§ cä¸­è°ƒç”¨c++æˆå‘˜å‡½æ•°ï¼Œéœ€è¦ä¸€ä¸ªæ¥å£å‡½æ•° CMakeè¿™ä¸€å— CMakeæ˜¯ä¸€ä¸ªC/C++é¡¹ç›®æ„å»ºå·¥å…· æ ¹æ®CMakeLists.txtæ¥æ„å»ºmakefile/ninjaæ–‡ä»¶ï¼Œå†æ ¹æ®makefile/ninjaæ–‡ä»¶æ¥ç¼–è¯‘Cå’ŒC++æ–‡ä»¶å¹¶ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶\nåªéœ€è¦ç†è§£ åœ¨å‘½ä»¤è¡Œä½¿ç”¨g++ è¿›è¡Œå¤šæ–‡ä»¶ç¼–è¯‘æ—¶ï¼Œæ¯æ¬¡è¾“å…¥éƒ½éœ€è¦è¾“å…¥ä¸€å¤§å †çš„æ–‡ä»¶ï¼Œéå¸¸éº»çƒ¦ ä½¿ç”¨CMake+make/ninjaè¿›è¡Œç®€åŒ–æ“ä½œå³å¯ï¼ˆä¸ªäººè®¤ä¸ºçš„CMakeçš„ä¸€ä¸ªæ ¸å¿ƒæ€æƒ³ï¼ˆæç®€åŒ–ç†è§£ï¼‰ï¼‰\nå±‚çº§å…³ç³»\nå¼€å‘è€…å±‚ï¼šç¼–å†™CMakeLists.txtå®šä¹‰æ„å»ºè§„åˆ™ ç”Ÿæˆå™¨å±‚ï¼šCMakeè§£æé…ç½®ï¼Œç”Ÿæˆåº•å±‚æ„å»ºæ–‡ä»¶ æ‰§è¡Œå™¨å±‚ï¼šMake/Ninjaæ‰§è¡Œå…·ä½“æ„å»ºå‘½ä»¤ å·¥å…·é“¾å±‚ï¼šç¼–è¯‘å™¨(å¦‚gcc)ã€é“¾æ¥å™¨ç­‰å®é™…æ‰§è¡Œç¼–è¯‘ cmake cmakeæ˜¯ä¸€ä¸ªç”Ÿæˆ .ninja å’Œ .makefile çš„å·¥å…·ã€‚cmakeåªéœ€è¦ç”¨æˆ·é€šè¿‡å¯¹æºç æ–‡ä»¶çš„ç®€å•æè¿°ï¼ˆå°±æ˜¯CMakeLists.txtæ–‡ä»¶ï¼‰ï¼Œå°±èƒ½è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªprojectçš„makefileæ–‡ä»¶æˆ–è€…ninjaæ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ninjaæˆ–è€…makeè¿›è¡Œå¯åŠ¨ç¼–è¯‘äº†ï¼Œå¾ˆå¤šIDEéƒ½åœ¨ç”¨cmakeä½œä¸ºé¡¹ç›®ç®¡ç†å·¥å…·ã€‚\nmakeä¸ninja makeåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥ç»™äººçœ‹ï¼Œninjaå¯åŠ¨é€Ÿåº¦å¿«ï¼Œé¡¹ç›®æ„å»ºé€Ÿåº¦å¿«ï¼Œä½†ä¸æ˜¯ç»™äººçœ‹çš„\nå¯ä»¥è®¤ä¸ºä¸¤è€…åŒçº§ã€‚\nStep4 C++æå‡\u0026amp;è®¾è®¡æ¨¡å¼ è¿™ä¸€èŠ‚ä¹Ÿæ˜¯æœ¬äººæå…¶æ¬ ç¼ºçš„ï¼Œç›®å‰æ­£åœ¨æ¶è¡¥\nC++çš„æå‡æ¨èC\u0026amp;C++ ç³»ç»Ÿå­¦ä¹ ï¼ˆè‡ªèè¿™ä¸€å—å„¿ï¼‰\nè®¾è®¡æ¨¡å¼æ¨èï¼šæš‚æ— \nC++æå‡ å†…å­˜å¯¹é½ ä¸€æ–‡è½»æ¾ç†è§£å†…å­˜å¯¹é½ - çŸ¥ä¹ è¿™é‡Œä»…ä»¥ç»“æ„ä½“çš„å†…å­˜å¯¹é½ä¸ºä¾‹ï¼Œä¸æä¾›å…·ä½“ä¾‹å­ï¼Œå…·ä½“ä¾‹å­è¯¦è§ä¸Šé¢çš„åšå®¢\nç»“æ„ä½“ï¼ˆstructï¼‰å¯¹é½ è§„åˆ™ 1ï¼šæˆå‘˜åœ°å€ =Â min(è‡ªèº«å¯¹é½å€¼, æœ‰æ•ˆå¯¹é½å€¼)Â çš„å€æ•°\nè§„åˆ™ 2ï¼šç»“æ„ä½“æ€»å¤§å° = æœ€å¤§æˆå‘˜å¯¹é½å€¼çš„æ•´æ•°å€\nè§„åˆ™ 3ï¼šæˆå‘˜æ’åˆ—é¡ºåºå½±å“æœ€ç»ˆå¤§å°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #pragma pack(1)//è®¾ç½®é»˜è®¤å¯¹é½æ•°ä¸º1 struct S1 { char c1; int i; char c2; }; #pragma pack()//å–æ¶ˆè®¾ç½®çš„é»˜è®¤å¯¹é½æ•°ï¼Œè¿˜åŸä¸ºé»˜è®¤ int main() { //è¾“å‡ºçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ printf(\u0026#34;%d\\n\u0026#34;, sizeof(struct S1)); return 0; } 1 2 3 4 5 6 7 #pragma pack(push, 1)//è®¾ç½®é»˜è®¤å¯¹é½æ•°ä¸º1 struct MyStruct { char a; int b; double c; }; #pragma pack(pop)//å–æ¶ˆè®¾ç½®çš„é»˜è®¤å¯¹é½æ•°ï¼Œè¿˜åŸä¸ºé»˜è®¤ 1 2 3 4 5 struct MyStruct { char a; int b; double c; } __attribute__((packed)); æ·±æ‹·è´ä¸æµ…æ‹·è´ 1. æµ…æ‹·è´ï¼ˆShallow Copyï¼‰ åŸç†ï¼šä»…å¤åˆ¶å¯¹è±¡çš„æˆå‘˜å€¼ï¼ˆåŒ…æ‹¬æŒ‡é’ˆçš„å€¼ï¼‰ï¼Œä¸å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„å®é™…èµ„æºã€‚\nç»“æœï¼šåŸå¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„æŒ‡é’ˆæˆå‘˜æŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 class Shallow { public: int* data; Shallow(int d) { data = new int(d); // åˆ†é…å †å†…å­˜ } // ç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼ˆæµ…æ‹·è´ï¼‰ Shallow(const Shallow\u0026amp; other) : data(other.data) {} ~Shallow() { delete data; } }; // ä½¿ç”¨ç¤ºä¾‹ Shallow obj1(10); Shallow obj2 = obj1; // æµ…æ‹·è´ï¼šobj2.data æŒ‡å‘ obj1.data çš„å†…å­˜ *obj1.data = 20; // ä¿®æ”¹ obj1 cout \u0026lt;\u0026lt; *obj2.data; // è¾“å‡º 20ï¼ˆobj2 ä¹Ÿè¢«ä¿®æ”¹ï¼‰ // mainç»“æŸæ—¶ï¼šobj2 å’Œ obj1 ä¼šå…ˆåè°ƒç”¨ææ„å‡½æ•° // å¯¼è‡´åŒä¸€å†…å­˜è¢« delete ä¸¤æ¬¡ â†’ ç¨‹åºå´©æºƒï¼ æµ…æ‹·è´çš„æ ¸å¿ƒé—®é¢˜ï¼š æ‚¬ç©ºæŒ‡é’ˆï¼šä¸€ä¸ªå¯¹è±¡é‡Šæ”¾èµ„æºåï¼Œå¦ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆå¤±æ•ˆ é‡å¤é‡Šæ”¾ï¼šå¤šä¸ªå¯¹è±¡å°è¯•é‡Šæ”¾åŒä¸€å—å†…å­˜ â†’ å´©æºƒ æ•°æ®ç¯¡æ”¹ï¼šé€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¿®æ”¹æ•°æ®ä¼šå½±å“å…¶ä»–å¯¹è±¡ 2. æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ ä¸»è¦ç”¨äºæ‹·è´æ„é€ å‡½æ•°ï¼Œèµ‹å€¼è¿ç®—ç¬¦ åŸç†ï¼šä¸ä»…å¤åˆ¶å¯¹è±¡æˆå‘˜ï¼Œè¿˜å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„èµ„æºã€‚\nç»“æœï¼šåŸå¯¹è±¡å’Œæ‹·è´å¯¹è±¡æ‹¥æœ‰å®Œå…¨ç‹¬ç«‹çš„èµ„æºå‰¯æœ¬ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 class Deep { public: int* data; Deep(int d) { data = new int(d); } // è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°ï¼ˆæ·±æ‹·è´ï¼‰ Deep(const Deep\u0026amp; other) { data = new int(*other.data); // å…³é”®ï¼šåˆ†é…æ–°å†…å­˜å¹¶å¤åˆ¶å€¼ } // æ·±æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ Deep\u0026amp; operator=(const Deep\u0026amp; other) { if (this != \u0026amp;other) { // é˜²æ­¢è‡ªèµ‹å€¼ delete data; // é‡Šæ”¾åŸæœ‰èµ„æº data = new int(*other.data); // åˆ›å»ºæ–°å‰¯æœ¬ } return *this; } ~Deep() { delete data; } }; // ä½¿ç”¨ç¤ºä¾‹ Deep obj1(10); Deep obj2 = obj1; // æ·±æ‹·è´ï¼šobj2 æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å‰¯æœ¬ *obj1.data = 20; // ä¿®æ”¹ obj1 cout \u0026lt;\u0026lt; *obj2.data; // è¾“å‡º 10ï¼ˆobj2 ä¸å—å½±å“ï¼‰ // ææ„æ—¶å„è‡ªé‡Šæ”¾ç‹¬ç«‹å†…å­˜ â†’ å®‰å…¨ æ·±æ‹·è´çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š èµ„æºç‹¬ç«‹ï¼šæ¯ä¸ªå¯¹è±¡æ‹¥æœ‰è‡ªå·±çš„èµ„æºå‰¯æœ¬ å®‰å…¨ææ„ï¼šä¸ä¼šå‘ç”Ÿé‡å¤é‡Šæ”¾ æ•°æ®éš”ç¦»ï¼šä¿®æ”¹ä¸€ä¸ªå¯¹è±¡ä¸å½±å“å…¶ä»–å¯¹è±¡ æ„é€ å‡½æ•°\u0026amp;æ‹·è´æ„é€ å‡½æ•°\u0026amp;èµ‹å€¼è¿ç®—ç¬¦ å¤§ç–†C++ä¸€é¢ï¼šC++ä»€ä¹ˆæ—¶å€™ç”Ÿæˆé»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼Ÿ\n1.æ„é€ å‡½æ•° ç”¨äºåˆå§‹åŒ–å¯¹è±¡çš„ç‰¹æ®Šæˆå‘˜å‡½æ•°ï¼Œä¸ç±»åŒåï¼Œæ— è¿”å›å€¼\nå¯é‡è½½ï¼Œæ”¯æŒé»˜è®¤å‚æ•° è‹¥æœªæ˜¾å¼å®šä¹‰ï¼Œç¼–è¯‘å™¨ç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•° å¯¹è±¡åˆ›å»ºæ—¶è‡ªåŠ¨è°ƒç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 ```cpp class Point { private: int x, y; public: // 1. é»˜è®¤æ„é€ å‡½æ•° Point() : x(0), y(0) {} // 2. å¸¦å‚æ•°æ„é€ å‡½æ•° Point(int x_val, int y_val) : x(x_val), y(y_val) {} }; // ä½¿ç”¨ Point p1; // è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•° Point p2(3, 4); // è°ƒç”¨å¸¦å‚æ•°æ„é€ å‡½æ•° 2.æ‹·è´æ„é€ å‡½æ•° ç”¨å·²æœ‰å¯¹è±¡åˆå§‹åŒ–æ–°å¯¹è±¡æ—¶è°ƒç”¨çš„ç‰¹æ®Šæ„é€ å‡½æ•°ï¼Œæ³¨æ„ä¸èµ‹å€¼è¿ç®—ç¬¦åŒºåˆ†\nå‚æ•°ä¸ºåŒç±»å¯¹è±¡çš„ const å¼•ç”¨ è‹¥æœªæ˜¾å¼å®šä¹‰ï¼Œç¼–è¯‘å™¨ç”Ÿæˆé»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼ˆæµ…æ‹·è´ï¼‰ æ¶‰åŠåŠ¨æ€å†…å­˜æ—¶å¿…é¡»æ˜¾å¼å®šä¹‰ï¼ˆæ·±æ‹·è´ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 class String { private: char* data; public: // æ™®é€šæ„é€ å‡½æ•° String(const char* str) { data = new char[strlen(str) + 1]; strcpy(data, str); } // æ‹·è´æ„é€ å‡½æ•°ï¼ˆæ·±æ‹·è´ï¼‰ String(const String\u0026amp; other) { //ä¸éœ€è¦æå‰å¤„ç†dataï¼Œè¿™æ˜¯åœ¨æ„é€ æ˜¯è°ƒç”¨çš„ data = new char[strlen(other.data) + 1]; strcpy(data, other.data); } // ç¦ç”¨æ‹·è´æ„é€ å‡½æ•°ï¼ˆC++11ï¼‰ // String(const String\u0026amp;) = delete; ~String() { delete[] data; } }; // ä½¿ç”¨ String s1(\u0026#34;hello\u0026#34;); String s2(s1); // è°ƒç”¨æ‹·è´æ„é€ å‡½æ•° éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸ç”¨å†æ‹·è´æ„é€ å‡½æ•°ä¸­å…ˆåˆ¤æ–­æ˜¯å¦åˆ é™¤dataçš„åŠ¨æ€å†…å­˜ï¼Œå› ä¸ºæ‹·è´æ„é€ å‡½æ•°æœ¬è´¨è¿˜æ˜¯ä¸€ä¸ªæ„é€ å‡½æ•°ï¼Œåˆå§‹åŒ–æ—¶è°ƒç”¨\n3.èµ‹å€¼è¿ç®—ç¬¦ å½“ç±»ä¸­åŒ…å«æŒ‡é’ˆæˆ–éœ€è¦æ·±æ‹·è´çš„æ•°æ®æˆå‘˜æ—¶ï¼Œä½¿ç”¨é»˜è®¤çš„èµ‹å€¼è¿ç®—ç¬¦å¯èƒ½ä¼šå¯¼è‡´é—®é¢˜ï¼Œå¦‚å†…å­˜æ³„æ¼æˆ–é‡å¤é‡Šæ”¾å†…å­˜ã€‚å› æ­¤ï¼Œåœ¨è¿™äº›æƒ…å†µä¸‹ï¼Œéœ€è¦æ˜¾å¼åœ°é‡è½½èµ‹å€¼è¿ç®—ç¬¦ã€‚\næ³¨æ„èµ‹å€¼è¿ç®—ç¬¦åœ¨å†…å­˜ç®¡ç†ä¸Šçš„ç»†èŠ‚\né¿å…è‡ªèµ‹å€¼ èµ‹å€¼å‰å…ˆå›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #includeÂ \u0026lt;iostream\u0026gt; #includeÂ \u0026lt;string.h\u0026gt; using namespaceÂ std; classÂ ClassA { public: ClassA() {} ClassA(const char* pszInputStr) { pszTestStr =Â new char[strlen(pszInputStr) + 1]; strncpy(pszTestStr, pszInputStr, strlen(pszInputStr) + 1); } virtualÂ ~ClassA() { deleteÂ pszTestStr; } // èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•° ClassA\u0026amp;Â operator=(constÂ ClassA\u0026amp; cls) { // é¿å…è‡ªèµ‹å€¼ ifÂ (thisÂ != \u0026amp;cls) { // é¿å…å†…å­˜æ³„éœ² ifÂ (pszTestStr != NULL) { deleteÂ pszTestStr; pszTestStr = NULL; } pszTestStr =Â new char[strlen(cls.pszTestStr) + 1]; strncpy(pszTestStr, cls.pszTestStr, strlen(cls.pszTestStr) + 1); } returnÂ *this; } public: char* pszTestStr; }; intÂ main() { ClassA obj1(\u0026#34;liitdar\u0026#34;); ClassA obj2; obj2 = obj1; cout \u0026lt;\u0026lt;Â \u0026#34;obj2.pszTestStr is: \u0026#34;Â \u0026lt;\u0026lt; obj2.pszTestStr \u0026lt;\u0026lt; endl; returnÂ 0; } æ¨¡æ¿(å‡½æ•°æ¨¡æ¿\u0026amp;ç±»æ¨¡æ¿) å‡½æ•°æ¨¡æ¿ç”Ÿæˆçš„å®ä¾‹åŒ–æˆä¸ºæ¨¡æ¿å‡½æ•°ï¼Œç±»æ¨¡æ¿å’Œæ¨¡æ¿ç±»çš„å®šä¹‰åŒç†\nå‡½æ•°æ¨¡æ¿ å®šä¹‰ï¼šé€šç”¨å‡½æ•°å®šä¹‰ï¼Œæ”¯æŒå¤šç§æ•°æ®ç±»å‹ï¼Œç¼–è¯‘å™¨æ ¹æ®å®é™…ç±»å‹ï¼ˆéšå¼å®ä¾‹åŒ–ï¼‰æˆ–è€…æ˜¾å¼å®ä¾‹åŒ–ç”Ÿæˆå…·ä½“å‡½æ•° ç‰¹ç‚¹ï¼š\nç”¨ template å…³é”®å­—å£°æ˜ å¯æ˜¾å¼æˆ–éšå¼å®ä¾‹åŒ– æ”¯æŒå‡½æ•°é‡è½½å’Œç‰¹åŒ– æ¨¡æ¿çš„å®šä¹‰ï¼ˆå®ç°ï¼‰ï¼Œè¿˜æ˜¯æ¨¡æ¿çš„å…¨ç‰¹åŒ–ï¼Œéƒ½å»ºè®®æ”¾åœ¨å¤´æ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // 1. åŸºæœ¬å‡½æ•°æ¨¡æ¿ template\u0026lt;typename T\u0026gt; T max(T a, T b) { return a \u0026gt; b ? a : b; } // 2. å‡½æ•°æ¨¡æ¿ç‰¹åŒ–ï¼ˆé’ˆå¯¹ç‰¹å®šç±»å‹ï¼‰ template\u0026lt;\u0026gt; const char* max\u0026lt;const char*\u0026gt;(const char* a, const char* b) { return strcmp(a, b) \u0026gt; 0 ? a : b; } // ä½¿ç”¨ int i = max(3, 5); // éšå¼å®ä¾‹åŒ–intç‰ˆæœ¬ const char* s = max(\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;); // è°ƒç”¨ç‰¹åŒ–ç‰ˆæœ¬ ç±»æ¨¡æ¿ å®šä¹‰ï¼šé€šç”¨ç±»å®šä¹‰ï¼Œæˆå‘˜å˜é‡å’Œå‡½æ•°å¯ä½¿ç”¨æ¨¡æ¿å‚æ•°ç±»å‹ã€‚\nç‰¹ç‚¹ï¼š\nç±»å†…æˆå‘˜å‡½æ•°å¯åœ¨ç±»å†…å®šä¹‰ï¼ˆé»˜è®¤å†…è”ï¼‰ æˆ–ç±»å¤–å®šä¹‰ æ”¯æŒå…¨ç‰¹åŒ–å’Œéƒ¨åˆ†ç‰¹åŒ– å®ä¾‹åŒ–æ—¶éœ€æŒ‡å®šå…·ä½“ç±»å‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // 1. åŸºæœ¬ç±»æ¨¡æ¿ template\u0026lt;typename T, int Size\u0026gt; class Array { private: T data[Size]; public: Array() {} T\u0026amp; operator[](int index) { return data[index]; } int getSize() const { return Size; } }; // 2. ç±»æ¨¡æ¿ç‰¹åŒ–ï¼ˆé’ˆå¯¹boolç±»å‹ä¼˜åŒ–ï¼‰ template\u0026lt;int Size\u0026gt; class Array\u0026lt;bool, Size\u0026gt; { private: unsigned char data[(Size + 7) / 8]; // ä½å‹ç¼©å­˜å‚¨ public: bool get(int index) const { return (data[index / 8] \u0026gt;\u0026gt; (index % 8)) \u0026amp; 1; } }; // ä½¿ç”¨ Array\u0026lt;int, 10\u0026gt; intArray; // å®ä¾‹åŒ–intç±»å‹æ•°ç»„ Array\u0026lt;bool, 100\u0026gt; boolArray; // ä½¿ç”¨ç‰¹åŒ–ç‰ˆæœ¬ ç°ä»£C++ç›¸å…³ï¼ˆå¾…è¡¥å……ï¼‰ è‡ªæ¨å¯¼ï¼Œlambdaè¡¨è¾¾å¼ï¼Œæ™ºèƒ½æŒ‡é’ˆï¼ŒRAIIä¸RTTIçš„æ¦‚å¿µ\nè®¾è®¡æ¨¡å¼ To be continued\nStep5 arm-cortex-Må­¦ä¹ \u0026amp;å¯åŠ¨æ–‡ä»¶ä¸é“¾æ¥å™¨è„šæœ¬ åœ¨å¯¹ä¸Šé¢çš„æŠ½è±¡å±‚çº§æœ‰ä¸€å®šäº†è§£åï¼Œè¿˜éœ€è¦å°†ä¸Šè¿°åè½¯ä»¶çš„æŠ½è±¡å±‚ä¸å…·ä½“çš„ç¡¬ä»¶ç›¸è¿æ¥ï¼Œå»ºç«‹è½¯ç¡¬ç»“åˆçš„è®¤çŸ¥éœ€è¦æœ‰ä¸€å®šå¾®æœºåŸç†çš„çŸ¥è¯†\nè‡ªèä¸€ä¸‹ç¬”è€…çš„åšå®¢ ä»CPUæ¶æ„åˆ°æ“ä½œç³»ç»Ÿå®ç°\ncortex-M æ¶æ„ç‰¹æ€§ Cortex-M ç³»åˆ—ä½œä¸ºå¾®æ§åˆ¶å™¨å†…æ ¸ï¼Œé‡‡ç”¨å“ˆä½›æ¶æ„ï¼ˆæŒ‡ä»¤ä¸æ•°æ®ç‹¬ç«‹å­˜å‚¨ä½†å…±äº«å†…å­˜ç©ºé—´ï¼‰ï¼Œå…·å¤‡ä½åŠŸè€—ã€é«˜æ€§èƒ½ã€ä¸­æ–­æ˜“ç”¨æ€§å¼ºã€ä»£ç å¯†åº¦é«˜ç­‰ä¼˜åŠ¿ï¼Œæ”¯æŒåµŒå…¥å¼æ“ä½œç³»ç»Ÿè¿è¡Œã€‚å…¶å†…æ ¸æ¼”å˜åŒ…å« Cortex-M0/M3/M4 ç­‰å¤šä¸ªå‹å·ï¼Œå…¶ä¸­ M3/M4 é›†æˆ 3 çº§æµæ°´çº¿ï¼ˆå–æŒ‡ - è¯‘ç  - æ‰§è¡Œï¼‰ï¼ŒM4F é¢å¤–æ”¯æŒæµ®ç‚¹è¿ç®—å•å…ƒ\næ ¸å¿ƒç»„ä»¶åŒ…æ‹¬ï¼š\nNVICï¼ˆåµŒå¥—å‘é‡ä¸­æ–­æ§åˆ¶å™¨ï¼‰ï¼šç®¡ç†ä¸­æ–­å“åº”ï¼Œæ”¯æŒå¤šçº§ä¸­æ–­ä¼˜å…ˆçº§ã€‚ MPUï¼ˆå†…å­˜ä¿æŠ¤å•å…ƒï¼‰ï¼šå®ç°å†…å­˜è®¿é—®æƒé™æ§åˆ¶ï¼Œä¿éšœç³»ç»Ÿå®‰å…¨ã€‚ è°ƒè¯•æ¥å£ï¼šæ”¯æŒ JTAG æˆ– Serial Wire è°ƒè¯•ï¼Œæ­é…åµŒå…¥å¼è·Ÿè¸ªæ¨¡å—ï¼ˆETMï¼‰å®ç°ä»£ç è·Ÿè¸ªã€‚ æŒ‡ä»¤é›†ï¼šä¸»è¦æ”¯æŒ Thumb/Thumb2 æŒ‡ä»¤é›†ï¼ˆ16 ä½ + 32 ä½æ··åˆï¼‰ï¼Œå…¼é¡¾ä»£ç å¯†åº¦ä¸æ‰§è¡Œæ•ˆç‡ï¼Œå±äº RISC æ¶æ„ï¼ˆç²¾ç®€æŒ‡ä»¤ç³»ç»Ÿï¼‰ï¼Œæ¯æ¡æŒ‡ä»¤ä»…å®Œæˆå•ä¸€æ“ä½œï¼Œç¡¬ä»¶å®ç°ç®€å•é«˜æ•ˆã€‚ å†…å­˜åˆ†å¸ƒè§„åˆ™ é‡ç‚¹çœ‹Flashå’ŒRAMï¼Œä»¥åŠå¯¹åº”çš„æ®µåˆ†é…è§„åˆ™\nCortex-M èŠ¯ç‰‡å†…å­˜åˆ†ä¸º FLASHå’Œ RAMä¸¤å¤§åŒºåŸŸï¼Œå…·ä½“åˆ†å¸ƒç”±ç¡¬ä»¶ç‰¹æ€§å’Œé“¾æ¥è„šæœ¬å…±åŒå®šä¹‰ï¼Œä»¥ STM32F103C8Txï¼ˆ64K FLASHã€20K RAMï¼‰ä¸ºä¾‹ï¼š\nå†…å­˜ç±»å‹ èµ·å§‹åœ°å€ å¤§å° æƒé™ å­˜å‚¨å†…å®¹ FLASH 0x8000000 64K å¯è¯»å¯æ‰§è¡Œ ä¸­æ–­å‘é‡è¡¨ã€.text ä»£ç æ®µã€.rodata åªè¯»å¸¸é‡æ®µ RAM 0x20000000 20K å¯è¯»å¯å†™ .data åˆå§‹åŒ–æ•°æ®æ®µã€.bss æœªåˆå§‹åŒ–æ•°æ®æ®µã€å †ã€æ ˆ å†…å­˜æ®µç‰¹æ€§ï¼š .isr_vectorï¼šä½äº FLASH èµ·å§‹åœ°å€ï¼Œå­˜å‚¨æ ˆé¡¶åœ°å€å’Œä¸­æ–­ / å¼‚å¸¸å¤„ç†å‡½æ•°åœ°å€ï¼Œæ˜¯å¤ä½åå†…æ ¸é¦–ä¸ªè®¿é—®çš„åŒºåŸŸã€‚ .textï¼šå­˜æ”¾å¯æ‰§è¡Œä»£ç ï¼ˆå‡½æ•°å®ç°ï¼‰ï¼ŒåŒ…æ‹¬ç”¨æˆ·ä»£ç å’Œå¯åŠ¨æ–‡ä»¶é€»è¾‘ã€‚ .rodataï¼šå­˜å‚¨åªè¯»å¸¸é‡ï¼ˆå¦‚ const å˜é‡ã€å­—ç¬¦ä¸²å­—é¢é‡ï¼‰ï¼ŒèŠ‚çœ RAM ç©ºé—´ã€‚ .dataï¼šå­˜æ”¾å·²åˆå§‹åŒ–çš„å…¨å±€ / é™æ€å˜é‡ï¼Œç¼–è¯‘æ—¶åˆå§‹å€¼å­˜äº FLASHï¼Œè¿è¡Œæ—¶å¤åˆ¶åˆ° RAMã€‚ .bssï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€ / é™æ€å˜é‡ï¼Œè¿è¡Œæ—¶ç”±å¯åŠ¨æ–‡ä»¶æ¸…é›¶ï¼Œæ— éœ€å ç”¨ FLASH ç©ºé—´ã€‚ å † / æ ˆï¼šå †ä»ä½åœ°å€å‘ä¸Šç”Ÿé•¿ï¼ˆä¾› malloc ä½¿ç”¨ï¼‰ï¼Œæ ˆä»é«˜åœ°å€å‘ä¸‹ç”Ÿé•¿ï¼ˆä¾›å‡½æ•°è°ƒç”¨ã€å±€éƒ¨å˜é‡ä½¿ç”¨ï¼‰ï¼Œç”±é“¾æ¥è„šæœ¬é¢„ç•™ç©ºé—´ã€‚ FlashåŒºï¼Œèµ·å§‹ä½ç½®0x8000000\næ®µåç§° èµ·å§‹åœ°å€ ç»“æŸåœ°å€ å†…å®¹ .isr_vector 0x8000 0000 æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ ä¸­æ–­å‘é‡è¡¨ .text ç´§é‚».isr_vectoræœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ ç¨‹åº .rodata ç´§é‚».textæœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ å¸¸é‡ .ARM.extab ç´§é‚».rodataæœ«å°¾ æŒ‰éœ€è®¡ç®— ARMå¼‚å¸¸å¤„ç†ä¿¡æ¯ .ARM.exidx* ç´§é‚».ARM.extabæœ«å°¾ æŒ‰éœ€è®¡ç®— ARMå¼‚å¸¸ç´¢å¼•è¡¨ .preinit_array ç´§é‚».ARM.exidx* æœ«å°¾ æŒ‰éœ€è®¡ç®— C++é¢„åˆå§‹åŒ–æ•°ç»„ .init_array ç´§é‚».preinit_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®— C++æ„é€ å‡½æ•°æ•°ç»„ .fini_array ç´§é‚».init_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®— C++ææ„å‡½æ•°æ•°ç»„ .data ç´§é‚».fini_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ åˆå§‹åŒ–å˜é‡çš„åˆå§‹å€¼ RAMåŒºï¼Œèµ·å§‹ä½ç½®0x20000000\næ®µåç§° èµ·å§‹åœ°å€ ç»“æŸåœ°å€ å†…å®¹ .data 0x2000 0000 _edataï¼Œæ‹·è´è‡ªFlashåŒº å·²åˆå§‹åŒ–å…¨å±€/é™æ€å˜é‡ .bss _edata _end æœªåˆå§‹åŒ–å…¨å±€/é™æ€å˜é‡ ç³»ç»Ÿå †åº• _end _end å †åº• ç³»ç»Ÿå †æ ˆæœ€å°é¢„ç•™ç©ºé—´ _end _end+é¢„ç•™ç©ºé—´ å †æ ˆé¢„ç•™ç©ºé—´ ç©ºé—²RAM _end+é¢„ç•™ç©ºé—´ _estack ç©ºé—²ç©ºé—´ ç³»ç»Ÿæ ˆåº• _estackï¼ˆRAMæœ«å°¾ï¼‰ _estackï¼ˆRAMæœ«å°¾ï¼‰ æ ˆåº• å¯åŠ¨æ–‡ä»¶ä¸å¯åŠ¨åŸç† å¯åŠ¨åŸç† ç¡¬ä»¶å¤ä½ï¼šå†…æ ¸è¯»å– FLASH èµ·å§‹åœ°å€çš„ä¸­æ–­å‘é‡è¡¨ï¼Œåˆå§‹åŒ– MSPï¼ˆæ ˆé¡¶åœ°å€ï¼‰ï¼Œå°† PC æŒ‡å‘Reset_Handlerã€‚ æ‰§è¡Œ Reset_Handlerï¼šå®Œæˆæ—¶é’Ÿé…ç½®ã€å†…å­˜æ®µåˆå§‹åŒ–ï¼ˆ.data å¤åˆ¶ã€.bss æ¸…é›¶ï¼‰ã€‚ è¿›å…¥ç”¨æˆ·ä»£ç ï¼šè·³è½¬è‡³mainå‡½æ•°ï¼Œå¯åŠ¨æµç¨‹ç»“æŸï¼Œæ­£å¼è¿è¡Œåº”ç”¨é€»è¾‘ã€‚ ä¸­æ–­å“åº”ï¼šè¿è¡Œä¸­è§¦å‘ä¸­æ–­æ—¶ï¼Œå†…æ ¸ä»å‘é‡è¡¨æŸ¥æ‰¾å¯¹åº”å¤„ç†å‡½æ•°åœ°å€ï¼Œæ‰§è¡Œåè¿”å›æ–­ç‚¹ã€‚ å¯åŠ¨æ¨¡å¼ STM32F103 æ”¯æŒ 3 ç§å¯åŠ¨æ¨¡å¼ï¼Œç”± BOOT0 å’Œ BOOT1 å¼•è„šç”µå¹³å†³å®šï¼š\nBOOT0=0ï¼šä¸» FLASH å¯åŠ¨ï¼ˆé»˜è®¤æ¨¡å¼ï¼‰ï¼Œä»ç”¨æˆ·ä»£ç åŒºå¯åŠ¨ã€‚ BOOT0=1ã€BOOT1=0ï¼šç³»ç»Ÿå†…å­˜å¯åŠ¨ï¼Œä»èŠ¯ç‰‡å‡ºå‚å›ºåŒ–çš„ Bootloader å¯åŠ¨ã€‚ BOOT0=1ã€BOOT1=1ï¼šåµŒå…¥å¼ SRAM å¯åŠ¨ï¼Œä» RAM åŠ è½½ä»£ç ï¼ˆç”¨äºè°ƒè¯•ï¼‰ã€‚ å¯åŠ¨æ–‡ä»¶ å¯åŠ¨æ–‡ä»¶ï¼ˆå¦‚startup_stm32f103xb.sï¼‰æ˜¯æ±‡ç¼–è¯­è¨€ç¼–å†™çš„åº•å±‚ç¨‹åºï¼Œä½œä¸º \u0026ldquo;ç¡¬ä»¶åˆ°è½¯ä»¶çš„æ¡¥æ¢\u0026rdquo;ï¼Œè´Ÿè´£è¡”æ¥ç¡¬ä»¶å¤ä½ä¸ç”¨æˆ·mainå‡½æ•°ï¼Œæ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ç¡¬ä»¶åˆå§‹åŒ–ã€å†…å­˜åˆå§‹åŒ–ã€ä¸­æ–­ç³»ç»Ÿå‡†å¤‡å’Œå¼•å¯¼ç”¨æˆ·ä»£ç \nå¯åŠ¨æ–‡ä»¶ç»“æ„æ‹†è§£ ï¼ˆ1ï¼‰æ±‡ç¼–ç¯å¢ƒé…ç½® æŒ‡å®šå¤„ç†å™¨æ¶æ„ã€æŒ‡ä»¤é›†å’Œæµ®ç‚¹æ¨¡å¼ï¼Œç¡®ä¿æ±‡ç¼–ä»£ç ä¸ç¡¬ä»¶å…¼å®¹ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 .syntax unified ; å…¼å®¹ARMä¸ThumbæŒ‡ä»¤é›† .cpu cortex-m3 ; ç›®æ ‡å†…æ ¸ä¸ºCortex-M3 .fpu softvfp ; è½¯ä»¶æ¨¡æ‹Ÿæµ®ç‚¹è¿ç®—ï¼ˆæ— ç¡¬ä»¶FPUï¼‰ .thumb ; å¯ç”¨ThumbæŒ‡ä»¤é›† ï¼ˆ2ï¼‰å…³é”®ç¬¦å·å£°æ˜ å¼•ç”¨é“¾æ¥å™¨è„šæœ¬å®šä¹‰çš„å†…å­˜åœ°å€ç¬¦å·ï¼Œå»ºç«‹å¯åŠ¨æ–‡ä»¶ä¸å†…å­˜å¸ƒå±€çš„å…³è”ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 .word _sidata ; .dataæ®µåœ¨FLASHçš„åŠ è½½åœ°å€ .word _sdata ; .dataæ®µåœ¨RAMçš„è¿è¡Œèµ·å§‹åœ°å€ .word _edata ; .dataæ®µåœ¨RAMçš„è¿è¡Œç»“æŸåœ°å€ .word _sbss ; .bssæ®µåœ¨RAMçš„èµ·å§‹åœ°å€ .word _ebss ; .bssæ®µåœ¨RAMçš„ç»“æŸåœ°å€ ï¼ˆ3ï¼‰å¤ä½å¤„ç†å‡½æ•°ï¼ˆReset_Handlerï¼‰ å¤ä½åæ‰§è¡Œçš„æ ¸å¿ƒé€»è¾‘ï¼Œæ˜¯å¯åŠ¨æµç¨‹çš„å…¥å£ï¼Œåˆ†ä¸º 5 ä¸ªå…³é”®æ­¥éª¤ï¼š\nç³»ç»Ÿæ—¶é’Ÿåˆå§‹åŒ–ï¼šè°ƒç”¨SystemInitå‡½æ•°é…ç½® HSE/PLLï¼Œå°†æ—¶é’Ÿä» 8MHz HSI æå‡è‡³ 72MHz .data æ®µå¤åˆ¶ï¼šä» FLASH çš„_sidataåœ°å€å¤åˆ¶åˆå§‹å€¼åˆ° RAM çš„_sdataè‡³_edataåŒºåŸŸ .bss æ®µæ¸…é›¶ï¼šå°† RAM ä¸­_sbssè‡³_ebssåŒºåŸŸå…¨éƒ¨ç½® 0ï¼Œç¬¦åˆ C è¯­è¨€æ ‡å‡† C++ é™æ€æ„é€ å‡½æ•°åˆå§‹åŒ–ï¼šè°ƒç”¨__libc_init_arrayï¼Œæ‰§è¡Œå…¨å±€å¯¹è±¡æ„é€ ï¼ˆå…¼å®¹ C++ é¡¹ç›®ï¼‰ è·³è½¬è‡³ main å‡½æ•°ï¼šå®Œæˆåº•å±‚åˆå§‹åŒ–åï¼Œå°†ç¨‹åºæ§åˆ¶æƒäº¤ç»™ç”¨æˆ·ä»£ç  ï¼ˆ4ï¼‰ä¸­æ–­å‘é‡è¡¨ï¼ˆg_pfnVectorsï¼‰ å­˜å‚¨æ‰€æœ‰å¼‚å¸¸ / ä¸­æ–­çš„å¤„ç†å‡½æ•°åœ°å€ï¼Œä½äº FLASH èµ·å§‹åœ°å€ï¼Œæ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š\nç¬¬ 0 ä¸ªå…ƒç´ ä¸ºæ ˆé¡¶åœ°å€ï¼ˆ_estackï¼‰ï¼Œç”¨äºåˆå§‹åŒ–ä¸»æ ˆæŒ‡é’ˆï¼ˆMSPï¼‰ ç¬¬ 1 ä¸ªå…ƒç´ ä¸ºReset_Handleråœ°å€ï¼Œæ˜¯å¤ä½åç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰çš„åˆå§‹æŒ‡å‘ å‘é‡è¡¨é¡ºåºéšå«ä¸­æ–­ä¼˜å…ˆçº§ï¼Œé å‰å…ƒç´ å¯¹åº”ä¼˜å…ˆçº§æ›´é«˜ï¼ˆå¦‚ç¡¬ fault ä¼˜å…ˆçº§é«˜äº SysTickï¼‰ ï¼ˆ5ï¼‰é»˜è®¤ä¸­æ–­å¤„ç†å‡½æ•°ï¼ˆDefault_Handlerï¼‰ ä¸ºæœªè‡ªå®šä¹‰çš„ä¸­æ–­æä¾› \u0026ldquo;å…œåº•\u0026rdquo; é€»è¾‘ï¼Œé€šè¿‡æ— é™å¾ªç¯é˜²æ­¢ç¨‹åºè·‘é£ï¼ŒåŒæ—¶æ”¯æŒå¼±åˆ«åæœºåˆ¶ï¼ˆ.weakï¼‰ï¼Œå…è®¸ç”¨æˆ·åœ¨ C ä»£ç ä¸­é‡å®šä¹‰ä¸­æ–­å‡½æ•°è¦†ç›–é»˜è®¤é€»è¾‘\né“¾æ¥å™¨è„šæœ¬ é“¾æ¥è„šæœ¬ï¼ˆ.ldï¼‰æ˜¯é“¾æ¥å™¨çš„é…ç½®æ–‡ä»¶ï¼Œæœ¬è´¨æ˜¯å‘ŠçŸ¥é“¾æ¥å™¨èŠ¯ç‰‡å†…å­˜å¸ƒå±€ã€ä»£ç  / æ•°æ®çš„æ®µåˆ†é…è§„åˆ™ã€å…¨å±€ç¬¦å·å®šä¹‰å’Œå†…å­˜åˆæ³•æ€§æ£€æŸ¥ï¼Œæ˜¯ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ.elf/.hexï¼‰çš„å…³é”®ï¼Œæ²¡æœ‰å®ƒé“¾æ¥å™¨æ— æ³•ç¡®å®š \u0026ldquo;ä»£ç æ”¾å“ªé‡Œã€å˜é‡æ”¾å“ªé‡Œ\u0026rdquo;\nï¼ˆ1ï¼‰å…¥å£ç‚¹ä¸æ ˆé¡¶å®šä¹‰ æŒ‡å®šç¨‹åºå…¥å£å’Œæ ˆå †å¤§å°ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 ENTRY(Reset_Handler) ; ç¨‹åºå…¥å£ä¸ºReset_Handler _estack = ORIGIN(RAM) + LENGTH(RAM); æ ˆé¡¶åœ°å€=RAMèµ·å§‹+RAMå¤§å° _Min_Heap_Size = 0x200; æœ€å°å †å¤§å°ï¼ˆ512å­—èŠ‚ï¼‰ _Min_Stack_Size = 0xF00; æœ€å°æ ˆå¤§å°ï¼ˆ3840å­—èŠ‚ï¼‰ ï¼ˆ2ï¼‰å†…å­˜åŒºåŸŸå®šä¹‰ï¼ˆMEMORY å—ï¼‰ æè¿° FLASH å’Œ RAM çš„ç‰©ç†å±æ€§ï¼Œä¾‹å¦‚ï¼š\n1 2 3 4 5 MEMORY { RAM (xrw) : ORIGIN = 0x20000000, LENGTH = 20K ; RAMï¼šå¯è¯»å¯å†™å¯æ‰§è¡Œ FLASH (rx) : ORIGIN = 0x8000000, LENGTH = 64K ; FLASHï¼šå¯è¯»å¯æ‰§è¡Œ } ï¼ˆ3ï¼‰æ®µåˆ†é…è§„åˆ™ï¼ˆSECTIONS å—ï¼‰ å®šä¹‰ç¼–è¯‘ç”Ÿæˆçš„æ®µä¸ç‰©ç†å†…å­˜çš„æ˜ å°„å…³ç³»ï¼Œæ ¸å¿ƒæ®µåŒ…æ‹¬ï¼š\n.isr_vectorï¼šåˆ†é…åˆ° FLASH èµ·å§‹åœ°å€ï¼Œç”¨KEEPå…³é”®å­—é˜²æ­¢è¢«ä¼˜åŒ–åˆ é™¤ã€‚ .textï¼šå­˜æ”¾ä»£ç æ®µï¼Œå®šä¹‰_etextæ ‡è®°ç»“æŸåœ°å€ã€‚ .rodataï¼šå­˜æ”¾åªè¯»å¸¸é‡ï¼Œåˆ†é…åˆ° FLASHã€‚ .dataï¼šè¿è¡Œåœ°å€åœ¨ RAMï¼ŒåŠ è½½åœ°å€åœ¨ FLASHï¼Œå®šä¹‰_sidataï¼ˆåŠ è½½åœ°å€ï¼‰ã€_sdataï¼ˆè¿è¡Œèµ·å§‹ï¼‰ã€_edataï¼ˆè¿è¡Œç»“æŸï¼‰ã€‚ .bssï¼šåˆ†é…åˆ° RAMï¼Œå®šä¹‰_sbssï¼ˆèµ·å§‹ï¼‰ã€_ebssï¼ˆç»“æŸï¼‰ã€‚ ._user_heap_stackï¼šé¢„ç•™å †å’Œæ ˆç©ºé—´ï¼Œæ£€æŸ¥ RAM å®¹é‡æ˜¯å¦å……è¶³ã€‚ /DISCARD/ï¼šä¸¢å¼ƒæ— ç”¨æ®µï¼ˆå¦‚æ ‡å‡†åº“å†—ä½™ä»£ç ï¼‰ï¼Œå‡å°æ–‡ä»¶å¤§å°ã€‚ é“¾æ¥è„šæœ¬ä¸å¯åŠ¨æ–‡ä»¶çš„ååŒå…³ç³» å¯åŠ¨æ–‡ä»¶ä¸é“¾æ¥è„šæœ¬é€šè¿‡å…¨å±€ç¬¦å·å’Œæ®µåˆ†é…ç´§å¯†è€¦åˆï¼ŒäºŒè€…åä½œå…³ç³»å¦‚ä¸‹ï¼š\nåä½œç»´åº¦ å¯åŠ¨æ–‡ä»¶è§’è‰² é“¾æ¥è„šæœ¬è§’è‰² å†…å­˜åœ°å€æä¾› å¼•ç”¨_sdataã€_ebssç­‰ç¬¦å· è®¡ç®—å¹¶å®šä¹‰å†…å­˜åœ°å€ç¬¦å· æ®µåˆ†é…ä¾æ® å°†ä»£ç  / æ•°æ®æ”¾å…¥æŒ‡å®šæ®µï¼ˆå¦‚.textï¼‰ è§„å®šæ®µçš„å­˜å‚¨ä½ç½®ï¼ˆå¦‚ FLASH/RAMï¼‰ ç¨‹åºå…¥å£æŒ‡å®š å®ç°Reset_Handlerå‡½æ•° é€šè¿‡ENTRYæŒ‡å®šå…¥å£ä¸ºReset_Handler å†…å­˜åˆæ³•æ€§æ£€æŸ¥ ä¾èµ–ç¬¦å·ç¡®ä¿å†…å­˜è®¿é—®ä¸è¶Šç•Œ æ£€æŸ¥å † / æ ˆ / æ•°æ®æ®µæ€»å¤§å°æ˜¯å¦è¶…è¿‡ RAM å®¹é‡ æ¶æ„â†’å†…å­˜â†’é“¾æ¥è„šæœ¬ï¼šCortex-M çš„å“ˆä½›æ¶æ„å†³å®šå†…å­˜åˆ†ä¸º FLASH å’Œ RAMï¼Œé“¾æ¥è„šæœ¬æ ¹æ®ç¡¬ä»¶å†…å­˜å‚æ•°ï¼ˆèµ·å§‹åœ°å€ã€å¤§å°ï¼‰å®šä¹‰å­˜å‚¨è§„åˆ™ã€‚ é“¾æ¥è„šæœ¬â†’å¯åŠ¨æ–‡ä»¶ï¼šé“¾æ¥è„šæœ¬æä¾›å†…å­˜åœ°å€ç¬¦å·ï¼ˆå¦‚_sdataï¼‰ï¼Œå¯åŠ¨æ–‡ä»¶ä¾èµ–è¿™äº›ç¬¦å·å®Œæˆ.data å¤åˆ¶ã€.bss æ¸…é›¶ç­‰åˆå§‹åŒ–æ“ä½œã€‚ å¯åŠ¨æ–‡ä»¶â†’æ¶æ„ï¼šå¯åŠ¨æ–‡ä»¶æ ¹æ® Cortex-M å†…æ ¸ç‰¹æ€§ï¼ˆå¦‚å‘é‡è¡¨ä½ç½®ã€æ ˆåˆå§‹åŒ–è¦æ±‚ï¼‰å®ç°åº•å±‚é€»è¾‘ï¼Œæœ€ç»ˆå¼•å¯¼ç¨‹åºè¿›å…¥ç”¨æˆ·ä»£ç ã€‚ å¾…ç»­ ","date":"2025-09-17T23:37:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/%E7%94%B5%E6%8E%A7%E6%88%90%E9%95%BF%E6%8C%87%E5%8D%97/","title":"ç”µæ§æˆé•¿æŒ‡å—"},{"content":"åŸºäº å—ç§‘å¤§ äºä»•çªè€å¸ˆçš„è¯¾ç¨‹å­¦ä¹ ç¬”è®° ã€å¿«é€Ÿå­¦ä¹ Cå’ŒC++ï¼ŒåŸºç¡€è¯­æ³•å’Œä¼˜åŒ–ç­–ç•¥ï¼Œå­¦äº†ä¸å†æ€•æŒ‡é’ˆ(å—ç§‘å¤§è®¡ç®—æœºç³»åŸç‰ˆ)ã€‘https://www.bilibili.com/video/BV1Vf4y1P7pq?vd_source=5a0790755035f26a67935abfbfcdfd5b\næ¨èæ–‡ç«  C++ å¦‚ä½•è¿›é˜¶ï¼Ÿå¦‚ä½•å‡†å¤‡ C++ é¢è¯•ï¼Ÿ - çŸ¥ä¹\nç¨‹åºåŸºæœ¬å¸¸è¯† ç¼–è¯‘ä¸é“¾æ¥ Cè¯­è¨€ç¼–è¯‘åŸç†æ¶‰åŠå°†Cè¯­è¨€ä»£ç è½¬æ¢ä¸ºæœºå™¨è¯­è¨€çš„è¿‡ç¨‹ã€‚è¿™ä¸ªè¿‡ç¨‹åŒ…æ‹¬é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–å’Œé“¾æ¥ã€‚ç¼–è¯‘å™¨åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­å¯¹æºä»£ç è¿›è¡Œä¼˜åŒ–å’Œè½¬æ¢ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š\n1.Â é¢„å¤„ç†ï¼ˆPreprocessingï¼‰ ä½œç”¨ï¼šå¤„ç†æºä»£ç æ–‡ä»¶ä¸­çš„é¢„å¤„ç†æŒ‡ä»¤ï¼Œå¦‚#includeå’Œ#define\nè¿‡ç¨‹ï¼šæ›¿æ¢å®å®šä¹‰ï¼Œå¤„ç†æ¡ä»¶ç¼–è¯‘æŒ‡ä»¤ï¼ŒåŒ…å«å¤´æ–‡ä»¶å†…å®¹\nå·¥å…·ï¼šé¢„å¤„ç†å™¨ï¼Œå¦‚cppã€armclang\n2.ç¼–è¯‘ï¼ˆCompilationï¼‰ ä½œç”¨ï¼šå°†é¢„å¤„ç†åçš„æºä»£ç è½¬æ¢æˆæ±‡ç¼–è¯­è¨€\nè¿‡ç¨‹ï¼šè¿›è¡Œè¯­æ³•åˆ†æå’Œè¯­ä¹‰åˆ†æï¼Œç”Ÿæˆæ±‡ç¼–ä»£ç \nå·¥å…·ï¼šç¼–è¯‘å™¨ï¼Œå¦‚GCCã€armclang\n3.æ±‡ç¼–ï¼ˆAssemblyï¼‰ ä½œç”¨ï¼šå°†æ±‡ç¼–è¯­è¨€è½¬æ¢æˆæœºå™¨è¯­è¨€ï¼Œå³ç›®æ ‡ä»£ç ï¼ˆObject Codeï¼‰\nè¿‡ç¨‹ï¼šæ±‡ç¼–å™¨å°†æ±‡ç¼–æŒ‡ä»¤è½¬æ¢ä¸ºæœºå™¨ç \nå·¥å…·ï¼šæ±‡ç¼–å™¨ï¼Œå¦‚asã€armasm\n4.é“¾æ¥ï¼ˆLinkingï¼‰ ä½œç”¨ï¼šå°†å¤šä¸ªç›®æ ‡ä»£ç æ–‡ä»¶å’Œåº“æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå•ç‹¬çš„å¯æ‰§è¡Œæ–‡ä»¶\nè¿‡ç¨‹ï¼š\nè§£å†³å¤–éƒ¨ç¬¦å·å¼•ç”¨ï¼Œå¦‚å‡½æ•°å’Œå…¨å±€å˜é‡\nåˆå¹¶ä¸åŒæ¨¡å—ä¸­çš„ç›¸åŒæ®µï¼ˆå¦‚.textï¼Œ.dataï¼‰\nç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶æˆ–åº“æ–‡ä»¶\nå·¥å…·ï¼šé“¾æ¥å™¨ï¼Œå¦‚ldã€armlink\nç¼–è¯‘å™¨ä¸é“¾æ¥å™¨ åœ¨æ•´ä¸ªç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘å™¨å’Œé“¾æ¥å™¨æ˜¯æ ¸å¿ƒç»„ä»¶ï¼Œä¸€èˆ¬çš„ç¯å¢ƒé…ç½®ä¹Ÿä¸»è¦é’ˆå¯¹è¿™äºŒè€…å±•å¼€ï¼š\nç¼–è¯‘å™¨ï¼ˆCompilerï¼‰ï¼šè´Ÿè´£å°†æºä»£ç è½¬æ¢æˆæ±‡ç¼–ä»£ç æˆ–ç›´æ¥ç”Ÿæˆç›®æ ‡ä»£ç ã€‚ç¼–è¯‘å™¨çš„é«˜çº§ä¼˜åŒ–åŒ…æ‹¬å¾ªç¯ä¼˜åŒ–ã€å¸¸æ•°ä¼ æ’­ã€æ­»ç åˆ é™¤ç­‰\né“¾æ¥å™¨ï¼ˆLinkerï¼‰ï¼šè´Ÿè´£å°†å¤šä¸ªç›®æ ‡ä»£ç æ–‡ä»¶æ•´åˆä¸ºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚é“¾æ¥å™¨å¤„ç†ç¬¦å·è§£æã€é‡å®šä½ç­‰ä»»åŠ¡\né”™è¯¯ ç¼–è¯‘é”™è¯¯ï¼Œé“¾æ¥é”™è¯¯ï¼Œè¿è¡Œé”™è¯¯\né¢„å¤„ç†ä¸å® é¢„å¤„ç†ï¼Œå¯¹å®å®šä¹‰è¿›è¡Œæ›¿æ¢ å®å°±æ˜¯å­—ç¬¦æ›¿æ¢\n1 #define PI 3.1415926 åˆå§‹åŒ– c++11å¼€å§‹æ”¯æŒçš„åˆå§‹åŒ–{}å’Œ()\n1 2 3 4 int test{};//åˆå§‹åŒ–ä¸º0ï¼Œc++11æ”¯æŒï¼Œc++98ä¸æ”¯æŒ int man();//åˆå§‹åŒ–ä¸º0ï¼Œc++11æ”¯æŒï¼Œc++98ä¸æ”¯æŒ int wow[]{1,2,3};//åˆå§‹åŒ–ï¼Œc++11æ”¯æŒï¼Œc++98ä¸æ”¯æŒ int test_man[] = {0,1,2};//åˆå§‹åŒ–ï¼Œc++11æ”¯æŒï¼Œc++98æ”¯æŒ Data-Types-and-Arithmetic-Operators integer-numbers int æ³¨æ„åœ¨ä¸åŒå¹³å°ä¸Šï¼Œintï¼Œshort intï¼Œlong intï¼Œlong longçš„å®šä¹‰æ˜¯ä¸åŒçš„\nsizeof() sizeofæ˜¯ä¸€ä¸ªæ“ä½œç¬¦ï¼Œä¸æ˜¯å‡½æ•°\n1 2 3 int i ; cout \u0026lt;\u0026lt; sizeof(int) \u0026lt;\u0026lt; endl ; cout \u0026lt;\u0026lt; sizeof(i) \u0026lt;\u0026lt; endl ; char charæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª8ä½çš„æ•´æ•°ï¼Œå¯ä»¥ç”¨æœ‰ç¬¦åˆå’Œæ— ç¬¦å·ä¿®é¥°ç¬¦ä¿®é¥°\n1 2 3 char CH ; unsigned char UCH ; signed SCH ; æ³¨æ„charåœ¨ä¸åŒå¹³å°ä¸Šä¸ä¸€å®šæ˜¯signed charï¼Œæœ‰å¯èƒ½æ˜¯unsigned char ä¸€èˆ¬charæ˜¯int8_t\nbool boolæ•°æ®ç±»å‹ï¼Œ1byteè€Œä¸æ˜¯1bitï¼ŒåŒæ—¶è¿™æ˜¯c++é‡Œçš„æ•°æ®ç±»å‹\ncè¯­è¨€ä¸­éœ€è¦#include \u0026lt;stdbool.h\u0026gt;æ¥å¼•å…¥boolæ•°æ®ç±»å‹ï¼Œæˆ–è€…æœ‰ä»¥ä¸‹ä»£ç æ¥ä½¿ç”¨bool\n1 2 3 typedef char bool; #define true 1 #define false 0 æ³¨æ„ç»™boolç±»å‹æ•°æ®èµ‹å€¼ï¼Œåªè¦ä¸æ˜¯0ï¼Œå°±éƒ½æ˜¯1\n1 2 bool test = -256 ; cout \u0026lt;\u0026lt; test ; è¾“å‡ºtestï¼Œä¼šå‘ç°testæ˜¯1\ncstdint c++11ä¹‹åå¼•å…¥\u0026lt;ctsdint\u0026gt;\n1 2 3 4 5 6 7 8 int8_t int16_t int32_t int64_t uint8_t uint16_t uint32_t uint64_t ä»¥åŠä¸€äº›å®\n1 2 3 4 5 6 7 8 INT8_MIN INT16_MIN INT32_MIN INT64_MIN INT8_MAX INT16_MAX INT32_MAX INT64_MAX floating-point-numbers float å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œfloatç±»å‹çš„æ•°æ®ä¸€å®šä¼šå¸¦æœ‰è¯¯å·® 32bits\n1 2 3 4 5 6 7 int main() { float f1 = 1.2f ; float f2 = f1*1000000000000000 ;//1e15 cout \u0026lt;\u0026lt; std::fixed\u0026lt;\u0026lt;std::steprecision(15)\u0026lt;\u0026lt; f1 \u0026lt;\u0026lt; endl ; cout \u0026lt;\u0026lt; std::fixed\u0026lt;\u0026lt;std::steprecision(15)\u0026lt;\u0026lt; f2 \u0026lt;\u0026lt; endl ; return 0 ; } è¾“å‡ºç»“æœ\n1 2 1.200000047683716 1200000038076416.000000000000000 floatç±»å‹æ•°çš„è§„æ ¼ï¼Œè¯¦è§IEEEè§„å®š 1 2 3 4 5 6 7 8 9 10 int main() { float f1 = 2.34E+10f; float f2 = f1+10;//but f2=f1 cout.setf(ios_base::fixed,ios_base::floatfield);//fixed-point cout \u0026lt;\u0026lt; \u0026#34;f1=\u0026#34; \u0026lt;\u0026lt; f1 \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;f2=\u0026#34; \u0026lt;\u0026lt; f2 \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;f1-f2\u0026#34; \u0026lt;\u0026lt; f1-f2 \u0026lt;\u0026lt;endl; cout \u0026lt;\u0026lt; \u0026#34;(f1-f2==0)=\u0026#34;\u0026lt;\u0026lt;(f1-f2==0) \u0026lt;\u0026lt; endl; return 0; } è¾“å‡ºç»“æœ\n1 2 3 4 f1=23399999488.000000 f2=23399999488.000000 f1-f2=0.000000 (f1-f2==0)=1 åŸå› æ˜¯floatç±»å‹æœ¬è´¨æ˜¯åœ¨é‡‡æ ·ç‚¹ï¼Œè¯¥ä¾‹å­ä¸­ä¸­+10çš„é‡‡æ ·ç‚¹é—´éš”ä¸å¤Ÿï¼Œæ•°å€¼ä¸å‘ç”Ÿå˜åŒ– æµ®ç‚¹æ•°æ˜¯å–ä¸€äº›é—´éš”å€¼\nå…³äº.f/.F åœ¨ C++ ä¸­ï¼Œ1.0f å’Œ 1.0F éƒ½è¡¨ç¤ºå•ç²¾åº¦æµ®ç‚¹æ•°ï¼ˆfloat ç±»å‹ï¼‰ï¼Œä¸¤è€…åœ¨åŠŸèƒ½ä¸Šæ˜¯å®Œå…¨ç­‰ä»·çš„ï¼Œå”¯ä¸€çš„åŒºåˆ«æ˜¯å­—æ¯ f çš„å¤§å°å†™ä¸åŒã€‚\nè¯´æ˜ï¼š 1.0f å’Œ 1.0F éƒ½è¡¨ç¤º float ç±»å‹çš„å­—é¢é‡ï¼Œå€¼ä¸º 1.0ã€‚ å¦‚æœä¸åŠ åç¼€ f æˆ– Fï¼Œä¾‹å¦‚ 1.0ï¼Œåˆ™é»˜è®¤æ˜¯ double ç±»å‹ï¼ˆåŒç²¾åº¦æµ®ç‚¹æ•°ï¼‰ã€‚ ç±»ä¼¼åœ°ï¼Œ1.0L æˆ– 1.0l è¡¨ç¤º long double ç±»å‹ï¼ˆæ‰©å±•ç²¾åº¦æµ®ç‚¹æ•°ï¼‰ã€‚ ç¤ºä¾‹ï¼š 1 2 3 4 float a = 1.0f; // float ç±»å‹ float b = 1.0F; // åŒä¸Šï¼Œfloat ç±»å‹ double c = 1.0; // double ç±»å‹ long double d = 1.0L; // long double ç±»å‹ ä¸ºä»€ä¹ˆæœ‰ä¸¤ç§å†™æ³•ï¼Ÿ C++ å…è®¸ f å’Œ F ä¸¤ç§å†™æ³•ï¼Œä¸»è¦æ˜¯ä¸ºäº†ä»£ç é£æ ¼çš„ä¸€è‡´æ€§ã€‚ä¾‹å¦‚ï¼š\næŸäº›ç¼–ç è§„èŒƒå¯èƒ½æ¨èä½¿ç”¨å¤§å†™ F ä»¥å¢å¼ºå¯è¯»æ€§ï¼ˆé¿å…ä¸æ•°å­— 1 æ··æ·†ï¼‰ã€‚ è€Œå°å†™ f æ›´å¸¸è§ï¼Œå› ä¸ºæ›´ç®€æ´ã€‚ æ€»ç»“ï¼š 1.0f å’Œ 1.0F åœ¨ C++ ä¸­å®Œå…¨ç­‰ä»·ï¼Œé€‰æ‹©å“ªä¸€ç§å–å†³äºä¸ªäººæˆ–å›¢é˜Ÿçš„ä»£ç é£æ ¼åå¥½ã€‚\næµ®ç‚¹æ•°ä¸è¦ç›´æ¥ç›¸ç­‰ æµ®ç‚¹æ•°éƒ½æ˜¯è¿‘ä¼¼ï¼Œä¸æ˜¯ç²¾ç¡®çš„æ•°å€¼ï¼Œæ‰€ä»¥ä¸é€‚åˆç”¨==åˆ¤æ–­ç›¸ç­‰\n1 2 if(f1==f2)//bad if(fabs(f1-f2)\u0026lt;FLT_EPSILON)//good inf and nan 1 2 float f1 = 2.0f / 0.0f ; float f2 = 0.0f / 0.0f ; +/- infï¼šinfinity ( Exponent=11111111 , fraction=0 ) nanï¼šnot a number ( Exponent=11111111 , fraction!=0 ) å¦‚æœè®¡ç®—è¿‡ç¨‹ä¸­å‡ºç°äº†infæˆ–è€…nan,åç»­çš„è®¡ç®—ä¼šäº§ç”Ÿé—®é¢˜\ndouble åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œ64bits\nlong double å¦‚æœç³»ç»Ÿæ”¯æŒï¼Œ128bits å¦åˆ™ï¼Œ64bits\nArithmetic Operators ç®—æ•°è¿ç®—ï¼Œå¯¹è®¡ç®—çš„å®ç°è¦æœ‰æ‰€ç†è§£ï¼Œæ‰èƒ½é¿å…å‡ºç°ä¸€äº›é”™è¯¯\nConstant-numbers 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 95//åè¿›åˆ¶ 0137//å…«è¿›åˆ¶ 0x5F//åå…­è¿›åˆ¶ 95//int 95u//unsigned int 95l//long 95lu//unsianed long 95ul//unsianed long 3.14//3.14 6.02e23//6.02*10^23 1.6e-19//1.6*10^-19 6.02e23L//long double 6.02e23f//float 6.02e23//double constç±»å‹é™å®šç¬¦ åœ¨å˜é‡å‰åŠ äº†consté™å®šç¬¦ï¼Œå˜é‡çš„å€¼å°±ä¸å¯ä»¥è¢«ä¿®æ”¹äº†\n1 2 const float PI = 3.1415926f ; PI += 1 ;//error! è¿ç®—ç¬¦ä¼˜å…ˆçº§\n1 2 3 4 5 a++ ++a * / + - \u0026lt;\u0026lt; \u0026gt;\u0026gt; èµ‹å€¼æ“ä½œ\n1 2 3 4 5 6 7 8 a = b a += b a -= b a *= b a \u0026amp;= b a |= b a \u0026lt;\u0026lt;= b a \u0026gt;\u0026gt;= b è‡ªå¢è‡ªå‡\n1 2 3 4 i ++ ++ i i -- -- i 1 2 3 int i = 3 ; int b = i ++ ;//å…ˆèµ‹å€¼å†++ int c = ++ i ;//å…ˆ++å†èµ‹å€¼ ç±»å‹è½¬æ¢ æµ®ç‚¹ç±»å‹è½¬æ•´å‹ï¼Œä¼šç›´æ¥èˆå¼ƒå°æ•°ä½ï¼Œä¿ç•™æ•´æ•°ä½\n1 2 implicit conversion éšå¼è½¬æ¢ explicit conversion æ˜¾å¼è½¬æ¢ å¾ˆå¤šæ—¶å€™æœ‰é”™çš„éšå¼è½¬æ¢ä¸ä¼šè¢«æŠ¥é”™ï¼Œèƒ½æ­£å¸¸ç¼–è¯‘ï¼Œéœ€è¦æ ¼å¤–æ³¨æ„\n1 2 3 float f = 17 / 5 ;//f will be 3.f , not 3.4f float f = 17 / 5.f ;//f will be 3.4f é™¤æ³•ä¸¤è¾¹éƒ½æ˜¯æ•´æ•°ï¼Œåšçš„æ˜¯æ•´æ•°é™¤æ³•\nData loss å ç”¨å­—èŠ‚ä½çš„æ•°æ®ç±»å‹ è½¬æ¢åˆ° å ç”¨å­—èŠ‚é«˜çš„æ•°æ®ç±»å‹ï¼Œä¸ä¼šæœ‰æ•°æ®ä¸¢å¤±\nå ç”¨å­—èŠ‚é«˜çš„æ•°æ®ç±»å‹ è½¬æ¢åˆ° å ç”¨å­—èŠ‚ä½çš„æ•°æ®ç±»å‹ï¼Œå°±ä¼šæœ‰æ•°æ®ä¸¢å¤±\nAuto auto( since C++11 ) auto is placeholder type specifier\n1 2 3 auto a = 2;//type of a is int auto b - 2.3;//type of b is double auto c ;//valid in C , error in C++ autoåœ¨åˆå§‹åŒ–é˜¶æ®µå°±ä¼šç¡®å®šæ•°æ®ç±»å‹ï¼Œåé¢ä¸å†æ”¹å˜\n1 2 auto a = 2; a = 2.3 ;// int = 2.3 , ä¼šå‘ç”Ÿç±»å‹è½¬æ¢ï¼Œæœ€åa = 2 Branching-and-Looping-Statements å¾ªç¯å’Œåˆ†æ”¯ç»“æ„\nif else å¦‚æœæ²¡æœ‰èŠ±æ‹¬å·å»çº¦æŸï¼Œelseä¼šä¸æœ€è¿‘çš„ifé…å¯¹\nä¸‰ç›®è¿ç®—ç¬¦ 1 2 3 factor = isPositive ? 1 : -1 ; //isPositiveæˆç«‹ï¼Œå–å‰é¢çš„å€¼ //isPositiveä¸æˆç«‹ï¼Œå–åé¢çš„å€¼ Logical Expressions !\u0026gt;\u0026amp;\u0026amp;\u0026gt;|| å¦‚æœé€»è¾‘è¿ç®—ä¸¤è¾¹ä¸æ˜¯å¸ƒå°”ï¼Œåˆ™ä¼šéšå¼è½¬æ¢ä¸ºå¸ƒå°”\n1 2 if( -2 \u0026amp;\u0026amp; true )//-2ä¼šè¢«å¼ºåˆ¶è½¬æ¢ä¸ºboolï¼Œå…¶å¸ƒå°”å€¼ä¸º1ï¼ˆåªè¦ä¸æ˜¯é›¶ï¼Œå…¨éƒ¨è½¬æ¢æˆ1ï¼‰ cout \u0026lt;\u0026lt; \u0026#34;The condition is true.\u0026#34; \u0026lt;\u0026lt; endl; æŒ‡é’ˆç”¨ä½œæ¡ä»¶åˆ¤æ–­æ—¶\n1 2 3 int * p = new int [1024]; if(!p)// if( p == NULL ) cout \u0026lt;\u0026lt; \u0026#34;Memory allocation failed.\u0026#34; \u0026lt;\u0026lt; endl ; while loop å¦‚æœæ¡ä»¶ä¸ºtrueï¼Œå°±ä¼šæ‰§è¡Œå¾ªç¯\nå¾ªç¯æ‰§è¡Œä¸­é—´å¯ä»¥ç”¨breakæ‰“æ–­å¾ªç¯ï¼Œæˆ–è€…ç”¨continueè·³è¿‡å½“å‰å¾ªç¯\n1 2 3 4 5 6 size_t num = 10 ; while( num \u0026gt;= 0 ) { cout \u0026lt;\u0026lt; \u0026#34;num = \u0026#34; \u0026lt;\u0026lt; num \u0026lt;\u0026lt; endl ; num -- ; } //è¿™æ˜¯ä¸€ä¸ªæ­»å¾ªç¯ï¼Œsize_tæ˜¯æ— ç¬¦å·æ•° èµ‹å€¼æ“ä½œè¿™ä¸ªè¡¨è¾¾å¼ä¹Ÿæœ‰å€¼\n1 2 3 4 bool flag = false ; while( flag = true ) { flag = false ; } do-while loop å…ˆæ‰§è¡Œä¸€æ¬¡å¾ªç¯ï¼Œå†åˆ¤æ–­æ¡ä»¶\nfor loop 1 2 for(init-clause;cond-expression;iteration-expression) loop-statement åˆå§‹åŒ–è¡¨è¾¾å¼ï¼Œæ¡ä»¶è¡¨è¾¾å¼ï¼Œè¿­ä»£è¡¨è¾¾å¼\nendless-loop 1 2 3 4 5 6 7 for(;;) { } while(true) { } goto-and-switch Statement caseç›¸å½“äºgotoçš„label\n1 2 3 4 5 6 7 8 switch(str) { case \u0026#39;a\u0026#39;: break; case \u0026#39;b\u0026#39;: break; default: break; } Data-Structures Array åœ¨Cå’ŒC++ä¸­ï¼Œæ•°ç»„å°±æ˜¯ä¸€å—è¿ç»­çš„å†…å­˜ æ•°ç»„çš„åå­—æŒ‡å‘æ•°ç»„çš„é¦–åœ°å€\nåˆå§‹åŒ–\n1 2 int number[5]={2,2};//åªåˆå§‹åŒ–å‰ä¸¤ä¸ªå€¼ int number[5]{2,2}; éœ€è¦æ³¨æ„æ•°ç»„æ“ä½œæ²¡æœ‰è¶Šç•Œæç¤ºï¼Œç”šè‡³å¯ä»¥å–è´Ÿæ•°\n1 num_array[-1] = 100 ; ä½†å¦‚æœè¶…å‡ºåº”ç”¨ç¨‹åºçš„å†…å­˜è¾¹ç•Œæ—¶ï¼Œä¼šè¢«æ“ä½œç³»ç»Ÿæ€æ­»\nå˜é•¿æ•°ç»„ å…¶é•¿åº¦ç”±å˜é‡å†³å®šï¼Œåœ¨è¿è¡Œæ—¶å†³å®šè€Œéç¼–è¯‘æ—¶å†³å®š\n1 2 3 4 5 6 int len = 0 ; int num_array[len];//å¯ä»¥ä¸º0 for (int i = 1 ; i \u0026lt; 10 ; ++ i ) { cout \u0026lt;\u0026lt; sizeof(num_array) \u0026lt;\u0026lt; endl ; ++ len ; } Array of unkown size æœªçŸ¥é•¿åº¦çš„æ•°ç»„\n1 2 3 4 5 int num_array[]={1,2,3,4}; //ä½œä¸ºå‡½æ•°å‚æ•° float array_sum(float values[],size_t length); float array_sum(float *values,size_t length); äºŒç»´æ•°ç»„ 1 2 3 void init_2d_array(float mat[][] , uint8_t rows , uint8_t cols);//error void init_2d_array(float mat[][3] , uint8_t rows , uint8_t cols); const-Arrays constä¿®é¥°çš„æ•°ç»„ä¸å…è®¸è¢«ä¿®æ”¹\nStrings Array-style strings 1 2 3 4 5 6 7 8 char man[4]={\u0026#39;m\u0026#39;,\u0026#39;a\u0026#39;,\u0026#39;n\u0026#39;}; char MAN[3]={\u0026#39;M\u0026#39;,\u0026#39;A\u0026#39;,\u0026#39;N\u0026#39;};//a bad one char Man[4]={\u0026#39;M\u0026#39;,\u0026#39;a\u0026#39;,\u0026#39;n\u0026#39;,\u0026#39;\\0\u0026#39;}; //beter defination //æ›´å¥½çš„å®šä¹‰æ–¹å¼ char name[]=\u0026#34;MAN!\u0026#34;; //æ•°ç»„å¤§å°æ˜¯5ï¼Œå­—ç¬¦ä¸²å¤§å°æ˜¯4 strlen(Man)==3ï¼Œå› ä¸ºæœ‰\\0é™åˆ¶\nstring class åŒæ ·æ²¡æœ‰è¶Šç•Œæ£€æŸ¥\n1 2 #include \u0026lt;string\u0026gt; std::string str1 = \u0026#34;MAN\u0026#34;; Struct\u0026amp;Union\u0026amp;Enum Struct æ³¨æ„æœ‰å†…å­˜å¯¹é½\n1 2 3 4 5 6 7 8 9 typedef struct Student{ char name[4]; int born; bool male; }Stu; struct Student stu={\u0026#34;Yu\u0026#34;,2004,true}; Stu stu1 ; Union Unionæ‰€æœ‰æˆå‘˜å…±äº«ä¸€ä¸ªå†…å­˜ï¼Œä»¥æœ€å¤§çš„æˆå‘˜å˜é‡ä¸ºå‡† ç›¸å½“äºåŒä¸€ä¸ªæ•°æ®å¤šä¸ªåå­—\n1 2 3 4 union ipv4add{ std::uint32_t add32; std::uint8_t add8[4]; }; Enum æšä¸¾ç±»å‹\n1 2 3 4 enum color{WHITE,BLACK,RED,BLUE};(0,1,2,3) enum color pen_color = RED ; pen_color += 1;//error typedef ç”¨äºåˆ›å»ºåˆ«å\n1 typedef unsigned char uint8_t; Memory and Pointer Pointers æŒ‡é’ˆå˜é‡å­˜å‚¨çš„æ˜¯ä¸€ä¸ªåœ°å€ å¯¹æŒ‡é’ˆè¿›è¡ŒåŠ å‡ï¼ŒåŠ å‡æ˜¯åŠ å‡ä¸€ä¸ªå…ƒç´ \n1 2 int numbers[4]; int * p =numbers+1 ;//åŠ 1ä¸ªå…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯4ä¸ªå­—èŠ‚ Pointers of Pointers 1 2 3 int num=10; int * p =\u0026amp;num; int ** pp = \u0026amp;p ; const pointers 1 const int * p1=\u0026amp;num; è¯¥æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ä¸å¯ä»¥é€šè¿‡è¯¥æŒ‡é’ˆå»ä¿®æ”¹\n1 2 *p1 = 3;//error num=3;//ok å¯ä»¥ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ï¼Œä½†æŒ‡é’ˆä¸èƒ½å»æŒ‡å…¶ä»–å€¼\n1 2 3 int * const p2 = \u0026amp;num ; *p2 = 3 ;//ok p2 = \u0026amp;another;//error æ¢è¡Œè½¬ä¹‰ç¬¦ è™½ç„¶å®é™…ä¸Šæ˜¯3è¡Œï¼Œä½†æ˜¯åœ¨è¯­ä¹‰ä¸Šæ˜¯1è¡Œ\n1 2 3 #define PRINT_ARRAY(array,n) \\ for( int i = 0 ; i \u0026lt; (n) ; ++ i ) \\ cout \u0026lt;\u0026lt; (array)[i] \u0026lt;\u0026lt; endl; Allocate-memory:C-style åªæ˜¯ç¤ºæ„å›¾ï¼Œåœ¨ä¸åŒç³»ç»Ÿä¸‹ä¼šæœ‰åŒºåˆ« ç”³è¯·å†…å­˜\n1 int *p1 = (int*)malloc(4); é‡Šæ”¾å†…å­˜\n1 void free(void* ptr); å†…å­˜æ³„æ¼é—®é¢˜ ç¬¬ä¸€æ¬¡ç”³è¯·çš„å†…å­˜æ— æ³•è¿›è¡Œç®¡ç†äº†ï¼Œæ— æ³•å›æ”¶\n1 2 3 4 5 p = (int *)malloc(4*sizeof(int)); // ... p = (int *)malloc(8*sizeof(int)); // ... free(p); pæ˜¯å±€éƒ¨å˜é‡ï¼Œå‡½æ•°è¿”å›åå°±æ¶ˆå¤±äº†ï¼Œè¿™æ®µç”³è¯·çš„å†…å­˜å°±æ— æ³•å›æ”¶äº†\n1 2 3 4 void foo() { int * p = (int *)malloc(sizeof(int)); return ; }//memory leak Allocate-memory:C++-style operator new and new[] ç”³è¯·å†…å­˜ï¼Œæ¯”mallocåŠŸèƒ½æ›´ä¸°å¯Œ newæ˜¯ä¸€ä¸ªæ“ä½œç¬¦\n1 2 3 4 5 int * p1 = new int ; int * p2 = new int(5);//ç”³è¯·å†…å­˜ååˆå§‹åŒ–ä¸º5 int * p3 = new int();//åˆå§‹åŒ–ä¸º0 int * p4 = new int{};//åˆå§‹åŒ–ä¸º0 1 2 int * pa1 = new int[16]{1,2,3};//ç”³è¯·16ä¸ªintçš„å†…å­˜ï¼Œ64å­—èŠ‚ //åŒæ—¶è¿˜è¿›è¡Œåˆå§‹åŒ– operator delete and delete[] å¯¹äºæ•°ç»„å’Œæ™®é€šå˜é‡è€Œè¨€ï¼Œæ²¡æœ‰åŒºåˆ«\n1 2 3 4 5 6 7 8 9 int *p1 = new int ; int *ps1 = new int[16]; delete p1 ;//æ²¡åŒºåˆ« delete []p1 ; delete ps1 ; delete []ps1; ä½†å¦‚æœæ˜¯ä¸€ä¸ªç±»çš„å¯¹è±¡çš„æ•°ç»„ï¼Œä¸¤ç§æ–¹å¼éƒ½ä¼šé‡Šæ”¾æ‰€æœ‰çš„å†…å­˜ï¼Œ ä½†æ˜¯deleteåªæœ‰ç¬¬ä¸€ä¸ªå…ƒç´ ä¼šå»è°ƒç”¨ææ„å‡½æ•°ï¼Œ delete[]æ‰€æœ‰å…ƒç´ éƒ½ä¼šå»è°ƒç”¨ææ„å‡½æ•°\n1 2 3 4 stu *p1 = new stu[3] ; delete p1 ; delete []p1 ; Basics of Functions Functions å‡½æ•°æ˜¯ä¸ºäº†è®©ç¼–ç¨‹æ›´åŠ æ¨¡å—åŒ–è€Œè®¾è®¡çš„\nParameters ä¼ å‚çš„ä¸¤ç§æ–¹å¼ï¼Œå€¼ä¼ é€’å’Œå¼•ç”¨ä¼ é€’ å€¼ä¼ é€’çš„å€¼å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå‡½æ•°å†…çš„å±€éƒ¨å˜é‡\nå€¼ä¼ é€’ å€¼ä¼ é€’çš„å€¼å¯ä»¥è®¤ä¸ºæ˜¯ä¸€ä¸ªå‡½æ•°å†…çš„å±€éƒ¨å˜é‡\n1 2 3 4 5 6 7 8 9 10 int foo(int x) { x += 10 ; return x ; } int main() { int num1 = 20 ; int num2 = foo(num1); return 0; } xæ˜¯num1çš„ä¸€ä»½æ‹·è´ï¼ˆä¼šæ¶‰åŠæ‹·è´æ„é€ å‡½æ•°ï¼‰\nå¼•ç”¨ä¼ é€’-Reference å¼•ç”¨æ˜¯ä¸€ä¸ªå˜é‡çš„ åˆ«å\n1 2 int num = 0; int \u0026amp; num_ref = num ;//åˆ«å å¼•ç”¨åˆ›å»ºçš„æ—¶å€™ä¸€å®šè¦åˆå§‹åŒ–\n1 int \u0026amp;num_ref ;//error åœ¨å‡½æ•°ä¼ é€’ä¸€ä¸ªå†…å­˜å ç”¨å·¨å¤§çš„å‚æ•°æ—¶ï¼Œé‡‡ç”¨å€¼ä¼ é€’ï¼Œæ‹·è´çš„å˜é‡ä¼šå ç”¨å¤§é‡å†…å­˜ï¼Œè¿™ä¸ªæ—¶å€™å¯ä»¥ä½¿ç”¨æŒ‡é’ˆæˆ–è€…å¼•ç”¨\næŒ‡é’ˆä¸å¼•ç”¨çš„åŒºåˆ« å¼•ç”¨ç›¸è¾ƒäºæŒ‡é’ˆæ›´åŠ å®‰å…¨ Return-statement å¦‚æœreturnä¸€ä¸ªæ•°æ®å¾ˆå¤§ï¼Œå¯ä»¥é‡‡ç”¨ä»¥ä¸‹çš„æ–¹å¼\n1 2 3 4 5 bool matrix_add(const Matrix \u0026amp; matA , const Matrix \u0026amp; matB , Matrix \u0026amp; matC ) { //æ£€æŸ¥å‚æ•°æ˜¯å¦æ­£å¸¸ //... //return true if everything ok } Inline-functions å†…è”å‡½æ•°ï¼Œä¼—æ‰€å‘¨çŸ¥ï¼Œå‡½æ•°çš„è°ƒç”¨æ˜¯æœ‰ä»£ä»·çš„ï¼Œéœ€è¦å°†ä¸€éƒ¨åˆ†æ•°æ®å‹å…¥æ ˆä¸­ï¼Œè·³è½¬æ‰§è¡Œå®Œåå†å›æ¥å‡ºæ ˆ\nå¦‚æœä¸€ä¸ªå¾®å°çš„å‡½æ•°ä¸”è¢«é¢‘ç¹è°ƒç”¨ï¼Œè¿™ä¸ªä»£ä»·å°±ä¼šå˜å¾—ä¸å¯å¿½è§†ï¼Œæ­¤æ—¶å¯ä»¥ä½¿ç”¨å†…è”å‡½æ•°ï¼ˆç©ºé—´æ¢æ—¶é—´çš„å…¸å‹æ¡ˆä¾‹ï¼‰\n1 2 3 4 inline float max_function(float a ,float b ) { if(a\u0026gt;b) return a; else return b; } éœ€è¦æ³¨æ„çš„æ˜¯inlineæ˜¯å»ºè®®ç¼–è¯‘å™¨ä»¥å†…è”inlineçš„æ–¹å¼ç¼–è¯‘è¿™ä¸ªå‡½æ•°ï¼ˆæ‰€ä»¥æœ‰å¯èƒ½ç¼–è¯‘å™¨ä¼šä¸å¬ä½ çš„å»ºè®®ï¼‰\nå†…è”å‡½æ•°\u0026amp;å® çš„åŒºåˆ« ä¸å®å®šä¹‰æ˜¯æœ‰å»åˆ«çš„ï¼Œå®å®šä¹‰æ˜¯åœ¨é¢„ç¼–è¯‘ä¹‹å‰çš„æ–‡æœ¬æ›¿æ¢ï¼Œæœ‰è¾ƒå¤§çš„å®‰å…¨æ€§é—®é¢˜\næ³¨æ„ï¼Œå®æ˜¯åœ¨åšæ–‡æœ¬æ›¿æ¢ï¼Œä¸€å®šè¦è­¦æƒ•æ–‡æœ¬æ›¿æ¢åçš„è¿ç®—ç¬¦ä¼˜å…ˆçº§é—®é¢˜\n1 2 3 4 5 6 7 8 9 10 11 //å® æ–‡æœ¬æ›¿æ¢åè¿ç®—ä¼˜å…ˆçº§ #define MAX_MACRO(a,b) (a)\u0026gt;(b) ? (a):(b) //#define MAX_MACRO(a,b) a\u0026gt;b ? a : b int num1=20; int num2=30; int maxv=MAX_MACRO(num1,num2); int maxt=MAX_MACRO(num1++,num2++); //maxt=(num1++)\u0026gt;(num2++)?(num1++):(num2++); //å®é™…æ‰§è¡Œäº†ä¸¤æ¬¡num2++,num2å®é™…æ˜¯32 //è€Œnum1åªæ‰§è¡Œäº†ä¸€æ¬¡num1++,num1å®é™…æ˜¯31 1 2 3 4 5 6 7 8 9 10 11 //å® æ–‡æœ¬æ›¿æ¢åè¿ç®—ä¼˜å…ˆçº§ //#define MAX_MACRO(a,b) (a)\u0026gt;(b) ? (a):(b) #define MAX_MACRO(a,b) a\u0026gt;b ? a : b int num1=0xAB09; int num2=0xEF08; int maxv=MAX_MACRO(num1\u0026amp;0xFF,num2\u0026amp;0xFF); //maxv=0x0009 //maxv= num1\u0026amp;0xFF \u0026gt; num2\u0026amp;0xFF ? num1\u0026amp;0xFF : num2\u0026amp;0xFF //å®é™…ä¸Š\u0026gt;ä¼˜å…ˆçº§å¤§äº\u0026amp; //æ‰§è¡Œçš„æ˜¯num1\u0026amp;(0xFF\u0026gt;num2)\u0026amp;0xFF Advances in Functions Default-arguments é»˜è®¤å‚æ•°æ˜¯C++çš„ç‰¹æ€§ï¼ŒCå¹¶ä¸æ”¯æŒ\n1 2 3 float norm(float x,float y,float z); float norm(float x,float y,float z=0); //x,y,zæ˜¯parameters,z=0çš„0æ˜¯arguments Function-Overloading å‡½æ•°é‡è½½æ˜¯åªæœ‰C++æ‰æ”¯æŒçš„ç‰¹æ€§ï¼ŒCå¹¶ä¸æ”¯æŒ ä¸C++å’ŒCå‡½æ•°åç¬¦å·ä¿®é¥°æœ‰å…³\néœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒC++çš„å‡½æ•°é‡è½½åªå…è®¸å°†å‚æ•°é‡è½½ï¼Œè€Œä¸èƒ½é‡è½½è¿”å›å€¼\n1 2 3 float sum(float x , float y); double sum(float x , float y);//error //ä¼šå‡ºç°é‡å®šä¹‰çš„é”™è¯¯ åŒæ—¶è¦æ³¨æ„ï¼Œå‡½æ•°è°ƒç”¨ä¸è¦å‡ºç°æ­§ä¹‰ï¼Œä¸€æ—¦å‡ºç°æ­§ä¹‰ï¼Œç¼–è¯‘å™¨ä¼šåœæ­¢å·¥ä½œï¼Œæ— æ³•ç¼–è¯‘é€šè¿‡\nFunction-templates å‡½æ•°æ¨¡æ¿ç”Ÿæˆçš„å‡½æ•°æ˜¯æ¨¡æ¿å‡½æ•°ï¼Œæ¨¡æ¿å‡½æ•°æ˜¯å‡½æ•°æ¨¡æ¿è¢«å®ä¾‹åŒ–ä»¥åç”Ÿæˆçš„\næ­¤å¤„çš„Tæ˜¯å®šä¹‰çš„ä¸€ä¸ªæ³›å‹\n1 2 3 4 5 template\u0026lt;typename T\u0026gt; T sum(T x , T y ) { cout \u0026lt;\u0026lt; \u0026#34;The input type is\u0026#34;\u0026lt;\u0026lt; typeid(T).name() \u0026lt;\u0026lt; endl; return x+y; } å‡½æ•°æ¨¡æ¿å®šä¹‰åï¼Œå½“ç¼–è¯‘å™¨çœ‹åˆ°è¿™æ®µä»£ç çš„æ—¶å€™ï¼Œç¼–è¯‘å™¨å¹¶ä¸ä¼šå»ç”ŸæˆçœŸæ­£çš„å¯æ‰§è¡Œä»£ç \nè¦è®©ç¼–è¯‘å™¨å»ç”Ÿæˆå‡½æ•°æ¨¡æ¿å¯¹åº”çš„å¯æ‰§è¡Œä»£ç éœ€è¦å®ä¾‹åŒ–\n1 2 3 4 template double sum\u0026lt;double\u0026gt;(double,double);//å…¨å†™ template char sum\u0026lt;\u0026gt;(char,char);//çœç•¥\u0026lt;\u0026gt;å†…çš„å®šä¹‰ template int sum(int,int);//çœç•¥\u0026lt;\u0026gt; //ä»¥ä¸Šæ˜¯æ˜¾ç¤ºçš„å®ä¾‹åŒ– éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå‡½æ•°æ¨¡æ¿é™¤äº†æ˜¾å¼çš„å®ä¾‹åŒ–ï¼Œè¿˜å¯ä»¥åšéšå¼çš„å®ä¾‹åŒ–\n1 2 3 4 5 6 template float sum\u0026lt;float\u0026gt;(float,float);//å…¨å†™ //1.0f (float) //1.0 (double) auto man = sum(1.0,1.0);//ä¼šè¿›è¡Œéšå¼å®ä¾‹åŒ– //å®ä¾‹åŒ–çš„æ¨¡æ¿å‡½æ•°åº”è¯¥æ˜¯ //template double sum\u0026lt;double\u0026gt;(double,double); éšå¼çš„å®ä¾‹åŒ–å¯ä»¥æŒ‡å®šå®ä¾‹åŒ–çš„ç±»å‹\n1 2 auto man = sum\u0026lt;int\u0026gt;(1.0f,2.0f); //è¿™é‡ŒæŒ‡å®šå®ä¾‹åŒ–ç±»å‹åï¼Œå¯¹å‚æ•°ä¼šæœ‰éšå¼è½¬æ¢ å®ä¾‹åŒ–åè¿˜å¯ä»¥è¿›è¡Œè‡ªå®šä¹‰ï¼Œä¹Ÿå°±æ˜¯ç‰¹ä¾‹åŒ–ï¼Œç‰¹ä¾‹åŒ–çš„ä»£ç æ˜¯ä¼šè¢«ç¼–è¯‘çš„ï¼Œä¸€èˆ¬ä¼šæ”¾åœ¨.cppæºæ–‡ä»¶\n1 2 3 4 5 6 7 8 9 //Pointæ˜¯ä¸€ä¸ªç»“æ„ä½“ //æ³¨æ„templateåé¢ä¸€å®šè¦åŠ \u0026lt;\u0026gt; template \u0026lt;\u0026gt; Point sum\u0026lt;Point\u0026gt;(Point pt1,Point pt2) { cout \u0026lt;\u0026lt; \u0026#34;The input type is \u0026#34; \u0026lt;\u0026lt; typeid(pt1).name() \u0026lt;\u0026lt; endl ; Point pt; pt.x = pt1.x+pt2.x; pt.y = pt1.y+pt2.y; } Function-Pointers and References Function-Pointers å‡½æ•°æŒ‡é’ˆæ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼ŒæŒ‡å‘å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯æŒ‡å‘æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ æŒ‡é’ˆå‡½æ•°çš„ç±»å‹éœ€è¦ä¸å…¶æŒ‡å‘çš„å‡½æ•°ç±»å‹å®Œå…¨åŒ¹é…\n1 2 3 4 5 6 7 8 9 10 float nprm_l1(float x , float y); float norm_l2(float x , float y); float (*norm_ptr)(float x , float y);//æ‹¬å·ä¸èƒ½çœ //ä¸¤ç§å†™æ³•ç­‰ä»· norm_ptr = norm_l1; norm_ptr = \u0026amp;norm_l2; float len1 = norm_ptr(-3.0f,4.0f); float len2 = (*norm_ptr)(-3.0f,4.0f); å¸¸è§çš„åº”ç”¨æ¡ˆä¾‹æ˜¯å°†å‡½æ•°ä½œä¸ºä¸€ä¸ªå‚æ•°ä¼ é€’åˆ°å¦å¤–ä¸€ä¸ªå‡½æ•°é‡Œé¢ï¼Œä½œä¸ºå›è°ƒå‡½æ•°\nFunction-references å‡½æ•°å¼•ç”¨ï¼Œéœ€è¦æ³¨æ„å‡½æ•°å¼•ç”¨åœ¨åˆå§‹åŒ–çš„æ—¶å€™éœ€è¦å®šæ­»\n1 2 3 float nprm_l1(float x , float y); float norm_l2(float x , float y); float (\u0026amp;norm_ref)(float x, float y) =norm_l1; Recursive-Functions é€’å½’å‡½æ•°ï¼Œè‡ªå·±è°ƒç”¨è‡ªå·±ï¼Œéœ€è¦æœ‰é€’å½’ç»ˆæ­¢æ¡ä»¶ï¼Œå¦åˆ™ä¸€ç›´é€’å½’ä¼šçˆ†æ ˆ\n1 2 3 4 5 6 7 8 void div2(double val) { if(val\u0026gt;1.0) { cout \u0026lt;\u0026lt; val \u0026lt;\u0026lt; endl; div(val/2); } else cout \u0026lt;\u0026lt; \u0026#34;over\u0026#34;; cout \u0026lt;\u0026lt; val \u0026lt;\u0026lt; endl; } å‡½æ•°çš„æ¯ä¸€æ¬¡è°ƒç”¨éœ€è¦å‹æ ˆè¿›è¡Œæ•°æ®ä¿å­˜ï¼Œæ— ç©·é€’å½’å°±ä¼šå¯¼è‡´çˆ†æ ˆ\nSpeedup-Your-Program C-and-Cpp-with-arm Cå’ŒC++è¯­è¨€æ˜¯ç”±æ˜ç¡®çš„è¯­è¨€è§„èŒƒçš„ï¼Œæ˜¯å…·æœ‰å¹³å°æ— å…³æ€§çš„ï¼Œèƒ½é€šè¿‡ç¼–è¯‘å™¨ç¼–è¯‘æˆå¹³å°ç›¸å…³çš„å¯æ‰§è¡Œç¨‹åº\næœºå™¨äººæˆ–è€…è¯´æ˜¯æ™ºèƒ½è®¾å¤‡é¢†åŸŸå…¨æ˜¯armçš„å¤©ä¸‹\nSpeedup-Your-Program Simple is Beautiful ä»£ç ä¼˜åŒ–å¸¸ç”¨ç­–ç•¥ä¸Šï¼Œä¼˜åŒ–ä»£ç ä¸€å®šè¦è€ƒè™‘åˆ°å†…å­˜\nå¤§é‡çš„å†…å­˜è¯»å†™å¸¦æ¥çš„æ—¶é—´æµªè´¹ éè¿ç»­å†…å­˜çš„è·³è·ƒå¼è¯»å–å¯¼è‡´çš„cacheå‘½ä¸­ç‡ä¸‹é™ é¿å…å¤§é‡çš„å†…å­˜æ‹·è´ å…³äºSIMDå’ŒOpenMP SIMD:Single instruction,multiple data ï¼ˆä¾‹å¦‚å‘é‡åŠ æ³•ï¼‰ OpenMP 1 2 3 4 5 6 #include \u0026lt;omp.h\u0026gt; #pragma omp parallel for for( int i = 0 ; i \u0026lt; n ; ++ i ) c[i] = a[i]+b[i]; //å°†å¾ªç¯æ‹†å¼€ï¼Œåˆ†ç»™ä¸åŒçš„cpuæ ¸è¿è¡Œ //éœ€è¦æ³¨æ„å°†ä»»åŠ¡æ‹†å¼€ç»™ä¸åŒçš„cpuæ ¸æœ¬èº«ä¹Ÿæ˜¯éœ€è¦æ—¶è€—çš„ Basics of Classes classes-and-objects ç±»çš„å¯¹è±¡å»æ“ä½œæˆå‘˜ä¼šæ›´åŠ çš„å®‰å…¨ ç±»çš„æˆå‘˜å‡½æ•°åœ¨ç±»å†…å£°æ˜æ—¶ï¼Œé»˜è®¤æ˜¯inlineå‡½æ•° æ‰€ä»¥ç®€å•çš„å‡½æ•°åœ¨ç±»å†…å®ç°ï¼Œå¤æ‚å‡½æ•°åœ¨ç±»å¤–å®ç°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 class Student { private: char name[4]; int born; bool male; public: //ç±»å†…å®ç°ï¼Œé»˜è®¤inline void setName(cont cahr s) { strcpy(name,s,sizeof(name)) } void setGender(); void printInfo(); }; inline void Student:::setGender(bool isMale) { male = isMale; } void Student::printInfo() {//ä¸æ˜¯inlineå‡½æ•° cout \u0026lt;\u0026lt; name \u0026lt;\u0026lt; endl ; //... } Constructors-and-Destructors æ„é€ å‡½æ•°ä¸ææ„å‡½æ•° æ„é€ å‡½æ•°å¯ä»¥æœ‰å¾ˆå¤šä¸ªï¼Œææ„å‡½æ•°åªèƒ½æœ‰ä¸€ä¸ª\næ„é€ å‡½æ•°Constructors 1 2 struct in C:alloca te memory class in C++:allocate memory\u0026amp;invoke a constructor æ„é€ å‡½æ•°çš„ç”¨é€”æ˜¯å¯¹ å¯¹è±¡é‡Œé¢çš„æ•°æ® è¿›è¡Œåˆå§‹åŒ– å¦‚æœä¸€ä¸ªç±»ä¸å®šä¹‰æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªé»˜è®¤æ„é€ å‡½æ•°\nå®šä¹‰æ„é€ å‡½æ•°éœ€è¦å®šä¹‰åœ¨publicé‡Œé¢\næ¯ä¸ªnewå‡ºæ¥çš„å¯¹è±¡ï¼Œéƒ½ä¼šè°ƒç”¨æ„é€ å‡½æ•°è¿›è¡Œåˆå§‹åŒ–\nææ„å‡½æ•°Destructors 1 2 3 4 5 6 7 8 9 10 11 12 13 14 class Student { public: //... Student() { name = new char[1024]{0}; } //... ~Student() { delete [] name; } } this-Pointer å¯¹äºç±»è€Œè¨€ï¼Œå‡½æ•°çš„æŒ‡ä»¤åªæœ‰ä¸€ä»½ All methods in a function have a this-pointer\n1 2 3 4 5 6 7 8 9 10 11 void setBorn(int b) { born=b; } void setBorn(int b) { this-\u0026gt;born=b; } void setBorn(int born) { this-\u0026gt;born=born;//thisæŒ‡é’ˆä¸å¯çœç•¥ï¼Œç”¨æ¥å¯¹å‚æ•°è¿›è¡ŒåŒºåˆ† } const-and-static-Members const Members å¸¸é‡æˆå‘˜å˜é‡ä¸èƒ½è¢«ä¿®æ”¹ï¼Œå¸¸é‡æˆå‘˜å‡½æ•°ä¸èƒ½å»ä¿®æ”¹æˆå‘˜å˜é‡\n1 2 3 4 5 6 7 8 9 class Student { private: const int BMI=24; public: int getBorn() const { //born ++ ;//error return born; } } static Members é™æ€æˆå‘˜å˜é‡å’Œé™æ€æˆå‘˜å‡½æ•°å¹¶ä¸ç»‘å®šåœ¨æŸä¸€ä¸ªå®ä¾‹ä¸Š ç±»çš„é™æ€å˜é‡å±äºç±»ï¼Œä¸å±äºå®ä¾‹åŒ–çš„å¯¹è±¡ é™æ€å‡½æ•°ä¸èƒ½è®¿é—®å®ä¾‹æˆå‘˜ï¼Œä¹Ÿä¸èƒ½ä¿®æ”¹éé™æ€æ•°æ®\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 class Student { public: int born ; static int stu_num ;//ä»…ä»…æ˜¯å£°æ˜ //inline static int stu_num = 0 ;//C++17æ ‡å‡†ï¼Œä¸éœ€è¦å¤–éƒ¨å®šä¹‰ int getBorn() const { //born ++ ;//error return born; } static int getNum() { return stu_num; } } int Student::stunum = 1 ;//å¤–éƒ¨å®šä¹‰ Advances in Classes Operator-overloading è¿ç®—ç¬¦é‡è½½\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 class complex { public: complex();//é»˜è®¤æ„é€ å‡½æ•° complex(double,double);//åˆå§‹åŒ–æ„é€ å‡½æ•° complex(double);//å¼ºåˆ¶è½¬æ¢æ„é€ å‡½æ•° //*****************************************************// //ä¸‹é¢æ˜¯äºŒé€‰ä¸€ complex operator + (const complex\u0026amp;);//è¿ç®—ç¬¦é‡è½½æˆå‘˜å‡½æ•°å®ç° complex operator - (const complex\u0026amp;);//è¿ç®—ç¬¦é‡è½½æˆå‘˜å‡½æ•°å®ç° friend complex operator + (complex\u0026amp;,complex\u0026amp;);//å‹å…ƒå‡½æ•°å®ç° friend complex operator - (complex\u0026amp;,complex\u0026amp;);//å‹å…ƒå‡½æ•°å®ç° //é‡è½½+=ç¬¦å· complex \u0026amp; operator+=ï¼ˆconst complex\u0026amp; comp1) { this-\u0026gt;real += comp1.real; this-\u0026gt;imag += comp1.imag; return *this; } //****************************************************// friend std::istream\u0026amp; operator \u0026gt;\u0026gt; (std::istream\u0026amp; , complex\u0026amp;);//istreamç±»\u0026gt;\u0026gt;è¿ç®—ç¬¦é‡è½½ friend std::ostream\u0026amp; operator \u0026lt;\u0026lt; (std::ostream\u0026amp; , complex\u0026amp;);//ostreamç±»\u0026lt;\u0026lt;è¿ç®—ç¬¦é‡è½½ private: double real , imag ; }; éœ€è¦æ³¨æ„è¿ç®—ç¬¦é‡è½½æ˜¯æœ‰æ–¹å‘çš„\n1 2 3 4 complex comp1(1.0,1.0); complex comp2(2.0,2.0); comp1 += comp2; //comp1.operator+=(comp2); Friend-Functions å‹å…ƒå‡½æ•°çš„å£°æ˜åœ¨ç±»å†…ï¼Œèƒ½è®¿é—®ç±»çš„ç§æœ‰å˜é‡å’Œç§æœ‰å‡½æ•°ï¼Œä½†æ˜¯å®ƒä¸æ˜¯ç±»çš„æˆå‘˜ï¼Œæ˜¯ä¸€ä¸ªç‰¹æ®Šçš„å‡½æ•°\nå‹å…ƒå‡½æ•°çš„å®šä¹‰å¯ä»¥åœ¨ç±»å†…ç´§è·Ÿå£°æ˜ï¼Œä¹Ÿå¯ä»¥åœ¨ç±»å¤–\nOperator \u0026lt;\u0026lt; ä¹Ÿèƒ½è¢«é‡è½½ï¼Œä¸€èˆ¬é‡‡ç”¨å‹å…ƒå‡½æ•°å½¢å¼é‡è½½\n1 2 3 4 5 6 7 8 9 10 //è¿”å›ç±»å‹æ˜¯è¾“å…¥è¾“å‡ºæµçš„å¼•ç”¨ friend std::istream\u0026amp; operator \u0026gt;\u0026gt; (std::istream\u0026amp; , complex\u0026amp;);//istreamç±»\u0026gt;\u0026gt;è¿ç®—ç¬¦é‡è½½ friend std::ostream\u0026amp; operator \u0026lt;\u0026lt; (std::ostream\u0026amp; , complex\u0026amp;);//ostreamç±»\u0026lt;\u0026lt;è¿ç®—ç¬¦é‡è½½ /**************************************************/Â friend std::ostream\u0026amp; operator \u0026lt;\u0026lt; (std::ostream\u0026amp; os, complex\u0026amp; comp) { os\u0026lt;\u0026lt;comp.real\u0026lt;\u0026lt;\u0026#34;+\u0026#34;\u0026lt;\u0026lt;comp.imag; return os ;//ä¸€å®šè¦è¿”å›osï¼Œä¸ºäº†èƒ½å¤Ÿé“¾å¼è°ƒç”¨ } è¾“å…¥è¾“å‡ºæµçš„è¿”å›ä¸€å®šæ˜¯è¾“å…¥è¾“å‡ºæµçš„å¼•ç”¨ï¼Œä¸ºäº†èƒ½å¤Ÿé“¾å¼è°ƒç”¨\nuser-defined-type-conversion ç±»è½¬åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè¿ç®—ç¬¦é‡è½½\n1 2 3 4 5 6 7 8 9 //implicit conversion operator int() const {//å…è®¸éšå¼è½¬æ¢ return int(this-\u0026gt;real) ; } //åªå…è®¸æ˜¾å¼è½¬æ¢ explicit operator float() const { return float(this-\u0026gt;real); } åŸºæœ¬ç±»å‹è½¬ç±»ï¼Œå¯ä»¥åˆ©ç”¨æ„é€ å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 complex(int m):real(m),imag(0) {} complex\u0026amp; operator=(int m) { this-\u0026gt;real = m ; this -\u0026gt;imag = 0 ; return *this ; } //ä¸Šé¢æ˜¯æ„é€ å‡½æ•°ï¼Œåœ¨ç±»å†… //è°ƒç”¨ complex comp1 = 100 ;//å°±ä¼šè‡ªåŠ¨è°ƒç”¨æ„é€ å‡½æ•° //åˆå§‹åŒ– æ‰§è¡Œçš„æ˜¯æ„é€ å‡½æ•° comp1 = 10 ;//æ­¤å¤„æ‰æ˜¯èµ‹å€¼è¿ç®—ç¬¦ï¼Œèµ‹å€¼æ“ä½œ comp1 = complex(20);//æ­¤å¤„æ˜¯æ„é€ å‡½æ•° Increment æœ‰å‰ç½®(++i)å’Œåç½®(i++)\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 //éƒ½æ˜¯ç±»çš„æˆå‘˜å‡½æ•° //prefix increment complex\u0026amp; operator++() {//å‰ç½® this-\u0026gt;real ++ ; return *this ; } //postfix increment complex operator++(int) {//åç½®ï¼Œå‚æ•°åˆ—è¡¨é‡Œé¢æ”¾int ä¸»è¦æ˜¯ä¸ºäº†åšåŒºåˆ† //éœ€è¦ä¿å­˜æ—§å€¼ç”¨æ¥è¿”å› complex old = *this ;//keep the old value operator++();//prefix increment return old ; } Dynamic-Memory-Management-in-Classes Some-default-operations Default-Constructors é»˜è®¤æ„é€ å‡½æ•°\nå¦‚æœä¸€ä¸ªç±»æ²¡æœ‰ä»»ä½•æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¼šç”Ÿæˆä¸€ä¸ªç©ºçš„æ„é€ å‡½æ•°ï¼Œå¦‚æœç»™ç±»å®šä¹‰äº†æ„é€ å‡½æ•°ï¼Œç¼–è¯‘å™¨å°±ä¸ä¼šç”Ÿæˆé»˜è®¤æ„é€ å‡½æ•°\néœ€è¦é¿å…æ­§ä¹‰\n1 2 3 4 5 6 7 8 complex() { cout \u0026lt;\u0026lt; \u0026#34;man\u0026#34;\u0026lt;\u0026lt;endl ; } complex(int n=0) { cout \u0026lt;\u0026lt; \u0026#34;MAN\u0026#34; \u0026lt;\u0026lt; endl ; } //æ­¤æ—¶å°±ä¼šæœ‰æ­§ä¹‰ï¼Œç¼–è¯‘å™¨å¥´çŸ¥é“æ‰§è¡Œå“ªä¸€ä¸ª Implicitly-defined-Destructor éšå¼å®šä¹‰çš„ææ„å‡½æ•°ï¼Œæ²¡æœ‰æ˜¾å¼å®šä¹‰ææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šå»å®šä¹‰ä¸€ä¸ªç©ºçš„ææ„å‡½æ•°\nDefault-Copy-Constructors å¤§ç–†C++ä¸€é¢ï¼šC++ä»€ä¹ˆæ—¶å€™ç”Ÿæˆé»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼Ÿ\næ‹·è´æ„é€ å‡½æ•°çš„å‚æ•°å¿…é¡»æ˜¯constå¼•ç”¨ï¼ˆé¿å…æ— é™é€’å½’è°ƒç”¨ï¼‰ æ‹·è´æ„é€ å‡½æ•°å®šä¹‰å¦‚ä¸‹\n1 2 3 4 5 6 7 complex::complex(complex \u0026amp; comp1) { //... } complex comp(1.0,1.0); complex comp_copy = comp;//copy constructor complex comp_kobe(comp);//copy constructor é»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼Œå¦‚æœç”¨æˆ·æ²¡æœ‰æ˜¾å¼å®šä¹‰ï¼Œç¼–è¯‘å™¨ä¼šé»˜è®¤ç”Ÿæˆä¸€ä¸ªç©ºçš„æ‹·è´æ„é€ å‡½æ•°ï¼Œè¯¥é»˜è®¤æ„é€ å‡½æ•°ä¼šå°†å¯¹è±¡é‡Œé¢çš„æ‰€æœ‰éé™æ€æˆå‘˜å…¨éƒ¨æ‹·è´ä¸€é\nå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„=deleteæ¥è®©ç¼–è¯‘å™¨ä¸å»æä¾›é»˜è®¤çš„copy-constructors\n1 complex(const complex\u0026amp;)=delete; Default-Copy-Assignment Assignment operators:=,+=,-=\n1 2 3 4 5 6 7 complex\u0026amp; complex::operator=(complex \u0026amp; comp) { //... } complex comp(1.0,1.0); complex comp_man = comp;//copy constructoræ‹·è´æ„é€ å‡½æ•° comp_man = comp;//copy assignment Default-Copy-Assignment å¦‚æœç”¨æˆ·æ²¡æœ‰å®šä¹‰Copy-Assignmentï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªé»˜è®¤çš„Copy-Assignment\nè¯¥é»˜è®¤å‡½æ•°ä¼šå°†å¯¹è±¡æ‰€æœ‰çš„éé™æ€æˆå‘˜å˜é‡å…¨éƒ¨æ‹·è´ä¸€é\nå¯ä»¥ä½¿ç”¨ä¸‹é¢çš„=deleteæ¥è®©ç¼–è¯‘å™¨ä¸å»æä¾›é»˜è®¤çš„copy-assignment\n1 complex \u0026amp; operator= (const complex\u0026amp;)=delete; Copy-Assignment æ³¨æ„èµ‹å€¼è¿ç®—ç¬¦åœ¨å†…å­˜ç®¡ç†ä¸Šçš„ç»†èŠ‚\né¿å…è‡ªèµ‹å€¼ èµ‹å€¼å‰å…ˆå›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 #includeÂ \u0026lt;iostream\u0026gt; #includeÂ \u0026lt;string.h\u0026gt; using namespaceÂ std; classÂ ClassA { public: ClassA() {} ClassA(const char* pszInputStr) { pszTestStr =Â new char[strlen(pszInputStr) + 1]; strncpy(pszTestStr, pszInputStr, strlen(pszInputStr) + 1); } virtualÂ ~ClassA() { deleteÂ pszTestStr; } // èµ‹å€¼è¿ç®—ç¬¦é‡è½½å‡½æ•° ClassA\u0026amp;Â operator=(constÂ ClassA\u0026amp; cls) { // é¿å…è‡ªèµ‹å€¼ ifÂ (thisÂ != \u0026amp;cls) { // é¿å…å†…å­˜æ³„éœ² ifÂ (pszTestStr != NULL) { deleteÂ pszTestStr; pszTestStr = NULL; } pszTestStr =Â new char[strlen(cls.pszTestStr) + 1]; strncpy(pszTestStr, cls.pszTestStr, strlen(cls.pszTestStr) + 1); } returnÂ *this; } public: char* pszTestStr; }; intÂ main() { ClassA obj1(\u0026#34;liitdar\u0026#34;); ClassA obj2; obj2 = obj1; cout \u0026lt;\u0026lt;Â \u0026#34;obj2.pszTestStr is: \u0026#34;Â \u0026lt;\u0026lt; obj2.pszTestStr \u0026lt;\u0026lt; endl; returnÂ 0; } An-Example-with-Dynamic-Memory æ³¨æ„æ·±æ‹·è´ä¸æµ…æ‹·è´çš„é—®é¢˜ï¼Œå¯¼è‡´é‡å¤é‡Šæ”¾åŒä¸€å—å†…å­˜ è¿™ç§é”™è¯¯æœ€å®¹æ˜“ç”± é»˜è®¤æ‹·è´æ„é€ å‡½æ•° å’Œ é»˜è®¤èµ‹å€¼è¿ç®—ç¬¦é‡è½½ å¯¼è‡´\nHard-Copy æ¯æ¬¡åˆ›å»ºå’Œèµ‹å€¼çš„æ—¶å€™éƒ½å»é‡æ–°ç”³è¯·å†…å­˜ ç¼ºç‚¹åœ¨äºå¦‚æœæ¯æ¬¡ç”³è¯·çš„å†…å­˜è¾ƒå¤§ä¼šå¾ˆè€—æ—¶\nSoft-Copy å¦‚æœæ˜¯èµ‹å€¼æ“ä½œï¼Œæˆ–è€… æ‹·è´æ„é€ ï¼Œå¯ä»¥è®©ä¸¤ä¸ªå˜é‡å…±äº«åŒä¸€å—å†…å­˜ï¼ŒåŒæ—¶ç”¨è¿‡ä¸€ä¸ªå˜é‡å»è®°å½•è¯¥å—å†…å­˜çš„å¼•ç”¨æ•°é‡\nSmart-Pointers ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆçš„è¯ï¼Œå¯ä»¥åªç®¡ç”³è¯·ï¼Œä¸ç®¡é‡Šæ”¾ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨å¸®ä½ é‡Šæ”¾ï¼Œé‡Šæ”¾deleteä¼šè°ƒç”¨å¯¹åº”çš„ææ„å‡½æ•°\nstd::shared_ptr å®šä¹‰\n1 2 3 std::shared_ptr\u0026lt;æ•°æ®ç±»å‹\u0026gt; man(new æ•°æ®ç±»å‹(å‚æ•°åˆ—è¡¨));//å‚æ•°åˆ—è¡¨æ˜¯æ„é€ å‡½æ•°çš„å‚æ•°åˆ—è¡¨ std::shared_ptr\u0026lt;string\u0026gt; man(new string(\u0026#34;MAN\u0026#34;)); auto MAN = std::make_shared\u0026lt;int\u0026gt;(119); å¤šä¸ªæŒ‡é’ˆæŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¯¹è±¡ï¼Œå…±äº«\nstd::unique_ptr æŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå¯¹è±¡åï¼Œå°±ä¸å…è®¸åˆ†äº«\n1 2 3 4 5 std::unique_ptr\u0026lt;string\u0026gt; man(new string(\u0026#34;MAN\u0026#34;)); auto MAN = std::make_unique\u0026lt;int\u0026gt;(119);//C++17æ ‡å‡† std::unique_ptr\u0026lt;string\u0026gt; m3 = std::move(man);//ç§»åŠ¨è¿‡å»åï¼Œmanæˆäº†ç©ºæŒ‡é’ˆ std::unique_ptr\u0026lt;int\u0026gt; m4 = MAN ;//error How-to-Understand-Smart-Pointers æ™ºèƒ½æŒ‡é’ˆçš„å®šä¹‰ï¼Œæ˜¯æŒ‡é’ˆçš„åŒæ—¶è¿˜æ˜¯ä¸€ä¸ªå¯¹è±¡\n1 2 3 template\u0026lt;class T\u0026gt;class shared_ptr; template\u0026lt;class T,class Deleter=std::default_delete\u0026lt;T\u0026gt;\u0026gt;class unique_ptr; Class-Inheritance Improve-your-source-code åœ¨èµ‹å€¼æ“ä½œä¸Šï¼Œå¾ˆå¤šæ—¶å€™ä¸€ä¸ªä¸€ä¸ªèµ‹å€¼ä¸å¦‚memcopyç›´æ¥å°†å†…å­˜çš„å†…å®¹å¤åˆ¶è¿‡å»æ•ˆç‡é«˜ äºŒç»´æ•°ç»„æœ€å¥½ç”¨ä¸€ç»´æ•°ç»„å»è¡¨è¾¾ï¼Œå› ä¸ºè¿™æ ·ä¸ç”¨å¤šæ¬¡å»ç”³è¯·ä¸€ç»´çš„å†…å­˜ï¼Œå¤šæ¬¡ç”³è¯·çš„ä¸€ç»´æ•°æ®ä¸ä¿è¯è¿ç»­ï¼Œä¼šé™ä½è¯»å–é€Ÿç‡ ä¸€ä¸ªå‡½æ•°ï¼Œä¸€å®šè¦å»æ£€æŸ¥å‡½æ•°çš„å‚æ•°æ˜¯å¦æœ‰æ•ˆ æ³¨æ„å¤´æ–‡ä»¶é‡å¤åŒ…å«çš„é—®é¢˜ æ³¨æ„å†…å­˜å¯¹é½ å‡½æ•°çš„è¾“å…¥å‚æ•°ï¼Œä¸éœ€è¦ä¿®æ”¹çš„åŠ constå…³é”®å­— Derived-class Base class(parent)ï¼ŒDerived class(child) ä¸€ä¸ªæ˜¯åŸºç±»ï¼ˆçˆ¶ç±»ï¼‰ï¼Œä¸€ä¸ªæ˜¯æ´¾ç”Ÿç±»ï¼ˆå­ç±»ï¼‰\nå¯ä»¥å¤šå±‚ç»§æ‰¿å’Œå¤šä¸ªç»§æ‰¿\næ„é€ å‡½æ•°ä¸ææ„å‡½æ•°åœ¨å­ç±»ä¸­çš„æ‰§è¡Œ æ„é€ å‡½æ•° å­ç±»çš„æ„é€ å‡½æ•°æ‰§è¡Œçš„ç¬¬ä¸€åˆ»ï¼Œçˆ¶ç±»çš„æ„é€ å‡½æ•°å…ˆæ‰§è¡Œ\nä¸‹é¢å­ç±»çš„æ„é€ å‡½æ•°æ‰§è¡Œé¡ºåºï¼šBaseçš„æ„é€ å‡½æ•°-\u0026gt;MANçš„èµ‹å€¼-\u0026gt;æœ€åæ˜¯å­ç±»æ„é€ å‡½æ•°å†…éƒ¨\n1 2 3 4 5 6 7 class Derived :public base { public ï¼š int MAN ; Derived(int man):Base(man-1,man-2),MAN(man) { //... } }; ææ„å‡½æ•° å­ç±»çš„ææ„å‡½æ•°ä¼šå…ˆæ‰§è¡Œå­ç±»çš„ææ„å‡½æ•°ï¼Œå†æ‰§è¡Œçˆ¶ç±»çš„æ„é€ å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 class Derived :public base { public ï¼š int MAN ; Derived(int man):Base(man-1,man-2),MAN(man) { //... } ~Derived() { //... } }; Acess-Control è®¿é—®æ§åˆ¶ privateåªèƒ½ç±»å†…è®¿é—®ï¼Œprotectedå¯ä»¥åœ¨ç±»å†…å’Œå­ç±»é‡Œé¢è®¿é—®\nå…³äºç»§æ‰¿æ–¹å¼ï¼šæœ‰ä¸‰ç§ç»§æ‰¿æ–¹å¼ï¼Œpublicï¼Œprotectedï¼Œprivate Virtual-Functions è™šå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 class A{ protected: int x; public: A(){ x =1000; } virtual void print(){ //è™šå‡½æ•° cout \u0026lt;\u0026lt; \u0026#34;x=\u0026#34; \u0026lt;\u0026lt; x \u0026lt;\u0026lt; endl ; } }; class B:public A{ int y; public: B() { y=2000; } void print() { //æ´¾ç”Ÿè™šå‡½æ•° cout \u0026lt;\u0026lt; \u0026#34;y=\u0026#34; \u0026lt;\u0026lt; y \u0026lt;\u0026lt; endl ; } }; class C:public A{ int z; public: C(){ z=3000; } void print(){ //æ´¾ç”Ÿè™šå‡½æ•° cout \u0026lt;\u0026lt; \u0026#34;z=\u0026#34; \u0026lt;\u0026lt; z \u0026lt;\u0026lt; endl ; } }; void main(void ) { A a, *pa; B b; C c; a.print(); b.print(); c.print(); //ä»¥ä¸Šä¸ºé™æ€å…³è” pa=\u0026amp;a; pa-\u0026gt;print(); //è°ƒç”¨ç±»Açš„è™šå‡½æ•° pa=\u0026amp;b; pa-\u0026gt;print(); //è°ƒç”¨ç±»Bçš„è™šå‡½æ•° pa=\u0026amp;c; pa-\u0026gt;print();//è°ƒç”¨ç±»Cçš„è™šå‡½æ•° } è™šå‡½æ•°ä¸éè™šå‡½æ•°çš„ç»‘å®šä¸åŒï¼Œå¸¸è§„å‡½æ•°éƒ½æ˜¯é™æ€ç»‘å®šï¼Œè™šå‡½æ•°æ˜¯åŠ¨æ€ç»‘å®š\næœ‰è™šå‡½æ•°æ—¶ï¼Œæ­¤ç±»å®šä¹‰çš„å¯¹è±¡ä¼šæœ‰ä¸€ä¸ªéšå«çš„æˆå‘˜å˜é‡ï¼Œè¯¥éšå«å˜é‡ä¼šæŒ‡å‘ä¸€ä¸ªå‡½æ•°è¡¨\nå¯¹äºçº¯è™šå‡½æ•°ï¼Œåœ¨ç±»å†…å®šä¹‰\n1 virtual void print() = 0; æ¥å‘Šè¯‰ç¼–è¯‘å™¨è¿™æ˜¯ä¸€ä¸ªçº¯è™šå‡½æ•°ï¼Œæ‹¥æœ‰çº¯è™šå‡½æ•°çš„ç±»å°±ä¸èƒ½åˆ›å»ºå¯¹è±¡\nå¦å¤–ï¼Œææ„å‡½æ•°ä¹Ÿæ˜¯ä¸€ä¸ªè™šå‡½æ•°\nInheritance-and-dynamic-memory-allocation å¦‚æœä¸€ä¸ªå­ç±»åªæœ‰åŸºç±»æœ‰åŠ¨æ€å†…å­˜ç”³è¯·ï¼Œå°±ä¸ç”¨è€ƒè™‘å­ç±»ï¼Œåªéœ€è¦è§£å†³åŸºç±»çš„é—®é¢˜ï¼Œè‡ªå®šä¹‰å†™ æ„é€ å‡½æ•°ï¼Œèµ‹å€¼è¿ç®—ç¬¦é‡è½½ï¼Œæ‹·è´æ„é€ å‡½æ•°\nå¦‚æœå­ç±»æœ‰åŠ¨æ€å†…å­˜ç”³è¯·ï¼Œè§£å†³æ–¹æ¡ˆä¸€æ ·ï¼Œé‡æ–°æŠŠ æ„é€ å‡½æ•°ï¼Œæ‹·è´æ„é€ å‡½æ•°ï¼Œèµ‹å€¼è¿ç®—ç¬¦é‡è½½ å®šä¹‰å³å¯\nä¸‹é¢ç”¨ä¼ªä»£ç å±•ç¤º\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 class MyMap:public MyString { private: char *keyname; public: MyMap(const char *key , const char *value) {//ä¼šè‡ªåŠ¨å…ˆè°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°ï¼Œæ­¤å¤„ä¸éœ€è¦å‘åŸºç±»æ„é€ å‡½æ•°ä¼ é€’å‚æ•° //...ï¼Œä¸ºæ–°çš„æŒ‡é’ˆå˜é‡åŠ¨æ€ç”³è¯·å†…å­˜ } //ææ„å‡½æ•°å°†å­ç±»çš„æŒ‡é’ˆç”³è¯·çš„åŠ¨æ€å†…å­˜é‡Šæ”¾æ‰ MyMap(const MyMap \u0026amp;mm):MyString(mm.buf_len,mm.characters) {//ç»™åŸºç±»çš„æ„é€ å‡½æ•°ä¼ é€’å‚æ•°ï¼Œè°ƒç”¨åŸºç±»çš„æ„é€ å‡½æ•°å»ç”³è¯·å†…å­˜ //allocate memory for keyname //and hard copy from mm to *this } MyMap \u0026amp; operator=(const MyMap \u0026amp;mm) { MyString::operator=(Mys(mm));//è°ƒç”¨åŸºç±»çš„ //allocate memory for keyname //and hard copy from mm to *this return *this; } }; Class-Templates-and-Std-Library æ¨¡æ¿ååˆ†å®ç”¨ï¼Œå‰é¢æœ‰å‡½æ•°æ¨¡æ¿ï¼Œæ­¤å¤„æ˜¯ç±»æ¨¡æ¿\nå‡½æ•°æ¨¡æ¿å›é¡¾ å‡½æ•°æ¨¡æ¿ç”Ÿæˆçš„å‡½æ•°æ˜¯æ¨¡æ¿å‡½æ•°ï¼Œæ¨¡æ¿å‡½æ•°æ˜¯å‡½æ•°æ¨¡æ¿è¢«å®ä¾‹åŒ–ä»¥åç”Ÿæˆçš„\n1 2 3 4 5 6 7 8 9 template \u0026lt;typename T\u0026gt; T sum(T x , T y ) { cout \u0026lt;\u0026lt;\u0026#34;The input type is \u0026#34; \u0026lt;\u0026lt; typeid(T).name() \u0026lt;\u0026lt; endl ; return x+y ; } template double sum\u0026lt;double\u0026gt;(double,double);//å®ä¾‹åŒ– template char sum\u0026lt;\u0026gt;(char,char); template int sum(int,int); ç±»æ¨¡æ¿å’Œæ¨¡æ¿ç±»ä¹Ÿæ˜¯ç±»ä¼¼çš„\nclass-template ç±»æ¨¡æ¿çš„å®šä¹‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 template\u0026lt;typename T\u0026gt; class Mat { uint16_t rows ; uint16_t clos ; T* data ; public : Mat(uint16_t rows,uint16_t cols):rows(rows),cols(cols) { data = new T[rows*cols]{}; } ~Mat() { delete [] data; } T getElement(uint16_t r , uint16_t c);//å‡½æ•°æ¨¡æ¿ï¼Œç±»å†…å£°æ˜ bool setElement(uint16_t r , uint16_t c , T value);//å‡½æ•°æ¨¡æ¿ï¼Œç±»å†…å£°æ˜ }; //ç±»å†…å‡½æ•°æ¨¡æ¿çš„ç±»å¤–å®šä¹‰ template \u0026lt;typename T\u0026gt; T Mat\u0026lt;T\u0026gt;::getElement(uint16_t r , uint16_t c) {//getElementæ˜¯Mat\u0026lt;T\u0026gt;çš„æˆå‘˜å‡½æ•° if( r \u0026gt;= this-\u0026gt;rows || c \u0026gt;= this-\u0026gt;cols ) { cout \u0026lt;\u0026lt; \u0026#34;getElement():Indices are out of range\u0026#34; \u0026lt;\u0026lt; endl ; return 0 ; } return data[this-\u0026gt;cols*r+c]; } template \u0026lt;typename T\u0026gt; T Mat\u0026lt;T\u0026gt;::setElement(uint16_t r , uint16_t c , T value) { if( r \u0026gt;= this-\u0026gt;rows || c \u0026gt;= this-\u0026gt;cols ) { cout \u0026lt;\u0026lt; \u0026#34;setElement():Indices are out of range\u0026#34; \u0026lt;\u0026lt; endl ; return false ; } data[this-\u0026gt;cols*r+c]=value; return true ; } //æ˜¾å¼å®ä¾‹åŒ– template class Mat\u0026lt;int\u0026gt;; æ¨¡æ¿çš„å‚æ•° declare a template\n1 template \u0026lt;parameter-list\u0026gt; declaration The parameters can be\ntype template parameters(ä¾‹å¦‚intï¼Œfloat ç±»å‹) `templaate template parameters(æ¨¡æ¿ç±»å‹åšä¸ºå‚æ•°)` non-type template parameters(å®šå€¼ï¼Œfloat,intç±»å‹çš„å®šå€¼ï¼Œä¾‹å¦‚1.0fï¼Œå€¼å‚æ•°) Template-Non-Type-Parameters æ¨¡æ¿çš„éç±»å‹å‚æ•° æ­¤å¤„ç›¸å½“äºåœ¨ç¼–è¯‘æ—¶å°±è¦ç¡®å®šçŸ©é˜µæœ‰å¤šå°‘è¡Œå¤šå°‘åˆ—ï¼Œè€Œä¸æ˜¯åŠ¨æ€ç”³è¯· å› ä¸ºä¸éœ€è¦åŠ¨æ€ç”³è¯·ï¼Œä¹Ÿå°±æ²¡æœ‰å¿…è¦ææ„çš„æ—¶å€™åˆ é™¤\n1 2 3 4 5 6 7 8 template\u0026lt;typename T,uint16_t rows,uint16_t cols\u0026gt; class Mat { T data[rows][cols]; public: Mat() {} T getElement(uint16_t rows,uint16_t cols); bool setElement(uint16_t r , uint16_t c , T value); }; 1 2 3 4 Mat\u0026lt;int\u0026gt; vec1(3,3);//ä¼šåœ¨æ„é€ å‡½æ•°å†…éƒ¨åŠ¨æ€ç”³è¯·å†…å­˜ Mat\u0026lt;int,3,3\u0026gt; vec2;//ç¼–è¯‘æ—¶å°±ç¡®å®š typedef Mat\u0026lt;int,2,2\u0026gt; Mat22i;//ç®€åŒ– å¦å¤–è¡¥å……ï¼Œé™æ€æ•°ç»„çš„é»˜è®¤æ‹·è´æ„é€ ï¼Œæ˜¯ä¸€ä¸ªä¸€ä¸ªå€¼å¤åˆ¶è¿‡å»ï¼Œä¸ä¼šæœ‰å†…å­˜ç®¡ç†é—®é¢˜\næ¨¡æ¿ç±»æ˜¯å¯ä»¥ç›¸äº’ç»§æ‰¿çš„\n1 2 3 4 5 6 //ç»§æ‰¿æ¨¡æ¿ç±»ï¼Œéœ€è¦template\u0026lt;typename _Tp, int cn\u0026gt; template\u0026lt;typename _Tp, int cn\u0026gt;class Vec:public Matx\u0026lt;_Tp,cn,1\u0026gt; { publicï¼› typedef _Tp value_type; }; Class-template-specialization ç±»æ¨¡æ¿çš„ç‰¹åŒ–\nä¸€ä¸ªMyVectorçš„ç±»æ¨¡æ¿\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 template\u0026lt;typename T\u0026gt; class MyVector { uint16_t length ; T *data ; public : MyVector(uint16_t length):length(length) {//æ„é€ å‡½æ•° data = new T[length]{};//æ‰€æœ‰å…ƒç´ åˆå§‹åŒ–ä¸º0 } ~MyVector() { delete [] data ; } MyVector(const MyVector\u0026amp;)=delete;//åˆ é™¤æ‹·è´æ„é€ å‡½æ•° MyVector\u0026amp; operator=(const MyVector\u0026amp;)=delete; T getElement(uint16_t index); bool setElement(uint16_t index , T value); }; template\u0026lt;typename T\u0026gt; T MyVector\u0026lt;T\u0026gt;::getElement(uint16_t index) { //... } boolç±»å‹å˜é‡æ˜¯ä¸€ä¸ªå­—èŠ‚ï¼Œå› ä¸ºå†…å­˜ç®¡ç†åˆ é™¤ç”³è¯·çš„æœ€å°å•ä½æ˜¯ä¸€ä¸ªå­—èŠ‚ ç°åœ¨å¯¹äºä¸Šè¿°æ¨¡æ¿æƒ³ä½¿ç”¨boolï¼Œåˆæƒ³æ›´åŠ å‹ç¼©å†…å­˜ï¼Œå¯ä»¥å°†boolç±»å‹çš„æ¨¡æ¿ç‰¹åŒ–ï¼Œç‰¹æ®Šæƒ…å†µç‰¹æ®Šå¤„ç†\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 template\u0026lt;\u0026gt; class MyVector \u0026lt;bool\u0026gt; { uint16_t length ; unsigned char *data ; public : MyVector(uint16_t length):length(length) {//æ„é€ å‡½æ•° int num_bytes = (length-1)/8+1; data = new unsigned char [num_bytes]{};//æ‰€æœ‰å…ƒç´ åˆå§‹åŒ–ä¸º0 } ~MyVector() { delete [] data ; } MyVector(const MyVector\u0026amp;)=delete;//åˆ é™¤æ‹·è´æ„é€ å‡½æ•° MyVector\u0026amp; operator=(const MyVector\u0026amp;)=delete; bool getElement(uint16_t index); bool setElement(uint16_t index , bool value); }; bool MyVector\u0026lt;bool\u0026gt;::getElement(uint16_t index) { //... } std-classes std::string array\n1 2 3 template\u0026lt;class T,std::size_t N\u0026gt;struct array; std::array\u0026lt;int,3\u0026gt;a = {1,2,3}; others Error-Handling Standard-Output-Stream-and-Standard-Error-Stream æ ‡å‡†è¾“å‡ºæµä¸æ ‡å‡†é”™è¯¯æµ C\u0026amp;C++çš„è¾“å‡ºæµä¸é”™è¯¯æµ æ ‡å‡†è¾“å‡ºæµçš„å†…å®¹å¯ä»¥é€šè¿‡ç®¡é“è¾“å‡ºåˆ°å…¶ä»–æ–‡ä»¶ï¼Œè€Œæ ‡å‡†é”™è¯¯æµä¸ä¼š\né‡å®šå‘ 1 2 3 4 5 6 7 ./program | less ./program \u0026gt; output.log å°†stdoutè¾“å‡ºåˆ°output.logæ–‡ä»¶ï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨å°±é”€æ¯å†åˆ›å»ºï¼Œå†…å®¹è¦†ç›– ./program 1\u0026gt; output.log å°†stdoutè¾“å‡ºåˆ°output.logæ–‡ä»¶ ./program \u0026gt;\u0026gt; output.log å°†stdoutè¾“å‡ºåˆ°output.logæ–‡ä»¶ï¼Œå¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºï¼Œæœ‰å†…å®¹åˆ™åŠ åˆ°å·²æœ‰å†…å®¹åé¢ ./program 2\u0026gt; error.log å°†stderrè¾“å‡ºåˆ°error.logæ–‡ä»¶ ç”±æ­¤å¯ä»¥çœ‹å‡ºå…³äºæ—¥å¿—çš„é‡è¦æ€§ï¼Œä»¥åŠæ—¥å¿—æ˜¯ä»€ä¹ˆ\nassert åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œæ–¹ä¾¿debugçš„å·¥å…·\nExceptions catchï¼Œtryä¸throw\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 float ratio( float a , float b ) { if(...) throw 1; if(...) throw 2; return a+b; } try{ z = ratio(x,y); } catch(int eid) { //... } throwç›¸å½“äºæ‰”å‡ºä¸€ä¸ªå¼‚å¸¸ï¼Œå†å‡½æ•°è°ƒç”¨ä¸­ä¸€çº§ä¸€çº§å¾€ä¸Šï¼Œå¦‚æœæœ‰catchï¼Œå°±è¿›å…¥å¯¹åº”çš„catchçš„å¤„ç†ï¼Œå¦åˆ™è‹¥è¿”å›åˆ°mainå‡½æ•°ä¸­ä»æ²¡æœ‰catchï¼Œç¨‹åºå°±ä¼šè¢«æ€æ­»\n1 2 3 4 catch(...) { //è¡¨ç¤ºæ‰€æœ‰å¼‚å¸¸éƒ½èƒ½æ¥ä½ std::cerr\u0026lt;\u0026lt;\u0026#34;Unrecognized Exception\u0026#34;\u0026lt;\u0026lt;std::endl; //... } throwå¯ä»¥æ‰”ä¸€ä¸ªç±»ï¼Œstdæ ‡å‡†å¯æœ‰æä¾›std::exceptionçš„ç±»\nNested-Classes-and-RTTI Friend-Classes å¤ä¹ ä¸€ä¸‹å‹å…ƒå‡½æ•°ï¼Œæ³¨æ„æœ‰é¡ºåºé—®é¢˜\n1 2 3 4 5 6 7 8 9 10 11 class MyVector { //... public: friend MyVector operator(int m , const MyVector\u0026amp; v); }; MyVector operator+(int m , const MyVector \u0026amp;v ) { MyVector v_trmp ; //... return v_temp ; } å‹å…ƒç±»\n1 2 3 4 5 6 7 8 class Sniper { private: int bullets; public: Sniper(int bullets=0):bullets(bullets){} friend class Supplier;//ä»…ä»…æ˜¯å£°æ˜ } Friend-Member-Functions å¯ä»¥ç”¨æ¥å®ç°æœ€å°æˆæƒï¼Œå¦ä¸€ä¸ªç±»çš„æŸä¸€ä¸ªæˆå‘˜å‡½æ•°å¯ä»¥è®¿é—®\n1 2 3 4 5 6 7 8 9 10 11 12 13 class Supplier;//å…ˆå£°æ˜ class Sniper { private: int bullets; public: Sniper(int bullets=0):bullets(bullets){} friend bool Supplier::provider(Sniper \u0026amp;); } class Supplier{ //... } æ³¨æ„é¡ºåºé—®é¢˜ä»¥åŠå…ˆå£°æ˜å†å®ç°çš„å¤„ç†æ–¹æ³•\nNested-Types å†…éƒ¨ç±»å‹ï¼Œæ­¤å¤„çš„enum DataTYpeå³æ˜¯å†…éƒ¨ç±»å‹ï¼Œä½œç”¨æ˜¯è¿™ä¸ªæšä¸¾ç±»å‹ä»…Matç±»èƒ½ç”¨\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 class Mat { public: enum DataType { TYPE8U, TYPE8S, TYPE32F, TYPE64F }; private: DataType type ; void* data ; public: Mat(DataType type):type(type),data(NULL){} DataType getType() const { return type ;} }; Nested-Classes ä¸å†…éƒ¨ç±»å‹çš„ç±»ä¼¼ï¼Œä¸ç”¨è¿‡å¤šèµ˜è¿°ï¼Œè‘—éœ€è¦æ³¨æ„åœ¨ä½¿ç”¨æ—¶åŠ ä¸Šå‰ç¼€\n1 Storage::Fruit apple(\u0026#34;apple\u0026#34;,100); Runtime-Type-Identification(RTTI) è¿è¡Œæ—¶çš„ç±»å‹é‰´åˆ«\n1 2 3 4 5 6 7 8 9 10 class Person; class Student: pubic Person;//studentç±»å¯¹personç±»è¿›è¡Œäº†æ‹“å±• Person person(\u0026#34;Yu\u0026#34;); Student student(\u0026#34;MAN\u0026#34;,\u0026#34;20210212\u0026#34;); Person *pp = \u0026amp;student ;//ok Student *ps = (Student*)\u0026amp;person;//danger //ä»å†…å­˜ç®¡ç†è§’åº¦å»ç†è§£ä¼šå¾ˆç®€å•ï¼Œæœ¬è´¨è¿˜æ˜¯è®¿é—®å†…å­˜è¶Šç•Œçš„é—®é¢˜ cout \u0026lt;\u0026lt; ps-\u0026gt;getInfo() \u0026lt;\u0026lt; endl ;//å¯èƒ½ä¼šè®¿é—®ä¸è¯¥è®¿é—®çš„å†…å­˜ ä½†æ˜¯å¦‚æœgetInfoæ˜¯virtualè™šå‡½æ•°ï¼Œåˆ™ä¼šæœ‰åŠ¨æ€ç»‘å®šï¼Œä¸ä¼šå‡ºç°è®¿é—®è¶Šç•Œçš„é—®é¢˜\n1 2 3 4 5 6 dynamic_cast operator:conversion of polymorphic types. polymorphic types(å¤šæ€ç±»å‹) typeid operator:Identify the exact type of an object. å¯ä»¥ç”¨typeid()æ“ä½œç¬¦æ¥è·å–ç±»çš„åç§°\n1 2 if( typeid(std::string)==typeid(s) ) cout \u0026lt;\u0026lt; \u0026#34;s is a std::string object.\u0026#34; \u0026lt;\u0026lt; endl ; ä½¿ç”¨dynamic_castè½¬æ¢ï¼ˆä»…å¤šæ€ç±»å‹ä½¿ç”¨ï¼‰ å¤šæ€ç±»å‹çš„ç±»é‡Œé¢éœ€è¦æœ‰virtual\n1 2 3 4 5 6 7 8 9 10 11 class Person; class Student: pubic Person;//studentç±»å¯¹personç±»è¿›è¡Œäº†æ‹“å±• Person person(\u0026#34;Yu\u0026#34;); Student student(\u0026#34;MAN\u0026#34;,\u0026#34;20210212\u0026#34;); Person *pp = NULL ; Student *ps = NULL ; ps = dynamic_cast\u0026lt;Student*\u0026gt;(\u0026amp;person);//ä¸ä¼šè¿›è¡Œè½¬æ¢ï¼Œè½¬æ¢å¤±è´¥ï¼Œps=NULLï¼Œæ›´å®‰å…¨ pp = dynamic_cast\u0026lt;Person*\u0026gt;(\u0026amp;student); More-Type-Cast-Operations const_cast:Type cast for const or volatile value .\nstatic_cast:å¦‚æœä¸¤ç±»å‹èƒ½å¤Ÿéšå¼è½¬æ¢ï¼Œåˆ™å‘ç”Ÿè½¬æ¢ï¼Œå¦åˆ™ä¸èƒ½è½¬\n1 2 3 Base *pB = static_cast\u0026lt;Base*\u0026gt;(derived);//valid Derived *pD = static_cast\u0026lt;Derived*\u0026gt;(base);//valid UnRelated *pU = static_cast\u0026lt;UnRelated*\u0026gt;(base);//invalid reinterpret_cast:Converts between types by reinterpreting the underlying bit pattern.\n1 2 3 int i = 18; float *p1 = reinterpret_cast\u0026lt;float *\u0026gt;(i);//static_cast will fail int *p2 = reinterpret_cast\u0026lt;int *\u0026gt;(p1); Code-Optimization Register-and-Cache ä¸‰çº§ï¼ŒRegister,Cache,Memory ä¸€èˆ¬é€šè¿‡Latencyå»¶è¿Ÿ,Bandwidthå¸¦å®½è¿™ä¸¤ä¸ªæŒ‡æ ‡æ¥è¡¡é‡\nåœ¨è®¿é—®å†…å­˜ä¸­è¿ç»­æ•°æ®çš„æƒ…å†µä¸‹ï¼Œè®¿é—®é€Ÿåº¦ä¼šæ›´å¿« ç°ä»£å¤šæ ¸çš„CPUåœ¨ç¼“å†²åŒºçš„è®¾ç½®ä¸Šä¼šæ›´å¤æ‚ï¼Œä¼šåˆ†ä¸ºä¸“é—¨å­˜æ”¾æŒ‡ä»¤çš„åŒºåŸŸå’Œä¸“é—¨å­˜æ”¾æ•°æ®çš„åŒºåŸŸï¼ŒåŒæ—¶å¤šæ ¸ä¼šæœ‰å…±äº«çš„ç¼“å­˜åŒº\nLocality-of-Reference å±€éƒ¨æ€§ä¸»è¦æœ‰æ—¶é—´å±€éƒ¨æ€§å’Œç©ºé—´å±€éƒ¨æ€§ï¼Œå±€éƒ¨æ€§æ˜¯è§‚å¯Ÿç¨‹åºçš„è¿è¡Œå¾—å‡ºçš„ æ—¶é—´å±€éƒ¨æ€§æ˜¯æŒ‡åŒä¸€å—å†…å­˜åœ¨ä¸€ä¸¤ä¸ªæŒ‡ä»¤å‘¨æœŸåå¾ˆæœ‰å¯èƒ½ä¼šè¢«å†æ¬¡è®¿é—® ç©ºé—´å±€éƒ¨æ€§æ˜¯æŒ‡è¢«è®¿é—®çš„ä¸€å—å†…å­˜ï¼Œå…¶å‘¨å›´ä¹Ÿä¼šå¾ˆæœ‰å¯èƒ½è¢«è®¿é—®\nè®¡ç®—CPUä¼˜åŒ–æ•ˆç‡ Peak_FLOPS=2*Frequency*cores*æ¯å‘¨æœŸå‘é€çš„æŒ‡ä»¤*(æŒ‡ä»¤å®½åº¦/æ•°æ®å®½åº¦)\n3GHzï¼Œ24æ ¸ï¼Œæ¯å‘¨æœŸå‘é€2æŒ‡ä»¤ï¼ŒæŒ‡ä»¤å®½åº¦512æ¯”ç‰¹ å‡è®¾ç®—çš„æ˜¯doubleï¼ˆ64æ¯”ç‰¹ï¼‰\nFLOPS=2*3G*24*2*(512/64)\næœ‰æ•ˆfloating opè®¡ç®— Matrix Aæ˜¯m*kï¼ŒMatrix Bæ˜¯k*nï¼ŒMatrix Cæ˜¯m*n Effected floating op = 2*m*k*n\nè¡¡é‡ä¼˜åŒ–æ•ˆç‡ Efficiency=Eddected_Performance/Peak_Performance\nä¸ªäººçš„è¡¥å……ä¸æ€»ç»“ å…³äºInclude 1 2 include \u0026lt;\u0026gt;//ä»ç¼–è¯‘å™¨æŒ‡å®šçš„è·¯å¾„å»æ‰¾ include \u0026#34;\u0026#34;//ä»ç¼–è¯‘å™¨æŒ‡å®šçš„è·¯å¾„å»æ‰¾ä»¥åŠå½“å‰.cppæ–‡ä»¶æ‰€åœ¨ç›®å½•å»æ‰¾ å…³äºç±» ç±»å†…æˆå‘˜å‡½æ•°å¯åœ¨ç±»å†…å®šä¹‰ï¼ˆé»˜è®¤å†…è”ï¼‰ æˆ–ç±»å¤–å®šä¹‰ å…³äºæ¨¡æ¿ c++æ¨¡æ¿ç¼–ç¨‹åº”è¯¥æŠŠå®ç°æ”¾åœ¨å¤´æ–‡ä»¶ä¸­å—ï¼Œè¿™æ ·å†™ä¼šä¸ä¼šè®©å¤´æ–‡ä»¶å˜å¾—å¾ˆéš¾çœ‹ï¼Ÿ - çŸ¥ä¹ å€Ÿç”¨å…¶ä¸­çš„ä¸€ä¸ªå›ç­”\nç†è®ºä¸Šï¼Œæ¨¡æ¿å‡½æ•°çš„å®ç°åº”è¯¥æ”¾åœ¨å¤´æ–‡ä»¶é‡Œï¼Œè¿™æ˜¯å› ä¸º C++ ç»§æ‰¿äº† C è¯­è¨€å…ˆåˆ†ç¦»ç¼–è¯‘æœ€åé“¾æ¥çš„ä¼ ç»Ÿï¼Œè€Œæ¨¡æ¿çš„å®ä¾‹åŒ–åœ¨ç¼–è¯‘æœŸï¼Œæ‰€ä»¥å¿…é¡»è¦è®©ç¼–è¯‘å™¨çœ‹åˆ°å‡½æ•°çš„å®ç°ï¼Œæ‰èƒ½å®ä¾‹åŒ–\nè¿™é‡Œä»åŸç†ä¸Šæ¥çœ‹å°±çŸ¥é“æ¨¡æ¿çš„å£°æ˜å’Œå®šä¹‰ï¼ˆå®ç°ï¼‰åº”è¯¥éƒ½æ”¾åœ¨å¤´æ–‡ä»¶ä¸­äº†ï¼Œä¸ç„¶åœ¨ç¼–è¯‘æœŸå¼•ç”¨äº†æ¨¡æ¿å®ä¾‹åŒ–çš„æºæ–‡ä»¶ä¼šæ— æ³•æ­£å¸¸ç¼–è¯‘ï¼Œä¹Ÿå°±æ˜¯æ— æ³•æ­£å¸¸ç”Ÿæˆå®ä¾‹åŒ–çš„æ¨¡æ¿å‡½æ•°ï¼Œç±»æ¨¡æ¿åŒç†\nè¯¦è§£å¦‚ä¸‹ C++ä¸­æ¨¡æ¿ä»¥åŠæ¨¡æ¿å®ä¾‹åŒ–éƒ½æ”¾åœ¨å¤´æ–‡ä»¶_æ¨¡æ¿ç‰¹åŒ–èƒ½æ”¾åˆ°cppæ–‡ä»¶å—-CSDNåšå®¢\nå…³äºå…¨ç‰¹åŒ–ï¼Œå‡½æ•°æ¨¡æ¿çš„ç‰¹åŒ–ç‰ˆæœ¬æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå…·ä½“çš„å‡½æ•°ï¼ˆä¸å†æ˜¯æ¨¡æ¿ï¼‰ï¼Œä½†ç”±äºå®ƒä¸é€šç”¨æ¨¡æ¿å­˜åœ¨å…³è”ï¼Œå®è·µä¸­å‡ ä¹éƒ½æ”¾åœ¨å¤´æ–‡ä»¶ä¸­\nç±»æ¨¡æ¿ç‰¹ä¾‹åŒ–çš„åŒæ ·è§„åˆ™ï¼Œç±»æ¨¡æ¿çš„å…¨ç‰¹åŒ–å’Œéƒ¨åˆ†ç‰¹åŒ–ä¹Ÿå»ºè®®æ”¾åœ¨å¤´æ–‡ä»¶ä¸­\nåŸå› å¦‚ä¸‹\né¿å…éšå¼å®ä¾‹åŒ–å†²çª\nå½“ç¼–è¯‘å™¨å¤„ç†æ¨¡æ¿å®ä¾‹åŒ–æ—¶ï¼Œå¦‚æœåœ¨æŸä¸ªç¼–è¯‘å•å…ƒä¸­çœ‹ä¸åˆ°ç‰¹åŒ–ç‰ˆæœ¬çš„å£°æ˜ï¼Œä¼šè‡ªåŠ¨å®ä¾‹åŒ–é€šç”¨æ¨¡æ¿ã€‚è‹¥æ­¤æ—¶å…¶ä»–ç¼–è¯‘å•å…ƒå­˜åœ¨ç‰¹åŒ–ç‰ˆæœ¬çš„å®ç°ï¼Œä¼šå¯¼è‡´é“¾æ¥æ—¶å‡ºç° â€œå¤šé‡å®šä¹‰â€ é”™è¯¯ 1 2 3 4 5 6 7 8 9 10 11 // å¤´æ–‡ä»¶ï¼ˆfunc.hï¼‰ template\u0026lt;typename T\u0026gt; void print(T value) { // é€šç”¨æ¨¡æ¿ std::cout \u0026lt;\u0026lt; value; } // ç‰¹åŒ–ç‰ˆæœ¬æ”¾åœ¨å¤´æ–‡ä»¶ï¼Œç¡®ä¿æ‰€æœ‰ä½¿ç”¨å¤„å¯è§ template\u0026lt;\u0026gt; void print\u0026lt;const char*\u0026gt;(const char* str) { std::cout \u0026lt;\u0026lt; \u0026#34;String: \u0026#34; \u0026lt;\u0026lt; str; } ç¬¦åˆæ¨¡æ¿ä½¿ç”¨ä¹ æƒ¯\næ¨¡æ¿ï¼ˆåŒ…æ‹¬ç‰¹åŒ–ï¼‰çš„ä½¿ç”¨è€…é€šå¸¸ä¼šé€šè¿‡å¤´æ–‡ä»¶è·å–å®Œæ•´å®šä¹‰ï¼Œæ— éœ€å…³å¿ƒå®ç°æ–‡ä»¶çš„é“¾æ¥ç»†èŠ‚ã€‚å°†ç‰¹åŒ–æ”¾åœ¨å¤´æ–‡ä»¶ä¸­ï¼Œèƒ½è®©ä»£ç ç»“æ„æ›´æ¸…æ™°ï¼Œå‡å°‘å¤–éƒ¨ä¾èµ– ç±»æ¨¡æ¿å’Œå‡½æ•°æ¨¡æ¿çš„ä¾‹å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 // 1. åŸºæœ¬å‡½æ•°æ¨¡æ¿ template\u0026lt;typename T\u0026gt; T max(T a, T b) { return a \u0026gt; b ? a : b; } // 2. å‡½æ•°æ¨¡æ¿ç‰¹åŒ–ï¼ˆé’ˆå¯¹ç‰¹å®šç±»å‹ï¼‰ template\u0026lt;\u0026gt; const char* max\u0026lt;const char*\u0026gt;(const char* a, const char* b) { return strcmp(a, b) \u0026gt; 0 ? a : b; } // ä½¿ç”¨ int i = max(3, 5); // éšå¼å®ä¾‹åŒ–intç‰ˆæœ¬ const char* s = max(\u0026#34;apple\u0026#34;, \u0026#34;banana\u0026#34;); // è°ƒç”¨ç‰¹åŒ–ç‰ˆæœ¬ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 // 1. åŸºæœ¬ç±»æ¨¡æ¿ template\u0026lt;typename T, int Size\u0026gt; class Array { private: T data[Size]; public: Array() {} T\u0026amp; operator[](int index) { return data[index]; } int getSize() const { return Size; } }; // 2. ç±»æ¨¡æ¿ç‰¹åŒ–ï¼ˆé’ˆå¯¹boolç±»å‹ä¼˜åŒ–ï¼‰ template\u0026lt;int Size\u0026gt; class Array\u0026lt;bool, Size\u0026gt; { private: unsigned char data[(Size + 7) / 8]; // ä½å‹ç¼©å­˜å‚¨ public: bool get(int index) const { return (data[index / 8] \u0026gt;\u0026gt; (index % 8)) \u0026amp; 1; } }; // ä½¿ç”¨ Array\u0026lt;int, 10\u0026gt; intArray; // å®ä¾‹åŒ–intç±»å‹æ•°ç»„ Array\u0026lt;bool, 100\u0026gt; boolArray; // ä½¿ç”¨ç‰¹åŒ–ç‰ˆæœ¬ ","date":"2025-09-17T17:31:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/cc-%E7%B3%BB%E7%BB%9F%E5%AD%A6%E4%B9%A0/","title":"C\u0026C++ ç³»ç»Ÿå­¦ä¹ "},{"content":"å¼•è¨€ é‡è½½çš„æœ¬è´¨ é‡è½½ï¼ˆoverloadingï¼‰æ˜¯åŒä¸€ç¬¦å·åœ¨ä¸åŒä½œç”¨åŸŸçš„ä¸åŒåº”ç”¨æ¡ä»¶ä¸‹å…·æœ‰ä¸åŒçš„è¯­ä¹‰ã€‚è¿™ä¸ªç¬¦å·å¯ä»¥æ˜¯å‡½æ•°ï¼Œè¿ç®—ç¬¦ï¼Œä¹Ÿå°±æ˜¯ä¸€ç‰©å¤šç”¨\nå‡½æ•°é‡è½½ å‡½æ•°é‡è½½ï¼šå®šä¹‰åŒåä½†å‚æ•°ç±»å‹ä¸æ•°é‡ä¸åŒçš„å‡½æ•°ï¼Œç¼–è¯‘ç³»ç»Ÿæ ¹å‚æ•°çš„åŒ¹é…è§„åˆ™æ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°\nå‰ç½®å†…å®¹ï¼ˆå¸¦ç¼ºçœå€¼çš„å‡½æ•°ï¼‰ å¸¦ç¼ºçœå€¼çš„å‡½æ•° å‡½æ•°åœ¨è¯´æ˜æˆ–å‡½æ•°å®šä¹‰ä¸­ï¼Œå½¢å‚æŒ‡å®šäº†ä¸€ä¸ªæ•°å€¼ï¼Œåˆ™ç§°æ­¤å‡½æ•°ä¸ºå¸¦ç¼ºçœå€¼çš„å‡½æ•°ï¼ŒæŒ‡å®šçš„å€¼ç§°ä¸ºç¼ºçœå€¼\nExample 1 2 3 //å¸¦ç¼ºçœå€¼çš„å‡½æ•°å£°æ˜ï¼š float area(float r=6.5) //6.5å°±æ˜¯ç¼ºçœå€¼ åœ¨è°ƒç”¨æ—¶ï¼Œå¦‚æœä¸ä¼ å‚æ•°ï¼Œä½¿ç”¨é»˜è®¤å€¼ï¼Œå°±ä¼šé»˜è®¤å½¢å‚ç­‰äºç¼ºçœå€¼\n1 area();//é»˜è®¤ r=6.5 ä¸ä½¿ç”¨é»˜è®¤å€¼\n1 area(7.5);// r=7.5 å¸¦å¤šä¸ªç¼ºçœå‚æ•°çš„å‡½æ•° å¦‚æœå‡½æ•°æœ‰å¤šä¸ªç¼ºçœå‚æ•°ï¼Œåˆ™ç¼ºçœå‚æ•°å¿…é¡»æ˜¯ ä»å³å‘å·¦å®šä¹‰ï¼Œå¹¶ä¸”åœ¨ä¸€ä¸ªç¼ºçœå‚æ•°çš„å³è¾¹ä¸èƒ½æœ‰ æœªæŒ‡å®šç¼ºçœå€¼çš„å‚æ•°ã€‚(ç¼ºçœå€¼é›†ä¸­åœ¨å‚æ•°è¡¨å³ä¾§)\n1 2 void f1( float a , int b=6 , int c , char d=\u0026#39;a\u0026#39; );//é”™è¯¯å®šä¹‰ void f2( float a , int c , int b=6 , char d=\u0026#39;a\u0026#39; );//æ­£ç¡®å®šä¹‰ è°ƒç”¨å½¢å¼å¯ä»¥ä¸ºï¼š\n1 2 3 f2( 3.5 , 5 , 3 , \u0026#39;x\u0026#39; ); f2( 3.5 , 5 , 3 ); f2( 3.5 , 5 ); ä¸å¸¦ç¼ºçœçš„å¾—å‡½æ•°é‡è½½ å‡½æ•°é‡è½½ï¼šå®šä¹‰åŒåä½†å‚æ•°ç±»å‹ä¸æ•°é‡ä¸åŒçš„å‡½æ•°ï¼Œç¼–è¯‘ç³»ç»Ÿæ ¹æ®å‚æ•°çš„åŒ¹é…è§„åˆ™æ¥æ¥å†³å®šè°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°\n1 2 3 4 5 6 7 8 9 int max( int a , int b , int c ) { ... } int max( int a , int b ) { ... } double max(double a , double b ) { ... } æ³¨æ„ï¼šä¸èƒ½å‡ºç°å‡½æ•°å‚æ•°ä¸ªæ•°ï¼Œå‚æ•°ç±»å‹éƒ½ç›¸åŒï¼Œåªæœ‰å‡½æ•°è¿”å›å€¼ä¸åŒçš„åŒåå‡½æ•°ã€‚ å› ä¸ºç³»ç»Ÿå°†æ— æ³•ä»è°ƒç”¨å½¢å¼ä¸Šåˆ¤æ–­è°ƒç”¨å“ªä¸ªå‡½æ•°\n1 2 3 4 5 6 int max( int a , int b ) { ... } bool max( int a , int b ) { ... } å¸¦ç¼ºçœå€¼çš„å‡½æ•°é‡è½½ ä¸€èˆ¬å¸¦ç¼ºçœå€¼çš„å‡½æ•°ä¸èƒ½è¿›è¡Œé‡è½½ï¼Œå®¹æ˜“å‡ºç°é”™è¯¯ é”™è¯¯å®ä¾‹ï¼š\n1 2 3 4 5 6 7 8 9 10 int max( int a , int b , int c=1 ) { ... } int max( int a , int b ) { ... } int main() { max(1,2) ; } æ­¤æ—¶ç³»ç»Ÿæ— æ³•åŒ¹é…æ­£ç¡®çš„å‡½æ•°ï¼Œä¸èƒ½å®ç°å‡½æ•°é‡è½½ï¼ˆé™æ€å¤šæ€ï¼‰\nä¸€ä¸ªå‡½æ•°ä¸èƒ½å³ä½œä¸ºé‡è½½å‡½æ•°ï¼Œåˆ ä½œä¸ºæœ‰é»˜è®¤å‚æ•°çš„å‡½æ•°ï¼ ï¼ˆè¿™æ˜¯ä¸€ä¸ªå»ºè®®ï¼Œå…¶å®å¹¶ä¸ç»å¯¹ï¼Œåªè¦è®©ç³»ç»Ÿèƒ½åŒ¹é…åˆ°å”¯ä¸€çš„å‡½æ•°å°±è¡Œï¼‰\nè¿ç®—ç¬¦é‡è½½ å‰ç½®å†…å®¹ï¼ˆC++ ç±»ä¸å¯¹è±¡ï¼‰\nè¿ç®—ç¬¦é‡è½½æœ¬è´¨ä¸Šæ˜¯å‡½æ•°é‡è½½ï¼Œå°†æŒ‡å®šçš„è¿ç®—è¡¨è¾¾å¼è½¬åŒ–ä¸ºå¯¹è¿ç®—ç¬¦å‡½æ•°çš„è°ƒç”¨ï¼Œè¿ç®—å¯¹è±¡è½¬åŒ–ä¸ºè¿ç®—ç¬¦å‡½æ•°çš„å®å‚ï¼ˆçœ‹ä¸ªä¹å‘µå°±è¡Œï¼‰\nä¸ºä»€ä¹ˆéœ€è¦è¿ç®—ç¬¦é‡è½½ C++ä¸­é¢„å®šä¹‰çš„è¿ç®—ç¬¦å…¶è¿ç®—å¯¹è±¡åªèƒ½æ˜¯åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€Œä¸é€‚ç”¨äºç”¨æˆ·è‡ªå®šä¹‰ç±»å‹ã€‚è¿ç®—ç¬¦é‡è½½å…è®¸æŠŠC++æ ‡å‡†è¿ç®—ç¬¦åº”ç”¨äºè‡ªå®šä¹‰æ•°æ®ç±»å‹çš„å¯¹è±¡ï¼Œä¸å‡½æ•°é‡è½½ç±»ä¼¼ï¼Œå¯¹å·²æœ‰çš„è¿ç®—ç¬¦èµ‹äºˆæ–°çš„å«ä¹‰ï¼Œç”¨ä¸€ä¸ªè¿ç®—ç¬¦è¡¨ç¤ºä¸åŒåŠŸèƒ½çš„è¿ç®—ï¼Œ è¿™å°±æ˜¯è¿ç®—ç¬¦é‡è½½\nè¿ç®—ç¬¦é‡è½½çš„ä¾‹å­ ç±»çš„å®šä¹‰\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 class complex { public: complex();//é»˜è®¤æ„é€ å‡½æ•° complex(double,double);//åˆå§‹åŒ–æ„é€ å‡½æ•° complex(double);//å¼ºåˆ¶è½¬æ¢æ„é€ å‡½æ•° //*****************************************************// //ä¸‹é¢æ˜¯äºŒé€‰ä¸€ complex operator + (complex\u0026amp;);//è¿ç®—ç¬¦é‡è½½æˆå‘˜å‡½æ•°å®ç° complex operator - (complex\u0026amp;);//è¿ç®—ç¬¦é‡è½½æˆå‘˜å‡½æ•°å®ç° friend complex operator + (complex\u0026amp;,complex\u0026amp;);//å‹å…ƒå‡½æ•°å®ç° friend complex operator - (complex\u0026amp;,complex\u0026amp;);//å‹å…ƒå‡½æ•°å®ç° //****************************************************// friend istream\u0026amp; operator \u0026gt;\u0026gt; (istream\u0026amp; , complex\u0026amp;);//istreamç±»\u0026gt;\u0026gt;è¿ç®—ç¬¦é‡è½½ friend ostream\u0026amp; operator \u0026lt;\u0026lt; (ostream\u0026amp; , complex\u0026amp;);//ostreamç±»\u0026lt;\u0026lt;è¿ç®—ç¬¦é‡è½½ private: double real , imag ; }; æˆå‘˜å‡½æ•°é‡è½½è¿ç®—ç¬¦ éšå«thisæŒ‡é’ˆï¼Œå·¦ä¾§è‡ªå®šä¹‰ç±»å‹\n1 c3 = c1+c2 ; ç¿»è¯‘ä¸º\n1 c3 = c1.operator+(c2); å‚æ•°ä¸ªæ•°=åŸæ“ä½œæ•°ä¸ªæ•°-1ï¼ˆåç½®++ã€\u0026ndash;é™¤å¤–ï¼‰\næ¨¡æ¿ 1 2 3 æ•°æ®ç±»å‹(è¿”å›å€¼ç±»å‹) ç±»å(åŸŸ)::operator è¿ç®—ç¬¦( å½¢å‚è¡¨ ) { é‡è½½å¤„ç† } å…·ä½“ä¾‹å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 complex complex::operator + (const complex \u0026amp;c1) { complex c2 ; c2.real = real+c1.real ; c2.imag = imag+c1.imag ; return c2 ; } complex complex::operator - (const complex \u0026amp;c1) { complex c2 ; c2.real = real-c1.real ; c2.imag = imag-c1.imag ; return c2 ; } å‹å…ƒå‡½æ•°é‡è½½è¿ç®—ç¬¦ 1 c3 = c1 + c2 ; ç¿»è¯‘ä¸º\n1 c3 = operator+(c1,c2);//å‹å…ƒå‡½æ•° å‚æ•°ä¸ªæ•°=åŸæ“ä½œæ•°ä¸ªæ•° (è‡³å°‘æœ‰ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å½¢å‚)\næ¨¡æ¿ 1 2 3 friend æ•°æ®ç±»å‹(è¿”å›å€¼ç±»å‹) ç±»å(åŸŸ):: operator è¿ç®—ç¬¦( å½¢å‚è¡¨ ) { é‡è½½å¤„ç† } å…·ä½“ä¾‹å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 complex complex::operator + (const complex \u0026amp;c1 , const complex \u0026amp;c2) { complex c ; c.real = c2.real+c1.real ; c.imag = c2.imag+c1.imag ; return c ; } complex complex::operator - (const complex \u0026amp;c1 , const complex \u0026amp;c2) { complex c ; c.real = c1.real-c2.real ;ã€ c.imag = c1.imag-c2.imag ; return c ; } é‡è½½\u0026laquo;å’Œ\u0026raquo;è¿ç®—ç¬¦ \u0026laquo;é‡è½½å‡½æ•°å’Œ\u0026raquo;é‡è½½å‡½æ•°åªèƒ½å®šä¹‰ä¸ºå‹å…ƒå‡½æ•°ï¼Œä¸èƒ½å®šä¹‰ä¸ºæˆå‘˜å‡½æ•°ï¼Œ å› ä¸º\u0026laquo;å’Œ\u0026raquo;è¿ç®—ç¬¦æœ‰ä¸¤ä¸ªå½¢å‚ï¼Œå¹¶ä¸”ç¬¬ä¸€ä¸ªå½¢å‚ä¸æ˜¯è‡ªå®šä¹‰ç±»å‹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 //ç±»ä¸­çš„å‹å…ƒå‡½æ•°å®šä¹‰ //***********************************// friend istream\u0026amp; operator \u0026gt;\u0026gt; (istream\u0026amp; , complex\u0026amp;);//istreamç±»\u0026gt;\u0026gt;è¿ç®—ç¬¦é‡è½½ friend ostream\u0026amp; operator \u0026lt;\u0026lt; (ostream\u0026amp; , complex\u0026amp;);//ostreamç±»\u0026lt;\u0026lt;è¿ç®—ç¬¦é‡è½½ //***********************************// //å¤æ•°çš„è‡ªå®šä¹‰è¾“å…¥è¾“å‡º istream\u0026amp; operator \u0026gt;\u0026gt; (istream\u0026amp; input , complex\u0026amp;c ) { input \u0026gt;\u0026gt; c.real \u0026gt;\u0026gt; c.imag ; return input ; } ostream\u0026amp; operator \u0026lt;\u0026lt; (ostream\u0026amp; output , complex\u0026amp;c ) { output \u0026lt;\u0026lt; c.real \u0026lt;\u0026lt; \u0026#39;+\u0026#39; \u0026lt;\u0026lt; c.imag \u0026lt;\u0026lt; \u0026#39;i\u0026#39; \u0026lt;\u0026lt; endl ; return output ; } é‡è½½å•ç›®è¿ç®—ç¬¦ æˆå‘˜å‡½æ•°é‡è½½ å‰ç½®++\n1 2 //å‰ç½® complex operator ++(); åç½®++\n1 2 3 //åç½® complex operator ++(int); //å¦‚æœåœ¨å½¢å‚ä¸­æ·»åŠ intå ä½å‚æ•°ï¼Œç¼–è¯‘å™¨ä¼šè¯†åˆ«å‡ºè¿™æ˜¯åç½®++ å‹å…ƒå‡½æ•°é‡è½½ å‰ç½®++\n1 2 //å‰ç½® friend complex operator ++ (complex); åç½®++\n1 friend complex operator ++ (complex,int); è¿ç®—ç¬¦é‡è½½çš„è§„åˆ™ï¼ˆçœ‹ä¸ªä¹å‘µå°±è¡Œï¼‰ â€¢ è¿ç®—ç¬¦é‡è½½ä¸å…è®¸å‘æ˜æ–°çš„è¿ç®—ç¬¦ã€‚å¦‚@ â€¢ ä¸èƒ½æ”¹å˜è¿ç®—ç¬¦æ“ä½œå¯¹è±¡çš„ä¸ªæ•°ï¼Œå¦‚+æ˜¯åŒç›®è¿ç®— â€¢ è¿ç®—ç¬¦è¢«é‡è½½åï¼Œä¼˜å…ˆçº§å’Œç»“åˆæ€§ä¸ä¼šæ”¹å˜ â€¢ ç»é‡è½½çš„è¿ç®—ç¬¦è‡³å°‘æœ‰ä¸€ä¸ªå‚æ•°ä¸ºè‡ªå®šä¹‰ç±»å‹ï¼Œå¦åˆ™ç³» ç»Ÿå·²ç»å®ç°\nè¿ç®—ç¬¦é‡è½½çš„å®ç°å½¢å¼ è¿ç®—ç¬¦é‡è½½å‡½æ•°å¯ä»¥å£°æ˜ä¸º ç±»æˆå‘˜å‡½æ•° ä¹Ÿå¯ä»¥æ˜¯ ç±»çš„å‹å…ƒå‡½æ•° ï¼Œè¿˜å¯ä»¥æ˜¯ æ™®é€šå‡½æ•°\næ¨èä½¿ç”¨æˆå‘˜å‡½æ•°æˆ–æ˜¯å‹å…ƒå‡½æ•°å®ç° ï¼ˆä¸»è¦å› ä¸ºç§æœ‰æˆå‘˜çš„è®¿é—®é—®é¢˜ï¼‰ å®ç°è¿ç®—ç¬¦é‡è½½çš„æ–¹å¼\u0026mdash;\u0026mdash;æ—¢ç„¶æ˜¯æ“ä½œç¬¦é‡è½½ï¼Œä¸€èˆ¬ä¼šè®¿é—®ç±»çš„ç§æœ‰æˆå‘˜å˜é‡ï¼Œæ ¹æ®ç±»çš„å°è£…æ€§è¦æ±‚ï¼Œé™¤äº†å‹å…ƒå‡½æ•°å¤–ï¼Œå…¶ä»–ä»»ä½•å¤–éƒ¨æ“ä½œéƒ½æ˜¯è¿è§„çš„ï¼Œæ‰€ä»¥ä¸æ¨èç”¨ æ™®é€šå‡½æ•° æ¥é‡è½½æ“ä½œç¬¦\n","date":"2025-09-04T10:13:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E9%87%8D%E8%BD%BD/","title":"C++ é‡è½½"},{"content":"C++ å¼•ç”¨ | èœé¸Ÿæ•™ç¨‹\nä»€ä¹ˆæ˜¯å¼•ç”¨ å¼•ç”¨å˜é‡æ˜¯ä¸€ä¸ªåˆ«åï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒæ˜¯æŸä¸ªå·²å­˜åœ¨å˜é‡çš„å¦ä¸€ä¸ªåå­— ä¸€æ—¦æŠŠå¼•ç”¨åˆå§‹åŒ–ä¸ºæŸä¸ªå˜é‡ï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥å¼•ç”¨åç§°æˆ–å˜é‡åç§°æ¥æŒ‡å‘å˜é‡ å¼•ç”¨å¿…é¡»åœ¨å®šä¹‰æ—¶åˆå§‹åŒ–ï¼Œå¹¶ä¸”ä¸€æ—¦ç»‘å®šåˆ°ä¸€ä¸ªå˜é‡åï¼Œå°±ä¸èƒ½å†ç»‘å®šåˆ°å…¶ä»–å˜é‡\n1 2 int a = 10; int \u0026amp;ref = a; // ref æ˜¯ a çš„å¼•ç”¨ è§£é‡Šï¼š\nint \u0026amp;refÂ è¡¨ç¤ºÂ refÂ æ˜¯ä¸€ä¸ªÂ intÂ ç±»å‹çš„å¼•ç”¨ refÂ æ˜¯Â aÂ çš„åˆ«åï¼Œå¯¹Â refÂ çš„æ“ä½œä¼šç›´æ¥ä½œç”¨äºÂ a å¼•ç”¨ä¸æŒ‡é’ˆ å¼•ç”¨å¾ˆå®¹æ˜“ä¸æŒ‡é’ˆæ··æ·†ï¼Œå®ƒä»¬ä¹‹é—´æœ‰ä¸‰ä¸ªä¸»è¦çš„ä¸åŒï¼š\nä¸å­˜åœ¨ç©ºå¼•ç”¨ï¼Œå¼•ç”¨å¿…é¡»è¿æ¥åˆ°ä¸€å—åˆæ³•çš„å†…å­˜ã€‚ ä¸€æ—¦å¼•ç”¨è¢«åˆå§‹åŒ–ä¸ºä¸€ä¸ªå¯¹è±¡ï¼Œå°±ä¸èƒ½è¢«æŒ‡å‘åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚æŒ‡é’ˆå¯ä»¥åœ¨ä»»ä½•æ—¶å€™æŒ‡å‘åˆ°å¦ä¸€ä¸ªå¯¹è±¡ã€‚ å¼•ç”¨å¿…é¡»åœ¨åˆ›å»ºæ—¶è¢«åˆå§‹åŒ–ã€‚æŒ‡é’ˆå¯ä»¥åœ¨ä»»ä½•æ—¶é—´è¢«åˆå§‹åŒ–ã€‚ å¼•ç”¨çš„å¯¹è±¡å¿…é¡»æ˜¯ä¸€ä¸ªå˜é‡ï¼Œè€ŒæŒ‡é’ˆå¿…é¡»æ˜¯ä¸€ä¸ªåœ°å€ã€‚ ç‰¹æ€§ å¼•ç”¨ æŒ‡é’ˆ å®šä¹‰ä¸åˆå§‹åŒ– å¿…é¡»åˆå§‹åŒ–ï¼Œä¸”ä¸èƒ½ä¸ºÂ nullã€‚ å¯ä»¥ä¸åˆå§‹åŒ–ï¼Œå¯ä»¥åœ¨åç»­ä»£ç ä¸­æŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œå¯ä»¥ä¸ºÂ nullã€‚ è¯­æ³• ä½¿ç”¨Â \u0026amp;Â å£°æ˜ï¼Œä¾‹å¦‚ï¼šint \u0026amp;ref = a; ä½¿ç”¨Â *Â å£°æ˜ï¼Œä¾‹å¦‚ï¼šint *ptr = \u0026amp;a; é‡æ–°ç»‘å®š ä¸èƒ½é‡æ–°ç»‘å®šï¼Œä¸€æ—¦åˆå§‹åŒ–åå§‹ç»ˆå¼•ç”¨åŒä¸€ä¸ªå¯¹è±¡ã€‚ å¯ä»¥é‡æ–°æŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œä¾‹å¦‚ï¼šptr = \u0026amp;b; ç©ºå€¼ï¼ˆNullabilityï¼‰ ä¸èƒ½ä¸ºÂ nullï¼Œå¿…é¡»ç»‘å®šåˆ°æœ‰æ•ˆçš„å¯¹è±¡ã€‚ å¯ä»¥ä¸ºÂ nullï¼Œè¡¨ç¤ºä¸æŒ‡å‘ä»»ä½•å¯¹è±¡ã€‚ å†…å­˜å ç”¨ ä¸å ç”¨é¢å¤–å†…å­˜ï¼ˆç¼–è¯‘å™¨é€šå¸¸å°†å…¶ä¼˜åŒ–ä¸ºç›´æ¥æ“ä½œæ‰€å¼•ç”¨çš„å¯¹è±¡ï¼‰ã€‚ å ç”¨é¢å¤–å†…å­˜ï¼ˆå­˜å‚¨åœ°å€ï¼Œé€šå¸¸æ˜¯ä¸€ä¸ªæœºå™¨å­—é•¿ï¼Œå¦‚4å­—èŠ‚æˆ–8å­—èŠ‚ï¼‰ã€‚ è®¿é—®æ–¹å¼ ç›´æ¥ä½¿ç”¨ï¼Œæ— éœ€è§£å¼•ç”¨æ“ä½œç¬¦ï¼Œä¾‹å¦‚ï¼šref = 10; éœ€è¦ä½¿ç”¨Â *Â è§£å¼•ç”¨æ“ä½œç¬¦è®¿é—®æˆ–ä¿®æ”¹æ‰€æŒ‡å‘çš„å¯¹è±¡ï¼Œä¾‹å¦‚ï¼š*ptr = 10; å¤šçº§é—´æ¥è®¿é—® ä¸æ”¯æŒå¤šçº§é—´æ¥è®¿é—®ï¼ˆä¸èƒ½æœ‰å¼•ç”¨çš„å¼•ç”¨ï¼‰ã€‚ æ”¯æŒå¤šçº§é—´æ¥è®¿é—®ï¼ˆå¦‚æŒ‡é’ˆçš„æŒ‡é’ˆï¼šint **pptr;ï¼‰ã€‚ å‡½æ•°å‚æ•°ä¼ é€’ å¸¸ç”¨äºå‡½æ•°å‚æ•°ä¼ é€’ï¼Œè¯­æ³•ç®€æ´ï¼Œä¾‹å¦‚ï¼švoid func(int \u0026amp;x) { x = 10; } ä¹Ÿå¯ä»¥ç”¨äºå‡½æ•°å‚æ•°ä¼ é€’ï¼Œä½†éœ€è¦ä½¿ç”¨è§£å¼•ç”¨æ“ä½œç¬¦ï¼Œä¾‹å¦‚ï¼švoid func(int *x) { *x = 10; } æ•°ç»„ä¸å¼•ç”¨ ä¸èƒ½ç›´æ¥åˆ›å»ºå¼•ç”¨æ•°ç»„ï¼Œä½†å¯ä»¥åˆ›å»ºæ•°ç»„çš„å¼•ç”¨ï¼Œä¾‹å¦‚ï¼šint (\u0026amp;ref)[10] = arr; å¯ä»¥åˆ›å»ºæŒ‡é’ˆæ•°ç»„ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºæŒ‡å‘æ•°ç»„çš„æŒ‡é’ˆï¼Œä¾‹å¦‚ï¼šint *ptrArr[10]; å®‰å…¨æ€§ æ›´å®‰å…¨ï¼Œä¸èƒ½ä¸ºÂ nullï¼Œä¸”è¯­æ³•æ›´ç›´è§‚ã€‚ æ›´çµæ´»ï¼Œä½†å®¹æ˜“å‡ºé”™ï¼ˆå¦‚ç©ºæŒ‡é’ˆã€é‡æŒ‡é’ˆç­‰ï¼‰ã€‚ åº•å±‚å®ç° é€šå¸¸é€šè¿‡æŒ‡é’ˆå®ç°ï¼Œä½†ç¼–è¯‘å™¨ä¼šä¼˜åŒ–ä¸ºç›´æ¥æ“ä½œæ‰€å¼•ç”¨çš„å¯¹è±¡ã€‚ ç›´æ¥å­˜å‚¨ç›®æ ‡å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ åˆ›å»ºå¼•ç”¨ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #include \u0026lt;iostream\u0026gt; using namespace std; int main () { // å£°æ˜ç®€å•çš„å˜é‡ int i; double d; // å£°æ˜å¼•ç”¨å˜é‡ int\u0026amp; r = i; double\u0026amp; s = d; i = 5; cout \u0026lt;\u0026lt; \u0026#34;Value of i : \u0026#34; \u0026lt;\u0026lt; i \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;Value of i reference : \u0026#34; \u0026lt;\u0026lt; r \u0026lt;\u0026lt; endl; d = 11.7; cout \u0026lt;\u0026lt; \u0026#34;Value of d : \u0026#34; \u0026lt;\u0026lt; d \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;Value of d reference : \u0026#34; \u0026lt;\u0026lt; s \u0026lt;\u0026lt; endl; return 0; } è¾“å‡º\n1 2 3 4 Value of i : 5 Value of i reference : 5 Value of d : 11.7 Value of d reference : 11.7 å¼•ç”¨çš„ä¸€äº›ç”¨æ³• å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•° ç›´æ¥äº¤æ¢æ˜¯äº¤æ¢çš„å½¢å‚ï¼Œç”¨å¼•ç”¨å°±å¯ä»¥äº¤æ¢å®å€¼\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 #include \u0026lt;iostream\u0026gt; using namespace std; // å‡½æ•°å£°æ˜ void swap(int\u0026amp; x, int\u0026amp; y); int main () { // å±€éƒ¨å˜é‡å£°æ˜ int a = 100; int b = 200; cout \u0026lt;\u0026lt; \u0026#34;äº¤æ¢å‰ï¼Œa çš„å€¼ï¼š\u0026#34; \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;äº¤æ¢å‰ï¼Œb çš„å€¼ï¼š\u0026#34; \u0026lt;\u0026lt; b \u0026lt;\u0026lt; endl; /* è°ƒç”¨å‡½æ•°æ¥äº¤æ¢å€¼ */ swap(a, b); cout \u0026lt;\u0026lt; \u0026#34;äº¤æ¢åï¼Œa çš„å€¼ï¼š\u0026#34; \u0026lt;\u0026lt; a \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;äº¤æ¢åï¼Œb çš„å€¼ï¼š\u0026#34; \u0026lt;\u0026lt; b \u0026lt;\u0026lt; endl; return 0; } // å‡½æ•°å®šä¹‰ void swap(int\u0026amp; x, int\u0026amp; y) { int temp; temp = x; /* ä¿å­˜åœ°å€ x çš„å€¼ */ x = y; /* æŠŠ y èµ‹å€¼ç»™ x */ y = temp; /* æŠŠ x èµ‹å€¼ç»™ y */ return; } è¾“å‡º\n1 2 3 4 äº¤æ¢å‰ï¼Œa çš„å€¼ï¼š 100 äº¤æ¢å‰ï¼Œb çš„å€¼ï¼š 200 äº¤æ¢åï¼Œa çš„å€¼ï¼š 200 äº¤æ¢åï¼Œb çš„å€¼ï¼š 100 å¼•ç”¨ä½œä¸ºå‡½æ•°è¿”å›å€¼ é€šè¿‡ä½¿ç”¨å¼•ç”¨æ¥æ›¿ä»£æŒ‡é’ˆï¼Œä¼šä½¿ C++ ç¨‹åºæ›´å®¹æ˜“é˜…è¯»å’Œç»´æŠ¤ã€‚C++ å‡½æ•°å¯ä»¥è¿”å›ä¸€ä¸ªå¼•ç”¨ï¼Œæ–¹å¼ä¸è¿”å›ä¸€ä¸ªæŒ‡é’ˆç±»ä¼¼\nå½“å‡½æ•°è¿”å›ä¸€ä¸ªå¼•ç”¨æ—¶ï¼Œåˆ™è¿”å›ä¸€ä¸ªæŒ‡å‘è¿”å›å€¼çš„éšå¼æŒ‡é’ˆã€‚è¿™æ ·ï¼Œå‡½æ•°å°±å¯ä»¥æ”¾åœ¨èµ‹å€¼è¯­å¥çš„å·¦è¾¹\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #include \u0026lt;iostream\u0026gt; using namespace std; double vals[] = {10.1, 12.6, 33.1, 24.1, 50.0}; double\u0026amp; setValues(int i) { double\u0026amp; ref = vals[i]; return ref; // è¿”å›ç¬¬ i ä¸ªå…ƒç´ çš„å¼•ç”¨ï¼Œref æ˜¯ä¸€ä¸ªå¼•ç”¨å˜é‡ï¼Œref å¼•ç”¨ vals[i] } // è¦è°ƒç”¨ä¸Šé¢å®šä¹‰å‡½æ•°çš„ä¸»å‡½æ•° int main () { cout \u0026lt;\u0026lt; \u0026#34;æ”¹å˜å‰çš„å€¼\u0026#34; \u0026lt;\u0026lt; endl; for ( int i = 0; i \u0026lt; 5; i++ ) { cout \u0026lt;\u0026lt; \u0026#34;vals[\u0026#34; \u0026lt;\u0026lt; i \u0026lt;\u0026lt; \u0026#34;] = \u0026#34;; cout \u0026lt;\u0026lt; vals[i] \u0026lt;\u0026lt; endl; } setValues(1) = 20.23; // æ”¹å˜ç¬¬ 2 ä¸ªå…ƒç´  setValues(3) = 70.8; // æ”¹å˜ç¬¬ 4 ä¸ªå…ƒç´  cout \u0026lt;\u0026lt; \u0026#34;æ”¹å˜åçš„å€¼\u0026#34; \u0026lt;\u0026lt; endl; for ( int i = 0; i \u0026lt; 5; i++ ) { cout \u0026lt;\u0026lt; \u0026#34;vals[\u0026#34; \u0026lt;\u0026lt; i \u0026lt;\u0026lt; \u0026#34;] = \u0026#34;; cout \u0026lt;\u0026lt; vals[i] \u0026lt;\u0026lt; endl; } return 0; } è¾“å‡º\n1 2 3 4 5 6 7 8 9 10 11 12 æ”¹å˜å‰çš„å€¼ vals[0] = 10.1 vals[1] = 12.6 vals[2] = 33.1 vals[3] = 24.1 vals[4] = 50 æ”¹å˜åçš„å€¼ vals[0] = 10.1 vals[1] = 20.23 vals[2] = 33.1 vals[3] = 70.8 vals[4] = 50 å½“è¿”å›ä¸€ä¸ªå¼•ç”¨æ—¶ï¼Œè¦æ³¨æ„è¢«å¼•ç”¨çš„å¯¹è±¡ä¸èƒ½è¶…å‡ºä½œç”¨åŸŸã€‚æ‰€ä»¥è¿”å›ä¸€ä¸ªå¯¹å±€éƒ¨å˜é‡çš„å¼•ç”¨æ˜¯ä¸åˆæ³•çš„ï¼Œä½†æ˜¯ï¼Œå¯ä»¥è¿”å›ä¸€ä¸ªå¯¹é™æ€å˜é‡çš„å¼•ç”¨\n","date":"2025-09-04T10:12:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E5%BC%95%E7%94%A8/","title":"C++ å¼•ç”¨"},{"content":"åŸºäºèœé¸Ÿæ•™ç¨‹å’Œè¯¾ä»¶çš„ä¸ªäººå­¦ä¹ ç¬”è®°\nå¼•è¨€ C++çš„ç±»æœ‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ç”¨äºåˆå§‹åŒ–å’Œæ¸…ç†å¯¹è±¡ ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šè¢«è‡ªåŠ¨è°ƒç”¨ï¼Œä¸è‡ªå®šä¹‰æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼Œç¼–è¯‘å™¨ä¼šè‡ªåŠ¨æä¾›ä¸¤ä¸ªå‡½æ•°çš„ç©ºå®ç°\næ„é€ å‡½æ•°\u0026amp;ææ„å‡½æ•° æ„é€ å‡½æ•°ï¼šä¸»è¦ä½œç”¨äºåˆ›å»ºå‡½æ•°æ—¶å¯¹å¯¹è±¡æˆå‘˜çš„å±æ€§èµ‹å€¼ ææ„å‡½æ•°ï¼šä¸»è¦ä½œç”¨äºå¯¹è±¡é”€æ¯å‰ï¼Œæ‰§è¡Œæ¸…ç†å·¥ä½œï¼ˆæ¯”å¦‚é‡Šæ”¾newå¼€è¾Ÿåœ¨å †åŒºçš„ç©ºé—´ï¼‰ æ„é€ å‡½æ•°å’Œææ„å‡½æ•°æ˜¯ä¸€ç§ç‰¹æ®Šçš„å…¬æœ‰æˆå‘˜å‡½æ•°ï¼Œæ¯ä¸€ä¸ªç±»éƒ½æœ‰ä¸€ä¸ªé»˜è®¤çš„æ„é€ å‡½æ•°å’Œææ„å‡½æ•° æ„é€ å‡½æ•°åœ¨ç±»å®šä¹‰æ—¶ç”±ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ï¼Œææ„å‡½æ•°åœ¨ç±»è¢«é”€æ¯æ—¶ç”±ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ æ„é€ å‡½æ•°çš„åç§°å’Œç±»åç›¸åŒï¼Œä¸€ä¸ªç±»å¯ä»¥æœ‰å¤šä¸ªæ„é€ å‡½æ•°ï¼Œä¸åŒçš„æ„é€ å‡½æ•°ä¹‹é—´é€šè¿‡å‚æ•°ä¸ªæ•°å’Œå‚æ•°ç±»å‹æ¥åŒº ä¸€ä¸ªç±»åªèƒ½æœ‰ä¸€ä¸ªææ„å‡½æ•° å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­ç»™ç±»åˆ†é…èµ„æºï¼Œåœ¨ç±»çš„ææ„å‡½æ•°ä¸­é‡Šæ”¾å¯¹åº”çš„èµ„æº å¦‚æœç¨‹åºå‘˜æ²¡æœ‰æä¾›æ„é€ å’Œææ„ï¼Œç³»ç»Ÿä¼šé»˜è®¤æä¾›ç©ºå®ç° æ„é€ å‡½æ•°å’Œææ„å‡½æ•°ï¼Œå¿…é¡»å®šä¹‰åœ¨publicé‡Œé¢ï¼Œæ‰å¯ä»¥è°ƒç”¨ æ„é€ å‡½æ•° æ„é€ å‡½æ•°å¯ç”¨äºä¸ºæŸäº›æˆå‘˜å˜é‡è®¾ç½®åˆå§‹å€¼ ç±»çš„æ„é€ å‡½æ•°æ˜¯ç±»çš„ä¸€ç§ç‰¹æ®Šçš„æˆå‘˜å‡½æ•°ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡åˆ›å»ºç±»çš„æ–°å¯¹è±¡æ—¶æ‰§è¡Œ\næ„é€ å‡½æ•°å®šä¹‰å½¢å¼ æ„é€ å‡½æ•°çš„åç§°ä¸ç±»çš„åç§°æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå¹¶ä¸”ä¸ä¼šè¿”å›ä»»ä½•ç±»å‹ï¼Œä¹Ÿä¸ä¼šè¿”å› void\n1 ç±»å(å½¢å‚è¡¨); ä¾‹å­ 1 2 3 4 5 6 7 8 9 10 11 12 class complex { public: complex();//é»˜è®¤æ„é€ å‡½æ•° complex(double,double);//åˆå§‹åŒ–æ„é€ å‡½æ•° complex(double);//å¼ºåˆ¶è½¬æ¢æ„é€ å‡½æ•° complex operator + (complex);//è¿ç®—ç¬¦é‡è½½ complex operator - (complex);//è¿ç®—ç¬¦é‡è½½ friend istream\u0026amp; operator \u0026gt;\u0026gt; (istream\u0026amp; , complex\u0026amp;);//istreamç±»\u0026gt;\u0026gt;è¿ç®—ç¬¦é‡è½½ friend ostream\u0026amp; operator \u0026lt;\u0026lt; (ostream\u0026amp; , complex\u0026amp;);//ostreamç±»\u0026lt;\u0026lt;è¿ç®—ç¬¦é‡è½½ private: double real , imag ; }; æ„é€ å‡½æ•°ç‰¹ç‚¹ æ„é€ å‡½æ•°å¯ä»¥æœ‰å‚æ•°ï¼Œæ‰€ä»¥å…è®¸æ„é€ å‡½æ•°é‡è½½\næ— å‚æ„é€ å‡½æ•°ä¸å…¨ç¼ºçœå‡½æ•° å…¨ç¼ºçœæ„é€ å‡½æ•°å’Œæ— å‚å¯èƒ½ä¼šåœ¨è°ƒç”¨çš„æ—¶å€™å‡ºé—®é¢˜ï¼Œå¹¶ä¸æ˜¯ä¸å¯ä»¥åŒæ—¶å­˜åœ¨ï¼ˆæ„æˆå‡½æ•°é‡è½½ï¼‰ï¼Œè€Œæ˜¯è°ƒç”¨å‡ºç°æ­§ä¹‰ æ— å‚çš„æ„é€ å‡½æ•°å’Œå…¨ç¼ºçœçš„æ„é€ å‡½æ•°éƒ½ç§°ä¸ºé»˜è®¤æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”é»˜è®¤æ„é€ å‡½æ•°åªèƒ½æœ‰ä¸€ä¸ª æ— å‚æ„é€ å‡½æ•°ã€å…¨ç¼ºçœæ„é€ å‡½æ•°ã€æˆ‘ä»¬æ²¡å†™ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆçš„æ„é€ å‡½æ•°ï¼Œéƒ½å¯ä»¥è®¤ä¸ºæ˜¯é»˜è®¤æ„é€ å‡½æ•°ã€‚ï¼ˆä¸€èˆ¬æƒ…å†µå†™å…¨ç¼ºçœï¼‰ æ— å‚æ•°æ„é€ å‡½æ•°ï¼ˆé»˜è®¤æ„é€ å‡½æ•°ï¼‰ 1 2 3 4 //ç±»å¤–å®ç° complex::complex() { real = 0 ;imag = 0 ; } æœ‰å‚æ•°æ„é€ å‡½æ•°ï¼ˆåˆå§‹åŒ–æ„é€ å‡½æ•°ï¼‰ æ‹¬å·å†…çš„åå­—ä¸ºä¸ªäººæ„Ÿæ‚Ÿæ‰€èµ·\n1 2 3 4 //ç±»å¤–å®ç° complex::complex(double r , double i ) { real = r ; imag = i ; } æœ‰ç‰¹æ®Šè¯­æ³•è§„åˆ™\nä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–å­—æ®µ 1 2 3 complex::complex(double r , double i ):real(r),imag(i) { cout \u0026lt;\u0026lt; \u0026#34;ç‰¹æ®Šè¯­æ³•è§„åˆ™,ä½¿ç”¨åˆå§‹åŒ–åˆ—è¡¨æ¥åˆå§‹åŒ–å­—æ®µ\u0026#34; \u0026lt;\u0026lt; endl ; } å¼ºåˆ¶è½¬æ¢æ„é€ å‡½æ•° 1 2 3 4 5 6 7 8 9 10 11 12 //ç±»å¤–å®ç° complex::complex(double r ) { real = r ; imag = 0 ; } //ä¸»å‡½æ•°å†…çš„è°ƒç”¨ int main() { complex c1(2.5,6.7) , c2(3.5,7.6) ; complex c = c1+c2+complex(2.0) ;//å¼ºåˆ¶è½¬æ¢çš„ä½œç”¨ cout \u0026lt;\u0026lt; c ; return 0 ; } ææ„å‡½æ•° ç±»çš„ææ„å‡½æ•°æ˜¯ç±»çš„ä¸€ç§ç‰¹æ®Šçš„æˆå‘˜å‡½æ•°ï¼Œå®ƒä¼šåœ¨æ¯æ¬¡åˆ é™¤æ‰€åˆ›å»ºçš„å¯¹è±¡æ—¶æ‰§è¡Œã€‚ ææ„å‡½æ•°æœ‰åŠ©äºåœ¨è·³å‡ºç¨‹åºï¼ˆæ¯”å¦‚å…³é—­æ–‡ä»¶ã€é‡Šæ”¾å†…å­˜ç­‰ï¼‰å‰é‡Šæ”¾èµ„æº\nææ„å‡½æ•°å®šä¹‰å½¢å¼ ææ„å‡½æ•°çš„åç§°ä¸ç±»çš„åç§°æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œåªæ˜¯åœ¨å‰é¢åŠ äº†ä¸ªæ³¢æµªå·ï¼ˆ~ï¼‰ä½œä¸ºå‰ç¼€ï¼Œå®ƒä¸ä¼šè¿”å›ä»»ä½•å€¼ï¼Œä¹Ÿä¸èƒ½å¸¦æœ‰ä»»ä½•å‚æ•°\n1 ~ç±»å(); ä¾‹å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 class Student { public: void Print() { cout \u0026lt;\u0026lt; \u0026#34;å­¦ç”Ÿå§“åï¼š\u0026#34; \u0026lt;\u0026lt; _name \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;å­¦ç”Ÿå¹´é¾„ï¼š\u0026#34; \u0026lt;\u0026lt; _age \u0026lt;\u0026lt; endl; cout \u0026lt;\u0026lt; \u0026#34;å­¦ç”Ÿå­¦å·ï¼š\u0026#34; \u0026lt;\u0026lt; _ID \u0026lt;\u0026lt; endl; } ~Student() {//ææ„å‡½æ•° cout \u0026lt;\u0026lt; \u0026#34;~Student()\u0026#34; \u0026lt;\u0026lt;endl ; } private: char _name[20]; int _age; char _ID[20]; }; int main() { Student stu1;//è°ƒç”¨é»˜è®¤æ„é€ å‡½æ•° stu1.Print(); return 0; } ææ„å‡½æ•°ç‰¹ç‚¹ æ²¡æœ‰å‚æ•°ï¼Œä¸å…è®¸é‡è½½ï¼Œä¸€ä¸ªç±»åªèƒ½ç”±ä¸€ä¸ªææ„å‡½æ•°\n","date":"2025-09-04T10:09:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%B8%8E%E6%9E%90%E6%9E%84%E5%87%BD%E6%95%B0/","title":"C++ æ„é€ å‡½æ•°ä¸ææ„å‡½æ•°"},{"content":"åŸºäºèœé¸Ÿæ•™ç¨‹ï¼Œè¯¾ä»¶çš„å­¦ä¹ å†…å®¹çš„ä¸ªäººç¬”è®°\nå‰è¨€ C++ åœ¨ C è¯­è¨€çš„åŸºç¡€ä¸Šå¢åŠ äº†é¢å‘å¯¹è±¡ç¼–ç¨‹ï¼ŒC++ æ”¯æŒé¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ã€‚ç±»æ˜¯ C++ çš„æ ¸å¿ƒç‰¹æ€§ï¼Œé€šå¸¸è¢«ç§°ä¸ºç”¨æˆ·å®šä¹‰çš„ç±»å‹\né¢å‘å¯¹è±¡ç¨‹åºè®¾è®¡ å°†å®¢è§‚äº‹ç‰©çœ‹ä½œå…·æœ‰å±æ€§å’Œè¡Œä¸ºçš„å¯¹è±¡ å°†æ•°æ®ï¼ˆå±æ€§ï¼‰åŠå¯¹æ•°æ®çš„æ“ä½œæ–¹æ³•ï¼ˆè¡Œä¸ºï¼‰å°è£…åœ¨ä¸€èµ·ï¼Œä½œä¸ºä¸€ä¸ªæ•´ä½“â€”â€”å¯¹è±¡\nç±»æ˜¯å¯¹è±¡çš„æŠ½è±¡ï¼Œå¯¹è±¡æ˜¯ç±»çš„ç‰¹ä¾‹ï¼ˆå…·ä½“å®ä¾‹ï¼‰\nç±» ç±»ç”¨äºæŒ‡å®šå¯¹è±¡çš„å½¢å¼ï¼Œæ˜¯ä¸€ç§ç”¨æˆ·è‡ªå®šä¹‰çš„æ•°æ®ç±»å‹ï¼Œå®ƒæ˜¯ä¸€ç§å°è£…äº†æ•°æ®å’Œå‡½æ•°çš„ç»„åˆ ç±»ä¸­çš„æ•°æ®ç§°ä¸ºæˆå‘˜å˜é‡ï¼Œå‡½æ•°ç§°ä¸ºæˆå‘˜å‡½æ•° ç±»å¯ä»¥è¢«çœ‹ä½œæ˜¯ä¸€ç§æ¨¡æ¿ï¼Œå¯ä»¥ç”¨æ¥åˆ›å»ºå…·æœ‰ç›¸åŒå±æ€§å’Œè¡Œä¸ºçš„å¤šä¸ªå¯¹è±¡\nç±»æ˜¯å¯¹è±¡çš„æŠ½è±¡ ç±»æ˜¯æŠ½è±¡çš„ï¼Œä¸å ç”¨å†…å­˜ï¼Œå¯¹è±¡æ˜¯å…·ä½“çš„ï¼Œ å ç”¨å®é™…çš„å­˜å‚¨ç©ºé—´\nå®šä¹‰ç±» å®šä¹‰ä¸€ä¸ªç±»çš„ä¾‹å­ ï¼ˆ1ï¼‰classå…³é”®å­—+ç±»å ï¼ˆ2ï¼‰è®¿é—®ä¿®é¥°ç¬¦+æˆå‘˜ï¼ˆæˆå‘˜å˜é‡/æˆå‘˜å‡½æ•°ï¼‰\næ¨¡æ¿ï¼š\n1 2 3 4 5 class classname { Access specifiers: //è®¿é—®ä¿®é¥°ç¬¦ï¼šprivate/public/protected Data members ; //å˜é‡ï¼ˆæˆå‘˜å˜é‡ï¼‰ Member functions(); //å£°æ˜äº†æ–¹æ³•ï¼Œæˆå‘˜å‡½æ•°ï¼Œå¹¶æœªå®ç° };// è¦ä»¥åˆ†å·ç»“æŸ å…·ä½“ä¾‹å­ï¼š\n1 2 3 4 5 6 class student { public: int _id_ , _age_ ; string _name_ ; string _sex_ ; };// è¦ä»¥åˆ†å·ç»“æŸ publicå…³é”®å­—ï¼Œå®šä¹‰äº†ç±»çš„æˆå‘˜çš„è®¿é—®å±æ€§ publicå…³é”®å­—å…è®¸ç±»çš„å­ç±»ï¼Œä»¥åŠç±»å¤–ç±»å†…çš„è®¿é—®\nåœ¨ç±»å¤–å®šä¹‰æˆå‘˜å‡½æ•°çš„ä¸€èˆ¬å½¢å¼ C++ æˆå‘˜å‡½æ•°ä¸å‹å…ƒå‡½æ•°\n1 2 3 4 5 è¿”å›å€¼ç±»å‹ ç±»å::æˆå‘˜å‡½æ•°å(å‚æ•°è¡¨) { â€¦ â€¦ //å‡½æ•°ä½“ } å…¶ä¸­::æ˜¯ä½œç”¨åŸŸè¿ç®—ç¬¦ã€‚ ä¾‹å­\n1 2 3 void Student::get_value() { cin\u0026gt;\u0026gt; num \u0026gt;\u0026gt; name \u0026gt;\u0026gt; sex ; } è®¿é—®ç±»çš„æˆå‘˜ï¼ˆæ•°æ®æˆå‘˜ï¼‰ ï¼ˆ1ï¼‰ç±»çš„å¯¹è±¡çš„publicæˆå‘˜å¯ä»¥ç›´æ¥ä½¿ç”¨æˆå‘˜è®¿é—®è¿ç®—ç¬¦ . æ¥è®¿é—® éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç§æœ‰çš„æˆå‘˜å’Œå—ä¿æŠ¤çš„æˆå‘˜ä¸èƒ½ä½¿ç”¨ç›´æ¥æˆå‘˜è®¿é—®è¿ç®—ç¬¦ (.) æ¥ç›´æ¥è®¿é—® ï¼ˆ2ï¼‰ç±»çš„æˆå‘˜ä¹‹é—´å¯ä»¥äº’ç›¸è®¿é—®\nç±»æˆå‘˜çš„è®¿é—®æƒé™ å…¬æœ‰çš„(public) ï¼šå¯¹å¤–æ¥å£ï¼Œä»»ä½•å¤–éƒ¨å‡½ æ•°éƒ½å¯ä»¥è®¿é—®å…¬æœ‰ç±»å‹æ•°æ®å’Œå‡½æ•°\nç§æœ‰çš„(private)ï¼šåªå…è®¸æœ¬ç±»ä¸­çš„æˆå‘˜å‡½ æ•°è®¿é—®ï¼ˆå‹å…ƒé™¤å¤–ï¼‰\nå—ä¿æŠ¤çš„(protected): ä¸privateç±»ä¼¼ï¼Œå…¶å·®åˆ«è¡¨ç°åœ¨è¿˜å¯ä»¥è¢«æ´¾ç”Ÿç±»çš„æˆå‘˜å‡½æ•°è®¿é—®\nå¯¹è±¡ å¯¹è±¡æ˜¯ç±»çš„å…·ä½“å®ä¾‹ å®šä¹‰ä¸€ä¸ªç±»ï¼Œå¹¶å®šä¹‰ä¸€ä¸ªè¯¥ç±»çš„ï¼ˆå®ä¾‹ï¼‰å¯¹è±¡\n1 2 3 4 5 6 7 8 9 10 class student {// å®šä¹‰äº†ä¸€ä¸ªstudentç±» public: string _name_ ; string _sex_ ; int _id_ , _age_ ; };// ä¸€å®šè¦ä»¥åˆ†å·ç»“æŸ //å®šä¹‰äº†ä¸€ä¸ªstudentç±»çš„å¯¹è±¡ student stu1 ; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å®šä¹‰ç±»çš„æ—¶å€™ï¼Œåªæ˜¯å£°æ˜ï¼Œå¹¶æœªç»™ç±»çš„æˆå‘˜åˆ†é…å†…å­˜ç©ºé—´ åœ¨å®šä¹‰ç±»çš„å®ä¾‹å¯¹è±¡åï¼Œå†ç»™å®šä¹‰çš„å¯¹è±¡åˆ†é…ç©ºé—´\nç±»åªæ˜¯æ¨¡æ¿ï¼Œæ˜¯è™šçš„ å¯¹è±¡æ˜¯ç±»çš„å®ä¾‹ï¼Œæ˜¯å®é™…çš„\nç±»ä¸å¯¹è±¡çš„ç›¸å…³æ¦‚å¿µ ç±»æˆå‘˜å‡½æ•° ç±»è®¿é—®ä¿®é¥°ç¬¦ æ„é€ å‡½æ•° \u0026amp; ææ„å‡½æ•° å‹å…ƒå‡½æ•° thisæŒ‡é’ˆ ç±»çš„é™æ€æˆå‘˜é™æ€ è™šå‡½æ•° è™šåŸºç±» ç±»çš„åŠŸèƒ½ ç»§æ‰¿ä¸æ´¾ç”Ÿ å¤šæ€ ","date":"2025-09-04T10:09:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E7%B1%BB%E4%B8%8E%E5%AF%B9%E8%B1%A1/","title":"C++ ç±»ä¸å¯¹è±¡"},{"content":"è™šå‡½æ•°å®šä¹‰ è™šå‡½æ•°æ˜¯ç”¨å…³é”®å­—virtualä¿®é¥°çš„æŸåŸºç±»ä¸­çš„ protectedæˆ–publicæˆå‘˜å‡½æ•°ã€‚å®ƒå¯ä»¥åœ¨æ´¾ç”Ÿç±»ä¸­ é‡æ–°å®šä¹‰ï¼Œä»¥å½¢æˆä¸åŒç‰ˆæœ¬ã€‚åªæœ‰åœ¨ç¨‹åºçš„æ‰§ è¡Œè¿‡ç¨‹ä¸­ï¼Œä¾æ®æŒ‡é’ˆå…·ä½“æŒ‡å‘å“ªä¸ªç±»å¯¹è±¡ï¼Œæˆ– ä¾æ®å¼•ç”¨å“ªä¸ªç±»å¯¹è±¡ï¼Œæ‰èƒ½ç¡®å®šæ¿€æ´»å“ªä¸€ä¸ªç‰ˆ æœ¬ï¼Œå®ç°åŠ¨æ€å…³è”\nå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶é€šè¿‡è°ƒç”¨ç›¸åŒçš„å‡½æ•°åè€Œå®ç°ä¸åŒåŠŸèƒ½çš„å‡½æ•°ç§°ä¸ºè™šå‡½æ•°\nè™šå‡½æ•°çš„å£°æ˜ä¸ç‰¹ç‚¹ 1 virtual FuncName(å‚æ•°åˆ—è¡¨); ä¸€æ—¦æŠŠåŸºç±»çš„æˆå‘˜å‡½æ•°å®šä¹‰ä¸ºè™šå‡½æ•°ï¼Œç”±åŸºç±» æ‰€æ´¾ç”Ÿå‡ºæ¥çš„æ‰€æœ‰æ´¾ç”Ÿç±»ä¸­ï¼Œè¯¥å‡½æ•°å‡ä¿æŒè™šå‡½æ•°çš„ç‰¹æ€§ åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰åŸºç±»ä¸­çš„è™šå‡½æ•°æ—¶ï¼Œå¯ä»¥ä¸ç”¨å…³é”®å­—virtualæ¥ä¿®é¥°è¿™ä¸ªæˆå‘˜å‡½æ•°\nè™šå‡½æ•°å®ä¾‹ è™šå‡½æ•°å®ç°åŠ¨æ€å¤šæ€\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 class A{ protected: int x; public: A(){ x =1000; } virtual void print(){ //è™šå‡½æ•° cout \u0026lt;\u0026lt; \u0026#34;x=\u0026#34; \u0026lt;\u0026lt; x \u0026lt;\u0026lt; endl ; } }; class B:public A{ int y; public: B() { y=2000; } void print() { //æ´¾ç”Ÿè™šå‡½æ•° cout \u0026lt;\u0026lt; \u0026#34;y=\u0026#34; \u0026lt;\u0026lt; y \u0026lt;\u0026lt; endl ; } }; class C:public A{ int z; public: C(){ z=3000; } void print(){ //æ´¾ç”Ÿè™šå‡½æ•° cout \u0026lt;\u0026lt; \u0026#34;z=\u0026#34; \u0026lt;\u0026lt; z \u0026lt;\u0026lt; endl ; } }; void main(void ) { A a, *pa; B b; C c; a.print(); b.print(); c.print(); //ä»¥ä¸Šä¸ºé™æ€å…³è” pa=\u0026amp;a; pa-\u0026gt;print(); //è°ƒç”¨ç±»Açš„è™šå‡½æ•° pa=\u0026amp;b; pa-\u0026gt;print(); //è°ƒç”¨ç±»Bçš„è™šå‡½æ•° pa=\u0026amp;c; pa-\u0026gt;print();//è°ƒç”¨ç±»Cçš„è™šå‡½æ•° } çº¯è™šå‡½æ•° åœ¨åŸºç±»ä¸­ä¸å¯¹è™šå‡½æ•°ç»™å‡ºæœ‰æ„ä¹‰çš„å®ç°ï¼Œå®ƒåªæ˜¯åœ¨æ´¾ç”Ÿç±»ä¸­æœ‰å…·ä½“çš„æ„ä¹‰ã€‚è¿™æ—¶åŸºç±»ä¸­çš„è™šå‡½æ•°åªæ˜¯ä¸€ä¸ªå…¥å£ï¼Œå…·ä½“çš„ç›®çš„åœ°ç”±ä¸åŒçš„æ´¾ç”Ÿç±»ä¸­çš„å¯¹è±¡å†³å®šã€‚ è¿™ä¸ªè™šå‡½æ•°ç§°ä¸ºçº¯è™šå‡½æ•°ã€‚ åŒ…å«çº¯è™šå‡½æ•°çš„ç±»ä¸ºæŠ½è±¡ç±»ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 class Shape { protected: int width, height; public: Shape( int a=0, int b=0) { width = a; height = b; } // pure virtual function virtual int area() = 0; }; virtual int area() = 0å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå‡½æ•°æ²¡æœ‰ä¸»ä½“ï¼Œä¸Šé¢çš„è™šå‡½æ•°æ˜¯çº¯è™šå‡½æ•°\nè™šå‡½æ•°ä½¿ç”¨æ³¨æ„äº‹é¡¹ å½“åœ¨åŸºç±»ä¸­æŠŠæˆå‘˜å‡½æ•°å®šä¹‰ä¸ºè™šå‡½æ•°åï¼Œ åœ¨å…¶æ´¾ç”Ÿç±»ä¸­å®šä¹‰çš„è™šå‡½æ•°å¿…é¡»ä¸åŸºç±»ä¸­çš„è™šå‡½æ•° åŒåï¼Œå‚æ•°çš„ç±»å‹ã€é¡ºåºã€æ•°é‡å¿…é¡»ä¸€ä¸€ å¯¹åº”ï¼Œå‡½æ•°çš„è¿”å›çš„ç±»å‹ä¹Ÿç›¸åŒ è‹¥å‡½æ•°åç›¸åŒï¼Œä½†å‚æ•°çš„ä¸ªæ•°ä¸åŒæˆ–è€…å‚æ•°çš„ç±»å‹ä¸åŒæ—¶ï¼Œåˆ™å±äºå‡½æ•°çš„é‡è½½ï¼Œè€Œä¸æ˜¯è™šå‡½æ•°ã€‚ è‹¥å‡½æ•°åä¸åŒï¼Œæ˜¾ç„¶è¿™æ˜¯ä¸åŒçš„æˆå‘˜å‡½æ•°\nå®ç°è¿™ç§åŠ¨æ€çš„å¤šæ€æ€§æ—¶ï¼Œå¿…é¡»ä½¿ç”¨ åŸºç±» ç±»å‹çš„æŒ‡é’ˆå˜é‡ï¼Œå¹¶ä½¿è¯¥æŒ‡é’ˆæŒ‡å‘ä¸åŒçš„æ´¾ç”Ÿç±» å¯¹è±¡ï¼Œå¹¶é€šè¿‡è°ƒç”¨æŒ‡é’ˆæ‰€æŒ‡å‘çš„è™šå‡½æ•°æ‰èƒ½å®ç°åŠ¨æ€çš„å¤šæ€æ€§ ï¼Œå³åœ¨ç¨‹åºè¿è¡Œæ—¶ï¼Œé€šè¿‡èµ‹å€¼è¯­å¥å®ç°å¤šæ€æ€§\nè™šå‡½æ•°å¿…é¡»æ˜¯ç±»çš„ä¸€ä¸ªæˆå‘˜å‡½æ•°ï¼Œä¸èƒ½æ˜¯ å‹å…ƒå‡½æ•°ï¼Œä¹Ÿä¸èƒ½æ˜¯ é™æ€æˆå‘˜å‡½æ•° (æ‰€æœ‰å¯¹è±¡å…±æœ‰ï¼Œ æ— æ³•é‡æ–°å®šä¹‰)\nå¯æŠŠææ„å‡½æ•°å®šä¹‰ä¸ºè™šå‡½æ•°ï¼Œä½†æ˜¯ï¼Œä¸èƒ½å°† æ„é€ å‡½æ•°å®šä¹‰ä¸ºè™šå‡½æ•°\nä¸€ä¸ªå‡½æ•°å¦‚æœè¢«å®šä¹‰æˆè™šå‡½æ•°ï¼Œåˆ™ä¸ç®¡ç»å† å¤šå°‘æ¬¡æ´¾ç”Ÿï¼Œä»å°†ä¿æŒå…¶è™šç‰¹æ€§ï¼Œä»¥å®ç°â€œä¸€ä¸ª æ¥å£ï¼Œå¤šä¸ªå½¢æ€â€\nè™šå‡½æ•°ä¸ä¸€èˆ¬çš„æˆå‘˜å‡½æ•°ç›¸æ¯”è¾ƒï¼Œè°ƒç”¨æ—¶çš„ æ‰§è¡Œé€Ÿåº¦è¦æ…¢ä¸€äº›ã€‚ä¸ºäº†å®ç°å¤šæ€æ€§ï¼Œåœ¨æ¯ä¸€ ä¸ªæ´¾ç”Ÿç±»ä¸­å‡è¦ä¿å­˜ç›¸åº”è™šå‡½æ•°çš„å…¥å£åœ°å€è¡¨ï¼Œ å‡½æ•°çš„è°ƒç”¨æœºåˆ¶ä¹Ÿæ˜¯é—´æ¥å®ç°çš„ã€‚å› æ­¤ï¼Œé™¤äº† è¦ç¼–å†™ä¸€äº›é€šç”¨çš„ç¨‹åºï¼Œå¹¶ä¸€å®šè¦ä½¿ç”¨è™šå‡½æ•° æ‰èƒ½å®Œæˆå…¶åŠŸèƒ½è¦æ±‚å¤–ï¼Œé€šå¸¸ä¸å¿…ä½¿ç”¨è™šå‡½æ•°\n","date":"2025-09-04T10:09:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E8%99%9A%E5%87%BD%E6%95%B0/","title":"C++ è™šå‡½æ•°"},{"content":"å¤šæ€ï¼Œé™æ€å¤šæ€å’ŒåŠ¨æ€å¤šæ€\nå¤šæ€çš„å®šä¹‰ å¤šæ€æŒ‰å­—é¢çš„æ„æ€å°±æ˜¯å¤šç§å½¢æ€ã€‚å½“ç±»ä¹‹é—´å­˜åœ¨å±‚æ¬¡ç»“æ„ï¼Œå¹¶ä¸”ç±»ä¹‹é—´æ˜¯é€šè¿‡ç»§æ‰¿å…³è”æ—¶ï¼Œå°±ä¼šç”¨åˆ°å¤šæ€ã€‚ C++ å¤šæ€æ„å‘³ç€è°ƒç”¨æˆå‘˜å‡½æ•°æ—¶ï¼Œä¼šæ ¹æ®è°ƒç”¨å‡½æ•°çš„å¯¹è±¡çš„ç±»å‹æ¥æ‰§è¡Œä¸åŒçš„å‡½æ•°ã€‚ å¤šæ€æ€§ï¼šè°ƒç”¨åŒä¸€ä¸ªå‡½æ•°åï¼Œä½†å¯ä»¥æ ¹æ®éœ€è¦å® ç°ä¸åŒçš„åŠŸèƒ½ã€‚(æ¶ˆæ¯ç›¸åŒï¼Œå“åº”ä¸åŒ)\nè¿è¡Œæ—¶çš„å¤šæ€æ€§æ˜¯æŒ‡åœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰ï¼Œæ ¹æ®å‡½æ•°åå’Œ å‚æ•°æ— æ³•ç¡®å®šåº”è¯¥è°ƒç”¨å“ªä¸€ä¸ªå‡½æ•°ï¼Œå¿…é¡»åœ¨ç¨‹åºçš„æ‰§ è¡Œè¿‡ç¨‹ä¸­ï¼Œæ ¹æ®å…·ä½“çš„æ‰§è¡Œæƒ…å†µæ¥åŠ¨æ€åœ°ç¡®å®š\né™æ€å¤šæ€ï¼ˆå‡½æ•°é‡è½½ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 #include \u0026lt;iostream\u0026gt; using namespace std; class Shape { protected: int width, height; public: Shape( int a=0, int b=0) { width = a; height = b; } int area() { cout \u0026lt;\u0026lt; \u0026#34;Parent class area :\u0026#34; \u0026lt;\u0026lt;endl; return 0; } }; class Rectangle: public Shape{ public: Rectangle( int a=0, int b=0):Shape(a, b) { } int area () { cout \u0026lt;\u0026lt; \u0026#34;Rectangle class area :\u0026#34; \u0026lt;\u0026lt;endl; return (width * height); } }; class Triangle: public Shape{ public: Triangle( int a=0, int b=0):Shape(a, b) { } int area () { cout \u0026lt;\u0026lt; \u0026#34;Triangle class area :\u0026#34; \u0026lt;\u0026lt;endl; return (width * height / 2); } }; // ç¨‹åºçš„ä¸»å‡½æ•° int main( ) { Shape *shape; Rectangle rec(10,7); Triangle tri(10,5);// å­˜å‚¨çŸ©å½¢çš„åœ°å€ shape = \u0026amp;rec;// è°ƒç”¨çŸ©å½¢çš„æ±‚é¢ç§¯å‡½æ•° area shape-\u0026gt;area();// å­˜å‚¨ä¸‰è§’å½¢çš„åœ°å€ shape = \u0026amp;tri;// è°ƒç”¨ä¸‰è§’å½¢çš„æ±‚é¢ç§¯å‡½æ•° area shape-\u0026gt;area(); return 0; } è¾“å‡ºç»“æœ\n1 2 Parent class area : Parent class area : è°ƒç”¨å‡½æ•° area() è¢«ç¼–è¯‘å™¨è®¾ç½®ä¸ºåŸºç±»ä¸­çš„ç‰ˆæœ¬ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„é™æ€å¤šæ€ï¼Œæˆ–é™æ€é“¾æ¥Â - å‡½æ•°è°ƒç”¨åœ¨ç¨‹åºæ‰§è¡Œå‰å°±å‡†å¤‡å¥½äº†ã€‚æœ‰æ—¶å€™è¿™ä¹Ÿè¢«ç§°ä¸ºæ—©ç»‘å®šï¼Œå› ä¸º area() å‡½æ•°åœ¨ç¨‹åºç¼–è¯‘æœŸé—´å°±å·²ç»è®¾ç½®å¥½äº†ã€‚\nåŠ¨æ€å¤šæ€ åœ¨ Shape ç±»ä¸­ï¼Œarea() çš„å£°æ˜å‰æ”¾ç½®å…³é”®å­—Â virtual\nè™šå‡½æ•°Â æ˜¯åœ¨åŸºç±»ä¸­ä½¿ç”¨å…³é”®å­—Â virtualÂ å£°æ˜çš„å‡½æ•°ã€‚åœ¨æ´¾ç”Ÿç±»ä¸­é‡æ–°å®šä¹‰åŸºç±»ä¸­å®šä¹‰çš„è™šå‡½æ•°æ—¶ï¼Œä¼šå‘Šè¯‰ç¼–è¯‘å™¨ä¸è¦é™æ€é“¾æ¥åˆ°è¯¥å‡½æ•°ã€‚ æˆ‘ä»¬æƒ³è¦çš„æ˜¯åœ¨ç¨‹åºä¸­ä»»æ„ç‚¹å¯ä»¥æ ¹æ®æ‰€è°ƒç”¨çš„å¯¹è±¡ç±»å‹æ¥é€‰æ‹©è°ƒç”¨çš„å‡½æ•°ï¼Œè¿™ç§æ“ä½œè¢«ç§°ä¸ºåŠ¨æ€é“¾æ¥ï¼Œæˆ–åæœŸç»‘å®šã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 class Shape { protected: int width, height; public: Shape( int a=0, int b=0) { width = a; height = b; } virtual int area() { cout \u0026lt;\u0026lt; \u0026#34;Parent class area :\u0026#34; \u0026lt;\u0026lt;endl; return 0; } }; è¾“å‡ºç»“æœ\n1 2 Rectangle class area : Triangle class area : è‹¥è¦åŸºç±»æŒ‡é’ˆè®¿é—®æ´¾ç”Ÿç±»ä¸­ç›¸åŒåå­—çš„å‡½æ•°ï¼Œå¿…é¡»å°†åŸºç±»ä¸­çš„åŒåå‡½æ•°å®šä¹‰ä¸ºè™šå‡½æ•°ï¼Œ è¿™æ ·ï¼Œå°†ä¸åŒçš„æ´¾ç”Ÿç±»å¯¹è±¡çš„åœ°å€èµ‹ç»™åŸºç±»çš„æŒ‡é’ˆå˜é‡åï¼Œå°±å¯ä»¥åŠ¨æ€åœ°æ ¹æ®è¿™ç§èµ‹å€¼è¯­å¥ è°ƒç”¨ä¸åŒç±»ä¸­çš„å‡½æ•°(åŠ¨æ€ç»‘å®šã€åŠ¨æ€å…³è”)\nåŠ¨æ€å¤šæ€å®ç°æ³¨æ„äº‹é¡¹ å¯ä»¥å°†ä¸€ä¸ªæ´¾ç”Ÿç±»å¯¹è±¡çš„åœ°å€èµ‹ç»™åŸºç±»çš„æŒ‡é’ˆå˜é‡\nåŸºç±»æŒ‡é’ˆï¼Œåªèƒ½å¼•ç”¨ä»åŸºç±»ç»§æ‰¿æ¥çš„æˆå‘˜ ä½¿ç”¨åŸºç±»çš„æŒ‡é’ˆæ—¶ï¼Œåªèƒ½è®¿é—®ä»ç›¸åº”åŸºç±»ä¸­ç»§æ‰¿æ¥çš„æˆå‘˜ï¼Œè€Œ ä¸å…è®¸è®¿é—®åœ¨æ´¾ç”Ÿç±»ä¸­å¢åŠ çš„æˆå‘˜\n","date":"2025-09-04T10:08:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E5%A4%9A%E6%80%81/","title":"C++ å¤šæ€"},{"content":"å¼•è¨€ åœ¨å†…å­˜ä¸­ï¼Œç¨‹åºä¸ºä¿å­˜æŸç§ç±»å‹æ•°æ®å¦‚æ•°ç»„è€Œåˆ†é… ä¸€å—å†…å­˜ç©ºé—´ã€‚ ç”¨å®Œåå°±éœ€è¦æŠŠå…ˆå‰å ç”¨çš„å†…å­˜ç©ºé—´é‡Šæ”¾ç»™å†…å­˜ï¼Œ ä»¥åé‡æ–°åˆ†é…ï¼Œä¾›ç¨‹åºçš„å…¶å®ƒéƒ¨åˆ†ä½¿ç”¨\nnewè¿ç®—ç¬¦ï¼ˆå¯¹åº”mallocå‡½æ•°ï¼‰ 1 æŒ‡é’ˆå˜é‡ = new æ•°æ®ç±»å‹; newä»å†…å­˜ä¸­åˆ†é…å†…å­˜ç©ºé—´ï¼Œå¹¶è¿”å›æŒ‡å‘è¯¥å†… å­˜çš„é¦–åœ°å€ï¼Œè¯¥åœ°å€å­˜æ”¾äºæŒ‡é’ˆå˜é‡ä¸­\ndeleteè¿ç®—ç¬¦ï¼ˆå¯¹åº”freeå‡½æ•°ï¼‰ è¿ç®—ç¬¦deleteç”¨äºé‡Šæ”¾newåˆ†é…çš„å†…å­˜ç©ºé—´ï¼Œ å®ƒçš„ä½¿ç”¨å½¢å¼ä¸º\n1 delete æŒ‡é’ˆå˜é‡; å…¶ä¸­çš„æŒ‡é’ˆå˜é‡ä¿å­˜ç€newåŠ¨æ€åˆ†é…çš„å†…å­˜çš„é¦–åœ°å€\næ³¨æ„ (a) ç”¨newè·å–çš„å†…å­˜ç©ºé—´ï¼Œå¿…é¡»ç”¨deleteè¿›è¡Œé‡Šæ”¾ï¼› ( (b) å¯¹ä¸€ä¸ªæŒ‡é’ˆåªèƒ½è°ƒç”¨ä¸€æ¬¡deleteï¼› (c) ç”¨deleteè¿ç®—ç¬¦ä½œç”¨çš„å¯¹è±¡å¿…é¡»æ˜¯ç”¨newåˆ†é…çš„å†… å­˜ç©ºé—´çš„é¦–åœ°å€ã€‚\nå®ä¾‹ 1 2 3 4 5 6 7 8 #include \u0026lt;iostream\u0026gt; using namespace std; int main() { int *p; p=new int; // åˆ†é…å†…å­˜ç©ºé—´ *p=5; cout\u0026lt;\u0026lt;*p; delete p; }// é‡Šæ”¾å†…å­˜ç©ºé—´ ç”¨newå»ºç«‹æ•°ç»„ç±»å‹çš„å˜é‡ 1 æŒ‡é’ˆå˜é‡ = new æ•°æ®ç±»å‹[æ•°ç»„å¤§å°] ; æ­¤æ—¶æŒ‡é’ˆå˜é‡æŒ‡å‘ç¬¬ä¸€ä¸ªæ•°ç»„å…ƒç´ çš„åœ°å€ã€‚ä½¿ç”¨new åˆ†é…æ•°ç»„æ—¶ï¼Œä¸èƒ½æä¾›åˆå§‹å€¼\nä½¿ç”¨newå»ºç«‹çš„æ•°ç»„ å˜é‡ä¹Ÿç”±deleteé‡Šæ”¾ï¼Œå…¶å½¢å¼ä¸º:\n1 delete æŒ‡é’ˆå˜é‡; åŒæ ·ï¼Œä¹Ÿå¯ä»¥ç”¨newæ¥ä¸ºå¤šç»´æ•°ç»„åˆ†é…ç©ºé—´ï¼Œä½†æ˜¯é™¤ç¬¬ä¸€ç»´å¯ä»¥ä¸ºå˜é‡å¤–ï¼Œå…¶å®ƒç»´æ•°éƒ½å¿…é¡»æ˜¯å¸¸é‡\næ³¨æ„åœ¨ä½¿ç”¨deleteæ—¶ï¼Œä¸ç”¨è€ƒè™‘æ•°ç»„çš„ç»´æ•°ã€‚ æœ‰æ—¶ï¼Œå¹¶ä¸èƒ½ä¿è¯ä¸€å®šå¯ä»¥ä»å †å†…å­˜ä¸­è·å¾—æ‰€éœ€ç©ºé—´ï¼Œå½“ä¸èƒ½æˆåŠŸåœ°åˆ†é…åˆ°æ‰€éœ€è¦çš„å†…å­˜æ—¶ï¼Œnewè¿”å›0ï¼Œå³ç©ºæŒ‡é’ˆã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ¤æ–­newçš„è¿”å›å€¼æ˜¯å¦ä¸º0ï¼Œæ¥å¾—çŸ¥ç³»ç»Ÿä¸­æ˜¯å¦æœ‰è¶³å¤Ÿçš„ç©ºé—²å†…å­˜æ¥ä¾›ç¨‹åºä½¿ç”¨\nä¾‹å­ 1 2 3 4 5 int *p= new int[100]; if(p==0) { cout\u0026lt;\u0026lt;â€œcanâ€™t allocate more memory,terminating.\u0026#34;\u0026lt;\u0026lt;endl; exit(1); } ä¸€ç»´æ•°ç»„\n1 2 3 4 5 // åŠ¨æ€åˆ†é…,æ•°ç»„é•¿åº¦ä¸º m int *array=new int [m]; //é‡Šæ”¾å†…å­˜ delete [] array; äºŒç»´æ•°ç»„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 #include \u0026lt;iostream\u0026gt; using namespace std; int main() { int **p; int i,j; //p[4][8] //å¼€å§‹åˆ†é…4è¡Œ8åˆ—çš„äºŒç»´æ•°æ® p = new int *[4]; for(i=0;i\u0026lt;4;i++){ p[i]=new int [8]; } for(i=0; i\u0026lt;4; i++){ for(j=0; j\u0026lt;8; j++){ p[i][j] = j*i; } } //æ‰“å°æ•°æ® for(i=0; i\u0026lt;4; i++){ for(j=0; j\u0026lt;8; j++) { if(j==0) cout\u0026lt;\u0026lt;endl; cout\u0026lt;\u0026lt;p[i][j]\u0026lt;\u0026lt;\u0026#34;\\t\u0026#34;; } } //å¼€å§‹é‡Šæ”¾ç”³è¯·çš„å † for(i=0; i\u0026lt;4; i++){ delete [] p[i]; } delete [] p; return 0; } ä¸‰ç»´æ•°ç»„\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 int ***array; // å‡å®šæ•°ç»„ç¬¬ä¸€ç»´ä¸º mï¼Œ ç¬¬äºŒç»´ä¸º nï¼Œ ç¬¬ä¸‰ç»´ä¸ºh // åŠ¨æ€åˆ†é…ç©ºé—´ array = new int **[m]; for( int i=0; i\u0026lt;m; i++ ) { array[i] = new int *[n]; for( int j=0; j\u0026lt;n; j++ ) { array[i][j] = new int [h]; } } //é‡Šæ”¾ for( int i=0; i\u0026lt;m; i++ ) { for( int j=0; j\u0026lt;n; j++ ) { delete[] array[i][j]; } delete[] array[i]; } delete[] array; ","date":"2025-09-04T10:04:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E5%8A%A8%E6%80%81%E5%86%85%E5%AD%98%E7%9A%84%E5%88%86%E9%85%8D%E4%B8%8E%E9%87%8A%E6%94%BEnewdelete/","title":"C++ åŠ¨æ€å†…å­˜çš„åˆ†é…ä¸é‡Šæ”¾(new\u0026delete)"},{"content":"è·Ÿç€ä¸‹é¢çš„è§†é¢‘ï¼Œç³»ç»Ÿæ¢³ç†å¤ä¹ è¿‡å¾€çš„åµŒå…¥å¼çŸ¥è¯†ï¼ŒåŒæ—¶ä¹Ÿç®—æ˜¯ ç”µæ§æˆé•¿æŒ‡å— çš„ä¸€ä¸ª éƒ¨åˆ† å®ç°ï¼Œèƒ½æœ‰æ•ˆä¸”å¿«é€Ÿçš„å»ºç«‹ä¸€ä¸ªåµŒå…¥å¼ç³»ç»Ÿå’Œå·¥å…·é“¾çš„æ•´ä½“è®¤çŸ¥\nã€ã€Šä»CPUæ¶æ„åˆ°æ“ä½œç³»ç»Ÿå®ç°ã€‹ç³»åˆ—è¯¾ç¨‹ - Git å¼€æºã€‘https://www.bilibili.com/video/BV1ksNCzXEny?vd_source=5a0790755035f26a67935abfbfcdfd5b\nè§†é¢‘ä¸­è¯¦ç»†ä¸”ç¡¬æ ¸çš„å®ä¾‹ä¸ä¼šå‡ºç°åœ¨æ­¤ç¬”è®°ä¸­\næ¦‚è¿° å…³äºARMæ¶æ„ ç›®å‰armå†…æ ¸ä¸»è¦æ¼”å˜åˆ†ä¸ºCortex-Xï¼ŒCortex-Aï¼ŒCortex-Rï¼ŒCortex-M\nCortex-Aï¼šåº”ç”¨å¤„ç†å™¨ï¼Œè®¾è®¡ç”¨æ¥å¤„ç†å¤æ‚åº”ç”¨ï¼ˆä¾‹å¦‚é«˜ç«¯åµŒå…¥æ“ä½œç³»ç»ŸLinuxï¼ŒiOSï¼ŒAndroidï¼ŒWindowsï¼‰ï¼Œå¯¹æ ‡PCå’Œæ‰‹æœºå¤„ç†å™¨çš„æ€§èƒ½\nCortex-Xï¼šæ¯”Cortex-Mæ›´é«˜çš„æ€§èƒ½\nCortex-Rï¼šReal-timeï¼Œä¸»è¦ç”¨äºå®æ—¶ç³»ç»Ÿ\nCortex-Mï¼šMicrocontrolï¼Œå¾®å¤„ç†å™¨\nCortex-Mä¼˜ç‚¹ ä½åŠŸè€— é«˜æ€§èƒ½ ä¸­æ–­æ˜“ç”¨ ä»£ç å¯†åº¦é«˜ï¼ˆåŸå› åœ¨äºæŒ‡ä»¤é›†ï¼‰ å¯è°ƒå¼ æ”¯æŒæ“ä½œç³»ç»Ÿ å“ˆä½›æ¶æ„ï¼ŒæŒ‡ä»¤ä¸æ•°æ®åœ¨åŒä¸€å†…å­˜ æŒ‡ä»¤é›† å¤šå¥—æŒ‡ä»¤é›†ç”¨äºå¤„ç†ä¸åŒçš„åœºæ™¯\n1.CISCï¼ˆComplex Instruction Set Computerï¼‰ å¤æ‚æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—æœºï¼ŒCISCæŒ‡ä»¤é›†åŒ…å«å¤§é‡å¤æ‚çš„æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤å¯ä»¥å®Œæˆå¤šä¸ªæ“ä½œï¼Œè¿™ç§è®¾è®¡ä½¿å¾—ç¼–ç¨‹ç®€å•ï¼Œä½†ç¡¬ä»¶å®ç°å¤æ‚ï¼Œæ‰§è¡Œæ•ˆç‡ä½\nx86æ¶æ„ï¼ˆIntelçš„8086ï¼Œ8088ï¼Œ80286ï¼Œ80386ï¼‰\n2.RISCï¼ˆReduced Instruction Set Computerï¼‰ ç²¾ç®€æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—æœºï¼ŒRISCæŒ‡ä»¤é›†åŒ…å«è¾ƒå°‘çš„ç®€å•æŒ‡ä»¤ï¼Œæ¯æ¡æŒ‡ä»¤åªå®Œæˆä¸€ä¸ªæ“ä½œï¼Œä½¿å¾—ç¡¬ä»¶å®ç°æ›´ç®€å•ï¼Œæ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œä½†ç¼–ç¨‹æ›´å¤æ‚\nARMæ¶æ„ï¼ŒRISC-Væ¶æ„ï¼ŒMIPSæ¶æ„\nå¼€å‘ç¯å¢ƒï¼ˆDEVï¼‰ GUN-GCCç¼–è¯‘å™¨ï¼ŒCMake-\u0026gt;makefile STM32F103C8ï¼ˆC8T6ï¼‰ç»å…¸æ§åˆ¶å™¨ï¼ˆCortex-M3ï¼‰\nç¼–è¯‘ ç¼–è¯‘é“¾å·¥å…· ARM-Cortex-Må¤„ç†å™¨çš„ç¼–è¯‘å™¨å¾ˆå¤šï¼Œå¸¸ç”¨çš„æ˜¯MDK-ARM(ARMå…¬å¸è‡ªç ”çš„)(Keil)ï¼Œä»¥åŠGCC(GNU-Compiler-Collection)\nç¼–è¯‘å™¨ä¹‹é—´çš„æœ€å¤§åŒºåˆ«åœ¨äºæ±‡ç¼–ä¼ªä»£ç ï¼Œé“¾æ¥è¯­æ³•ï¼Œè¿˜æœ‰ä½¿ç”¨å‚æ•° arm-none-eabi\narmæ˜¯æŒ‡armæ¶æ„ï¼Œnoneæ˜¯æŒ‡ç¼–è¯‘å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶æ˜¯è¿è¡Œåœ¨ç¡¬ä»¶ä¸Šï¼Œè€Œä¸æ˜¯æ“ä½œç³»ç»Ÿä¸Šï¼Œeabi(The Embedded-Application Binary Interface)åµŒå…¥å¼åº”ç”¨äºŒè¿›åˆ¶æ¥å£\narm-none-eabi-objcopyæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ç”Ÿæˆå·¥å…·\nåµŒå…¥å¼ç¼–è¯‘çƒ§å½•æµç¨‹ ä¸ªäººæ›´å–œæ¬¢å°†ç¼–è¯‘è¿‡ç¨‹æ‹†è§£ä¸º é¢„ç¼–è¯‘ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–ï¼Œé“¾æ¥\nè½¬æ¢è¿™é‡Œæ˜¯å°†.elfæ–‡ä»¶è½¬æ¢ä¸º.binæ–‡ä»¶ .binæ–‡ä»¶æ˜¯ä»£ç çš„çº¯æœºå™¨ç \nä¸€æ–‡çœ‹æ‡‚hexæ–‡ä»¶ã€binæ–‡ä»¶ã€axfæ–‡ä»¶çš„åŒºåˆ« - çŸ¥ä¹\né¢„ç¼–è¯‘ å°†æ‰€æœ‰å¤´æ–‡ä»¶å’Œå®å±•å¼€ï¼ŒåŒæ—¶å»æ‰æ³¨é‡Šï¼Œç”Ÿæˆ.iæ–‡ä»¶ï¼ˆcä¸­é—´æ–‡ä»¶ï¼‰\nç¼–è¯‘ å°†.iæ–‡ä»¶ç¼–è¯‘ä¸º.sæ±‡ç¼–æ–‡ä»¶ï¼Œç¼–è¯‘ä¼˜åŒ–å‘ç”Ÿåœ¨æ­¤å¤„\næ±‡ç¼– å°†.sæ–‡ä»¶æ±‡ç¼–ä¸º.oäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆæœºå™¨ç ï¼‰ äºŒè¿›åˆ¶æ–‡ä»¶ä¸­è¿˜åŒ…å«å¾ˆå¤šçš„å…¶ä»–ä¿¡æ¯\nåœ¨æ±‡ç¼–æ—¶ï¼Œå¯ä»¥æŒ‡å®šæ±‡ç¼–å™¨çš„å‚æ•°æ¥é€‰æ‹©æŒ‡ä»¤é›†\né“¾æ¥ é“¾æ¥æ˜¯å°†å„ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶é‡Œé¢çš„æœºå™¨ç æ‰€åœ¨çš„å„ä¸ªæ®µæ‹¼æ¥èµ·æ¥ï¼Œä»¥å½¢æˆå¯æ‰§è¡Œæ–‡ä»¶.elfï¼ˆå¸¦æœ‰è°ƒè¯•ä¿¡æ¯ï¼‰\nåœ¨é“¾æ¥è¿™ä¸ªé˜¶æ®µæ‰èƒ½æ£€æµ‹å‡ºæœ‰ä¸æœ‰é‡å¤å®šä¹‰å’Œæœªå®šä¹‰çš„é”™è¯¯\nå¯¹äºGNUæ¥è¯´ï¼Œå¯ä»¥ç¼–å†™.ldé“¾æ¥è„šæœ¬æ¥ç¼–æ’ä»£ç çš„åˆ†åŒºåœ°å€\nè½¬æ¢ é€šè¿‡è½¬æ¢å™¨èƒ½å°†.elfæ–‡ä»¶è½¬æ¢ä¸º.hexå’Œ.binæ–‡ä»¶ï¼Œä¸»è¦ç”¨äºæå–ä¿¡æ¯\n.binæ–‡ä»¶åªåŒ…å«äºŒè¿›åˆ¶æœºå™¨ç  .hexæ–‡ä»¶æ˜¯Intelå®šä¹‰çš„åŒ…å«åœ°å€å’ŒäºŒè¿›åˆ¶æ•°å€¼çš„ASCç æ–‡æœ¬æ–‡ä»¶\nçƒ§å½• çƒ§å½•çš„è¿‡ç¨‹æ˜¯å°†ç¼–è¯‘å¥½çš„æœºå™¨ç å†™åˆ°CPUå­˜å‚¨å™¨ä¸­\nåæ±‡ç¼– GCCä¸­çš„åæ±‡ç¼–å·¥å…·Disassembleræ˜¯arm-none-eabi-objdump\nå¯åŠ¨ ä¸»è¦æ˜¯è®²è§£STM32çš„å¯åŠ¨æµç¨‹\nä¸­æ–­å‘é‡è¡¨ ä¸­æ–­å‘é‡è¡¨çš„æ„å»ºï¼Œæ ¹æ®ä¸åŒçš„ç¼–è¯‘å·¥å…·ï¼Œæœ‰ä¸åŒçš„æ–¹å¼æ„å»º\nä¸­æ–­å‘é‡è¡¨çš„å‰ä¸¤é¡¹ï¼ˆ.woedï¼Œ4å­—èŠ‚ï¼‰æ˜¯æœ€å…³é”®çš„ ç¬¬ä¸€é¡¹æ˜¯å †æ ˆæŒ‡é’ˆçš„å€¼ ç¬¬äºŒé¡¹æ˜¯Reset_Handlerå‡½æ•°å…¥å£\nåœ¨å¯åŠ¨æ—¶ï¼Œéœ€è¦å…ˆè®¾ç½®å †æ ˆæŒ‡é’ˆï¼Œå¦åˆ™æ— æ³•è¿›è¡Œå‹æ ˆçš„æ“ä½œï¼Œä»å®è§‚ä¸Šè¯´ï¼Œæ„å‘³ç€Cè¯­è¨€å‡½æ•°ä½“ä¸èƒ½è°ƒç”¨å­å‡½æ•°\nVTORå¯„å­˜å™¨ï¼Œä¸­æ–­å‘é‡è¡¨åç§»å¯„å­˜å™¨\nå¯åŠ¨åŸç† å¯åŠ¨åï¼Œä»é›¶åœ°å€ï¼ˆé›¶åœ°å€æ˜¯ç»è¿‡æ˜ å°„çš„ï¼‰å¤„è¯»å–å †æ ˆæŒ‡é’ˆå’Œç¨‹åºè®¡æ•°å™¨çš„å€¼ï¼ˆæ­¤æ—¶ç¨‹åºè®¡æ•°å™¨çš„å€¼æŒ‡å‘Reset_Handlerï¼‰ï¼Œæ­¤å¤–æ¯ä¸ªèŠ¯ç‰‡çš„Boot codeæ˜¯å®šåˆ¶åŒ–çš„ï¼Œéœ€è¦å‚è€ƒæ‰‹å†Œ\næœ€åReset_Handlerä¼šæŒ‡å‘mainå‡½æ•°\nä»¥STM32F103ä¸ºä¾‹ è¿™é‡Œæœ‰ä¸‰ç§å¯åŠ¨æ¨¡å¼ï¼Œæ ¹æ®å¯åŠ¨æ—¶BOOT1å’ŒBOOT0çš„ç”µå¹³æ¥é€‰æ‹©ä¸åŒçš„å¯åŠ¨åœ°å€ï¼ˆå³ å°†è¯¥ä¸åŒçš„åœ°å€æ˜ å°„ä¸ºé›¶åœ°å€ï¼‰\nä¸‰ç§å¯åŠ¨æ¨¡å¼åˆ†åˆ«æ˜¯ ä» flash å¼•å¯¼å¯åŠ¨ï¼Œä» system memory å¼•å¯¼å¯åŠ¨ å’Œ ä» SRAM å¼•å¯¼å¯åŠ¨ï¼ˆå³ å°†è¯¥ä¸åŒçš„åœ°å€æ˜ å°„ä¸ºé›¶åœ°å€ï¼‰\nä»ä¸» Flash å¯åŠ¨ï¼šå°†ä¸» Flash åœ°å€ 0x0800 0000 æ˜ å°„åˆ° 0x0000 0000ï¼Œä»£ç å¯åŠ¨åç›¸å½“äºä» 0x0800 0000 å¼€å§‹è¿è¡Œï¼Œä½¿ç”¨ JTAG æˆ–è€… SWD æ¨¡å¼ä¸‹è½½ç¨‹åºæ—¶ä¼šä¸‹è½½åˆ° Flash å¹¶ä»ä¸­å¯åŠ¨ ä»ç³»ç»Ÿå­˜å‚¨å™¨å¯åŠ¨ï¼šå°†ç³»ç»Ÿå­˜å‚¨å™¨åœ°å€ 0x1FFF F000 æ˜ å°„åˆ° 0x0000 0000ï¼Œç³»ç»Ÿå­˜å‚¨å™¨æ˜¯èŠ¯ç‰‡å†…éƒ¨çš„ ROM åŒºåŸŸï¼ŒèŠ¯ç‰‡å‡ºå‚æ—¶åœ¨å…¶ä¸­é¢„ç½®äº† Bootloaderï¼Œç§°ä¸º ISP ç¨‹åºã€‚Bootloader ç”±å‚å®¶è®¾ç½®ï¼Œä¸€èˆ¬æ— æ³•ä¿®æ”¹ ä»å†…ç½® SRAM å¯åŠ¨ï¼šå°† SRAM åœ°å€ 0x2000 0000 æ˜ å°„åˆ° 0x0000 0000ï¼Œä»£ç å¯åŠ¨åç›¸å½“äºä» 0x2000 0000 å¼€å§‹è¿è¡Œã€‚ç”±äº SRAM æ˜¯æ˜“å¤±æ€§å­˜å‚¨å™¨ï¼Œå› æ­¤è¿™ä¸ªæ¨¡å¼ä¸€èˆ¬ä»…ç”¨äºç¨‹åºè°ƒè¯• ï¼ˆä»¥STM32F103ä¸ºä¾‹ï¼‰ å­˜å‚¨åˆ†å¸ƒ ä»¥stm32f103c8t6ä¸ºä¾‹\nFlashåŒº FlashåŒºï¼Œèµ·å§‹ä½ç½®0x8000000\næ®µåç§° èµ·å§‹åœ°å€ ç»“æŸåœ°å€ å†…å®¹ .isr_vector 0x8000 0000 æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ ä¸­æ–­å‘é‡è¡¨ .text ç´§é‚».isr_vectoræœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ ç¨‹åº .rodata ç´§é‚».textæœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ å¸¸é‡ .ARM.extab ç´§é‚».rodataæœ«å°¾ æŒ‰éœ€è®¡ç®— ARMå¼‚å¸¸å¤„ç†ä¿¡æ¯ .ARM.exidx* ç´§é‚».ARM.extabæœ«å°¾ æŒ‰éœ€è®¡ç®— ARMå¼‚å¸¸ç´¢å¼•è¡¨ .preinit_array ç´§é‚».ARM.exidx* æœ«å°¾ æŒ‰éœ€è®¡ç®— C++é¢„åˆå§‹åŒ–æ•°ç»„ .init_array ç´§é‚».preinit_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®— C++æ„é€ å‡½æ•°æ•°ç»„ .fini_array ç´§é‚».init_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®— C++ææ„å‡½æ•°æ•°ç»„ .data ç´§é‚».fini_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ åˆå§‹åŒ–å˜é‡çš„åˆå§‹å€¼ RAMåŒº RAMåŒºï¼Œèµ·å§‹ä½ç½®0x20000000\næ®µåç§° èµ·å§‹åœ°å€ ç»“æŸåœ°å€ å†…å®¹ .data 0x2000 0000 _edataï¼Œæ‹·è´è‡ªFlashåŒº å·²åˆå§‹åŒ–å…¨å±€/é™æ€å˜é‡ .bss _edata _end æœªåˆå§‹åŒ–å…¨å±€/é™æ€å˜é‡ ç³»ç»Ÿå †åº• _end _end å †åº• ç³»ç»Ÿå †æ ˆæœ€å°é¢„ç•™ç©ºé—´ _end _end+é¢„ç•™ç©ºé—´ å †æ ˆé¢„ç•™ç©ºé—´ ç©ºé—²RAM _end+é¢„ç•™ç©ºé—´ _estack ç©ºé—²ç©ºé—´ ç³»ç»Ÿæ ˆåº• _estackï¼ˆRAMæœ«å°¾ï¼‰ _estackï¼ˆRAMæœ«å°¾ï¼‰ æ ˆåº• å¦‚æœä½¿ç”¨äº†FreeRTOSçš„è¯ï¼ŒFreeRTOSçš„å†…å­˜å¸ƒå±€å¦‚ä¸‹\nå†…å­˜åˆ†é…è§„åˆ™ å…¨å±€å˜é‡ã€å±€éƒ¨é™æ€å˜é‡ï¼šæ ¹æ®æ˜¯å¦åˆå§‹åŒ–å†³å®šåˆ†é…åœ¨.dataæ®µæˆ–.bssæ®µ ç”¨constå…³é”®å­—å£°æ˜çš„å¸¸é‡ï¼šåˆ†é…åœ¨Flashä¸­ ä½¿ç”¨Cæ ‡å‡†çš„mallocç”³è¯·çš„å†…å­˜ï¼šåˆ†é…åœ¨ç³»ç»Ÿå †ä¸­ ä¸åœ¨ä»»åŠ¡ä¸­å®šä¹‰çš„ä¸´æ—¶å˜é‡ï¼šåˆ†é…åœ¨ç³»ç»Ÿæ ˆä¸­ ä½¿ç”¨pvPortMallocå¼€è¾Ÿçš„å†…å­˜æˆ–è°ƒç”¨FreeRTOSæ ‡å‡†APIè‡ªåŠ¨åˆ†é…çš„å†…å­˜ï¼šåˆ†é…åœ¨FreeRTOSå †ä¸­ åœ¨ä»»åŠ¡ä¸­å®šä¹‰çš„ä¸´æ—¶å˜é‡ï¼šåˆ†é…åœ¨å¯¹åº”ä»»åŠ¡çš„ä»»åŠ¡æ ˆä¸­ åœ¨ä¸­æ–­ä¸­ä½¿ç”¨*pvPortMallocFromISRåˆ†é…çš„å†…å­˜ï¼šåˆ†é…åœ¨FreeRTOSå †ä¸­ åœ¨ä¸­æ–­ä¸­ç¦æ­¢ä½¿ç”¨Cæ ‡å‡†çš„mallocå’Œfree ä¸­æ–­ä¸­å®šä¹‰çš„ä¸´æ—¶å˜é‡ï¼šåˆ†é…åœ¨ç³»ç»Ÿ å¯åŠ¨æ–‡ä»¶è¯¦è§£ ä¸€ã€STM32F103 å¯åŠ¨æ–‡ä»¶ï¼ˆstartup_stm32f103xb.sï¼‰æ ¸å¿ƒå®šä½ STM32 çš„å¯åŠ¨æ–‡ä»¶ï¼ˆå¦‚startup_stm32f103xb.sï¼‰æ˜¯æ±‡ç¼–è¯­è¨€ç¼–å†™çš„åº•å±‚ç¨‹åºï¼Œæ˜¯ç¡¬ä»¶å¤ä½åæ‰§è¡Œçš„ç¬¬ä¸€æ®µä»£ç ï¼Œè´Ÿè´£è¡”æ¥ â€œç¡¬ä»¶åˆå§‹åŒ–â€ ä¸ â€œç”¨æˆ· C ä»£ç ï¼ˆmainå‡½æ•°ï¼‰â€ã€‚å…¶æ ¸å¿ƒåŠŸèƒ½åŒ…æ‹¬ï¼šè®¾ç½®æ ˆæŒ‡é’ˆã€æ„å»ºä¸­æ–­å‘é‡è¡¨ã€åˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.dataï¼‰ã€æ¸…é›¶æœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.bssï¼‰ã€é…ç½®ç³»ç»Ÿæ—¶é’Ÿï¼Œæœ€ç»ˆå¼•å¯¼ç¨‹åºè¿›å…¥mainå‡½æ•°ï¼Œæ˜¯ STM32 ç¨‹åºè¿è¡Œçš„ â€œåº•å±‚åŸºçŸ³â€ã€‚\näºŒã€å¯åŠ¨æ–‡ä»¶æ•´ä½“ç»“æ„æ‹†è§£ è¯¥å¯åŠ¨æ–‡ä»¶æŒ‰åŠŸèƒ½å¯åˆ’åˆ†ä¸º 5 ä¸ªæ ¸å¿ƒæ¨¡å—ï¼Œå„æ¨¡å—èŒè´£æ˜ç¡®ä¸”ç¯ç¯ç›¸æ‰£ï¼š\næ±‡ç¼–ç¯å¢ƒé…ç½®ï¼šæŒ‡å®šå¤„ç†å™¨æ¶æ„ã€æŒ‡ä»¤é›†ã€æµ®ç‚¹æ¨¡å¼ï¼Œç¡®ä¿æ±‡ç¼–ä»£ç ä¸ç¡¬ä»¶å…¼å®¹ã€‚ å…³é”®ç¬¦å·å£°æ˜ï¼šå¼•ç”¨é“¾æ¥å™¨è„šæœ¬ï¼ˆ.ldï¼‰ä¸­å®šä¹‰çš„å†…å­˜åœ°å€ç¬¦å·ï¼Œå»ºç«‹å¯åŠ¨æ–‡ä»¶ä¸å†…å­˜å¸ƒå±€çš„å…³è”ã€‚ å¤ä½å¤„ç†å‡½æ•°ï¼ˆReset_Handlerï¼‰ï¼šå¤ä½åæ‰§è¡Œçš„æ ¸å¿ƒé€»è¾‘ï¼Œå®Œæˆåˆå§‹åŒ–å¹¶è·³è½¬åˆ°mainã€‚ ä¸­æ–­å‘é‡è¡¨ï¼ˆg_pfnVectorsï¼‰ï¼šå­˜å‚¨æ‰€æœ‰å¼‚å¸¸ / ä¸­æ–­çš„å¤„ç†å‡½æ•°åœ°å€ï¼Œä¾›å†…æ ¸å“åº”ä¸­æ–­æ—¶è°ƒç”¨ã€‚ é»˜è®¤ä¸­æ–­å¤„ç†å‡½æ•°ï¼ˆDefault_Handlerï¼‰ï¼šæœªè‡ªå®šä¹‰çš„ä¸­æ–­ä¼šé»˜è®¤è¿›å…¥æ­¤å¤„ï¼Œé¿å…ç³»ç»Ÿå´©æºƒã€‚ ä¸‰ã€é€æ®µè§£æå¯åŠ¨æ–‡ä»¶ä»£ç  1. æ±‡ç¼–ç¯å¢ƒé…ç½®ï¼ˆå¼€å¤´åŸºç¡€è®¾ç½®ï¼‰ 1 2 3 4 .syntax unified ; ä½¿ç”¨ç»Ÿä¸€æ±‡ç¼–è¯­æ³•ï¼ˆå…¼å®¹ARMä¸ThumbæŒ‡ä»¤é›†ï¼‰ .cpu cortex-m3 ; ç›®æ ‡å¤„ç†å™¨ä¸ºCortex-M3ï¼ˆSTM32F103å†…æ ¸å‹å·ï¼‰ .fpu softvfp ; æµ®ç‚¹æ¨¡å¼ï¼šè½¯ä»¶æ¨¡æ‹Ÿï¼ˆSTM32F103æ— ç¡¬ä»¶FPUï¼‰ .thumb ; å¯ç”¨ThumbæŒ‡ä»¤é›†ï¼ˆCortex-M3ä»…æ”¯æŒThumb/Thumb2æŒ‡ä»¤ï¼‰ ä½œç”¨ï¼šå‘Šè¯‰æ±‡ç¼–å™¨ï¼ˆå¦‚arm-none-eabi-asï¼‰â€œå¦‚ä½•ç¼–è¯‘è¿™æ®µä»£ç â€ï¼Œç¡®ä¿ç”Ÿæˆçš„æŒ‡ä»¤èƒ½è¢« STM32F103 æ­£ç¡®æ‰§è¡Œã€‚ å…³é”®ç»†èŠ‚ï¼šsoftvfpå¯¹åº” STM32F103 çš„ç¡¬ä»¶ç‰¹æ€§ â€”â€” è¯¥å‹å·æ— ç¡¬ä»¶æµ®ç‚¹å¤„ç†å•å…ƒï¼ˆFPUï¼‰ï¼Œéœ€é€šè¿‡è½¯ä»¶æ¨¡æ‹Ÿæµ®ç‚¹è¿ç®—ï¼Œä¸ä¹‹å‰è§£æçš„.ldæ–‡ä»¶ä¸­æœªé…ç½® FPU å‚æ•°å®Œå…¨åŒ¹é…ã€‚ 2. å…³é”®ç¬¦å·å£°æ˜ï¼ˆä¸é“¾æ¥å™¨è„šæœ¬è”åŠ¨ï¼‰ 1 2 3 4 5 6 7 8 9 10 11 .global g_pfnVectors ; å…¨å±€ç¬¦å·ï¼šä¸­æ–­å‘é‡è¡¨ï¼ˆä¾›é“¾æ¥å™¨è¯†åˆ«å¹¶åˆ†é…åœ°å€ï¼‰ .global Default_Handler ; å…¨å±€ç¬¦å·ï¼šé»˜è®¤ä¸­æ–­å¤„ç†å‡½æ•°ï¼ˆä¾›ä¸­æ–­å‘é‡è¡¨å¼•ç”¨ï¼‰ /* å¼•ç”¨é“¾æ¥å™¨è„šæœ¬ï¼ˆ.ldï¼‰ä¸­å®šä¹‰çš„å†…å­˜åœ°å€ç¬¦å· */ .word _sidata ; .dataæ®µåœ¨FLASHä¸­çš„åŠ è½½åœ°å€ï¼ˆLMAï¼Œåˆå§‹å€¼å­˜æ”¾ä½ç½®ï¼‰ .word _sdata ; .dataæ®µåœ¨RAMä¸­çš„è¿è¡Œèµ·å§‹åœ°å€ï¼ˆVMAï¼Œå˜é‡å®é™…å­˜å‚¨ä½ç½®ï¼‰ .word _edata ; .dataæ®µåœ¨RAMä¸­çš„è¿è¡Œç»“æŸåœ°å€ .word _sbss ; .bssæ®µåœ¨RAMä¸­çš„èµ·å§‹åœ°å€ï¼ˆæœªåˆå§‹åŒ–å˜é‡å­˜å‚¨åŒºï¼‰ .word _ebss ; .bssæ®µåœ¨RAMä¸­çš„ç»“æŸåœ°å€ .equ BootRAM, 0xF108F85F ; å®šä¹‰RAMå¯åŠ¨æ¨¡å¼çš„ç‰¹æ®Šåœ°å€ï¼ˆä»…ç”¨äºç‰¹å®šbooté…ç½®ï¼‰ æ ¸å¿ƒæ„ä¹‰ï¼šé€šè¿‡.wordæŒ‡ä»¤å£°æ˜çš„ç¬¦å·ï¼Œç›´æ¥å¼•ç”¨.ldæ–‡ä»¶ä¸­æ ¹æ®ç¡¬ä»¶å†…å­˜å¸ƒå±€ï¼ˆ64K FLASHã€20K RAMï¼‰è®¡ç®—å‡ºçš„åœ°å€ã€‚ä¾‹å¦‚ï¼š _sdataå’Œ_edataç¡®å®šäº†.dataæ®µåœ¨ RAM ä¸­çš„èŒƒå›´ï¼Œ_sidataç¡®å®šäº†å…¶åˆå§‹å€¼åœ¨ FLASH ä¸­çš„ä½ç½®ï¼Œä¸ºåç»­ â€œæ•°æ®æ®µå¤åˆ¶â€ æä¾›åœ°å€ä¾æ®ã€‚ è‹¥ç¼ºå°‘è¿™äº›ç¬¦å·ï¼Œå¯åŠ¨æ–‡ä»¶æ— æ³•çŸ¥é“ â€œæ•°æ®è¯¥ä»å“ªé‡Œå¤åˆ¶åˆ°å“ªé‡Œâ€ï¼Œå†…å­˜åˆå§‹åŒ–ä¼šå½»åº•å¤±è´¥ã€‚ 3. å¤ä½å¤„ç†å‡½æ•°ï¼ˆReset_Handlerï¼šå¯åŠ¨æ ¸å¿ƒé€»è¾‘ï¼‰ Reset_Handleræ˜¯å¤ä½åæ‰§è¡Œçš„ç¬¬ä¸€ä¸ªå‡½æ•°ï¼ˆç”±ä¸­æ–­å‘é‡è¡¨æŒ‡å®šï¼‰ï¼Œå¯¹åº” STM32 å¯åŠ¨æµç¨‹ä¸­çš„ â€œè½¯ä»¶åˆå§‹åŒ–â€ é˜¶æ®µï¼Œä»£ç é€»è¾‘å¯åˆ†ä¸º 5 æ­¥ï¼š\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 .section .text.Reset_Handler ; å°†å‡½æ•°æ”¾å…¥.textæ®µï¼ˆä»£ç æ®µï¼Œ.ldä¸­åˆ†é…åˆ°FLASHï¼‰ .weak Reset_Handler ; å¼±å®šä¹‰ï¼šå…è®¸ç”¨æˆ·ä»£ç é‡å®šä¹‰è¯¥å‡½æ•°ï¼ˆè¦†ç›–é»˜è®¤é€»è¾‘ï¼‰ .type Reset_Handler, %function ; æ ‡è®°ä¸ºå‡½æ•°ç±»å‹ï¼ˆæ±‡ç¼–å™¨è¯†åˆ«å‡½æ•°è¾¹ç•Œï¼‰ Reset_Handler: /* æ­¥éª¤1ï¼šåˆå§‹åŒ–ç³»ç»Ÿæ—¶é’Ÿ */ bl SystemInit ; è·³è½¬åˆ°STM32åº“å‡½æ•°SystemInitï¼ˆé…ç½®HSE/PLLï¼Œå°†æ—¶é’Ÿä»8MHz HSIåˆ‡æ¢åˆ°72MHzï¼‰ /* æ­¥éª¤2ï¼šå¤åˆ¶.dataæ®µï¼ˆä»FLASHåˆ°RAMï¼‰ */ ldr r0, =_sdata ; r0 = .dataæ®µåœ¨RAMçš„èµ·å§‹åœ°å€ï¼ˆVMAï¼‰ ldr r1, =_edata ; r1 = .dataæ®µåœ¨RAMçš„ç»“æŸåœ°å€ ldr r2, =_sidata ; r2 = .dataæ®µåœ¨FLASHçš„åŠ è½½åœ°å€ï¼ˆLMAï¼‰ movs r3, #0 ; r3 = åç§»é‡ï¼ˆåˆå§‹ä¸º0ï¼Œæ¯æ¬¡å¤åˆ¶4å­—èŠ‚åé€’å¢ï¼‰ b LoopCopyDataInit ; è·³è½¬åˆ°å¾ªç¯å¤åˆ¶å…¥å£ CopyDataInit: ldr r4, [r2, r3] ; ä»FLASHè¯»å–æ•°æ®ï¼šr4 = *(r2 + r3)ï¼ˆæºåœ°å€=åŠ è½½åœ°å€+åç§»é‡ï¼‰ str r4, [r0, r3] ; å†™å…¥RAMï¼š*(r0 + r3) = r4ï¼ˆç›®æ ‡åœ°å€=è¿è¡Œåœ°å€+åç§»é‡ï¼‰ adds r3, r3, #4 ; åç§»é‡+4ï¼ˆ32ä½æ•°æ®ï¼Œæ¯æ¬¡å¤åˆ¶1ä¸ªwordï¼‰ LoopCopyDataInit: adds r4, r0, r3 ; r4 = å½“å‰å¤åˆ¶ä½ç½®ï¼ˆè¿è¡Œåœ°å€+åç§»é‡ï¼‰ cmp r4, r1 ; æ¯”è¾ƒå½“å‰ä½ç½®ä¸ç»“æŸåœ°å€ï¼šæ˜¯å¦å¤åˆ¶å®Œæˆï¼Ÿ bcc CopyDataInit ; è‹¥æœªå®Œæˆï¼ˆr4 \u0026lt; r1ï¼‰ï¼Œç»§ç»­å¾ªç¯å¤åˆ¶ /* æ­¥éª¤3ï¼šæ¸…é›¶.bssæ®µï¼ˆæœªåˆå§‹åŒ–å˜é‡åŒºï¼‰ */ ldr r2, =_sbss ; r2 = .bssæ®µåœ¨RAMçš„èµ·å§‹åœ°å€ ldr r4, =_ebss ; r4 = .bssæ®µåœ¨RAMçš„ç»“æŸåœ°å€ movs r3, #0 ; r3 = 0ï¼ˆç”¨äºæ¸…é›¶ï¼‰ b LoopFillZerobss ; è·³è½¬åˆ°å¾ªç¯æ¸…é›¶å…¥å£ FillZerobss: str r3, [r2] ; å°†0å†™å…¥å½“å‰åœ°å€ï¼š*r2 = 0 adds r2, r2, #4 ; åœ°å€+4ï¼ˆæ¯æ¬¡æ¸…é›¶1ä¸ªwordï¼‰ LoopFillZerobss: cmp r2, r4 ; æ¯”è¾ƒå½“å‰åœ°å€ä¸ç»“æŸåœ°å€ï¼šæ˜¯å¦æ¸…é›¶å®Œæˆï¼Ÿ bcc FillZerobss ; è‹¥æœªå®Œæˆï¼ˆr2 \u0026lt; r4ï¼‰ï¼Œç»§ç»­å¾ªç¯æ¸…é›¶ /* æ­¥éª¤4ï¼šåˆå§‹åŒ–C++é™æ€æ„é€ å‡½æ•°ï¼ˆå…¼å®¹C++é¡¹ç›®ï¼‰ */ bl __libc_init_array ; è°ƒç”¨Cåº“å‡½æ•°ï¼Œæ‰§è¡Œå…¨å±€å¯¹è±¡æ„é€ ï¼ˆçº¯Cé¡¹ç›®å¯å¿½ç•¥ï¼Œä¸å½±å“è¿è¡Œï¼‰ /* æ­¥éª¤5ï¼šè·³è½¬åˆ°ç”¨æˆ·mainå‡½æ•° */ bl main ; è·³è½¬åˆ°ç”¨æˆ·Cä»£ç çš„mainå‡½æ•°ï¼ˆå¯åŠ¨æµç¨‹ç»“æŸï¼Œäº¤æƒç»™ç”¨æˆ·ï¼‰ bx lr ; è‹¥mainå‡½æ•°è¿”å›ï¼ˆå®é™…ä¸­mainé€šå¸¸æ˜¯æ­»å¾ªç¯ï¼‰ï¼Œè·³å›å½“å‰ä½ç½®ï¼ˆæ— å®é™…æ„ä¹‰ï¼‰ .size Reset_Handler, .-Reset_Handler ; å®šä¹‰å‡½æ•°å¤§å°ï¼ˆ.è¡¨ç¤ºå½“å‰åœ°å€ï¼Œè®¡ç®—å‡½æ•°é•¿åº¦ï¼‰ å…³é”®æ­¥éª¤è§£è¯»ï¼š ç³»ç»Ÿæ—¶é’Ÿåˆå§‹åŒ–ï¼ˆSystemInitï¼‰ï¼šSTM32 å¤ä½åé»˜è®¤ä½¿ç”¨ 8MHz çš„å†…éƒ¨é«˜é€Ÿæ—¶é’Ÿï¼ˆHSIï¼‰ï¼ŒSystemInitå‡½æ•°ä¼šé…ç½®å¤–éƒ¨é«˜é€Ÿæ—¶é’Ÿï¼ˆHSEï¼‰å’Œé”ç›¸ç¯ï¼ˆPLLï¼‰ï¼Œå°†ç³»ç»Ÿæ—¶é’Ÿæå‡åˆ° 72MHzï¼ˆF103 çš„å¸¸ç”¨å·¥ä½œé¢‘ç‡ï¼‰ï¼Œç¡®ä¿å¤–è®¾å’Œ CPU é«˜æ•ˆè¿è¡Œã€‚ .data æ®µå¤åˆ¶ï¼š.dataæ®µå­˜å‚¨ â€œå·²åˆå§‹åŒ–çš„å…¨å±€ / é™æ€å˜é‡â€ï¼ˆå¦‚int a = 10;ï¼‰ï¼Œè¿™äº›å˜é‡éœ€è¦è¯»å†™æƒé™ï¼Œå› æ­¤è¿è¡Œæ—¶å¿…é¡»åœ¨ RAM ä¸­ï¼›ä½†ç¼–è¯‘æ—¶å…¶åˆå§‹å€¼ä¼šå­˜æ”¾åœ¨ FLASHï¼ˆèŠ‚çœ RAMï¼‰ï¼Œéœ€é€šè¿‡æ­¤æ­¥éª¤å¤åˆ¶åˆ° RAMã€‚ .bss æ®µæ¸…é›¶ï¼š.bssæ®µå­˜å‚¨ â€œæœªåˆå§‹åŒ–çš„å…¨å±€ / é™æ€å˜é‡â€ï¼ˆå¦‚int b;ï¼‰ï¼ŒC è¯­è¨€æ ‡å‡†è¦æ±‚å…¶åˆå§‹å€¼ä¸º 0ï¼Œå› æ­¤æ— éœ€åœ¨ FLASH ä¸­å­˜å‚¨åˆå§‹å€¼ï¼Œç›´æ¥å°† RAM å¯¹åº”åŒºåŸŸæ¸…é›¶å³å¯ã€‚ è·³è½¬åˆ°mainï¼šè¿™æ˜¯å¯åŠ¨æ–‡ä»¶çš„ â€œæœ€ç»ˆç›®æ ‡â€â€”â€” å®Œæˆæ‰€æœ‰åº•å±‚åˆå§‹åŒ–åï¼Œå°†ç¨‹åºæ§åˆ¶æƒäº¤ç»™ç”¨æˆ·ä»£ç ï¼Œæ­£å¼è¿›å…¥åº”ç”¨é€»è¾‘ã€‚ 4. ä¸­æ–­å‘é‡è¡¨ï¼ˆg_pfnVectorsï¼šä¸­æ–­å“åº”çš„ â€œåœ°å€ç°¿â€ï¼‰ ä¸­æ–­å‘é‡è¡¨æ˜¯Cortex-M3 å†…æ ¸å¤ä½åè®¿é—®çš„ç¬¬ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œå­˜å‚¨äº†æ‰€æœ‰å¼‚å¸¸ï¼ˆå¦‚å¤ä½ã€ç¡¬ faultï¼‰å’Œå¤–è®¾ä¸­æ–­ï¼ˆå¦‚ä¸²å£ã€å®šæ—¶å™¨ï¼‰çš„å¤„ç†å‡½æ•°åœ°å€ã€‚å½“å‘ç”Ÿä¸­æ–­ / å¼‚å¸¸æ—¶ï¼Œå†…æ ¸ä¼šä»å‘é‡è¡¨ä¸­æ‰¾åˆ°å¯¹åº”åœ°å€ï¼Œè·³è½¬åˆ°å¤„ç†å‡½æ•°æ‰§è¡Œã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 .section .isr_vector,\u0026#34;a\u0026#34;,%progbits ; å°†å‘é‡è¡¨æ”¾å…¥.isr_vectoræ®µï¼ˆ.ldä¸­åˆ†é…åˆ°FLASHèµ·å§‹åœ°å€0x8000000ï¼‰ .type g_pfnVectors, %object ; æ ‡è®°ä¸ºæ•°æ®å¯¹è±¡ï¼ˆè€Œéå‡½æ•°ï¼‰ .size g_pfnVectors, .-g_pfnVectors ; å®šä¹‰å‘é‡è¡¨å¤§å°ï¼ˆè®¡ç®—è¡¨çš„æ€»å­—èŠ‚æ•°ï¼‰ g_pfnVectors: .word _estack ; ç¬¬0ä¸ªå…ƒç´ ï¼šæ ˆé¡¶åœ°å€ï¼ˆMSPåˆå§‹å€¼ï¼Œæ¥è‡ª.ldæ–‡ä»¶ï¼‰ .word Reset_Handler ; ç¬¬1ä¸ªå…ƒç´ ï¼šå¤ä½å¤„ç†å‡½æ•°åœ°å€ï¼ˆå¤ä½åPCæŒ‡å‘è¿™é‡Œï¼‰ .word NMI_Handler ; ç¬¬2ä¸ªå…ƒç´ ï¼šä¸å¯å±è”½ä¸­æ–­ï¼ˆNMIï¼‰å¤„ç†å‡½æ•° .word HardFault_Handler ; ç¬¬3ä¸ªå…ƒç´ ï¼šç¡¬faultå¼‚å¸¸å¤„ç†å‡½æ•°ï¼ˆä¸¥é‡é”™è¯¯ï¼Œå¦‚å†…å­˜è®¿é—®è¶Šç•Œï¼‰ .word MemManage_Handler ; ç¬¬4ä¸ªå…ƒç´ ï¼šå†…å­˜ç®¡ç†å¼‚å¸¸å¤„ç†å‡½æ•° .word BusFault_Handler ; ç¬¬5ä¸ªå…ƒç´ ï¼šæ€»çº¿faultå¼‚å¸¸å¤„ç†å‡½æ•°ï¼ˆå¦‚è®¿é—®ä¸å­˜åœ¨çš„å¤–è®¾åœ°å€ï¼‰ .word UsageFault_Handler ; ç¬¬6ä¸ªå…ƒç´ ï¼šç”¨æ³•faultå¼‚å¸¸å¤„ç†å‡½æ•°ï¼ˆå¦‚æŒ‡ä»¤é”™è¯¯ï¼‰ .word 0 ; ç¬¬7-10ä¸ªå…ƒç´ ï¼šä¿ç•™ï¼ˆæœªä½¿ç”¨ï¼‰ .word 0 .word 0 .word 0 .word SVC_Handler ; ç¬¬11ä¸ªå…ƒç´ ï¼šç³»ç»ŸæœåŠ¡è°ƒç”¨ï¼ˆSVCï¼‰å¤„ç†å‡½æ•°ï¼ˆOSå¸¸ç”¨ï¼‰ .word DebugMon_Handler ; ç¬¬12ä¸ªå…ƒç´ ï¼šè°ƒè¯•ç›‘æ§å¤„ç†å‡½æ•° .word 0 ; ç¬¬13ä¸ªå…ƒç´ ï¼šä¿ç•™ .word PendSV_Handler ; ç¬¬14ä¸ªå…ƒç´ ï¼šPendSVå¼‚å¸¸å¤„ç†å‡½æ•°ï¼ˆä»»åŠ¡åˆ‡æ¢å¸¸ç”¨ï¼‰ .word SysTick_Handler ; ç¬¬15ä¸ªå…ƒç´ ï¼šç³»ç»Ÿæ»´ç­”å®šæ—¶å™¨ï¼ˆSysTickï¼‰å¤„ç†å‡½æ•° /* ä»¥ä¸‹ä¸ºå¤–è®¾ä¸­æ–­å‘é‡ï¼ˆç¬¬16ä¸ªå…ƒç´ å¼€å§‹ï¼‰ */ .word WWDG_IRQHandler ; çª—å£çœ‹é—¨ç‹—ä¸­æ–­ .word PVD_IRQHandler ; ç”µæºç”µå‹æ£€æµ‹ä¸­æ–­ .word TAMPER_IRQHandler ; ç¯¡æ”¹æ£€æµ‹ä¸­æ–­ .word RTC_IRQHandler ; RTCæ—¶é’Ÿä¸­æ–­ .word FLASH_IRQHandler ; FLASHæ“ä½œä¸­æ–­ .word RCC_IRQHandler ; RCCæ—¶é’Ÿæ§åˆ¶ä¸­æ–­ .word EXTI0_IRQHandler ; å¤–éƒ¨ä¸­æ–­0ï¼ˆå¦‚PA0ï¼‰ä¸­æ–­ ...ï¼ˆçœç•¥å…¶ä½™å¤–è®¾ä¸­æ–­ï¼Œå…±60+ä¸ªï¼Œå¯¹åº”F103æ‰€æœ‰å¤–è®¾ï¼‰... .word BootRAM ; RAMå¯åŠ¨æ¨¡å¼çš„ç‰¹æ®Šåœ°å€ï¼ˆä»…ç”¨äºä»RAMå¯åŠ¨ï¼Œé»˜è®¤ä»FLASHå¯åŠ¨æ—¶æ— ç”¨ï¼‰ æ ¸å¿ƒç‰¹æ€§ï¼š ä½ç½®å›ºå®šï¼šåœ¨.ldæ–‡ä»¶ä¸­ï¼Œ.isr_vectoræ®µè¢«å¼ºåˆ¶åˆ†é…åˆ° FLASH èµ·å§‹åœ°å€ï¼ˆ0x8000000ï¼‰ï¼Œè¿™æ˜¯ Cortex-M3 å†…æ ¸çš„ç¡¬ä»¶è§„å®š â€”â€” å¤ä½åå†…æ ¸ä¼šè‡ªåŠ¨ä»0x8000000è¯»å–å‘é‡è¡¨ã€‚ ç¬¬ 0 ä¸ªå…ƒç´ å¿…ä¸ºæ ˆé¡¶ï¼šå†…æ ¸å¤ä½ååšçš„ç¬¬ä¸€ä»¶äº‹æ˜¯ â€œåˆå§‹åŒ–æ ˆæŒ‡é’ˆï¼ˆMSPï¼‰â€ï¼Œå› æ­¤å‘é‡è¡¨ç¬¬ 0 ä¸ªå…ƒç´ å¿…é¡»æ˜¯æ ˆé¡¶åœ°å€ï¼ˆ_estackï¼Œæ¥è‡ª.ld æ–‡ä»¶ï¼‰ï¼Œå¦åˆ™åç»­å‡½æ•°è°ƒç”¨ã€å±€éƒ¨å˜é‡å­˜å‚¨ä¼šå› æ ˆåœ°å€é”™è¯¯å´©æºƒã€‚ ä¸­æ–­ä¼˜å…ˆçº§éšå«ï¼šå‘é‡è¡¨ä¸­å…ƒç´ çš„é¡ºåºå¯¹åº”ä¸­æ–­ / å¼‚å¸¸çš„ä¼˜å…ˆçº§ï¼ˆé å‰çš„ä¼˜å…ˆçº§æ›´é«˜ï¼‰ï¼Œä¾‹å¦‚ â€œç¡¬ faultâ€ï¼ˆç¬¬ 3 ä¸ªå…ƒç´ ï¼‰ä¼˜å…ˆçº§é«˜äº â€œSysTickâ€ï¼ˆç¬¬ 15 ä¸ªå…ƒç´ ï¼‰ã€‚ 5. é»˜è®¤ä¸­æ–­å¤„ç†å‡½æ•°ï¼ˆDefault_Handlerï¼šä¸­æ–­ â€œå…œåº•â€ é€»è¾‘ï¼‰ å½“ç”¨æˆ·æœªä¸ºæŸä¸ªä¸­æ–­å®šä¹‰å¤„ç†å‡½æ•°æ—¶ï¼Œä¸­æ–­å‘é‡è¡¨ä¼šå°†è¯¥ä¸­æ–­çš„åœ°å€æŒ‡å‘Default_Handlerï¼Œé¿å…ç³»ç»Ÿå›  â€œæ‰¾ä¸åˆ°ä¸­æ–­å¤„ç†å‡½æ•°â€ è€Œè¿›å…¥æœªçŸ¥çŠ¶æ€ã€‚\n1 2 3 4 5 .section .text.Default_Handler,\u0026#34;ax\u0026#34;,%progbits ; æ”¾å…¥.textæ®µï¼Œå±æ€§ä¸ºå¯æ‰§è¡Œï¼ˆaxï¼‰ Default_Handler: Infinite_Loop: b Infinite_Loop ; æ— é™å¾ªç¯ï¼ˆæ­»å¾ªç¯ï¼‰ï¼Œé˜²æ­¢ç¨‹åºè·‘é£ .size Default_Handler, .-Default_Handler ; å®šä¹‰å‡½æ•°å¤§å° å¼±åˆ«åæœºåˆ¶ï¼ˆç”¨æˆ·å¯é‡å®šä¹‰ä¸­æ–­å‡½æ•°ï¼‰ å¯åŠ¨æ–‡ä»¶é€šè¿‡ â€œå¼±åˆ«åï¼ˆ.weakï¼‰â€ å…è®¸ç”¨æˆ·åœ¨ C ä»£ç ä¸­é‡å®šä¹‰ä¸­æ–­å¤„ç†å‡½æ•°ï¼Œå…·ä½“é€»è¾‘å¦‚ä¸‹ï¼š\n1 2 .weak NMI_Handler ; å¼±å®šä¹‰ï¼šNMI_Handlerå¯è¢«ç”¨æˆ·ä»£ç è¦†ç›– .thumb_set NMI_Handler,Default_Handler ; è‹¥ç”¨æˆ·æœªå®šä¹‰ï¼ŒNMI_Handleré»˜è®¤æŒ‡å‘Default_Handler å·¥ä½œåŸç†ï¼š .weakæ ‡è®°è¡¨ç¤º â€œè¯¥ç¬¦å·æ˜¯å¼±å®šä¹‰çš„ï¼Œè‹¥ç”¨æˆ·å®šä¹‰äº†åŒåç¬¦å·ï¼Œä¼˜å…ˆä½¿ç”¨ç”¨æˆ·å®šä¹‰çš„ç‰ˆæœ¬â€ã€‚ ç”¨æˆ·åªéœ€åœ¨ C ä»£ç ä¸­ç¼–å†™void USART1_IRQHandler(void) { ... }ï¼Œé“¾æ¥æ—¶ä¼šè‡ªåŠ¨è¦†ç›–å¯åŠ¨æ–‡ä»¶ä¸­çš„å¼±å®šä¹‰ï¼Œä½¿ä¸²å£ 1 ä¸­æ–­è§¦å‘æ—¶æ‰§è¡Œç”¨æˆ·ä»£ç ã€‚ è‹¥ç”¨æˆ·æœªå®šä¹‰ï¼Œåˆ™ä½¿ç”¨é»˜è®¤çš„Default_Handlerï¼ˆæ— é™å¾ªç¯ï¼‰ã€‚ å››ã€å¯åŠ¨æ–‡ä»¶ä¸é“¾æ¥å™¨è„šæœ¬ï¼ˆ.ldï¼‰çš„é…åˆå…³ç³» å¯åŠ¨æ–‡ä»¶ä¸.ldæ–‡ä»¶æ˜¯ç´§å¯†è€¦åˆçš„ â€œæ­æ¡£â€ï¼ŒäºŒè€…é€šè¿‡ â€œå…¨å±€ç¬¦å·â€ å’Œ â€œæ®µåˆ†é…â€ ååŒå·¥ä½œï¼Œç¼ºä¸€ä¸å¯ï¼š\nåä½œç»´åº¦ å¯åŠ¨æ–‡ä»¶è§’è‰² é“¾æ¥å™¨è„šæœ¬ï¼ˆ.ldï¼‰è§’è‰² å†…å­˜åœ°å€æä¾› å¼•ç”¨.ldå®šä¹‰çš„_sdataã€_ebssã€_estackç­‰ç¬¦å· æ ¹æ®ç¡¬ä»¶å†…å­˜å¸ƒå±€ï¼ˆ64K FLASHã€20K RAMï¼‰è®¡ç®—å¹¶å®šä¹‰è¿™äº›ç¬¦å· æ®µåˆ†é…ä¾æ® å°†Reset_Handleræ”¾å…¥.textæ®µã€å‘é‡è¡¨æ”¾å…¥.isr_vectoræ®µ è§„å®š.textã€.isr_vectorç­‰æ®µçš„å­˜å‚¨ä½ç½®ï¼ˆå¦‚.isr_vectoråˆ†é…åˆ° FLASH èµ·å§‹åœ°å€ï¼‰ ç¨‹åºå…¥å£æŒ‡å®š å®ç°Reset_Handlerå‡½æ•°ï¼ˆå…¥å£é€»è¾‘ï¼‰ é€šè¿‡ENTRY(Reset_Handler)æŒ‡å®šç¨‹åºå…¥å£ä¸ºè¯¥å‡½æ•° å†…å­˜åˆæ³•æ€§æ£€æŸ¥ ä¾èµ–.ldç¡®ä¿_sdataã€_ebssä¸è¶…å‡º RAM èŒƒå›´ æ£€æŸ¥å †ã€æ ˆã€æ•°æ®æ®µæ€»å¤§å°æ˜¯å¦è¶…è¿‡ RAM/FLASH å®¹é‡ï¼Œæº¢å‡ºåˆ™æŠ¥é”™ äº”ã€æ€»ç»“ï¼šå¯åŠ¨æ–‡ä»¶çš„æ ¸å¿ƒä»·å€¼ STM32 å¯åŠ¨æ–‡ä»¶æ˜¯ â€œä»ç¡¬ä»¶åˆ°è½¯ä»¶çš„æ¡¥æ¢â€ï¼Œå…¶æ ¸å¿ƒä½œç”¨å¯æ¦‚æ‹¬ä¸º 3 ç‚¹ï¼š\nç¡¬ä»¶åˆå§‹åŒ–ï¼šå®Œæˆæ ˆæŒ‡é’ˆè®¾ç½®ã€ç³»ç»Ÿæ—¶é’Ÿé…ç½®ï¼Œä¸ºç¨‹åºè¿è¡Œæä¾›åŸºç¡€ç¡¬ä»¶ç¯å¢ƒã€‚ å†…å­˜åˆå§‹åŒ–ï¼šé€šè¿‡å¤åˆ¶.dataæ®µã€æ¸…é›¶.bssæ®µï¼Œç¡®ä¿å…¨å±€ / é™æ€å˜é‡ç¬¦åˆ C è¯­è¨€æ ‡å‡†è¦æ±‚ã€‚ ä¸­æ–­ç³»ç»Ÿå‡†å¤‡ï¼šæ„å»ºä¸­æ–­å‘é‡è¡¨ï¼Œæä¾›é»˜è®¤ä¸­æ–­å¤„ç†é€»è¾‘ï¼Œæ”¯æŒç”¨æˆ·è‡ªå®šä¹‰ä¸­æ–­å‡½æ•°ã€‚ å¼•å¯¼ç”¨æˆ·ä»£ç ï¼šæœ€ç»ˆè·³è½¬åˆ°mainå‡½æ•°ï¼Œå°†ç¨‹åºæ§åˆ¶æƒäº¤ç»™ç”¨æˆ·ï¼Œå®Œæˆ â€œåº•å±‚åˆå§‹åŒ–â†’åº”ç”¨é€»è¾‘â€ çš„è¿‡æ¸¡ã€‚ ç®€è¨€ä¹‹ï¼šæ²¡æœ‰å¯åŠ¨æ–‡ä»¶ï¼ŒSTM32 å¤ä½åæ— æ³•å®Œæˆä»»ä½•åˆå§‹åŒ–ï¼Œæ›´æ— æ³•è¿›å…¥mainå‡½æ•° â€”â€” å®ƒæ˜¯ STM32 ç¨‹åºè¿è¡Œçš„ â€œç¬¬ä¸€å—æ‹¼å›¾â€ã€‚ STM32 å¯åŠ¨æµç¨‹ã€.ld æ–‡ä»¶ä½œç”¨åŠç¤ºä¾‹è§£æ è¦ç†è§£ STM32 çš„å¯åŠ¨æµç¨‹ã€.ldæ–‡ä»¶ï¼ˆé“¾æ¥å™¨è„šæœ¬ï¼‰çš„ä½œç”¨ï¼Œä»¥åŠä½ æä¾›çš„å…·ä½“.ldæ–‡ä»¶å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦ä»å®è§‚å¯åŠ¨é€»è¾‘åˆ°é“¾æ¥å™¨è„šæœ¬ç»†èŠ‚é€æ­¥æ‹†è§£ï¼Œæœ€ç»ˆå»ºç«‹ä¸¤è€…çš„å…³è”ã€‚\nä¸€ã€STM32 çš„å¯åŠ¨æµç¨‹ï¼ˆä»å¤ä½åˆ°mainå‡½æ•°ï¼‰ STM32 çš„å¯åŠ¨æµç¨‹æ˜¯ç¡¬ä»¶å¤ä½â†’å†…æ ¸åˆå§‹åŒ–â†’è½¯ä»¶åˆå§‹åŒ–â†’è¿›å…¥mainÂ çš„è¿‡ç¨‹ï¼Œæ ¸å¿ƒä¾èµ–ã€Œä¸­æ–­å‘é‡è¡¨ã€å’Œã€Œå¯åŠ¨æ–‡ä»¶ã€ï¼Œè€Œ.ldæ–‡ä»¶ä¸ºè¿™ä¸ªæµç¨‹æä¾›äº†å†…å­˜åœ°å€æ˜ å°„å’Œæ®µåˆ†é…è§„åˆ™ã€‚\n1. ç¡¬ä»¶å¤ä½ï¼šPC æŒ‡é’ˆçš„åˆå§‹æŒ‡å‘ å½“ STM32 ä¸Šç”µæˆ–å¤ä½æ—¶ï¼ŒCortex-M å†…æ ¸ä¼šè‡ªåŠ¨æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š\nè¯»å–ä¸­æ–­å‘é‡è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼ˆæ ˆé¡¶åœ°å€_estackï¼‰ï¼Œåˆå§‹åŒ–ä¸»æ ˆæŒ‡é’ˆï¼ˆMSPï¼‰â€”â€” è¿™æ˜¯å†…æ ¸æ‰§è¡Œçš„ç¬¬ä¸€ä¸ªåŠ¨ä½œï¼Œå› ä¸ºå‡½æ•°è°ƒç”¨ã€å±€éƒ¨å˜é‡éƒ½ä¾èµ–æ ˆã€‚ å°†ç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰æŒ‡å‘ä¸­æ–­å‘é‡è¡¨çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼ˆReset_Handlerçš„åœ°å€ï¼‰â€”â€” è¿™æ˜¯å¤ä½åçš„ç¬¬ä¸€ä¸ªæ‰§è¡Œå‡½æ•°ï¼ˆå¯åŠ¨æµç¨‹çš„å…¥å£ï¼‰ã€‚ å…³é”®ï¼šä¸­æ–­å‘é‡è¡¨çš„é»˜è®¤åœ°å€æ˜¯0x8000000ï¼ˆSTM32 FLASH çš„èµ·å§‹åœ°å€ï¼‰ï¼Œè¿™ä¹Ÿæ˜¯.ldæ–‡ä»¶ä¸­FLASHçš„ORIGINï¼ˆèµ·å§‹åœ°å€ï¼‰è®¾ç½®ä¸º0x8000000çš„åŸå› ã€‚\n2. æ‰§è¡ŒReset_Handlerï¼ˆå¯åŠ¨æ–‡ä»¶æ ¸å¿ƒé€»è¾‘ï¼‰ Reset_Handleræ˜¯å¯åŠ¨æ–‡ä»¶ï¼ˆå¦‚startup_stm32f103c8tx.sï¼‰ä¸­çš„æ±‡ç¼–å‡½æ•°ï¼Œæ˜¯è½¯ä»¶åˆå§‹åŒ–çš„æ ¸å¿ƒï¼Œå…¶é€»è¾‘å®Œå…¨ä¾èµ–.ldæ–‡ä»¶å®šä¹‰çš„å…¨å±€ç¬¦å·ï¼ˆå¦‚_sdataã€_ebssï¼‰ï¼Œå…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š\nåˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.dataï¼‰ï¼š\n.dataæ®µå­˜æ”¾ã€Œåˆå§‹åŒ–è¿‡çš„å…¨å±€ / é™æ€å˜é‡ã€ï¼ˆå¦‚int a = 10;ï¼‰ï¼Œè¿™äº›å˜é‡éœ€è¦è¯»å†™æƒé™ï¼Œå› æ­¤è¿è¡Œæ—¶å¿…é¡»åœ¨ RAM ä¸­ï¼›ä½†ç¼–è¯‘æ—¶ä¼šæŠŠå®ƒä»¬çš„åˆå§‹å€¼å­˜æ”¾åœ¨ FLASH ä¸­ï¼ˆèŠ‚çœ RAM ç©ºé—´ï¼‰ã€‚\nReset_Handlerä¼šæ‰§è¡Œå¤åˆ¶æ“ä½œï¼šä».ldæ–‡ä»¶å®šä¹‰çš„_sidataï¼ˆ.data åœ¨ FLASH çš„åŠ è½½åœ°å€ï¼‰å¤åˆ¶åˆ°_sdataï¼ˆ.data åœ¨ RAM çš„è¿è¡Œåœ°å€ï¼‰ï¼Œç›´åˆ°_edataï¼ˆ.data çš„ç»“æŸåœ°å€ï¼‰ã€‚\næ¸…é›¶æœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆ.bssï¼‰ï¼š\n.bssæ®µå­˜æ”¾ã€Œæœªåˆå§‹åŒ–çš„å…¨å±€ / é™æ€å˜é‡ã€ï¼ˆå¦‚int b;ï¼‰ï¼ŒC è¯­è¨€æ ‡å‡†è¦æ±‚å®ƒä»¬åˆå§‹åŒ–ä¸º 0ã€‚\nReset_Handlerä¼šå°†_sbssï¼ˆ.bss çš„èµ·å§‹åœ°å€ï¼‰åˆ°_ebssï¼ˆ.bss çš„ç»“æŸåœ°å€ï¼‰çš„ RAM åŒºåŸŸå…¨éƒ¨æ¸…é›¶ã€‚\nåˆå§‹åŒ–ç³»ç»Ÿæ—¶é’Ÿï¼ˆSystemInitï¼‰ï¼š\nè°ƒç”¨SystemInitå‡½æ•°ï¼ˆç”± STM32 æ ‡å‡†åº“ / LL åº“æä¾›ï¼‰ï¼Œé…ç½® HSE/PLL ç­‰ï¼Œå°†ç³»ç»Ÿæ—¶é’Ÿä»é»˜è®¤çš„ HSIï¼ˆ8MHzï¼‰åˆ‡æ¢åˆ°æ›´é«˜é¢‘ç‡ï¼ˆå¦‚ 72MHzï¼‰ã€‚\nè°ƒç”¨mainå‡½æ•°ï¼š\nå®Œæˆæ‰€æœ‰åˆå§‹åŒ–åï¼Œè·³è½¬åˆ° C è¯­è¨€çš„mainå‡½æ•°ï¼Œè¿›å…¥ç”¨æˆ·åº”ç”¨é€»è¾‘ã€‚\n3. å¼‚å¸¸ / ä¸­æ–­çš„è§¦å‘ï¼ˆè¡¥å……ï¼‰ è‹¥ç¨‹åºè¿è¡Œä¸­è§¦å‘ä¸­æ–­ï¼ˆå¦‚å®šæ—¶å™¨ã€ä¸²å£ï¼‰ï¼Œå†…æ ¸ä¼šå†æ¬¡è¯»å–ã€Œä¸­æ–­å‘é‡è¡¨ã€ï¼Œæ ¹æ®ä¸­æ–­å·æ‰¾åˆ°å¯¹åº”çš„ä¸­æ–­æœåŠ¡å‡½æ•°ï¼ˆISRï¼‰åœ°å€ï¼Œè·³è½¬åˆ° ISR æ‰§è¡Œï¼Œæ‰§è¡Œå®Œæˆåè¿”å›æ–­ç‚¹ç»§ç»­è¿è¡Œã€‚\näºŒã€.ld æ–‡ä»¶ï¼ˆé“¾æ¥å™¨è„šæœ¬ï¼‰çš„æ ¸å¿ƒä½œç”¨ .ldæ–‡ä»¶æ˜¯é“¾æ¥å™¨ï¼ˆldï¼‰çš„é…ç½®æ–‡ä»¶ï¼Œå…¶æœ¬è´¨æ˜¯å‘Šè¯‰é“¾æ¥å™¨ï¼š\nèŠ¯ç‰‡çš„å†…å­˜å¸ƒå±€ï¼šFLASHï¼ˆåªè¯»ã€å­˜ä»£ç  / å¸¸é‡ï¼‰å’Œ RAMï¼ˆå¯è¯»å†™ã€å­˜å˜é‡ / æ ˆ / å †ï¼‰çš„èµ·å§‹åœ°å€å’Œå¤§å°ã€‚ ä»£ç  / æ•°æ®çš„æ®µåˆ†é…è§„åˆ™ï¼šå°†ç¼–è¯‘ç”Ÿæˆçš„å„ä¸ªã€Œæ®µï¼ˆSectionï¼‰ã€ï¼ˆå¦‚.textã€.dataï¼‰åˆ†é…åˆ°å¯¹åº”çš„å†…å­˜åŒºåŸŸï¼ˆFLASH/RAMï¼‰ã€‚ å®šä¹‰å…¨å±€ç¬¦å·ï¼šç”Ÿæˆ_sdataã€_ebssã€_estackç­‰ç¬¦å·ï¼Œä¾›å¯åŠ¨æ–‡ä»¶å’Œç”¨æˆ·ä»£ç ä½¿ç”¨ï¼ˆå¦‚å¯åŠ¨æ–‡ä»¶ä¾èµ–è¿™äº›ç¬¦å·åˆå§‹åŒ–å†…å­˜ï¼‰ã€‚ å†…å­˜åˆæ³•æ€§æ£€æŸ¥ï¼šç¡®ä¿å †ã€æ ˆã€æ•°æ®æ®µçš„æ€»å¤§å°ä¸è¶…è¿‡ RAM/FLASH çš„å®é™…å®¹é‡ï¼Œé¿å…å†…å­˜æº¢å‡ºã€‚ ç®€å•è¯´ï¼šæ²¡æœ‰.ldæ–‡ä»¶ï¼Œé“¾æ¥å™¨æ— æ³•çŸ¥é“ â€œä»£ç è¯¥æ”¾å“ªé‡Œã€å˜é‡è¯¥æ”¾å“ªé‡Œâ€ï¼Œæ— æ³•ç”Ÿæˆå¯æ‰§è¡Œçš„.elf/.hexæ–‡ä»¶ã€‚ ä¸‰ã€è§£æ STM32F103C8Tx çš„.ld æ–‡ä»¶ ä»¥ä¸‹æŒ‰æ–‡ä»¶ç»“æ„é€æ®µè§£æï¼Œç»“åˆ STM32F103C8Tx çš„ç¡¬ä»¶å‚æ•°ï¼ˆ64K FLASHã€20K RAMï¼‰è¯´æ˜æ¯éƒ¨åˆ†çš„ä½œç”¨ã€‚\n1. å…¥å£ç‚¹ä¸æ ˆé¡¶å®šä¹‰ 1 2 3 4 5 6 7 8 /* Entry Point */ ENTRY(Reset_Handler) // å®šä¹‰ç¨‹åºçš„å…¥å£å‡½æ•°ï¼šReset_Handlerï¼ˆä¸å¯åŠ¨æ–‡ä»¶å¯¹åº”ï¼‰ /* Highest address of the user mode stack */ _estack = ORIGIN(RAM) + LENGTH(RAM); // æ ˆé¡¶åœ°å€ = RAMèµ·å§‹åœ°å€ + RAMæ€»å¤§å° /* Generate a link error if heap and stack don\u0026#39;t fit into RAM */ _Min_Heap_Size = 0x200; // æœ€å°å †å¤§å°ï¼ˆ512å­—èŠ‚ï¼Œä¾›mallocä½¿ç”¨ï¼‰ _Min_Stack_Size = 0xF00; // æœ€å°æ ˆå¤§å°ï¼ˆ3840å­—èŠ‚ï¼Œä¾›å‡½æ•°è°ƒç”¨/å±€éƒ¨å˜é‡ä½¿ç”¨ï¼‰ ENTRY(Reset_Handler)ï¼šå¼ºåˆ¶é“¾æ¥å™¨å°†Reset_Handlerä½œä¸ºç¨‹åºç¬¬ä¸€ä¸ªæ‰§è¡Œçš„å‡½æ•°ï¼Œä¸å¯åŠ¨æµç¨‹ä¸­ PC æŒ‡å‘Reset_Handlerå®Œå…¨å¯¹åº”ã€‚ _estackï¼šå®šä¹‰æ ˆé¡¶åœ°å€ï¼ˆSTM32F103C8Tx çš„ RAM æ˜¯0x20000000~0x20004FFFï¼Œå› æ­¤_estack=0x20005000ï¼‰ï¼Œå¯åŠ¨æ–‡ä»¶ä¼šå°†è¿™ä¸ªåœ°å€åŠ è½½åˆ° MSPï¼ˆä¸»æ ˆæŒ‡é’ˆï¼‰ã€‚ å † / æ ˆå¤§å°ï¼š_Min_Heap_Sizeå’Œ_Min_Stack_Sizeæ˜¯æœ€å°è¦æ±‚ï¼Œè‹¥ç”¨æˆ·ä»£ç ä¸­å † / æ ˆä½¿ç”¨è¶…è¿‡è¿™ä¸ªå€¼ï¼Œé“¾æ¥å™¨ä¼šæŠ¥é”™ï¼ˆé˜²æ­¢ RAM æº¢å‡ºï¼‰ï¼Œå¯æ ¹æ®éœ€æ±‚è°ƒæ•´ï¼ˆå¦‚æ ˆä¸å¤Ÿæ—¶å¢å¤§_Min_Stack_Sizeï¼‰ã€‚ 2. å†…å­˜åŒºåŸŸå®šä¹‰ï¼ˆMEMORY å—ï¼‰ 1 2 3 4 5 6 /* Specify the memory areas */ MEMORY { RAM (xrw) : ORIGIN = 0x20000000, LENGTH = 20K // RAMåŒºåŸŸ FLASH (rx) : ORIGIN = 0x8000000, LENGTH = 64K // FLASHåŒºåŸŸ } è¿™æ˜¯.ldæ–‡ä»¶çš„æ ¸å¿ƒï¼Œå®šä¹‰äº†èŠ¯ç‰‡çš„ç‰©ç†å†…å­˜å±æ€§ï¼š\nRAM (xrw)ï¼š xrwï¼šæƒé™ï¼ˆx= å¯æ‰§è¡Œï¼Œr= å¯è¯»ï¼Œw= å¯å†™ï¼‰â€”â€”RAM æ”¯æŒè¯»å†™ï¼Œç†è®ºä¸Šå¯æ‰§è¡Œï¼ˆä½†é€šå¸¸ä¸æ”¾ä»£ç ï¼‰ã€‚ ORIGIN = 0x20000000ï¼šSTM32 æ‰€æœ‰ Cortex-M3 å†…æ ¸èŠ¯ç‰‡çš„ RAM èµ·å§‹åœ°å€ï¼ˆç¡¬ä»¶è§„å®šï¼‰ã€‚ LENGTH = 20Kï¼šSTM32F103C8Tx çš„ RAM å®é™…å¤§å°ï¼ˆ20KB = 0x5000 å­—èŠ‚ï¼ŒèŒƒå›´0x20000000~0x20004FFFï¼‰ã€‚ FLASH (rx)ï¼š rxï¼šæƒé™ï¼ˆr= å¯è¯»ï¼Œx= å¯æ‰§è¡Œï¼Œw= ä¸å¯å†™ï¼‰â€”â€”FLASH æ˜¯åªè¯»å­˜å‚¨å™¨ï¼Œåªèƒ½å­˜æ”¾ä»£ç å’Œå¸¸é‡ã€‚ ORIGIN = 0x8000000ï¼šSTM32 FLASH çš„èµ·å§‹åœ°å€ï¼ˆç¡¬ä»¶è§„å®šï¼Œå¤ä½å PC é»˜è®¤æŒ‡å‘è¿™é‡Œï¼‰ã€‚ LENGTH = 64Kï¼šSTM32F103C8Tx çš„ FLASH å®é™…å¤§å°ï¼ˆ64KB = 0x10000 å­—èŠ‚ï¼ŒèŒƒå›´0x8000000~0x800FFFFï¼‰ã€‚ 3. æ®µåˆ†é…è§„åˆ™ï¼ˆSECTIONS å—ï¼‰ SECTIONSå—æ˜¯æœ€å¤æ‚çš„éƒ¨åˆ†ï¼Œå®šä¹‰äº†ã€Œç¼–è¯‘ç”Ÿæˆçš„æ®µã€å¦‚ä½•æ˜ å°„åˆ°ã€ŒMEMORY å—å®šä¹‰çš„ç‰©ç†å†…å­˜ã€ï¼Œæ¯ä¸€ä¸ªå­æ®µéƒ½å¯¹åº”ç‰¹å®šçš„ä»£ç  / æ•°æ®ç±»å‹ã€‚\nFlashåŒºï¼Œèµ·å§‹ä½ç½®0x8000000\næ®µåç§° èµ·å§‹åœ°å€ ç»“æŸåœ°å€ å†…å®¹ .isr_vector 0x8000 0000 æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ ä¸­æ–­å‘é‡è¡¨ .text ç´§é‚».isr_vectoræœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ ç¨‹åº .rodata ç´§é‚».textæœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ å¸¸é‡ .ARM.extab ç´§é‚».rodataæœ«å°¾ æŒ‰éœ€è®¡ç®— ARMå¼‚å¸¸å¤„ç†ä¿¡æ¯ .ARM.exidx* ç´§é‚».ARM.extabæœ«å°¾ æŒ‰éœ€è®¡ç®— ARMå¼‚å¸¸ç´¢å¼•è¡¨ .preinit_array ç´§é‚».ARM.exidx* æœ«å°¾ æŒ‰éœ€è®¡ç®— C++é¢„åˆå§‹åŒ–æ•°ç»„ .init_array ç´§é‚».preinit_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®— C++æ„é€ å‡½æ•°æ•°ç»„ .fini_array ç´§é‚».init_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®— C++ææ„å‡½æ•°æ•°ç»„ .data ç´§é‚».fini_arrayæœ«å°¾ æŒ‰éœ€è®¡ç®—ï¼Œå››å­—èŠ‚å¯¹é½ åˆå§‹åŒ–å˜é‡çš„åˆå§‹å€¼ RAMåŒºï¼Œèµ·å§‹ä½ç½®0x20000000\næ®µåç§° èµ·å§‹åœ°å€ ç»“æŸåœ°å€ å†…å®¹ .data 0x2000 0000 _edataï¼Œæ‹·è´è‡ªFlashåŒº å·²åˆå§‹åŒ–å…¨å±€/é™æ€å˜é‡ .bss _edata _end æœªåˆå§‹åŒ–å…¨å±€/é™æ€å˜é‡ ç³»ç»Ÿå †åº• _end _end å †åº• ç³»ç»Ÿå †æ ˆæœ€å°é¢„ç•™ç©ºé—´ _end _end+é¢„ç•™ç©ºé—´ å †æ ˆé¢„ç•™ç©ºé—´ ç©ºé—²RAM _end+é¢„ç•™ç©ºé—´ _estack ç©ºé—²ç©ºé—´ ç³»ç»Ÿæ ˆåº• _estackï¼ˆRAMæœ«å°¾ï¼‰ _estackï¼ˆRAMæœ«å°¾ï¼‰ æ ˆåº• ï¼ˆ1ï¼‰.isr_vectorï¼šä¸­æ–­å‘é‡è¡¨ï¼ˆæ”¾ FLASHï¼‰ 1 2 3 4 5 6 .isr_vector : { . = ALIGN(4); // åœ°å€4å­—èŠ‚å¯¹é½ï¼ˆCortex-Må†…æ ¸è¦æ±‚ï¼Œå¦åˆ™è§¦å‘ç¡¬ faultï¼‰ KEEP(*(.isr_vector)) // ä¿ç•™ä¸­æ–­å‘é‡è¡¨ï¼Œé˜²æ­¢é“¾æ¥å™¨ä¼˜åŒ–åˆ é™¤ï¼ˆæ ¸å¿ƒï¼ï¼‰ . = ALIGN(4); } \u0026gt;FLASH // åˆ†é…åˆ°FLASHåŒºåŸŸ ä½œç”¨ï¼šå­˜æ”¾ STM32 çš„ä¸­æ–­å‘é‡è¡¨ï¼ˆå¦‚å¤ä½å‘é‡ã€å®šæ—¶å™¨ä¸­æ–­å‘é‡ã€ä¸²å£ä¸­æ–­å‘é‡ç­‰ï¼‰ï¼Œæ˜¯å¤ä½åå†…æ ¸ç¬¬ä¸€ä¸ªè®¿é—®çš„æ®µã€‚ KEEP(*(.isr_vector))ï¼šä¸­æ–­å‘é‡è¡¨ç”±å¯åŠ¨æ–‡ä»¶å®šä¹‰ï¼ˆå¦‚startup_stm32f103c8tx.sä¸­çš„g_pfnVectorsæ•°ç»„ï¼‰ï¼ŒKEEPå…³é”®å­—ç¡®ä¿é“¾æ¥å™¨ä¸ä¼šå› ä¸º â€œçœ‹ä¼¼æœªè¢«è°ƒç”¨â€ è€Œåˆ é™¤è¿™ä¸ªæ®µ â€”â€” å¦‚æœåˆ é™¤ï¼Œå¤ä½åå†…æ ¸æ‰¾ä¸åˆ°Reset_Handleråœ°å€ï¼Œç¨‹åºä¼šå´©æºƒã€‚ \u0026gt;FLASHï¼šæ˜ç¡®å°†è¯¥æ®µåˆ†é…åˆ°MEMORYå—å®šä¹‰çš„FLASHåŒºåŸŸï¼ˆç¬¦åˆç¡¬ä»¶è¦æ±‚ï¼Œå‘é‡è¡¨é»˜è®¤åœ¨ FLASH èµ·å§‹åœ°å€ï¼‰ã€‚ ï¼ˆ2ï¼‰.textï¼šä»£ç æ®µï¼ˆæ”¾ FLASHï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 .text : { . = ALIGN(4); *(.text) // æ‰€æœ‰.c/.sæ–‡ä»¶çš„ä»£ç ï¼ˆå¦‚mainå‡½æ•°ã€è‡ªå®šä¹‰å‡½æ•°ï¼‰ *(.text*) // æ‰©å±•ä»£ç æ®µï¼ˆå¦‚C++çš„æˆå‘˜å‡½æ•°ï¼‰ *(.glue_7) // ARMæŒ‡ä»¤ä¸ThumbæŒ‡ä»¤çš„èƒ¶æ°´ä»£ç ï¼ˆCortex-Mç”¨ThumbæŒ‡ä»¤ï¼Œå…¼å®¹ç”¨ï¼‰ *(.glue_7t) // åŒä¸Š *(.eh_frame) // C++å¼‚å¸¸å¤„ç†ç›¸å…³ï¼ˆè‹¥ç”¨Cå¯å¿½ç•¥ï¼‰ KEEP (*(.init)) // ç¨‹åºåˆå§‹åŒ–å‡½æ•°ï¼ˆå¦‚æ„é€ å‡½æ•°ï¼‰ KEEP (*(.fini)) // ç¨‹åºç»“æŸå‡½æ•°ï¼ˆå¦‚ææ„å‡½æ•°ï¼‰ . = ALIGN(4); _etext = .; // å®šä¹‰ç¬¦å·ï¼š.textæ®µçš„ç»“æŸåœ°å€ï¼ˆä¾›åç»­æ®µå®šä½ï¼‰ } \u0026gt;FLASH ä½œç”¨ï¼šå­˜æ”¾æ‰€æœ‰å¯æ‰§è¡Œä»£ç ï¼ˆC å‡½æ•°ã€æ±‡ç¼–å‡½æ•°ï¼‰ï¼Œæ˜¯ FLASH ä¸­å ç”¨ç©ºé—´æœ€å¤§çš„æ®µã€‚ _etext = .ï¼š.ä»£è¡¨å½“å‰åœ°å€ï¼Œ_etextæ˜¯å…¨å±€ç¬¦å·ï¼Œæ ‡è®°.textæ®µçš„ç»“æŸåœ°å€ â€”â€” åç»­çš„.rodataæ®µä¼šä»_etextä¹‹åçš„åœ°å€å¼€å§‹åˆ†é…ï¼Œé¿å…æ®µé‡å ã€‚ ï¼ˆ3ï¼‰.rodataï¼šåªè¯»å¸¸é‡æ®µï¼ˆæ”¾ FLASHï¼‰ 1 2 3 4 5 6 7 .rodata : { . = ALIGN(4); *(.rodata) // åªè¯»å¸¸é‡ï¼ˆå¦‚const int a = 10;ã€å­—ç¬¦ä¸²å¸¸é‡\u0026#34;hello\u0026#34;ï¼‰ *(.rodata*) // æ‰©å±•åªè¯»å¸¸é‡æ®µ . = ALIGN(4); } \u0026gt;FLASH ä½œç”¨ï¼šå­˜æ”¾åªè¯»æ•°æ®ï¼Œå› ä¸ºè¿™äº›æ•°æ®ä¸éœ€è¦ä¿®æ”¹ï¼Œæ”¾åœ¨ FLASH ä¸­å¯èŠ‚çœ RAM ç©ºé—´ã€‚ ç¤ºä¾‹ï¼šconst char str[] = \u0026quot;STM32\u0026quot;;ä¼šè¢«ç¼–è¯‘åˆ°.rodataæ®µï¼Œè¿è¡Œæ—¶ç›´æ¥ä» FLASH è¯»å–ï¼Œä¸ä¼šå¤åˆ¶åˆ° RAMã€‚ ï¼ˆ4ï¼‰.ARM.extab/.ARMï¼šARM æ¶æ„å…¼å®¹æ®µï¼ˆæ”¾ FLASHï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 .ARM.extab (READONLY) : { . = ALIGN(4); *(.ARM.extab* .gnu.linkonce.armextab.*) . = ALIGN(4); } \u0026gt;FLASH .ARM (READONLY) : { . = ALIGN(4); __exidx_start = .; *(.ARM.exidx*) // ARMå¼‚å¸¸ç´¢å¼•è¡¨ï¼ˆC++å¼‚å¸¸å¤„ç†ç”¨ï¼‰ __exidx_end = .; . = ALIGN(4); } \u0026gt;FLASH ä½œç”¨ï¼šä¸»è¦ç”¨äºARM æ¶æ„ä¸ Thumb æ¶æ„çš„å…¼å®¹ï¼Œä»¥åŠ C++ çš„å¼‚å¸¸å¤„ç†ï¼ˆè‹¥é¡¹ç›®ç”¨çº¯ Cï¼Œè¿™äº›æ®µå‡ ä¹ä¸ºç©ºï¼Œä½†ä¿ç•™å¯é¿å…é“¾æ¥é”™è¯¯ï¼‰ã€‚ READONLYï¼šæ ‡è®°ä¸ºåªè¯»ï¼Œä¸ FLASH çš„æƒé™åŒ¹é…ï¼ˆGCC11 + æ”¯æŒï¼Œä½ç‰ˆæœ¬éœ€åˆ é™¤ï¼‰ã€‚ ï¼ˆ5ï¼‰.preinit_array/.init_array/.fini_arrayï¼šåˆå§‹åŒ– / ç»“æŸå‡½æ•°æ•°ç»„ï¼ˆæ”¾ FLASHï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 .preinit_array (READONLY) : { . = ALIGN(4); PROVIDE_HIDDEN (__preinit_array_start = .); KEEP (*(.preinit_array*)) // é¢„åˆå§‹åŒ–å‡½æ•°ï¼ˆå¦‚åŠ¨æ€åº“é¢„åˆå§‹åŒ–ï¼‰ PROVIDE_HIDDEN (__preinit_array_end = .); . = ALIGN(4); } \u0026gt;FLASH .init_array (READONLY) : { . = ALIGN(4); PROVIDE_HIDDEN (__init_array_start = .); KEEP (*(SORT(.init_array.*))) // åˆå§‹åŒ–å‡½æ•°ï¼ˆå¦‚C++å…¨å±€å¯¹è±¡çš„æ„é€ å‡½æ•°ï¼‰ KEEP (*(.init_array*)) PROVIDE_HIDDEN (__init_array_end = .); . = ALIGN(4); } \u0026gt;FLASH .fini_array (READONLY) : { . = ALIGN(4); PROVIDE_HIDDEN (__fini_array_start = .); KEEP (*(SORT(.fini_array.*))) // ç»“æŸå‡½æ•°ï¼ˆå¦‚C++å…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ï¼‰ KEEP (*(.fini_array*)) PROVIDE_HIDDEN (__fini_array_end = .); . = ALIGN(4); } \u0026gt;FLASH ä½œç”¨ï¼šå­˜æ”¾ç¨‹åºå¯åŠ¨ / é€€å‡ºæ—¶è‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°æ•°ç»„ï¼ˆä¸»è¦ç”¨äº C++ï¼‰ï¼Œä¾‹å¦‚ï¼š init_arrayï¼šmainå‡½æ•°æ‰§è¡Œå‰ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™é‡Œçš„å‡½æ•°ï¼ˆå¦‚å…¨å±€å¯¹è±¡A a;çš„æ„é€ å‡½æ•°ï¼‰ã€‚ fini_arrayï¼šmainå‡½æ•°é€€å‡ºåï¼Œä¼šè‡ªåŠ¨è°ƒç”¨è¿™é‡Œçš„å‡½æ•°ï¼ˆå¦‚å…¨å±€å¯¹è±¡çš„ææ„å‡½æ•°ï¼‰ã€‚ PROVIDE_HIDDENï¼šè‹¥ç”¨æˆ·ä»£ç æœªå®šä¹‰__init_array_startç­‰ç¬¦å·ï¼Œé“¾æ¥å™¨è‡ªåŠ¨æä¾›ï¼ˆéšè—ç¬¦å·ï¼Œé¿å…å†²çªï¼‰ï¼›KEEPç¡®ä¿è¿™äº›æ®µä¸è¢«ä¼˜åŒ–åˆ é™¤ã€‚ ï¼ˆ6ï¼‰.dataï¼šåˆå§‹åŒ–æ•°æ®æ®µï¼ˆæ”¾ RAMï¼ŒåŠ è½½åœ°å€åœ¨ FLASHï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 /* used by the startup to initialize data */ _sidata = LOADADDR(.data); // å®šä¹‰ç¬¦å·ï¼š.dataåœ¨FLASHçš„åŠ è½½åœ°å€ï¼ˆLMAï¼‰ .data : { . = ALIGN(4); _sdata = .; // å®šä¹‰ç¬¦å·ï¼š.dataåœ¨RAMçš„è¿è¡Œåœ°å€ï¼ˆVMAï¼‰ *(.data) // åˆå§‹åŒ–çš„å…¨å±€/é™æ€å˜é‡ï¼ˆå¦‚int a = 10;ï¼‰ *(.data*) // æ‰©å±•åˆå§‹åŒ–æ•°æ®æ®µ *(.RamFunc) // è¦æ”¾åˆ°RAMä¸­æ‰§è¡Œçš„å‡½æ•°ï¼ˆå¦‚æŸäº›å¿«é€Ÿä¸­æ–­å¤„ç†å‡½æ•°ï¼‰ *(.RamFunc*) // åŒä¸Š . = ALIGN(4); _edata = .; // å®šä¹‰ç¬¦å·ï¼š.dataåœ¨RAMçš„ç»“æŸåœ°å€ } \u0026gt;RAM AT\u0026gt; FLASH // è¿è¡Œåœ°å€ï¼ˆVMAï¼‰åœ¨RAMï¼ŒåŠ è½½åœ°å€ï¼ˆLMAï¼‰åœ¨FLASH æ ¸å¿ƒæ¦‚å¿µï¼šVMAï¼ˆè™šæ‹Ÿ / è¿è¡Œåœ°å€ï¼‰å’ŒLMAï¼ˆåŠ è½½åœ°å€ï¼‰ï¼š \u0026gt;RAMï¼š.dataæ®µçš„è¿è¡Œåœ°å€ï¼ˆVMAï¼‰Â åœ¨ RAMï¼ˆå› ä¸ºå˜é‡éœ€è¦è¯»å†™ï¼‰ã€‚ AT\u0026gt;FLASHï¼š.dataæ®µçš„åŠ è½½åœ°å€ï¼ˆLMAï¼‰Â åœ¨ FLASHï¼ˆç¼–è¯‘æ—¶å°†å˜é‡åˆå§‹å€¼å­˜åˆ° FLASHï¼ŒèŠ‚çœ RAMï¼‰ã€‚ ä¸å¯åŠ¨æµç¨‹å…³è”ï¼šå¯åŠ¨æ–‡ä»¶çš„Reset_Handlerä¼šä»_sidataï¼ˆFLASH çš„ LMAï¼‰å¤åˆ¶æ•°æ®åˆ°_sdataï¼ˆRAM çš„ VMAï¼‰ï¼Œç›´åˆ°_edataâ€”â€” è¿™å°±æ˜¯ â€œåˆå§‹åŒ–.data æ®µâ€ çš„å…·ä½“å®ç°ã€‚ .RamFuncï¼šæŸäº›å¯¹æ‰§è¡Œé€Ÿåº¦è¦æ±‚é«˜çš„å‡½æ•°ï¼ˆå¦‚é«˜é¢‘ä¸­æ–­æœåŠ¡å‡½æ•°ï¼‰ï¼Œå¯é€šè¿‡__attribute__((section(\u0026quot;.RamFunc\u0026quot;)))æ ‡è®°ï¼Œé“¾æ¥æ—¶ä¼šæ”¾åˆ° RAM ä¸­æ‰§è¡Œï¼ˆRAM è®¿é—®é€Ÿåº¦æ¯” FLASH å¿«ï¼‰ã€‚ ï¼ˆ7ï¼‰.bssï¼šæœªåˆå§‹åŒ–æ•°æ®æ®µï¼ˆæ”¾ RAMï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 .bss : { _sbss = .; // å®šä¹‰ç¬¦å·ï¼š.bssåœ¨RAMçš„èµ·å§‹åœ°å€ __bss_start__ = _sbss; *(.bss) // æœªåˆå§‹åŒ–çš„å…¨å±€/é™æ€å˜é‡ï¼ˆå¦‚int b;ï¼‰ *(.bss*) // æ‰©å±•æœªåˆå§‹åŒ–æ•°æ®æ®µ *(COMMON) // æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡ï¼ˆå¦‚extern int c;ï¼‰ . = ALIGN(4); _ebss = .; // å®šä¹‰ç¬¦å·ï¼š.bssåœ¨RAMçš„ç»“æŸåœ°å€ __bss_end__ = _ebss; } \u0026gt;RAM ä½œç”¨ï¼šå­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€ / é™æ€å˜é‡ï¼ŒC è¯­è¨€æ ‡å‡†è¦æ±‚è¿™äº›å˜é‡åˆå§‹åŒ–ä¸º 0ï¼Œå› æ­¤ä¸éœ€è¦åœ¨ FLASH ä¸­å­˜å‚¨åˆå§‹å€¼ï¼ˆèŠ‚çœ FLASH ç©ºé—´ï¼‰ã€‚ ä¸å¯åŠ¨æµç¨‹å…³è”ï¼šå¯åŠ¨æ–‡ä»¶çš„Reset_Handlerä¼šå°†_sbssåˆ°_ebssçš„ RAM åŒºåŸŸæ¸…é›¶ â€”â€” è¿™å°±æ˜¯ â€œæ¸…é›¶.bss æ®µâ€ çš„å…·ä½“å®ç°ã€‚ COMMONï¼šå¯¹åº”æœªå£°æ˜ä½†å¤–éƒ¨å¼•ç”¨çš„å…¨å±€å˜é‡ï¼ˆå¦‚extern int c;ï¼‰ï¼Œé“¾æ¥æ—¶ä¼šåˆ†é…åˆ°.bss æ®µã€‚ ï¼ˆ8ï¼‰._user_heap_stackï¼šå †å’Œæ ˆçš„å ä½æ®µï¼ˆæ”¾ RAMï¼‰ 1 2 3 4 5 6 7 8 9 ._user_heap_stack : { . = ALIGN(8); // 8å­—èŠ‚å¯¹é½ï¼ˆå †/æ ˆé€šå¸¸è¦æ±‚æ›´é«˜å¯¹é½ï¼Œé¿å…å†…å­˜è®¿é—®é”™è¯¯ï¼‰ PROVIDE ( end = . ); // å®šä¹‰ç¬¦å·ï¼šRAMå·²åˆ†é…åŒºåŸŸçš„ç»“æŸåœ°å€ PROVIDE ( _end = . ); . = . + _Min_Heap_Size; // å †åŒºåŸŸï¼šä»å½“å‰åœ°å€åˆ†é…_Min_Heap_Sizeå¤§å° . = . + _Min_Stack_Size;// æ ˆåŒºåŸŸï¼šåœ¨å †ä¹‹ååˆ†é…_Min_Stack_Sizeå¤§å° . = ALIGN(8); } \u0026gt;RAM ä½œç”¨ï¼šä¸ºå †å’Œæ ˆé¢„ç•™ç©ºé—´ï¼Œå¹¶æ£€æŸ¥ RAM æ˜¯å¦è¶³å¤Ÿ â€”â€” è‹¥å † + æ ˆ + å·²åˆ†é…æ®µï¼ˆ.data+.bssï¼‰çš„æ€»å¤§å°è¶…è¿‡ RAM å®¹é‡ï¼Œé“¾æ¥å™¨ä¼šæŠ¥é”™ã€‚ end/_endï¼šæ ‡è®° RAM ä¸­ â€œå·²åˆ†é…æ®µï¼ˆ.data+.bssï¼‰â€ çš„ç»“æŸåœ°å€ï¼Œå †ä»endå¼€å§‹å‘ä¸Šç”Ÿé•¿ï¼Œæ ˆä»_estackï¼ˆæ ˆé¡¶ï¼‰å¼€å§‹å‘ä¸‹ç”Ÿé•¿ã€‚ å † / æ ˆç”Ÿé•¿æ–¹å‘ï¼š å †ï¼šä»endå‘ä¸Šï¼ˆåœ°å€å¢å¤§æ–¹å‘ï¼‰ç”Ÿé•¿ï¼Œä¾›malloc/freeä½¿ç”¨ã€‚ æ ˆï¼šä»_estackå‘ä¸‹ï¼ˆåœ°å€å‡å°æ–¹å‘ï¼‰ç”Ÿé•¿ï¼Œä¾›å‡½æ•°è°ƒç”¨ã€å±€éƒ¨å˜é‡ä½¿ç”¨ã€‚ è‹¥å †å’Œæ ˆç”Ÿé•¿æ—¶é‡å ï¼Œä¼šå¯¼è‡´å†…å­˜æº¢å‡ºï¼ˆç¡¬ faultï¼‰ï¼Œå› æ­¤éœ€åˆç†è®¾ç½®_Min_Heap_Sizeå’Œ_Min_Stack_Sizeã€‚ å¦‚æœä½¿ç”¨äº†FreeRTOSçš„è¯ï¼ŒFreeRTOSçš„å†…å­˜å¸ƒå±€å¦‚ä¸‹\nï¼ˆ9ï¼‰/DISCARD/ï¼šä¸¢å¼ƒæ— ç”¨æ®µï¼ˆå‡å°å¯æ‰§è¡Œæ–‡ä»¶å¤§å°ï¼‰ 1 2 3 4 5 6 /DISCARD/ : { libc.a ( * ) // ä¸¢å¼ƒæ ‡å‡†Cåº“çš„æ‰€æœ‰æ®µ libm.a ( * ) // ä¸¢å¼ƒæ ‡å‡†æ•°å­¦åº“çš„æ‰€æœ‰æ®µ libgcc.a ( * ) // ä¸¢å¼ƒGCCç¼–è¯‘å™¨åº“çš„æ‰€æœ‰æ®µ } ä½œç”¨ï¼šåµŒå…¥å¼ç³»ç»Ÿé€šå¸¸ä¸éœ€è¦æ ‡å‡†åº“çš„å®Œæ•´åŠŸèƒ½ï¼ˆå¦‚printfçš„æ–‡ä»¶è¾“å‡ºã€mallocçš„å¤æ‚å†…å­˜ç®¡ç†ï¼‰ï¼Œä¸¢å¼ƒè¿™äº›æ®µå¯å¤§å¹…å‡å°.elf/.hexæ–‡ä»¶çš„å¤§å°ã€‚ æ³¨æ„ï¼šè‹¥é¡¹ç›®éœ€è¦ä½¿ç”¨æ ‡å‡†åº“åŠŸèƒ½ï¼ˆå¦‚printfã€sqrtï¼‰ï¼Œéœ€åˆ é™¤å¯¹åº”è¡Œï¼Œå¦åˆ™ä¼šå‡ºç° â€œæœªå®šä¹‰å¼•ç”¨â€ é”™è¯¯ï¼ˆéœ€æ­é…newlib-nanoç­‰åµŒå…¥å¼ç²¾ç®€åº“ï¼‰ã€‚ å››ã€æ€»ç»“ï¼šå¯åŠ¨æµç¨‹ä¸.ld æ–‡ä»¶çš„å…³è” ç¡¬ä»¶å¤ä½Â â†’ å†…æ ¸è¯»å–FLASHèµ·å§‹åœ°å€ï¼ˆ0x8000000ï¼‰çš„.isr_vectoræ®µ â†’ æ‰¾åˆ°Reset_Handleråœ°å€ã€‚ æ‰§è¡ŒReset_HandlerÂ â†’ åˆ©ç”¨.ldå®šä¹‰çš„_sdata/_sidata/_edataå¤åˆ¶.dataæ®µ â†’ åˆ©ç”¨_sbss/_ebssæ¸…é›¶.bssæ®µã€‚ è°ƒç”¨mainÂ â†’ ç”¨æˆ·ä»£ç ä¸­çš„å˜é‡ï¼ˆ.data/.bssï¼‰å·²åœ¨ RAM ä¸­åˆå§‹åŒ–ï¼Œå‡½æ•°ï¼ˆ.textï¼‰åœ¨ FLASH ä¸­æ‰§è¡Œï¼Œå † / æ ˆåœ¨ RAM ä¸­é¢„ç•™ç©ºé—´ã€‚ å¯ä»¥è¯´ï¼š.ld æ–‡ä»¶æ˜¯ STM32 å¯åŠ¨æµç¨‹çš„ â€œåœ°å›¾â€ï¼Œæ²¡æœ‰å®ƒï¼Œå¯åŠ¨æ–‡ä»¶ä¸çŸ¥é“å¦‚ä½•åˆå§‹åŒ–å†…å­˜ï¼Œé“¾æ¥å™¨ä¸çŸ¥é“å¦‚ä½•åˆ†é…ä»£ç å’Œæ•°æ®ï¼Œç¨‹åºæ— æ³•æ­£å¸¸è¿è¡Œã€‚ å¯„å­˜å™¨ è®¤è¯†ä¸€ä¸ªCPUæœ€ç›´æ¥çš„æ˜¯å»è®¤è¯†å®ƒçš„å¯„å­˜å™¨ç»„ ï¼ˆRegister bankï¼‰ armç³»ç»Ÿå¯„å­˜å™¨ç»„\nè¿˜æœ‰5ä¸ªç‰¹æ®Šå¯„å­˜å™¨\næµ®ç‚¹æ•°å¯„å­˜å™¨\né€šç”¨å¯„å­˜å™¨ é€šç”¨å¯„å­˜å™¨é€šç”¨æ€§å¼ºï¼Œå¸¸ç”¨äºå­˜å‚¨ä¸´æ—¶çš„æ•°æ® å…¶ä¸­R0-R7æ˜¯ä½ç»„å¯„å­˜å™¨ï¼ŒR8-R12æ˜¯é«˜ç»„å¯„å­˜å™¨ï¼Œé«˜ç»„å¯„å­˜å™¨éƒ¨åˆ†æŒ‡ä»¤æ— æ³•è®¿é—®\nPCç¨‹åºè®¡æ•°å™¨\u0026amp;ç¨‹åºå¦‚ä½•è·‘èµ·æ¥ armæ¶æ„ä¸­çš„R15å¯„å­˜å™¨ï¼Œæ˜¯ç¨‹åºè®¡æ•°å™¨ï¼ˆprogram counterï¼‰ï¼Œè¯¥å¯„å­˜å™¨å¯è¯»å¯å†™\nåœ¨arm cortex-Mçš„CPUå†…ï¼Œæ¯ä¸€æ¬¡PCè‡ªå¢4ï¼ˆå³å‘ä¸‹ç§»åŠ¨äº†4ä¸ªå­—èŠ‚ï¼‰ï¼Œä½†æ˜¯åœ¨ä½¿ç”¨thumbæŒ‡ä»¤é›†æ—¶ï¼ŒthumbæŒ‡ä»¤é›†çš„éƒ¨åˆ†æŒ‡ä»¤æ˜¯2ä¸ªå­—èŠ‚ï¼Œè¿™ä¸å¤„ç†å™¨çš„æ‰§è¡Œæµæ°´çº¿pipelineçš„ç‰¹æ€§æœ‰å…³ï¼Œå®é™…å–å€çš„æ—¶å€™æ˜¯ä¸€æ¬¡å»4å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯å¯¹äº2å­—èŠ‚çš„æŒ‡ä»¤æ˜¯ä¸€æ¬¡å–ä¸¤æ¡\nCPUåœ¨ä¸æ–­æ‰§è¡Œç¨‹åºï¼Œæœ¬è´¨å°±æ˜¯ç¨‹åºè®¡æ•°å™¨çš„ä¸æ–­æ›´æ–°ï¼ŒPCæŒ‡å‘çš„å°±æ˜¯å½“å‰è¦æ‰§è¡Œçš„æŒ‡ä»¤çš„åœ°å€\nå †æ ˆæŒ‡é’ˆ\u0026amp;åŒå †æ ˆæŒ‡é’ˆæœºåˆ¶ æ ˆæ˜¯é«˜å€å‘ä½å€æ–¹å‘ç”Ÿé•¿ï¼Œå †æ˜¯ä½å€å‘é«˜å€æ–¹å‘ç”Ÿé•¿\narm cortex-Mæ¶æ„ä¸­R13æ˜¯å †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ åœ¨ç‰©ç†ä¸Šè¯¥å¯„å­˜å™¨æ˜¯ä¸¤ä¸ªä¸åŒçš„å¯„å­˜å™¨MSPä¸»å †æ ˆæŒ‡é’ˆå’ŒPSPè¿›ç¨‹å †æ ˆæŒ‡é’ˆï¼Œåœ¨ç¨‹åºè¿è¡Œæ—¶é€‰ç”¨å“ªä¸€ä¸ªå¯„å­˜å™¨ä¼šæœ‰Controlæ§åˆ¶å¯„å­˜å™¨çš„å€¼æ¥å†³å®š\né»˜è®¤å¯åŠ¨æ—¶ï¼Œå¤„ç†å™¨ä½¿ç”¨çš„æ˜¯ä¸»å †æ ˆæŒ‡é’ˆï¼Œå¯ä»¥ä¿®æ”¹Controlæ§åˆ¶å¯„å­˜å™¨çš„ç¬¬ä¸€ä½çš„å€¼æ¥ä¿®æ”¹å¤„ç†å™¨ä½¿ç”¨çš„å †æ ˆæŒ‡é’ˆ\nåŒå †æ ˆæŒ‡é’ˆ-MSPä¸»å †æ ˆæŒ‡é’ˆï¼ŒPSPè¿›ç¨‹å †æ ˆæŒ‡é’ˆ å¯ä»¥ç”¨æ¥å®ç°éš”ç¦»ç³»ç»Ÿå†…æ ¸å’Œåº”ç”¨ç¨‹åºä»»åŠ¡\nLRé“¾æ¥å¯„å­˜å™¨\u0026amp;å‡½æ•°è°ƒç”¨çš„æœ¬è´¨ å‡½æ•°è°ƒç”¨çš„æœ¬è´¨æ˜¯ç¨‹åºæ‰§è¡Œæµçš„åŠ¨æ€è½¬ç§»ä¸ä¸Šä¸‹æ–‡ç®¡ç†ï¼Œå…¶æ ¸å¿ƒåœ¨äºé€šè¿‡ æ ˆ æ¥å®ç°ä»£ç æ¨¡å—åŒ–æ‰§è¡Œå’ŒçŠ¶æ€çš„ä¿å­˜ä¸æ¢å¤\narmæ¶æ„çš„CPUæœ‰ä¸“é—¨è®¾ç«‹ä¸€ä¸ªå¯„å­˜å™¨R14(link register)ï¼Œç”¨äºå­˜æ”¾å­å‡½æ•°çš„è¿”å›åœ°å€\nä»¥armçš„blæŒ‡ä»¤ä¸ºä¾‹ï¼ˆç”¨äºå‡½æ•°è°ƒç”¨ï¼‰ bl \u0026lt;label\u0026gt;æ˜¯è·³è½¬åˆ°æ ‡ç­¾åœ°å€ï¼ŒåŒæ—¶å°†è¿”å›åœ°å€å­˜å…¥LRå¯„å­˜å™¨\néœ€è¦æ³¨æ„çš„æ˜¯ï¼Œarm cortex-Mæ¶æ„çš„å¤„ç†å™¨æŒ‡ä»¤éƒ½æ˜¯åŠå­—å¯¹é½ï¼ˆä¸¤å­—èŠ‚å¯¹é½ï¼‰ï¼Œæ‰€ä»¥å…¶åæ±‡ç¼–çš„åœ°å€éƒ½æ˜¯å¶æ•°ï¼Œå­˜åœ¨lrå¯„å­˜å™¨çš„è¿”å›åœ°å€ä¹Ÿéƒ½æ˜¯å¶æ•°ï¼Œä½†æ˜¯lrå¯„å­˜å™¨çš„ç¬¬0ä½å¿…é¡»è®¾ç½®ä¸º1æ¥æŒ‡ç¤ºthumbæŒ‡ä»¤é›†çš„çŠ¶æ€ï¼Œæ‰€ä»¥lrå¯„å­˜å™¨çš„å€¼ä¼šæ˜¯è¿”å›åœ°å€+1\nåœ¨å¤šçº§å‡½æ•°è°ƒç”¨æ—¶ï¼Œlrå¯„å­˜å™¨çš„å€¼ä¼šè¢«å‹å…¥æ ˆä¸­\nå¦å¤–lrå¯„å­˜å™¨è¿˜èƒ½è®°å½•å¼‚å¸¸è¿”å›å€¼ã€‚å½“å¤„ç†å™¨è¿›å…¥ä¸­æ–­æ—¶ï¼Œé“¾æ¥å¯„å­˜å™¨ä¼šæ›´æ–°ä¸ºå¼‚å¸¸è¿”å›å€¼ï¼Œç”¨æ¥å®ç°å¼‚å¸¸è¿”å›æœºåˆ¶ï¼Œç”¨æ¥è®°å½•åŒºåˆ†ä¸€äº›å·¥ä½œæ¨¡å¼ç°åœºï¼Œè¿™äº›ä¿¡æ¯æ˜¯æ¢å¤ä¸­æ–­ä¸Šä¸‹æ–‡éœ€è¦çš„\nåœ°å€åˆ†é… å­˜å‚¨å™¨ç³»ç»Ÿ cortex-Må¤„ç†å™¨æ˜¯32ä½åœ°å€ï¼Œå› æ­¤ä¼šæœ‰ 4GBçš„åœ°å€ç©ºé—´ï¼Œæ‰€æœ‰çš„æŒ‡ä»¤å’Œæ•°æ®é€šè¿‡è¿™ä¸ªåœ°å€è®¿é—®\nç¡¬ä»¶èµ„æºéƒ½æ˜¯é€šè¿‡åœ°å€æ˜ å°„çš„æ–¹å¼è®¿é—® å¦å¤–cortex-Mæ¶æ„æ²¡æœ‰è®¾ç½®MMUå†…å­˜ç®¡ç†å•å…ƒï¼Œæ‰€ä»¥æ²¡æœ‰MMUå†…å­˜ç®¡ç†å•å…ƒï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šæ­è½½Linux,Windowsè¿™ç§é€šç”¨ç±»å‹çš„ç³»ç»Ÿ\nåœ°å€æ˜ å°„å›¾ F103C8çš„åœ°å€æ˜ å°„å›¾ ç³»ç»Ÿæ¶æ„å›¾\ncortex-M3M4å†…æ ¸æ¶æ„å›¾\nä¸‰çº§æµæ°´çº¿å¤–çš„è®¾å¤‡å±äºCPUçš„å†…æ ¸å¤–è®¾ï¼Œä¾‹å¦‚NVIC,SysTickç³»ç»Ÿæ»´ç­”å®šæ—¶å™¨ï¼ŒMPUç­‰ï¼Œç”¨0xE004 0000-0xE00F F000åœ°å€è®¿é—®\nè½¯ä»¶ä¸Šå°±æ˜¯é€šè¿‡è¯»å†™å¤–è®¾åœ°å€ç©ºé—´æ¥æ§åˆ¶è¿™äº›å¤–è®¾ï¼Œå¯¹åº”çš„åœ°å€ç©ºé—´å•å…ƒæ˜ å°„åˆ°å¤–è®¾å¯„å­˜å™¨\nåµŒå…¥å¼ç¼–ç¨‹æœ¬è´¨å°±æ˜¯åœ¨æ“ä½œå­˜å‚¨å™¨ï¼Œæ¯ä¸€æ®µCPUä»£ç æŒ‡ä»¤éƒ½æ˜¯åœ¨è¯»å–æŸä¸ªåœ°å€ç©ºé—´çš„å•å…ƒï¼Œé«˜çº§ç¼–ç¨‹è¯­è¨€å°±æ˜¯ä¸æ–­å‘ä¸Šå°è£…æŠ½è±¡\nCè¯­è¨€æ¯æ¡è¯­å¥è¿½æº¯åˆ°æ±‡ç¼–éƒ½æ˜¯åœ¨è¯»å†™å­˜å‚¨å™¨çš„åœ°å€ç©ºé—´å•å…ƒ å…³äºå†…å­˜å’Œç¼–è¯‘ä¼˜åŒ– æŒ‡é’ˆæ˜¯å†…å­˜åœ°å€çš„å®¹å™¨ å…³äºi++ä¸++iæ‰§è¡Œæ•ˆç‡çš„é—®é¢˜ï¼Œåœ¨O0ä¼˜åŒ–çš„æƒ…å†µä¸‹ï¼Œä¸åŒç¼–è¯‘å™¨çš„å…·ä½“å®ç°æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ‰§è¡Œæ•ˆç‡æ˜¯ä¸èƒ½ç›´æ¥æ¯”è¾ƒçš„\nç¼–è¯‘ä¼˜åŒ–ä¼šä½¿æ±‡ç¼–çš„æŒ‡ä»¤åœ¨æ‰§è¡Œé€Ÿåº¦ä¸Šæé«˜ï¼Œä¾‹å¦‚ä¼šä½¿ç”¨movå»ä»£æ›¿ldrï¼Œæˆ–è€…å°†ä¸€äº›ç®€å•çš„å‡½æ•°æ”¹ä¸ºå†…åµŒï¼Œä»¥å‡å°‘å‡½æ•°è°ƒç”¨å¸¦æ¥çš„å¼€é”€\nä¸­æ–­ åœ¨å¾®æœºåŸç†ä¸­å·²æœ‰æ¶‰åŠï¼Œåé¢åªåšç®€å•å›é¡¾ç”¨\nå…³äºä¸­æ–­ ä¸­æ–­çš„äº‹ä»¶ä¸€èˆ¬ç”±ç¡¬ä»¶è§¦å‘ï¼ˆå®é™…æœ‰ç¡¬ä¸­æ–­å’Œè½¯ä¸­æ–­ï¼‰ï¼Œä¼šæ”¹å˜ç¨‹åºæ‰§è¡Œæµ\nNVICå±äºå†…æ ¸å¤–è®¾ï¼Œä¸“é—¨ç®¡ç†ä¸­æ–­\nåœ¨cortex-MèŠ¯ç‰‡ä¸­ï¼Œå‰15é¡¹ä¸­æ–­å‘é‡éƒ½ä¸€æ ·\nå¤„ç†å™¨å…·æœ‰å‘é‡è¡¨é‡å®šä½åŠŸèƒ½ï¼Œé€šè¿‡å‘é‡è¡¨åç§»å¯„å­˜å™¨(VTOR)æ¥è·å–å‘é‡è¡¨çš„èµ·å§‹åœ°å€\nä¸­æ–­è§¦å‘æ—¶ï¼Œå¤„ç†å™¨é€šè¿‡ä¸­æ–­å‘é‡è¡¨å»è·å–ä¸­æ–­å¤„ç†å‡½æ•°çš„å…¥å£åœ°å€\nä¸­æ–­è¿”å›\u0026amp;ä¸­æ–­ä¸Šä¸‹æ–‡ ç”µè„‘ä¸ºä»€ä¹ˆèƒ½è¾¹ç©æ¸¸æˆè¾¹èŠå¤©ï¼ŸCPUè¿™ä¸ªéªšæ“ä½œï¼Œ99%çš„ç¨‹åºå‘˜éƒ½è¯´ä¸æ¸…ï¼| CPU / å¤šä»»åŠ¡ / è¿›ç¨‹ä¸Šä¸‹æ–‡ / ä¸­æ–­æœºåˆ¶_å“”å“©å“”å“©_bilibili\nè¯¥è§†é¢‘ä¸­æœ€åè®²è§£çš„å°±ç±»ä¼¼äºarmæ¶æ„é‡‡ç”¨çš„æ–¹å¼\nåœ¨é˜…è¯»ä¸­æ–­çš„æ±‡ç¼–æ—¶ï¼Œä¼šå‘ç°ä¸­æ–­æ²¡æœ‰ä¿å­˜å’Œæ¢å¤ä¸Šä¸‹æ–‡çš„ä»£ç ï¼Œå®é™…ä¸Šæ˜¯ç¡¬ä»¶å¸®å¿™å®ç°ä¸Šè¿°åŠŸèƒ½\nå…³äºä¸Šä¸‹æ–‡ï¼Œå¦‚ç¨‹åºä¸Šçš„å‡½æ•°è°ƒç”¨éœ€è¦ä¿å­˜ä¸Šä¸‹æ–‡ï¼Œåœ¨æ“ä½œç³»ç»Ÿä¸­éœ€è¦å¤„ç†çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼ˆä»»åŠ¡ä¸Šä¸‹æ–‡ï¼‰ï¼Œå…¶æœ¬è´¨éƒ½åœ¨äºä¿å­˜å’Œæ¢å¤è‹¥å¹²å¯„å­˜å™¨çš„å€¼\ncortex-M3M4ä¸­æ–­éœ€è¦å…¥æ ˆä¿å­˜ä¸Šä¸‹æ–‡çš„8ä¸ªå¯„å­˜å™¨ é€‰æ‹©ä¿å­˜ä¸Šè¿°8ä¸ªå¯„å­˜å™¨ä¸»è¦æ˜¯æ ¹æ®armæ¶æ„çš„è¿‡ç¨‹è°ƒç”¨æ ‡å‡†ï¼ŒCè¯­è¨€çš„å‡½æ•°å®ç°ä¼šæ”¹åŠ¨è¿™äº›å¯„å­˜å™¨ï¼Œä¸ºä¾‹èƒ½è®©Cå‡½æ•°èƒ½ä½œä¸ºå¼‚å¸¸ï¼ˆä¸­æ–­ï¼‰å¤„ç†å‡½æ•°ï¼Œä¸­æ–­ï¼ˆå¼‚å¸¸ï¼‰æœºåˆ¶éœ€è¦èƒ½è‡ªåŠ¨åœ°ä¿å­˜è¿™äº›å¯„å­˜å™¨ï¼Œè¿™äº›å¯„å­˜å™¨ä¹Ÿè¢«ç§°ä¹‹ä¸ºè°ƒç”¨è€…ä¿å­˜å¯„å­˜å™¨\nå¤„ç†å™¨æ¢å¤ä¸Šä¸‹æ–‡ï¼Œå›åˆ°åŸæ‰§è¡Œæµï¼Œéœ€è¦lrå¯„å­˜å™¨å­˜å‚¨å¼‚å¸¸è¿”å›å€¼æ¥è®°å½•åŒºåˆ†ä¸€äº›å·¥ä½œæ¨¡å¼ç°åœºï¼Œè¿™äº›ä¿¡æ¯æ˜¯æ¢å¤ä¸­æ–­ä¸Šä¸‹æ–‡éœ€è¦çš„\né”™è¯¯å¤„ç† ä»‹ç»arm cortex-Må¤„ç†å™¨æ¶æ„å¦‚ä½•æ•è·å’Œè®°å½•é”™è¯¯æ•…éšœ\næœ‰ä¸“é—¨çš„å¯„å­˜å™¨å»è®°å½•æ•…éšœï¼Œé€šè¿‡æŸ¥æ‰¾å…¶å¯¹åº”çš„åœ°å€æŸ¥çœ‹å¯„å­˜å™¨çš„ä½æ¥è·å–é”™è¯¯ä¿¡æ¯\nåœ¨å‘ç”Ÿé”™è¯¯æ—¶ï¼Œå¯¹åº”é”™è¯¯å¯„å­˜å™¨çš„å¯¹åº”ä½è¢«ç½®1ï¼ŒåŒæ—¶è§¦å‘é”™è¯¯ä¸­æ–­å¤„ç†\nç¨‹åºæ‰§è¡Œéæ³•æŒ‡ä»¤æ“ä½œå¯¼è‡´ç³»ç»Ÿè¿›å…¥ä¸å¯æ¢å¤çš„æ•…éšœçŠ¶æ€ï¼Œç³»ç»Ÿè½¯ä»¶å°±ä¼šä»‹å…¥ç»ˆæ­¢ç¨‹åºæ‰§è¡Œæµï¼Œå…¶å®ç°æœºåˆ¶æ˜¯ä¸­æ–­\nå¾…ç»­ ","date":"2025-09-04T00:36:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/%E4%BB%8Ecpu%E6%9E%B6%E6%9E%84%E5%88%B0%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%AE%9E%E7%8E%B0/","title":"ä»CPUæ¶æ„åˆ°æ“ä½œç³»ç»Ÿå®ç°"},{"content":"ç±»çš„æˆå‘˜å‡½æ•° ç±»çš„æˆå‘˜å‡½æ•°æ˜¯æŒ‡é‚£äº›æŠŠå®šä¹‰å’ŒåŸå‹å†™åœ¨ç±»å®šä¹‰å†…éƒ¨çš„å‡½æ•°ï¼Œå°±åƒç±»å®šä¹‰ä¸­çš„å…¶ä»–å˜é‡ä¸€æ · ç±»æˆå‘˜å‡½æ•°æ˜¯ç±»çš„ä¸€ä¸ªæˆå‘˜ï¼Œå®ƒå¯ä»¥æ“ä½œç±»çš„ä»»æ„å¯¹è±¡ï¼Œå¯ä»¥è®¿é—®å¯¹è±¡ä¸­çš„æ‰€æœ‰æˆå‘˜ æ³¨æ„ï¼šæˆå‘˜å¯ä»¥è®¿é—®ä»»æ„çš„æˆå‘˜ï¼ˆæ— è®ºæ—¶publicè¿˜æ˜¯protectedï¼Œprivateï¼‰\nåœ¨å†…éƒ¨å£°æ˜å¹¶å®šä¹‰ 1 2 3 4 5 6 7 8 9 10 class Box { public: double length; // é•¿åº¦ double breadth; // å®½åº¦ double height; // é«˜åº¦ double getVolume(void) { return length * breadth * height; } }; åœ¨å†…éƒ¨å£°æ˜ï¼Œå¤–éƒ¨å®šä¹‰ åœ¨ç±»çš„å¤–éƒ¨ä½¿ç”¨èŒƒå›´è§£æè¿ç®—ç¬¦ ::Â å®šä¹‰è¯¥å‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 class complex { public: complex();//é»˜è®¤æ„é€ å‡½æ•° complex(double,double);//åˆå§‹åŒ–æ„é€ å‡½æ•° complex(double);//å¼ºåˆ¶è½¬æ¢æ„é€ å‡½æ•° complex operator + (complex);//è¿ç®—ç¬¦é‡è½½ complex operator - (complex);//è¿ç®—ç¬¦é‡è½½ friend istream\u0026amp; operator \u0026gt;\u0026gt; (istream\u0026amp; , complex\u0026amp;);//istreamç±»\u0026gt;\u0026gt;è¿ç®—ç¬¦é‡è½½ friend ostream\u0026amp; operator \u0026lt;\u0026lt; (ostream\u0026amp; , complex\u0026amp;);//ostreamç±»\u0026lt;\u0026lt;è¿ç®—ç¬¦é‡è½½ private: double real , imag ; }; //æˆå‘˜å‡½æ•°çš„ç±»å¤–å®ç° complex::complex() { real = 0 ;imag = 0 ; } complex::complex(double r , double i ) { real = r ; imag = i ; } complex::complex(double r ) { real = r ; imag = 0 ; } complex complex::operator + (const complex c1) { complex c2 ; c2.real = real+c1.real ; c2.imag = imag+c1.imag ; return c2 ; } complex complex::operator - (const complex c1) { complex c2 ; c2.real = real-c1.real ; c2.imag = imag-c1.imag ; return c2 ; } //å‹å…ƒå‡½æ•°çš„å®ç° //å®ç°iostreamç±»çš„è¿ç®—ç¬¦é‡è½½ istream\u0026amp; operator \u0026gt;\u0026gt; (istream\u0026amp; input , complex\u0026amp;c ) { input \u0026gt;\u0026gt; c.real \u0026gt;\u0026gt; c.imag ; return input ; } ostream\u0026amp; operator \u0026lt;\u0026lt; (ostream\u0026amp; output , complex\u0026amp;c ) { output \u0026lt;\u0026lt; c.real \u0026lt;\u0026lt; \u0026#39;+\u0026#39; \u0026lt;\u0026lt; c.imag \u0026lt;\u0026lt; \u0026#39;i\u0026#39; \u0026lt;\u0026lt; endl ; return output ; } ç±»çš„å‹å…ƒå‡½æ•° ç±»çš„å‹å…ƒå‡½æ•°æ˜¯å®šä¹‰åœ¨ç±»å¤–éƒ¨ï¼Œä½†æœ‰æƒè®¿é—®ç±»çš„æ‰€æœ‰ç§æœ‰ï¼ˆprivateï¼‰æˆå‘˜å’Œä¿æŠ¤ï¼ˆprotectedï¼‰æˆå‘˜ï¼Œå°½ç®¡å‹å…ƒå‡½æ•°çš„åŸå‹æœ‰åœ¨ç±»çš„å®šä¹‰ä¸­å‡ºç°è¿‡ï¼Œä½†æ˜¯å‹å…ƒå‡½æ•°å¹¶ä¸æ˜¯æˆå‘˜å‡½æ•°\nå‹å…ƒå¯ä»¥æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°è¢«ç§°ä¸ºå‹å…ƒå‡½æ•°ï¼›å‹å…ƒä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªç±»ï¼Œè¯¥ç±»è¢«ç§°ä¸ºå‹å…ƒç±»ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ•´ä¸ªç±»åŠå…¶æ‰€æœ‰æˆå‘˜éƒ½æ˜¯å‹å…ƒ\nå‹å…ƒå‡½æ•°çš„å®šä¹‰ä¸å£°æ˜ å¦‚æœè¦å£°æ˜å‡½æ•°ä¸ºä¸€ä¸ªç±»çš„å‹å…ƒï¼Œéœ€è¦åœ¨ç±»å®šä¹‰ä¸­å°†è¯¥å‡½æ•°åŸå‹å£°æ˜ï¼Œä¸”ä½¿ç”¨å…³é”®å­—Â friend\nä¾‹å­ 1 2 3 4 5 6 7 8 9 10 11 12 13 class Date { public: Date(int ,int ,int );//æ„é€ å‡½æ•° friend void Time::display( Date\u0026amp; );//å£°æ˜Timeç±»ä¸­çš„displayå‡½æ•°æ˜¯Dateç±»çš„å‹å…ƒæˆå‘˜å‡½æ•° private: int month , day , year ; }; //ç±»å¤–çš„å®šä¹‰å®ç° void Time::display(Date \u0026amp;D) { cout \u0026lt;\u0026lt; D.month \u0026lt;\u0026lt; \u0026#39;/\u0026#39; \u0026lt;\u0026lt; D.day \u0026lt;\u0026lt; \u0026#39;/\u0026#39; \u0026lt;\u0026lt; D.year \u0026lt;\u0026lt; endl ;//å¼•ç”¨Dateç±»å¯¹è±¡çš„ç§æœ‰æ•°æ® cout \u0026lt;\u0026lt; hour \u0026lt;\u0026lt; \u0026#34;:\u0026#34; \u0026lt;\u0026lt; minute \u0026lt;\u0026lt; \u0026#34;:\u0026#34; \u0026lt;\u0026lt; second \u0026lt;\u0026lt; endl ; } ","date":"2025-09-04T00:32:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E6%88%90%E5%91%98%E5%87%BD%E6%95%B0%E4%B8%8E%E5%8F%8B%E5%85%83%E5%87%BD%E6%95%B0/","title":"C++ æˆå‘˜å‡½æ•°ä¸å‹å…ƒå‡½æ•°"},{"content":"åœ¨ C\u0026amp;C++ ä¸­ï¼Œæ·±æ‹·è´ï¼ˆDeep Copyï¼‰ å’Œ æµ…æ‹·è´ï¼ˆShallow Copyï¼‰ æ˜¯å¯¹è±¡å¤åˆ¶çš„ä¸¤ç§æ ¹æœ¬ä¸åŒçš„æ–¹å¼ï¼Œä¸»è¦åŒºåˆ«åœ¨äºå¦‚ä½•å¤„ç†æŒ‡é’ˆæˆå‘˜æŒ‡å‘çš„èµ„æºã€‚ç†è§£å®ƒä»¬çš„åŒºåˆ«å¯¹å†…å­˜ç®¡ç†å’Œç¨‹åºç¨³å®šæ€§è‡³å…³é‡è¦ã€‚\nå…³äºCçš„æ·±æ‹·è´ä¸æµ…æ‹·è´ cè¯­è¨€ä¸­çš„æ·±æ‹·è´å’Œæµ…æ‹·è´ - çŸ¥ä¹\næ¨èåšæ–‡ cè¯­è¨€ä¸­çš„æ·±æ‹·è´å’Œæµ…æ‹·è´ - çŸ¥ä¹\nCè¯­è¨€ - æ·±æ‹·è´ä¸æµ…æ‹·è´è¯¦è§£_cè¯­è¨€ deepcopy-CSDNåšå®¢\nã€C++ æ·±æ‹·è´ä¸æµ…æ‹·è´è¯¦è§£ã€‘_c++æµ…æ‹·è´å’Œæ·±æ‹·è´-CSDNåšå®¢\nã€C++ Primerã€‘ æµ…æ‹·è´å’Œæ·±æ‹·è´çš„å®ç° - çŸ¥ä¹\n1. æµ…æ‹·è´ï¼ˆShallow Copyï¼‰ åŸç†ï¼šä»…å¤åˆ¶å¯¹è±¡çš„æˆå‘˜å€¼ï¼ˆåŒ…æ‹¬æŒ‡é’ˆçš„å€¼ï¼‰ï¼Œä¸å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„å®é™…èµ„æºã€‚\nç»“æœï¼šåŸå¯¹è±¡å’Œæ‹·è´å¯¹è±¡çš„æŒ‡é’ˆæˆå‘˜æŒ‡å‘åŒä¸€å—å†…å­˜åœ°å€ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 class Shallow { public: int* data; Shallow(int d) { data = new int(d); // åˆ†é…å †å†…å­˜ } // ç¼–è¯‘å™¨ç”Ÿæˆçš„é»˜è®¤æ‹·è´æ„é€ å‡½æ•°ï¼ˆæµ…æ‹·è´ï¼‰ Shallow(const Shallow\u0026amp; other) : data(other.data) {} ~Shallow() { delete data; } }; // ä½¿ç”¨ç¤ºä¾‹ Shallow obj1(10); Shallow obj2 = obj1; // æµ…æ‹·è´ï¼šobj2.data æŒ‡å‘ obj1.data çš„å†…å­˜ *obj1.data = 20; // ä¿®æ”¹ obj1 cout \u0026lt;\u0026lt; *obj2.data; // è¾“å‡º 20ï¼ˆobj2 ä¹Ÿè¢«ä¿®æ”¹ï¼‰ // mainç»“æŸæ—¶ï¼šobj2 å’Œ obj1 ä¼šå…ˆåè°ƒç”¨ææ„å‡½æ•° // å¯¼è‡´åŒä¸€å†…å­˜è¢« delete ä¸¤æ¬¡ â†’ ç¨‹åºå´©æºƒï¼ æµ…æ‹·è´çš„æ ¸å¿ƒé—®é¢˜ï¼š æ‚¬ç©ºæŒ‡é’ˆï¼šä¸€ä¸ªå¯¹è±¡é‡Šæ”¾èµ„æºåï¼Œå¦ä¸€ä¸ªå¯¹è±¡çš„æŒ‡é’ˆå¤±æ•ˆ é‡å¤é‡Šæ”¾ï¼šå¤šä¸ªå¯¹è±¡å°è¯•é‡Šæ”¾åŒä¸€å—å†…å­˜ â†’ å´©æºƒ æ•°æ®ç¯¡æ”¹ï¼šé€šè¿‡ä¸€ä¸ªå¯¹è±¡ä¿®æ”¹æ•°æ®ä¼šå½±å“å…¶ä»–å¯¹è±¡ 2. æ·±æ‹·è´ï¼ˆDeep Copyï¼‰ åŸç†ï¼šä¸ä»…å¤åˆ¶å¯¹è±¡æˆå‘˜ï¼Œè¿˜å¤åˆ¶æŒ‡é’ˆæŒ‡å‘çš„èµ„æºã€‚\nç»“æœï¼šåŸå¯¹è±¡å’Œæ‹·è´å¯¹è±¡æ‹¥æœ‰å®Œå…¨ç‹¬ç«‹çš„èµ„æºå‰¯æœ¬ã€‚\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 class Deep { public: int* data; Deep(int d) { data = new int(d); } // è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°ï¼ˆæ·±æ‹·è´ï¼‰ Deep(const Deep\u0026amp; other) { data = new int(*other.data); // å…³é”®ï¼šåˆ†é…æ–°å†…å­˜å¹¶å¤åˆ¶å€¼ } // æ·±æ‹·è´èµ‹å€¼è¿ç®—ç¬¦ Deep\u0026amp; operator=(const Deep\u0026amp; other) { if (this != \u0026amp;other) { // é˜²æ­¢è‡ªèµ‹å€¼ delete data; // é‡Šæ”¾åŸæœ‰èµ„æº data = new int(*other.data); // åˆ›å»ºæ–°å‰¯æœ¬ } return *this; } ~Deep() { delete data; } }; // ä½¿ç”¨ç¤ºä¾‹ Deep obj1(10); Deep obj2 = obj1; // æ·±æ‹·è´ï¼šobj2 æ‹¥æœ‰ç‹¬ç«‹çš„å†…å­˜å‰¯æœ¬ *obj1.data = 20; // ä¿®æ”¹ obj1 cout \u0026lt;\u0026lt; *obj2.data; // è¾“å‡º 10ï¼ˆobj2 ä¸å—å½±å“ï¼‰ // ææ„æ—¶å„è‡ªé‡Šæ”¾ç‹¬ç«‹å†…å­˜ â†’ å®‰å…¨ æ·±æ‹·è´çš„æ ¸å¿ƒä¼˜åŠ¿ï¼š èµ„æºç‹¬ç«‹ï¼šæ¯ä¸ªå¯¹è±¡æ‹¥æœ‰è‡ªå·±çš„èµ„æºå‰¯æœ¬ å®‰å…¨ææ„ï¼šä¸ä¼šå‘ç”Ÿé‡å¤é‡Šæ”¾ æ•°æ®éš”ç¦»ï¼šä¿®æ”¹ä¸€ä¸ªå¯¹è±¡ä¸å½±å“å…¶ä»–å¯¹è±¡ 3. å…³é”®å¯¹æ¯”è¡¨ ç‰¹æ€§ æµ…æ‹·è´ æ·±æ‹·è´ å¤åˆ¶å†…å®¹ æŒ‡é’ˆå€¼ï¼ˆå†…å­˜åœ°å€ï¼‰ æŒ‡é’ˆæŒ‡å‘çš„å®é™…æ•°æ® èµ„æºå‰¯æœ¬ å…±äº«åŒä¸€ä»½èµ„æº åˆ›å»ºç‹¬ç«‹èµ„æºå‰¯æœ¬ å†…å­˜å¼€é”€ å° å¤§ï¼ˆéœ€é¢å¤–åˆ†é…å†…å­˜ï¼‰ å®‰å…¨æ€§ å±é™©ï¼ˆæ‚¬ç©ºæŒ‡é’ˆ/é‡å¤é‡Šæ”¾ï¼‰ å®‰å…¨ é»˜è®¤è¡Œä¸º ç¼–è¯‘å™¨é»˜è®¤ç”Ÿæˆ éœ€è¦æ‰‹åŠ¨å®ç° ä¿®æ”¹å½±å“ å½±å“æ‰€æœ‰å‰¯æœ¬ åªå½±å“å½“å‰å¯¹è±¡ é€‚ç”¨åœºæ™¯ æ— èµ„æºç®¡ç†çš„ç®€å•å¯¹è±¡ å«æŒ‡é’ˆ/åŠ¨æ€èµ„æºçš„å¯¹è±¡ 4. ä½•æ—¶éœ€è¦æ·±æ‹·è´ï¼Ÿ å½“ç±»æ»¡è¶³ä»¥ä¸‹ä»»ä¸€æ¡ä»¶æ—¶å¿…é¡»å®ç°æ·±æ‹·è´ï¼š\nåŒ…å«åŸå§‹æŒ‡é’ˆæˆå‘˜æŒ‡å‘åŠ¨æ€åˆ†é…çš„å†…å­˜ ç®¡ç†ç‹¬å èµ„æºï¼ˆæ–‡ä»¶å¥æŸ„ã€ç½‘ç»œè¿æ¥ç­‰ï¼‰ éœ€è¦ç‹¬ç«‹å‰¯æœ¬é€»è¾‘ï¼ˆå¦‚å­—ç¬¦ä¸²ã€å®¹å™¨ç±»ï¼‰ Rule of Three åŸåˆ™ï¼šå¦‚æœç±»éœ€è¦è‡ªå®šä¹‰ææ„å‡½æ•°ï¼Œåˆ™é€šå¸¸ä¹Ÿéœ€è¦è‡ªå®šä¹‰æ‹·è´æ„é€ å‡½æ•°å’Œæ‹·è´èµ‹å€¼è¿ç®—ç¬¦ï¼ˆå³æ·±æ‹·è´ï¼‰ã€‚\n5. ç°ä»£C++çš„ä¼˜åŒ–æ–¹æ¡ˆ (1) ç¦ç”¨æ‹·è´ 1 2 3 4 5 6 class NonCopyable { public: NonCopyable() = default; NonCopyable(const NonCopyable\u0026amp;) = delete; // ç¦ç”¨æ‹·è´ NonCopyable\u0026amp; operator=(const NonCopyable\u0026amp;) = delete; }; (2) ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆï¼ˆæ¨èï¼‰ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 #include \u0026lt;memory\u0026gt; class SafeObject { std::unique_ptr\u0026lt;int\u0026gt; data; // ç‹¬å æ‰€æœ‰æƒ public: SafeObject(int d) : data(std::make_unique\u0026lt;int\u0026gt;(d)) {} // ä¸éœ€è¦è‡ªå®šä¹‰æ‹·è´æ„é€ /èµ‹å€¼ // unique_ptr ç¦æ­¢æ‹·è´ï¼Œä½†æ”¯æŒç§»åŠ¨ }; // shared_ptr ç‰ˆæœ¬ï¼ˆå…±äº«æ‰€æœ‰æƒï¼Œå¼•ç”¨è®¡æ•°ï¼‰ class SharedResource { std::shared_ptr\u0026lt;MyResource\u0026gt; res; }; (3) ç§»åŠ¨è¯­ä¹‰ï¼ˆC++11+ï¼‰ 1 2 3 4 5 6 7 8 9 class Movable { int* data; public: // ç§»åŠ¨æ„é€ å‡½æ•°ï¼ˆè½¬ç§»èµ„æºæ‰€æœ‰æƒï¼‰ Movable(Movable\u0026amp;\u0026amp; other) noexcept : data(other.data) { other.data = nullptr; // ç½®ç©ºåŸå¯¹è±¡ } }; 6. æ·±æ‹·è´çš„å…¸å‹åº”ç”¨åœºæ™¯ å­—ç¬¦ä¸²ç±»ï¼šstd::string å†…éƒ¨å®ç°æ·±æ‹·è´ å®¹å™¨ç±»ï¼šstd::vector å¤åˆ¶æ—¶æ·±æ‹·è´æ‰€æœ‰å…ƒç´  è‡ªå®šä¹‰èµ„æºç®¡ç†ï¼šæ•°æ®åº“è¿æ¥æ± ã€å›¾åƒç¼“å†²åŒºç­‰ å¤šçº¿ç¨‹å®‰å…¨ï¼šé¿å…å…±äº«èµ„æºéœ€è¦æ·±æ‹·è´ æ€»ç»“ æ¦‚å¿µ æœ¬è´¨ è§£å†³æ–¹æ¡ˆ æµ…æ‹·è´ å¤åˆ¶æŒ‡é’ˆï¼ˆå…±äº«èµ„æºï¼‰ ç¼–è¯‘å™¨é»˜è®¤è¡Œä¸º æ·±æ‹·è´ å¤åˆ¶èµ„æºå†…å®¹ï¼ˆç‹¬ç«‹å‰¯æœ¬ï¼‰ è‡ªå®šä¹‰æ‹·è´æ„é€ /èµ‹å€¼è¿ç®—ç¬¦ ç°ä»£å®è·µ é¿å…æ‰‹åŠ¨æ·±æ‹·è´ ä½¿ç”¨æ™ºèƒ½æŒ‡é’ˆ+ç§»åŠ¨è¯­ä¹‰ æœ€ä½³å®è·µï¼š\nä¼˜å…ˆä½¿ç”¨ std::vector, std::string ç­‰å·²å®‰å…¨å®ç°çš„å®¹å™¨ ç”¨ std::unique_ptr/std::shared_ptr æ›¿ä»£åŸå§‹æŒ‡é’ˆ éµå¾ª Rule of Zeroï¼šé€šè¿‡ç»„åˆå®‰å…¨ç±»å‹é¿å…è‡ªå®šä¹‰æ‹·è´/ææ„ å¯¹äºå¿…é¡»æ·±æ‹·è´çš„å¤§å‹å¯¹è±¡ï¼Œè€ƒè™‘æ·»åŠ ç§»åŠ¨è¯­ä¹‰ä¼˜åŒ–æ€§èƒ½ ","date":"2025-08-20T22:43:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/cc-%E6%B7%B1%E6%8B%B7%E8%B4%9D%E4%B8%8E%E6%B5%85%E6%8B%B7%E8%B4%9D/","title":"C\u0026C++ æ·±æ‹·è´ä¸æµ…æ‹·è´"},{"content":"ï¼ˆstm32ä¹‹HALåº“ï¼‰UARTå·¥ä½œåœ¨DMAæ¨¡å¼è¦æ‰“å¼€ä¸²å£ä¸­æ–­å—ï¼Ÿ_hal uart dma-CSDNåšå®¢\n10 é€šç”¨åŒæ­¥å¼‚æ­¥æ”¶å‘å™¨ï¼ˆUSARTï¼‰ - çŸ¥ä¹\nä¸²å£ç®€ä»‹ ä¸²å£æ˜¯ä¸²è¡Œæ¥å£çš„ç®€ç§° å¸¸ç”¨ä¸²å£ï¼šRS232,RS485,USB(Universal Serial Bus)é€šç”¨ä¸²è¡Œæ¥å£,TTLä¸²å£ TTLæ˜¯Transistor-Transistor Logicçš„ç®€å†™ï¼Œæ˜¯ä¸€ç§ç”µå¹³é€»è¾‘ï¼Œæ™¶ä½“ç®¡-æ™¶ä½“ç®¡é€»è¾‘\nUSARTç®€ä»‹ USARTï¼Œå³é€šç”¨åŒæ­¥/å¼‚æ­¥æ”¶å‘ä¼ è¾“å™¨ï¼ˆUniversal Asynchronous Receiver/Transmitter)ï¼Œæ˜¯å•ç‰‡æœºä¸Šçš„ä¸€ä¸ªå¤–è®¾\nUARTéµå¾ªå¼‚æ­¥ä¸²è¡Œé€šä¿¡åè®®çš„ï¼ŒUSRTéµå¾ªåŒæ­¥ä¸²è¡Œé€šä¿¡åè®® å¼‚æ­¥ä¸éœ€è¦ç»Ÿä¸€æ—¶é’Ÿä¿¡å·ï¼ŒåŒæ­¥éœ€è¦ç»Ÿä¸€æ—¶é’Ÿä¿¡å·\nä¸€èˆ¬ä½¿ç”¨æœ€å¤šçš„æ˜¯UARTï¼Œæˆ‘ä»¬æ­¤æ¬¡å­¦ä¹ ä¹Ÿæ˜¯é’ˆå¯¹UART\nUARTé€šä¿¡åè®® èµ·å§‹ä½ï¼šå‘å‡º1ä½ä½ç”µå¹³ä¿¡å·ï¼Œè¡¨ç¤ºå¼€å§‹ä¼ è¾“å­—ç¬¦ æ•°æ®ä½ï¼šçœŸæ­£å‘é€çš„æ•°æ®ï¼Œä¸€èˆ¬ä¸º8ä½ï¼ˆ1ä¸ªå­—èŠ‚ï¼‰ï¼Œå¸¸é‡‡ç”¨ASCIIç¼–ç ï¼Œä»æœ€ä½ä½å¼€å§‹å‘é€ æ ¡éªŒä½ï¼šç”¨äºæ£€éªŒæ¥æ”¶åˆ°çš„æ•°æ®æ˜¯å¦æ­£ç¡®ï¼Œåˆ†ä¸ºå¥‡æ ¡éªŒå’Œå¶æ ¡éªŒ åœæ­¢ä½ï¼šä¸€ç»„æ•°æ®çš„ç»“æŸä¼ è¾“çš„æ ‡å¿—ã€‚å¯ä»¥æ˜¯1ä½ã€1.5ä½ã€2ä½çš„é«˜ç”µå¹³ ç©ºé—²ä½ï¼šç©ºé—²æ—¶æ•°æ®çº¿ä¸ºé«˜ç”µå¹³çŠ¶æ€ï¼Œä»£è¡¨æ— æ•°æ®ä¼ è¾“ æ³¢ç‰¹ç‡ï¼šè¡¡é‡ä¼ è¾“é€Ÿç‡çš„æŒ‡æ ‡ã€‚UARTé€šä¿¡ä¸­æ³¢ç‰¹ç‡ç­‰äºæ¯”ç‰¹ç‡ UARTå‘é€/æ¥æ”¶æœºåˆ¶ UARTå‘é€ç«¯å£ï¼Œé¦–å…ˆæ˜¯CPUå°†æ•°æ®æ”¾å…¥æ•°æ®å‘é€å¯„å­˜å™¨ï¼Œç„¶åå‘é€ç§»ä½å¯„å­˜å™¨ä¼šå°†æ•°æ®ä»æ•°æ®å‘é€å¯„å­˜å™¨ å–å‡ºè¿›è¡Œç§»ä½å¹¶é€šè¿‡UART_TXå‘é€å‡ºå»\nUARTæ¥æ”¶ç«¯å£ï¼Œé¦–å…ˆæ˜¯UART_RXæ¥æ”¶ä¸²è¡Œæ•°æ®è‡³æ¥æ”¶ç§»ä½å¯„å­˜å™¨ï¼Œæ¥æ”¶ç§»ä½å¯„å­˜å™¨å°†ä¸²è¡Œæ•°æ®ç§»ä½å˜æ¢ä¸ºå¹¶è¡Œæ•°æ®ç»™æ•°æ®æ¥æ”¶å¯„å­˜å™¨ï¼Œå†é€šè¿‡APBæ€»çº¿ç»™STM32å†…éƒ¨\nUARTæ¨¡å¼ è½®è¯¢æ¨¡å¼ CPUä¸æ–­æŸ¥è¯¢å‘é€æ•°æ®å¯„å­˜å™¨æˆ–è€…æ¥å—æ•°æ®å¯„å­˜å™¨å¯¼è‡´ç¨‹åºçš„é˜»å¡\nå‘é€ åœ¨UARTåº•å±‚æœ‰å‘é€ç§»ä½å¯„å­˜å™¨å’Œå‘é€æ•°æ®å¯„å­˜å™¨ï¼Œå‘é€æ•°æ®æ—¶ï¼Œéœ€è¦CPUå°†å‘é€æ•°æ®å¯„å­˜å™¨çš„æ•°æ®ç§»åŠ¨è‡³å‘é€ç§»ä½å¯„å­˜å™¨ï¼Œç„¶åUARTæŒ‰ç…§æŒ‡å®šçš„æ³¢ç‰¹ç‡å‘é€æ•°æ®ï¼ŒCPUåˆ™ä¸æ–­æŸ¥è¯¢æ•°æ®å‘é€å¯„å­˜å™¨æ˜¯å¦ç©ºï¼Œå¦‚æœç©ºåˆ™éœ€è¦ç§»åŠ¨æ•°æ®è¿›æ¥\næ¥æ”¶ åœ¨UARTåº•å±‚æœ‰æ¥æ”¶ç§»ä½å¯„å­˜å™¨å’Œæ¥æ”¶æ•°æ®å¯„å­˜å™¨ï¼Œæ¥æ”¶æ•°æ®æ—¶ï¼ŒUARTæŒ‰ç…§æŒ‡å®šçš„æ³¢ç‰¹ç‡æ¥æ”¶æ•°æ®è‡³æ¥æ”¶ç§»ä½å¯„å­˜å™¨ï¼Œç„¶åæ•°æ®ä¼šå­˜å‚¨åœ¨æ¥æ”¶æ•°æ®å¯„å­˜å™¨ï¼ŒCPUåˆ™ä¸æ–­æŸ¥è¯¢æ•°æ®æ¥æ”¶å¯„å­˜å™¨æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼ŒCPUä¼šæŠŠå¯„å­˜å™¨çš„æ•°æ®ç§»åŠ¨è‡³æˆ‘ä»¬ç”¨æ¥æ¥æ”¶æ•°æ®çš„å˜é‡çš„å†…å­˜é‡Œ\nå½“HAL_UART_Receiveæ‰§è¡Œå®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ•°æ®æ¥æ”¶å®Œæˆ\nä¸­æ–­æ¨¡å¼ ä½¿ç”¨ä¸­æ–­æ¨¡å¼æ—¶ï¼Œéœ€è¦å…ˆé…ç½®UARTçš„NVICä¸­æ–­è®¾ç½®\nåº•å±‚ä¸­æ–­å®ç°æ•°æ®æ¯ä¼ é€ä¸€å­—èŠ‚ï¼Œå¬å›CPUç»§ç»­è¿è¾“æ•°æ®ï¼Œä¸éœ€è¦æˆ‘ä»¬è€ƒè™‘ï¼ŒHALåº“åº•å±‚å·²ç»å¸®æˆ‘ä»¬å®ç° ä¸Šå±‚ä¸­æ–­å®ç°æ•°æ®æ¥æ”¶å®Œæˆåçš„æ•°æ®å¤„ç†ï¼Œé€šè¿‡ä¸­æ–­å›è°ƒå‡½æ•°å®ç°ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±è®¾è®¡\nå‘é€ CPUå°†æ•°æ®é€å…¥ å‘é€æ•°æ®å¯„å­˜å™¨ï¼Œç„¶åå°±å»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œå½“å‘é€ç§»ä½å¯„å­˜å™¨çš„æ•°æ®å‘é€åï¼Œå‘é€æ•°æ®å¯„å­˜å™¨ç©ºï¼Œä¼šè§¦å‘å‘é€æ•°æ®å¯„å­˜å™¨ç©ºä¸­æ–­ï¼ŒCPUå†æ¬¡å°†æ•°æ®é€å…¥ å‘é€æ•°æ®å¯„å­˜å™¨ï¼Œç„¶ååˆå»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œæ‰€æœ‰æ•°æ®å‘é€å®Œæˆåä¼šè§¦å‘ ä¼ é€å®Œæˆä¸­æ–­ï¼Œè°ƒç”¨HAL_UART_TxCpltCallbackä¸­æ–­å›è°ƒå‡½æ•°\næ¥æ”¶ CPUåœ¨å¤„ç†å…¶ä»–ä»£ç ï¼Œæ¥æ”¶ç§»ä½å¯„å­˜å™¨å°†ä¸€å¸§æ•°æ®ç§»åŠ¨è‡³ æ¥å—æ•°æ®å¯„å­˜å™¨åï¼Œä¼šè§¦å‘ æ¥æ”¶æ•°æ®å¯„å­˜å™¨éç©ºä¸­æ–­ï¼ŒCPUä¼šå›æ¥å°† æ¥æ”¶æ•°æ®å¯„å­˜å™¨ çš„æ•°æ®ç§»åŠ¨è‡³æˆ‘ä»¬ç”¨æ¥æ¥æ”¶æ•°æ®çš„å˜é‡çš„å†…å­˜é‡Œï¼Œç„¶ååˆå»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œæ‰€æœ‰æ•°æ®å®Œæˆåä¼šè°ƒç”¨_HAL_UART_RxCpltCallback_ä¸­æ–­å›è°ƒå‡½æ•°å¤„ç†æ¥æ”¶çš„æ•°æ®\nè€Œæ‰§è¡ŒHAL_UART_Receive_ITåï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å¯¹æ•°æ®ç»§ç»­å¤„ç†ï¼Œæ•°æ®è¿˜æ²¡æ¥æ”¶å®Œæˆï¼Œå› ä¸ºCPUä¸ä¼šè¿›å…¥é˜»å¡æ€ï¼Œä¼šå»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œéœ€è¦é€šè¿‡HAL_UART_RxCpltCallbackå›è°ƒå‡½æ•°å¤„ç†æ¥æ”¶çš„æ•°æ®\nDMAæ¨¡å¼ DMAï¼Œå…¨ç§°ä¸ºDirect Memory Accessï¼Œç›´æ¥å†…å­˜è®¿é—®ï¼Œæœ¬è´¨æ˜¯å°†ä¼ è¾“æ•°æ®ä»ä¸€ä¸ªå†…å­˜ç©ºé—´æ¬è¿è‡³å¦ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œå¯ä»¥ç”¨æ¥æä¾›å¤–è®¾å’Œå†…å­˜ï¼Œå†…å­˜å’Œå¤–è®¾ä¹‹é—´çš„é«˜é€Ÿæ•°æ®ä¼ è¾“\nDMAæ¨¡å¼ä¸­ä¹Ÿä¼šæœ‰ä¸­æ–­å‚ä¸ï¼Œåœ¨Cubeé…ç½®ä¸­éœ€è¦å¼€å¯ä¸­æ–­\nå‘é€ åœ¨æ™®é€šçš„è½®è¯¢USARTä¸­ï¼ŒCPUä¸€ç›´åœ¨ç­‰å¾…å¤–è®¾å‘é€æ•°æ®ï¼Œå¤–è®¾æ¯å‘é€ä¸€å¸§æ•°æ®ï¼ŒCPUå°±ä»å†…å­˜ä¸­ç§»åŠ¨ä¸€å¸§æ•°æ®åˆ°å¤–è®¾çš„å¯„å­˜å™¨\nåœ¨ä¸­æ–­çš„USARTä¸­ï¼Œå¤–è®¾æ¯ä»å¯„å­˜å™¨ä¸­å‘é€ä¸€å¸§æ•°æ®ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡å‘é€æ•°æ®å¯„å­˜å™¨ç©ºä¸­æ–­ï¼Œä½¿CPUå›æ¥å°†æ•°æ®ä»å†…å­˜æ¬è¿è‡³å¤–è®¾çš„å¯„å­˜å™¨ä¸­\næ²¡æœ‰DMAçš„è¯ï¼ŒCPUä¼šä½œä¸ºæ•°æ®å‘é€çš„ä¸­è½¬ç«™ï¼Œè€Œä½¿ç”¨DMAçš„è¯ï¼Œæ•´ä¸ªæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸éœ€è¦CPUçš„å‚ä¸ï¼Œç”±DMAä»£ç†æ‰§è¡Œï¼ŒDMAè´Ÿè´£å°†å†…å­˜æ•°æ®æ¬è¿è‡³å¤–è®¾çš„ä¼ è¾“å¯„å­˜å™¨\næ¥æ”¶ åœ¨æ™®é€šçš„è½®è¯¢USARTä¸­ï¼ŒCPUä¸€ç›´åœ¨è¯¢é—®å¤–è®¾æ˜¯å¦æ¥æ”¶å®Œæ•°æ®ï¼Œå¤–è®¾æ¥æ”¶ä¸€å¸§æ•°æ®ï¼Œè¯¥ä½æ•°æ®ç”±CPUä»å¤–è®¾çš„æ•°æ®æ¥æ”¶å¯„å­˜å™¨è¿è¿›å†…å­˜ï¼ŒCPUå†æ¬¡è¯¢é—®å¤–è®¾æ˜¯å¦æ¥æ”¶å®Œæ•°æ®ï¼Œå†è¿ï¼Œç›´è‡³æ•´ä¸ªæ•°æ®æ¥æ”¶å®Œæˆ\nè€Œåœ¨ä¸­æ–­USARTä¸­ï¼Œå¤–è®¾æ¯æ¥æ”¶ä¸€å¸§æ•°æ®ï¼Œè§¦å‘ä¸€æ¬¡æ•°æ®æ¥æ”¶å¯„å­˜å™¨éç©ºä¸­æ–­ï¼ŒCPUè¿‡æ¥å°†æ•°æ®ä»å¯„å­˜å™¨æ¬è¿è‡³å†…å­˜ï¼Œæ‰€æœ‰æ•°æ®æ¥æ”¶å®Œæˆåï¼Œä¼šè°ƒç”¨æ¥æ”¶å®Œæˆä¸­æ–­å›è°ƒå‡½æ•°ï¼ˆHAL_UART_RxCpltCallbackï¼‰\næ²¡æœ‰DMAçš„è¯ï¼ŒCPUä¼šä½œä¸ºæ•°æ®è½¬è¿çš„ä¸­è½¬ç«™ï¼Œè€Œä½¿ç”¨DMAçš„è¯ï¼Œæ•´ä¸ªæ•°æ®è½¬è¿è¿‡ç¨‹ä¸éœ€è¦CPUçš„å‚ä¸ï¼Œç”±DMAä»£ç†æ‰§è¡Œ\nCubeé…ç½®è§£æ åŸºç¡€å‚æ•°é…ç½® Baud Rateï¼šæ³¢ç‰¹ç‡ Word Lengthï¼šåŒ…å«æ ¡éªŒä½åœ¨å†…çš„æ•°æ®åŒ…é•¿åº¦ Parityï¼šå¥‡å¶æ ¡éªŒä½ Stop Bitsï¼šåœæ­¢ä½ä½æ•° Data Directionï¼šå‘é€å’Œ NVICé…ç½® å¦‚æœä½¿ç”¨ä¸­æ–­æ¨¡å¼ï¼Œéœ€è¦åœ¨NVIC settingså¼€å¯USARTi global interrupt DMAé…ç½® Addï¼šé€‰æ‹©æ·»åŠ USARTi_RXçš„DMAæˆ–è€…USARTi_TXçš„DMA Deleteï¼šåˆ é™¤å¯¹åº”çš„DMA Modeï¼šé€‰æ‹©normalæ¨¡å¼æˆ–è€…circularæ¨¡å¼ Data Byteï¼šæ•°æ®ä¼ è¾“çš„ä½æ•° Increment Addressï¼šå¼€å¯åœ°å€è‡ªå¢ï¼Œå¤–è®¾åªæœ‰ä¸€ä¸ªå¯„å­˜å™¨ï¼Œåœ°å€å›ºå®šï¼Œä¸éœ€è¦å¼€å¯åœ°å€è‡ªå¢ï¼Œè€Œå†…å­˜ä¸­æˆ‘ä»¬å­˜æ•°æ®çš„å˜é‡æ˜¯æ•°ç»„ï¼Œæ¥å—ä¸€å­—èŠ‚æ•°æ®åéœ€è¦å¾€åç§»ï¼Œéœ€è¦å¼€å¯åœ°å€è‡ªå¢ Priorityï¼šä¼˜å…ˆçº§è®¾ç½® Directionï¼šæ–¹å‘ï¼Œå›ºå®šæ­»çš„ GPIOé…ç½® ä¸€èˆ¬ç”¨æ¥æŸ¥çœ‹å¼•è„šçš„GPIOé…ç½®ï¼Œä¸éœ€è¦æ›´æ”¹ï¼ˆæœ‰ç‰¹æ®Šéœ€æ±‚æ—¶ï¼Œå¯ä»¥æŒ‰éœ€ä¿®æ”¹ï¼‰ åœ¨GPIO Settingså¤„å¯ä»¥æŸ¥çœ‹TXå’ŒRXçš„GPIOå¼•è„šé…ç½®ï¼Œæ­¤å¤„å¯ä»¥çœ‹åˆ°RXä¸ºè¾“å…¥æ¨¡å¼ï¼Œæ— ä¸Šæ‹‰æ— ä¸‹æ‹‰\nHALåº“UARTå¸¸ç”¨å‡½æ•° è½®è¯¢æ¨¡å¼ 1 2 HAL_UART_Receive(\u0026amp;huart1, rxBuffer, 16 , HAL_MAX_DELAY);//æ¥æ”¶ HAL_UART_Transmit(\u0026amp;huart1 , txBuffer , sizeof(txBuffer) , 100 );//å‘é€ ä¸­æ–­æ¨¡å¼ åªèƒ½æ¥æ”¶ä¸€æ¬¡ï¼Œæ¥æ”¶å®Œæˆåéœ€è¦å†æ¬¡å¼€å¯\n1 2 3 4 5 6 7 HAL_UART_Receive_IT(\u0026amp;huart1, rxBuffer, 16 );//æ¥æ”¶ HAL_UART_Transmit_IT(\u0026amp;huart1 , txBuffer , sizeof(txBuffer) );//å‘é€ //å›è°ƒå‡½æ•° void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart) { } DMAæ¨¡å¼ ï¼ˆstm32ä¹‹HALåº“ï¼‰UARTå·¥ä½œåœ¨DMAæ¨¡å¼è¦æ‰“å¼€ä¸²å£ä¸­æ–­å—ï¼Ÿ_hal uart dma-CSDNåšå®¢\n1 2 3 4 5 6 7 HAL_UART_Receive_DMA(\u0026amp;huart1, rxBuffer, 16 );//æ¥æ”¶ HAL_UART_Transmit_DMA(\u0026amp;huart1 , txBuffer , sizeof(txBuffer) );//å‘é€ //å›è°ƒå‡½æ•° void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart) { } HALåº“ä¸­ä½¿ç”¨çš„HAL_UART_Transmit_DMAï¼ŒHAL_UART_Receive_DMAç­‰éƒ½æœ‰ä¸­æ–­çš„å‚ä¸ï¼Œéœ€è¦åœ¨Cubeä¸­å¼€å¯ä¸­æ–­\nDemo æ¥æ”¶å®šé•¿æ•°æ®Nomad_violetï¼ŒåŒæ—¶åœ¨ä¸»å‡½æ•°ä¸­ç¿»è½¬å°ç¯\nè½®è¯¢å®ç°æ•°æ®æ”¶å‘ Cubeé…ç½® æ¨¡å¼é€‰æ‹©ä¸ºå¼‚æ­¥\næ³¢ç‰¹ç‡é€‰æ‹©115200 Bit/sï¼Œå…¶ä½™ä¸åŠ¨å³å¯\nå°†PA8é…ç½®ä¸ºGPIO_Output\nGPIOé…ç½®ä¿æŒé»˜è®¤å³å¯\nä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 #include \u0026#34;string.h\u0026#34; #define rxBufferLen 16 #define txBufferLen 25 uint8_t rxBuffer[rxBufferLen] ; uint8_t txBuffer[txBufferLen] = \u0026#34;to feel,to experience \u0026#34;;// å»æ„Ÿå—ï¼Œå»ç»å†ã€Œæ„Ÿå…¶ç”Ÿï¼Œå†å…¶å¢ƒã€ int main(void) { HAL_Init(); SystemClock_Config(); MX_GPIO_Init(); MX_USART1_UART_Init(); while (1) { HAL_UART_Receive(\u0026amp;huart1, rxBuffer, 12 , HAL_MAX_DELAY);//åªèƒ½æ¥æ”¶å®šé•¿æ•°æ® if( !strcmp( (char *)rxBuffer , \u0026#34;Nomad_violet\u0026#34; ) ) {//Nomad_violet 12å­—èŠ‚ HAL_UART_Transmit(\u0026amp;huart1 , txBuffer , sizeof(txBuffer) , 100 ); } HAL_GPIO_TogglePin(GPIOA , GPIO_PIN_8 ); } } ä¸­æ–­å®ç°æ•°æ®æ”¶å‘ Cubeé…ç½® é…ç½®åŒä¸Šï¼Œåªéœ€é¢å¤–å¼€å¯ä¸­æ–­å³å¯\nä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 #include \u0026#34;string.h\u0026#34; #define rxBufferLen 12 #define txBufferLen 25 uint8_t rxBuffer[rxBufferLen] ; uint8_t txBuffer[txBufferLen] = \u0026#34;to feel,to experience \u0026#34;;// å»æ„Ÿå—ï¼Œå»ç»å†ã€Œæ„Ÿå…¶ç”Ÿï¼Œå†å…¶å¢ƒã€ void HAL_UART_RxCpltCallback(UART_HandleTypeDef *huart) { if(huart == \u0026amp;huart1) { if( !strcmp( (char *)rxBuffer , \u0026#34;Nomad_violet\u0026#34; ) ) { HAL_UART_Transmit(\u0026amp;huart1 , txBuffer , sizeof(txBuffer) , 100 ); } HAL_UART_Receive_IT(\u0026amp;huart1, rxBuffer, rxBufferLen ); } } int main(void) { HAL_Init(); SystemClock_Config(); MX_GPIO_Init(); MX_USART1_UART_Init(); HAL_UART_Receive_IT(\u0026amp;huart1, rxBuffer, rxBufferLen ); while (1) { HAL_GPIO_TogglePin(GPIOA , GPIO_PIN_8 ); HAL_Delay(500); } } ","date":"2025-06-27T14:53:35+08:00","permalink":"https://NomadJoeviolet.github.io/p/stm32uart%E4%B8%B2%E5%8F%A3%E9%80%9A%E4%BF%A1/","title":"STM32â€”â€”â€”â€”UARTä¸²å£é€šä¿¡"},{"content":"ã€STM32ã€‘HALåº“ STM32CubeMXæ•™ç¨‹ä¸ƒ\u0026mdash;PWMè¾“å‡º(å‘¼å¸ç¯)_stm32 hal pwm-CSDNåšå®¢\nSTM32CubeIdeä¸­äº’è¡¥PWMé…ç½®é¡¹çš„è¯¦ç»†è§£è¯»_ch idle state-CSDNåšå®¢ åŸºäºä¸Šè¿°åšå®¢ä»¥åŠkeyskingSTM32æ•™ç¨‹å†™çš„ä¸ªäººå­¦ä¹ æ–‡æ¡£ ã€ã€STM32å…¥é—¨æ•™ç¨‹ã€‘åº”è¯¥æ˜¯å…¨Bç«™æœ€å¥½çš„STM32æ•™ç¨‹äº†ï¼ï¼ã€‘https://www.bilibili.com/video/BV12v4y1y7uV?vd_source=5a0790755035f26a67935abfbfcdfd5b\nå®šæ—¶å™¨ç®€ä»‹ HALåº“å¼€å¯å®šæ—¶å™¨çš„åŸºæœ¬å‡½æ•° å¼€å¯å®šæ—¶å™¨\n1 2 HAL_TIM_Base_Start(\u0026amp;htim1);//ä»…å¼€å¯å®šæ—¶å™¨ HAL_TIM_Base_Start_IT(\u0026amp;htim1);//å¼€å¯å®šæ—¶å™¨å’Œä¸­æ–­ 1 2 HAL_TIM_Base_Stop(\u0026amp;htim1);//å…³é—­å®šæ—¶å™¨ HAL_TIM_Base_Stop_IT(\u0026amp;htim1);//æ—¢å…³é—­å®šæ—¶å™¨ï¼ŒåŒæ—¶å…³é—­ä¸­æ–­ æ¡†æ¶ è§£é‡Šæ•´ä¸ªTIMå¤–è®¾çš„æ„æˆ è®¡æ•°ä¿¡å·æ¥æº æœ‰å†…éƒ¨æ—¶é’Ÿä»¥åŠå¤–éƒ¨æ—¶é’Ÿ å†…éƒ¨æ—¶é’Ÿæ¨¡å¼ åœ¨f103c8t6ä¸­ï¼ŒTIM1æ˜¯é«˜çº§å®šæ—¶å™¨ï¼ŒTIM2ï¼ŒTIM3ï¼ŒTIM4æ˜¯é€šç”¨è®¡æ—¶å™¨\nCubeMXå‚æ•°é…ç½® Prescaler:é¢„åˆ†é¢‘ï¼Œå®é™…åˆ†é¢‘æ•°æ˜¯number+1 Counter Mode:è®¡æ•°æ¨¡å¼è®¾ç½® Counter Period:è‡ªåŠ¨é‡è£…è½½è®¡æ•°å™¨è®¡æ•°å€¼ Internal Clock Division:å†…éƒ¨æ—¶é’Ÿé¢„åˆ†é¢‘ Repetiton Counter:é‡å¤è®¡æ•°å™¨ (RCRÂ -8 bits)ï¼Œå±äºé«˜çº§æ§åˆ¶å¯„å­˜å™¨ä¸“ç”¨å¯„å­˜å™¨ä½ï¼Œåˆ©ç”¨å®ƒå¯ä»¥éå¸¸å®¹æ˜“æ§åˆ¶è¾“å‡º PWM çš„ä¸ªæ•°ï¼Œä¸å†…éƒ¨æ—¶é’Ÿæ¨¡å¼æ— å…³ auto-reload preload:æ˜¯å¦å¼€å¯å½±å­å¯„å­˜å™¨æ¨¡å¼ è¿˜éœ€è¦å¼€å¯å®šæ—¶å™¨æ›´æ–°ä¸­æ–­\nä»£ç å®ç° ç”¨çš„PA2ä½œGPIOè¾“å‡º\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim) {//ä¸­æ–­å›è°ƒå‡½æ•° if( htim == \u0026amp;htim1 ) { HAL_GPIO_TogglePin(GPIOA,GPIO_PIN_2); } } int main(void) { /* USER CODE BEGIN 1 */ /* USER CODE END 1 */ /* MCU Configuration--------------------------------------------------------*/ /* Reset of all peripherals, Initializes the Flash interface and the Systick. */ HAL_Init(); /* USER CODE BEGIN Init */ /* USER CODE END Init */ /* Configure the system clock */ SystemClock_Config(); /* USER CODE BEGIN SysInit */ /* USER CODE END SysInit */ /* Initialize all configured peripherals */ MX_GPIO_Init(); MX_TIM1_Init(); /* USER CODE BEGIN 2 */ HAL_TIM_Base_Start_IT(\u0026amp;htim1); /* USER CODE END 2 */ /* Infinite loop */ /* USER CODE BEGIN WHILE */ while (1) { /* USER CODE END WHILE */ /* USER CODE BEGIN 3 */ } /* USER CODE END 3 */ } å¤–éƒ¨æ—¶é’Ÿæ¨¡å¼ ã€ã€STM32ã€‘åŠ¨ç”»è®²è§£å®šæ—¶å™¨å¤–éƒ¨æ—¶é’Ÿ \u0026amp; å®æˆ˜ä¼ é€å¸¦æµ‹é€Ÿè£…ç½®ã€‘https://www.bilibili.com/video/BV1N94y1u7Uz?vd_source=5a0790755035f26a67935abfbfcdfd5b\n__HAL_GET_COUNTER(\u0026amp;htim)è·å–è®¡æ•°å€¼\nå¤–éƒ¨æ—¶é’Ÿæ¨¡å¼2 åœ¨Clock Sourceå¤„é€‰æ‹©\næ³¨æ„å¤–éƒ¨æ—¶é’Ÿçš„æ»¤æ³¢å™¨Clock Filterï¼Œè¾“å…¥æ»¤æ³¢ è¾“å…¥æ»¤æ³¢ï¼Œææ€§é€‰æ‹©ï¼Œé¢„åˆ†é¢‘å™¨\né‡‡æ ·é¢‘ç‡ç­‰äºå†…éƒ¨æ—¶é’Ÿçš„é¢‘ç‡\nä¸€èˆ¬æ¨èé€‰æ‹©1110ï¼ˆ15ï¼‰\nå¤–éƒ¨æ—¶é’Ÿæ¨¡å¼1 é€šè¿‡å®šæ—¶å™¨çš„Slave Mode è¿›è¡Œé€‰æ‹© å¯ç”¨ä»æ¨¡å¼ï¼Œé€‰æ‹©å¤–éƒ¨æ—¶é’Ÿæ¨¡å¼1 é€‰æ‹©Trigger Sourceæ—¶ï¼Œå°±æ˜¯é€‰æ‹©ä»€ä¹ˆæ–¹å¼æ¥å¤–éƒ¨è®¡æ•° å°±æ˜¯é€‰æ‹©è§¦å‘å™¨çš„æ¥æº TI_EDæ˜¯åŒè¾¹æ²¿è§¦å‘ï¼Œä¸”åªèƒ½æ˜¯åŒè¾¹æ²¿è§¦å‘\nä½¿ç”¨å¤–éƒ¨è®¡æ•°ETR å¯ä»¥åœ¨å¤–éƒ¨æ—¶é’Ÿæ¨¡å¼1ä¸‹ï¼ŒTrigger Sourceé€‰æ‹©ETR1 èŠ¯ç‰‡ä¸Šä¼šæœ‰å¼•è„šè¢«è®¾ç½®ä¸ºETR1\nç›´æ¥é€‰æ‹©å¤–éƒ¨æ—¶é’Ÿæ¨¡å¼2ï¼Œå¼•è„šä¸Šä¼šè‡ªåŠ¨æœ‰ä¸€ä¸ªETR2 å…³äºå®šæ—¶å™¨çš„äº‹ä»¶æ›´æ–°ä¸­æ–­ å…³äºå®šæ—¶å™¨ä¸­æ–­ è®¡æ•°å€¼åˆ°è¾¾è‡ªåŠ¨é‡è£…è½½å€¼æ—¶ï¼Œè§¦å‘æ›´æ–°ä¸­æ–­ åœ¨Cubeä¸­å¼€å¯global interrupt å…³äºMX_TIM2_Init()å¯åŠ¨æ—¶ä¼šå°†ä¸­æ–­æ ‡å¿—ä½ç½®1 åœ¨MX_TIM2_Init()æ—¶ï¼Œä¼šå°†å®šæ—¶å™¨æ›´æ–°ä¸­æ–­æ ‡å¿—ä½ç½®1ï¼Œåœ¨è°ƒç”¨HAL_TIM_Base_Start_ITåï¼ŒNVICä¼šæ£€æµ‹åˆ°æ›´æ–°ä¸­æ–­æ ‡å¿—ä½è¢«ç½®1ï¼Œä¼šç«‹é©¬è§¦å‘ä¸­æ–­\nåœ¨HAL_TIM_Base_Start_ITå‰é€‰æ‹©ä¸‹é¢ä¸¤ä¸ªå‡½æ•°å…¶ä¸­ä¸€ä¸ªå†™ä¸Šå³å¯ äº‹ä»¶æ›´æ–°ä¸­æ–­çš„é€»è¾‘ å…ˆæ˜¯NVICä¸­æ–­å‘é‡è¡¨æŸ¥æ‰¾åˆ°TIM2_IRQhandlerï¼Œåœ¨è¯¥å‡½æ•°ä¸­ï¼Œè°ƒç”¨äº†HAL_TIM_IRQhandlerå‡½æ•° å…¶ä¸­çš„äº‹ä»¶æ›´æ–°å¤„ç†çš„ä»£ç (HALåº“ä¸­HAL_TIM_IRQHandlerä¸­çš„å¤„ç†äº‹ä»¶æ›´æ–°ä¸­æ–­çš„ä»£ç ) åˆ¤æ–­æ ‡å¿—ä½ï¼Œåˆ¤æ–­æ˜¯å¦å¼€å¯äº‹ä»¶æ›´æ–°ä¸­æ–­ï¼Œæ¸…é›¶æ ‡å¿—ä½ï¼Œè°ƒç”¨HAL_TIM_PeriodElapsedCallbackå‡½æ•°\nå®šæ—¶å™¨çš„ä»æ¨¡å¼ ã€ã€STM32ã€‘ä¸€çœ‹å°±æ‡‚çš„å®šæ—¶å™¨ä»æ¨¡å¼è®²è§£ã€‘https://www.bilibili.com/video/BV1mU421o7vt?vd_source=5a0790755035f26a67935abfbfcdfd5b\nå®šæ—¶å™¨ä»æ¨¡å¼\nReset Mode å¤ä½æ¨¡å¼ Gate Mode é—¨æ¨¡å¼ Trigger Mode è§¦å‘æ¨¡å¼ å¤ä½æ¨¡å¼ è®¾å®šä¸ºå¤ä½æ¨¡å¼æ—¶\né€‰å–è®¡æ•°ä¿¡å·ï¼Œè®¡æ•°ä¿¡å·å¯ä»¥æ—¶å†…éƒ¨æ—¶é’Ÿï¼Œä¹Ÿå¯ä»¥æ˜¯å¤–éƒ¨æ—¶é’Ÿæ¨¡å¼2ï¼ˆä¸æ˜¯ä»æ¨¡å¼æ§åˆ¶å™¨ä¸‹å¤–éƒ¨æ—¶é’Ÿæ¨¡å¼1ï¼‰ è§¦å‘å™¨çš„ä¿¡å·ï¼Œæ¯å‡ºç°ä¸€æ¬¡ï¼Œæ‰§è¡Œä¸€æ¬¡å¤ä½æ“ä½œï¼ˆå‘ä¸Šè®¡æ•°æ¨¡å¼æ¢å¤ä¸º0ï¼Œå‘ä¸‹è®¡æ•°æ¨¡å¼æ¢å¤ä¸ºè‡ªåŠ¨é‡è£…è½½å€¼ï¼‰ ä¾‹å­ï¼šé€‰å–è®¡æ•°ä¿¡å·ä¸ºå†…éƒ¨æ—¶é’Ÿï¼Œè®¡æ•°å™¨ä¸æ–­è®¡æ•°ï¼Œå½“è§¦å‘å™¨ä¿¡å·æ¥ä¸´æ—¶ï¼ˆTI1çš„TIFP1æ£€æµ‹åˆ°ä¿¡å·ä¸Šå‡æ²¿ï¼‰ï¼Œåˆ™è§¦å‘ä¸€æ¬¡æ›´æ–°äº‹ä»¶ï¼Œè®¡æ•°å™¨å€¼å¤ä½ æ³¨æ„ï¼šå¦‚æœå¼€å¯å®šæ—¶å™¨çš„äº‹ä»¶æ›´æ–°ä¸­æ–­ï¼Œè§¦å‘å™¨ä¿¡å·ä¹Ÿä¼šè§¦å‘äº‹ä»¶æ›´æ–°ä¸­æ–­\nå¤ä½æ¨¡å¼ä¸‹çš„ä»æ¨¡å¼æ§åˆ¶å™¨ï¼Œåœ¨æ¥æ”¶åˆ°è§¦å‘ä¿¡å·åï¼Œå°±ä¼šè®©è®¡æ•°å™¨é‡æ–°å¼€å§‹è®¡æ•°ï¼Œå¹¶ä¸”ä¼šè§¦å‘å®šæ—¶å™¨æ›´æ–°ä¸­æ–­\nå¦‚ä½•åˆ¤æ–­äº‹ä»¶æ›´æ–°ä¸­æ–­çš„äº§ç”ŸåŸå›  åœ¨å¤ä½æ¨¡å¼ä¸­ï¼Œéœ€è¦åŒºåˆ†äº‹ä»¶æ›´æ–°ä¸­æ–­æ˜¯è§¦å‘ä¿¡å·çš„å¤ä½å¯¼è‡´è¿˜æ˜¯è‡ªåŠ¨æŒ¡é‡è£…è½½æ—¶å¯¼è‡´\nä»æ¨¡å¼æ”¶åˆ°è§¦å‘ä¿¡å·åï¼Œä¼šè®¾ç½®è§¦å‘å™¨ä¸­æ–­æ ‡å¿—ä½ï¼Œå¯ä»¥å€Ÿæ­¤æ¥åŒºåˆ†ä¸­æ–­åŸå› \nä½¿ç”¨è¯¥å‡½æ•°æ¥è·å–è§¦å‘å™¨ä¸­æ–­æ ‡å¿—ä½ 1 __HAL_TIM_GET_FALG(htim,TIM_FLAG_UPDATE)//å¯ä»¥è·å–å®šæ—¶å™¨å¯¹åº”æ ‡å¿—ä½çš„å€¼ TIM_FLAG_TRIGGERæ˜¯è§¦å‘å™¨ä¸­æ–­æ ‡å¿—ä½\n1 __HAL_TIM_GET_FLAG(htim,TIM_FLAG_TRIGGER) ä½¿ç”¨ä¸Šè¿°è¯­å¥å¯ä»¥è·å–å…¶æ ‡å¿—ä½ ä½¿ç”¨æ—¶éœ€è¦æ³¨æ„ï¼ŒHALåº“ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬åˆ¤æ–­ï¼Œå¹¶ä¸ä¼šå¯¹è¯¥æ ‡å¿—ä½æ¸…é›¶ï¼Œæ‰€ä»¥åœ¨è·å–æ ‡å¿—ä½çš„å€¼åï¼Œéœ€è¦å¯¹å…¶è¿›è¡Œæ¸…é›¶\n1 2 3 if(__HAL_TIM_GET_FLAG(htim,TIM_FLAG_TRIGGER)==SET) { __HAL_TIM_CLEAR_FLAG(htim,TIM_FLAG_TRIGGER); } HAL_TIM_PeriodElapsedCallbackå›è°ƒå‡½æ•°\n1 2 3 4 5 6 7 8 9 10 11 void HAL_TIM_PeriodElapsedCallback( TIM_HandleTypeDef *htim ) { if( htim == \u0026amp;htim2 ) { if( __HAL_TIM_GET_FLAG(htim,TIM_FLAG_TRIGGER) == SET ) {//è·å–è§¦å‘æ ‡å¿—ä½ï¼Œç”¨æ¥åŒºåˆ†å¤ä½å¼•èµ·çš„ä¸­æ–­è¿˜æ˜¯è‡ªåŠ¨é‡è£…è½½å¼•èµ·çš„ä¸­æ–­ __HAL_TIM_CLEAR_FLAG(htim,TIM_FLAG_TRIGGER); HAL_UART_Transmit( \u0026amp;huart2 , (uint8_t*)triggerMsg , strlen(triggerMsg) , 100 ); } else { HAL_UART_Transmit( \u0026amp;huart2 , (uint8_t*)updateMsg , strlen(updateMsg) , 100 ); } } } å…³äºMX_TIM2_Init()å¯åŠ¨æ—¶ä¼šå°†ä¸­æ–­æ ‡å¿—ä½ç½®1 åœ¨MX_TIM2_Init()æ—¶ï¼Œä¼šå°†å®šæ—¶å™¨æ›´æ–°ä¸­æ–­æ ‡å¿—ä½ç½®1ï¼Œåœ¨è°ƒç”¨HAL_TIM_Base_Start_ITåï¼ŒNVICä¼šæ£€æµ‹åˆ°æ›´æ–°ä¸­æ–­æ ‡å¿—ä½è¢«ç½®1ï¼Œä¼šç«‹é©¬è§¦å‘ä¸­æ–­\nåœ¨HAL_TIM_Base_Start_ITå‰é€‰æ‹©ä¸‹é¢ä¸¤ä¸ªå‡½æ•°å…¶ä¸­ä¸€ä¸ªå†™ä¸Šå³å¯ äº‹ä»¶æ›´æ–°ä¸­æ–­çš„é€»è¾‘ å…ˆæ˜¯NVICä¸­æ–­å‘é‡è¡¨æŸ¥æ‰¾åˆ°TIM2_IRQhandlerï¼Œåœ¨è¯¥å‡½æ•°ä¸­ï¼Œè°ƒç”¨äº†HAL_TIM2_IRQhandlerå‡½æ•° å…¶ä¸­çš„äº‹ä»¶æ›´æ–°å¤„ç†å¤„çš„ä»£ç (HALåº“ä¸­HAL_TIM_IRQHandlerä¸­çš„å¤„ç†äº‹ä»¶æ›´æ–°ä¸­æ–­çš„ä»£ç ) åˆ¤æ–­æ ‡å¿—ä½ï¼Œåˆ¤æ–­æ˜¯å¦å¼€å¯äº‹ä»¶æ›´æ–°ä¸­æ–­ï¼Œæ¸…é›¶æ ‡å¿—ä½ï¼Œè°ƒç”¨HAL_TIM_PeriodElapsedCallbackå‡½æ•°\né—¨æ¨¡å¼ å¦‚æœTI1çš„TI1FP1ä¸ºä¸Šå‡æ²¿æ£€æµ‹ï¼Œåˆ™æ˜¯å½“è§¦å‘ä¿¡å·æ˜¯é«˜ç”µå¹³æ—¶ï¼Œæ—¶é’Ÿä¿¡å·å¯ä»¥æ­£å¸¸è¿›å…¥å®šæ—¶å™¨ï¼Œå®šæ—¶å™¨èƒ½æ­£å¸¸è®¡æ•° å½“è§¦å‘ä¿¡å·æ—¶ä½ç”µå¹³æ—¶ï¼Œé—¨å…³é—­ï¼Œæ—¶é’Ÿä¿¡å·ä¸èƒ½æ­£å¸¸è¿›å…¥å®šæ—¶å™¨ï¼Œå®šæ—¶å™¨åœæ­¢è®¡æ•° è‹¥å°†è§¦å‘å™¨çš„ææ€§æ”¹ä¸ºæ£€æµ‹ä¸‹é™æ²¿çš„è¯ï¼Œé—¨çš„æ§åˆ¶ä½œç”¨åˆ™ç›¸å è§¦å‘å™¨çš„ææ€§é€‰æ‹© éœ€è¦æ³¨æ„ï¼Œåœ¨é—¨æ¨¡å¼æƒ…å†µä¸‹ï¼Œä¸Šå‡ä¸‹é™æ²¿çš„æ—¶åˆ»ï¼Œä¹Ÿä¼šå°†è§¦å‘å™¨ä¸­æ–­æ ‡å¿—ä½ç½®1ï¼Œä½†æ˜¯ä¸ä¼šè§¦å‘äº‹ä»¶æ›´æ–°ä¸­æ–­ï¼ˆå› ä¸ºæ²¡æœ‰å¯¹è®¡æ•°å€¼è¿›è¡Œå¤ä½ï¼Œå°±ä¸ä¼šè§¦å‘äº‹ä»¶æ›´æ–°ä¸­æ–­ï¼‰ è§¦å‘æ¨¡å¼ åœ¨æ£€æµ‹åˆ°è®¾å®šçš„è¾¹æ²¿åï¼Œè®©å®šæ—¶å™¨å¼€å§‹è®¡æ•° å¼€å§‹åä¸èƒ½è®¾å®šåœæ­¢ è§¦å‘æ¨¡å¼ä»…èƒ½å¯åŠ¨å®šæ—¶å™¨ï¼Œå¹¶ä¸èƒ½åœæ­¢è®¡æ•°å™¨è®¡æ•°\nä¸€èˆ¬é…åˆè®¡æ—¶å™¨çš„å•è„‰å†²æ¨¡å¼ä½¿ç”¨ å•è„‰å†²æ¨¡å¼ï¼Œæ˜¯æŒ‡è®¡æ•°å™¨è®¡æ•°åˆ°é‡è£…è½½è®¡æ•°å€¼åï¼Œå°±åœæ­¢è®¡æ•°ï¼ˆä¸å†å¾ªç¯è®¡æ•°ï¼‰ ä¸€èˆ¬éœ€è¦å‹¾é€‰å•è„‰å†²æ¨¡å¼\nä¸‰ç§æ¨¡å¼çš„æ€»ç»“ Trigger Source è§¦å‘æºçš„æ»¤æ³¢å™¨è®¾ç½® åœ¨æœ‰è§¦å‘æºçš„æ—¶å€™ï¼Œå¯¹è§¦å‘æºçš„ä¿¡å·çš„æ»¤æ³¢è®¾ç½® å®šæ—¶å™¨çš„è¾“å…¥æ•è· è½¯ä»¶å±‚é¢ä¸Šçš„æ¨¡æ‹Ÿ åœ¨è½¯ä»¶å±‚é¢æ£€æµ‹Echoç«¯çš„ç”µå¹³é«˜ä½ï¼Œè¿›è¡Œè®¡æ—¶ï¼Œåˆ°é‚£æ—¶å†æé«˜ç²¾åº¦è¦æ±‚çš„æƒ…å†µåˆ™ åŠ›ä¸è¶³\nè¾“å…¥æ•è·çš„æ¦‚æ‹¬ ç¡¬ä»¶åœ¨æ£€æµ‹åˆ°ä¸Šå‡æˆ–è€…ä¸‹é™æ²¿æ—¶ï¼Œå°±è®°å½•è®¡æ•°å™¨å€¼åˆ°æ•è·å¯„å­˜å™¨\nè¾“å…¥æ•è·çš„è¿è¡Œæœºåˆ¶ åœ¨TI1æ£€æµ‹åˆ°ä¸Šå‡æ²¿æ—¶ï¼Œæ•è·å¯„å­˜å™¨ç«‹å³å¤åˆ¶è®¡æ•°å™¨çš„å€¼ è¿˜å¯ä»¥å¼€å¯è¾“å…¥æ•è·ä¸­æ–­ï¼Œè¾“å…¥æ•è·åï¼Œå¯åŠ¨ä¸­æ–­ï¼Œå¯ä»¥å¿«é€Ÿå¤„ç†æ•è·å¯„å­˜å™¨ä¸Šçš„å€¼\nä¸€ä¸ªé€šé“åªèƒ½è¿›è¡Œä¸€ç§è¾¹æ²¿æ£€æµ‹ æ•è·çš„æ¨¡å¼ æ³¨æ„ï¼šTI3å’ŒTI4æ²¡æœ‰æ¥å…¥ä»æ¨¡å¼æ§åˆ¶å™¨ä¸­ TI1å’ŒTI2æ˜¯ä¸€å¯¹ï¼Œå¯ä»¥ç›¸äº’å€Ÿç”¨ TI3å’ŒTI4æ˜¯ä¸€å¯¹ï¼Œå¯ä»¥ç›¸äº’å€Ÿç”¨ Cubeä¸Šçš„é…ç½® æ³¨æ„è®¾ç½®è¾¹æ²¿æ£€æµ‹ æ‰“å¼€æ•è·ä¸­æ–­ å¯åŠ¨ï¼Œè¯¥ä¾‹å­ä¸­æ˜¯éœ€è¦åœ¨CHANNEL4æ•è·åˆ°åè¿›è¡Œå¤„ç†ï¼Œæ‰€ä»¥CHANNEL44å¼€å¯äº†ä¸­æ–­ è¾“å…¥æ•è·çš„å¼€å¯ å¯èƒ½é‡åˆ°çš„é—®é¢˜ ![[Pasted image 20250105120132.png]] ç”¨SET_COUNTERæ¥æ¸…é›¶ä¸€ä¸‹\nä¸­æ–­å›è°ƒå‡½æ•°\n1 HAL_TIM_IC_CaptureCallback(htim); å›è°ƒå‡½æ•°çš„ä»£ç ç¼–å†™ åˆ¤æ–­æ˜¯å¦æ˜¯TIM1ï¼Œåˆ¤æ–­æ˜¯å¦æ˜¯TIM1çš„4é€šé“ï¼ˆHAL_TIM_ACTIVE_CHANNEL_4ï¼‰ å†è¯»å–æŒ‡å®šå¯„å­˜å™¨çš„å€¼\nå®šæ—¶å™¨çš„è¾“å‡ºæ¯”è¾ƒæ¨¡å¼ è¾ƒä¸ºé¸¡è‚‹ï¼Œå¯¹è¿™äº›æ¨¡å¼èƒ½ç†è§£å…¶è¡Œä¸ºå³å¯\nå®šæ—¶å™¨çš„PWM ã€STM32ã€‘HALåº“ STM32CubeMXæ•™ç¨‹ä¸ƒ\u0026mdash;PWMè¾“å‡º(å‘¼å¸ç¯)_stm32 hal pwm-CSDNåšå®¢\nSTM32CubeIdeä¸­äº’è¡¥PWMé…ç½®é¡¹çš„è¯¦ç»†è§£è¯»_ch idle state-CSDNåšå®¢\nPWM è„‰å†²å®½åº¦è°ƒåˆ¶ï¼Œç”¨æ•°å­—ä¿¡å·å»æ¨¡æ‹Ÿ æ¨¡æ‹Ÿä¿¡å· PWMæ¨¡å¼ PWMæ¨¡å¼1 æ˜¯ è®¡æ•°å™¨å€¼ å°äº æ¯”è¾ƒå™¨å€¼ æ—¶è¾“å‡ºæœ‰æ•ˆç”µå¹³ PWMæ¨¡å¼2 æ˜¯ è®¡æ•°å™¨å€¼ å¤§äº æ¯”è¾ƒå™¨å€¼ æ—¶è¾“å‡ºæœ‰æ•ˆç”µå¹³ Cubeé…ç½® ä¸ºå®ç°ä¸€ä¸ªå‘¼å¸ç¯ï¼Œè¿›è¡Œä»¥ä¸‹é…ç½® PWMçš„é¢‘ç‡ä¸º1000Hzï¼Œæœ€å¤§è®¡æ•°å€¼ä¸º1000-1\nåŸºç¡€æ—¶é’Ÿé…ç½®\né¢„åˆ†é¢‘å™¨å€¼ï¼Œè®¡æ•°æ¨¡å¼é€‰æ‹©ï¼ˆå‘ä¸Šè®¡æ•°æ¨¡å¼ï¼Œå‘ä¸‹è®¡æ•°æ¨¡å¼ï¼Œä¸­å¤®å¯¹é½æ¨¡å¼ï¼‰ï¼Œè‡ªåŠ¨é‡è£…è½½å€¼ï¼Œå†…éƒ¨æ—¶é’Ÿåˆ†é¢‘ï¼Œé‡å¤è®¡æ•°å™¨å€¼ï¼Œæ˜¯å¦å¼€å¯å½±å­å¯„å­˜å™¨\nPWMé…ç½®\nModeï¼šé€‰æ‹©PWMæ¨¡å¼ Pulseï¼šè®¾ç½®æ¯”è¾ƒå¯„å­˜å™¨çš„å€¼ Output compare preloadï¼šæ˜¯å¦å¼€å¯å½±å­å¯„å­˜å™¨ Fast Modeï¼šæ˜¯å¦éœ€è¦è¾“å‡ºéå¸¸é«˜é¢‘çš„PWMä¿¡å· CH Polarityï¼šè®¾ç½®æœ‰æ•ˆç”µå¹³ææ€§ CH Idle Stateï¼šç©ºé—²æ—¶ï¼ŒPWMé€šé“çš„è¾“å‡º HALåº“PWMå¸¸ç”¨å‡½æ•° 1 2 3 HAL_TIM_PWM_Start(\u0026amp;htim1,TIM_CHANNEL_1);//å¼€å¯PWM HAL_TIM_PWM_Stop(\u0026amp;htim1,TIM_CHANNEL_1);//å…³é—­PWM __HAL_TIM_SET_COMPARE(\u0026amp;htim1,TIM_CHANNEL_1,num);//è®¾ç½®æ¯”è¾ƒå¯„å­˜å™¨çš„å€¼ ä½¿ç”¨PWMæ§åˆ¶æµæ°´ç¯ PWMçš„é¢‘ç‡ä¸º1000Hzï¼Œæœ€å¤§è®¡æ•°å€¼ä¸º1000-1\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 int main(void) { /* USER CODE BEGIN 1 */ /* USER CODE END 1 */ /* MCU Configuration--------------------------------------------------------*/ /* Reset of all peripherals, Initializes the Flash interface and the Systick. */ HAL_Init(); /* USER CODE BEGIN Init */ /* USER CODE END Init */ /* Configure the system clock */ SystemClock_Config(); /* USER CODE BEGIN SysInit */ /* USER CODE END SysInit */ /* Initialize all configured peripherals */ MX_GPIO_Init(); MX_TIM1_Init(); /* USER CODE BEGIN 2 */ HAL_TIM_PWM_Start(\u0026amp;htim1,TIM_CHANNEL_1); /* USER CODE END 2 */ /* Infinite loop */ /* USER CODE BEGIN WHILE */ while (1) { for( int i = 0 ; i \u0026lt; 1000 ; ++ i ) { __HAL_TIM_SET_COMPARE(\u0026amp;htim1,TIM_CHANNEL_1,i); HAL_Delay(0); } for( int i = 1000-1 ; i \u0026gt;= 0 ; -- i ) { __HAL_TIM_SET_COMPARE(\u0026amp;htim1,TIM_CHANNEL_1,i); HAL_Delay(0); } /* USER CODE END WHILE */ /* USER CODE BEGIN 3 */ } /* USER CODE END 3 */ } ç¼–ç å™¨çš„ä½¿ç”¨ å¾…å®Œæˆ\n","date":"2025-06-26T17:26:06+08:00","permalink":"https://NomadJoeviolet.github.io/p/stm32tim%E5%AE%9A%E6%97%B6%E5%99%A8/","title":"STM32â€”â€”â€”â€”TIMå®šæ—¶å™¨"},{"content":"ä¸€æ–‡è½»æ¾ç†è§£å†…å­˜å¯¹é½ - çŸ¥ä¹\nç»“æ„ä½“ï¼ˆstructï¼‰å¯¹é½ è§„åˆ™ 1ï¼šæˆå‘˜åœ°å€ =Â min(è‡ªèº«å¯¹é½å€¼, æœ‰æ•ˆå¯¹é½å€¼)Â çš„å€æ•°\nè§„åˆ™ 2ï¼šç»“æ„ä½“æ€»å¤§å° = æœ€å¤§æˆå‘˜å¯¹é½å€¼çš„æ•´æ•°å€\nè§„åˆ™ 3ï¼šæˆå‘˜æ’åˆ—é¡ºåºå½±å“æœ€ç»ˆå¤§å°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 #pragma pack(1)//è®¾ç½®é»˜è®¤å¯¹é½æ•°ä¸º1 struct S1 { char c1; int i; char c2; }; #pragma pack()//å–æ¶ˆè®¾ç½®çš„é»˜è®¤å¯¹é½æ•°ï¼Œè¿˜åŸä¸ºé»˜è®¤ int main() { //è¾“å‡ºçš„ç»“æœæ˜¯ä»€ä¹ˆï¼Ÿ printf(\u0026#34;%d\\n\u0026#34;, sizeof(struct S1)); return 0; } 1 2 3 4 5 6 7 #pragma pack(push, 1)//è®¾ç½®é»˜è®¤å¯¹é½æ•°ä¸º1 struct MyStruct { char a; int b; double c; }; #pragma pack(pop)//å–æ¶ˆè®¾ç½®çš„é»˜è®¤å¯¹é½æ•°ï¼Œè¿˜åŸä¸ºé»˜è®¤ 1 2 3 4 5 struct MyStruct { char a; int b; double c; } __attribute__((packed)); ","date":"2025-06-26T15:35:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/cc-%E5%86%85%E5%AD%98%E5%AF%B9%E9%BD%90%E6%9E%81%E7%AE%80%E7%89%88/","title":"C\u0026C++ å†…å­˜å¯¹é½ï¼ˆæç®€ç‰ˆï¼‰"},{"content":"MDKä»‹ç»åŠå…¶ä½¿ç”¨ ä¸€æ–‡æ•™ä½ ä½¿ç”¨MDKå¼€å‘å·¥å…·-CSDNåšå®¢\nMDKã€KEILã€uVision ä¹‹é—´çš„åŒºåˆ«\nMDKï¼ˆ Microcontroller Development Kit ï¼‰ï¼Œä¹Ÿç§° MDK-ARM ã€KEIL MDKã€KEIL For ARMï¼Œéƒ½æ˜¯åŒä¸€ä¸ªä¸œè¥¿ã€‚ARM å…¬å¸ç°åœ¨ç»Ÿä¸€ä½¿ç”¨ MDK-ARM çš„ç§°å‘¼ï¼ŒMDK çš„è®¾å¤‡æ•°æ®åº“ä¸­æœ‰å¾ˆå¤šå‚å•†çš„èŠ¯ç‰‡ï¼Œæ˜¯ä¸“ä¸ºå¾®æ§åˆ¶å™¨å¼€å‘çš„ä¸€æ¬¾å·¥å…·ï¼Œä¸ºæ»¡è¶³åŸºäº MCU è¿›è¡ŒåµŒå…¥å¼è½¯ä»¶å¼€å‘çš„å·¥ç¨‹å¸ˆéœ€æ±‚è€Œè®¾è®¡ï¼Œæ”¯æŒ ARM7ï¼ŒARM9ï¼ŒCortex-M4/M3/M1ï¼ŒCortex-R0/R3/R4 ç­‰ ARM å¾®æ§åˆ¶å™¨å†…æ ¸ã€‚KEIL æ˜¯å…¬å¸çš„åç§°ï¼Œæœ‰æ—¶å€™ä¹ŸæŒ‡ KEIL å…¬å¸çš„æ‰€æœ‰è½¯ä»¶å¼€å‘å·¥å…·ã€‚Keil å…¬å¸åœ¨2005å¹´è¢« ARM å…¬å¸æ”¶è´­ã€‚\nuVision æ˜¯ KEIL å…¬å¸å¼€å‘çš„ä¸€ä¸ªé›†æˆå¼€å‘ç¯å¢ƒï¼ˆIDEï¼‰ã€‚å®ƒåŒ…æ‹¬å·¥ç¨‹ç®¡ç†ï¼Œæºä»£ç ç¼–è¾‘ï¼Œç¼–è¯‘è®¾ç½®ï¼Œä¸‹è½½è°ƒè¯•å’Œæ¨¡æ‹Ÿä»¿çœŸç­‰åŠŸèƒ½ï¼ŒuVision æœ‰ uVision2ã€uVision3ã€uVision4 å’Œ uVision5 å››ä¸ªç‰ˆæœ¬ï¼Œç›®å‰æœ€æ–°çš„ç‰ˆæœ¬æ˜¯ uVision5ã€‚å®ƒæä¾›ä¸€ä¸ªç¯å¢ƒï¼Œè®©å¼€å‘è€…æ˜“äºæ“ä½œã€‚uVision é€šç”¨äº KEIL çš„å¼€å‘å·¥å…·ä¸­ï¼Œä¾‹å¦‚ MDKï¼ŒPK51ï¼ŒPK166ï¼ŒDK251ç­‰ã€‚\narmclang å°±æ˜¯ä¿—ç§°çš„AC6 armclangæ˜¯ARMå…¬å¸æä¾›çš„ä¸€æ¬¾C/C++ç¼–è¯‘å™¨ï¼Œä¸“é—¨ç”¨äºä¸ºARMæ¶æ„çš„å¤„ç†å™¨ç”Ÿæˆé«˜æ€§èƒ½ä»£ç ã€‚è¯¥ç¼–è¯‘å™¨é€šå¸¸ä¸ARMçš„å…¶ä»–å·¥å…·é“¾ä¸€èµ·ä½¿ç”¨ï¼Œé€‚åˆåµŒå…¥å¼ç³»ç»Ÿå¼€å‘ã€‚\nè¯·æ³¨æ„ï¼Œç¡®ä¿åœ¨é¡¹ç›®ä¸­ä½¿ç”¨åˆé€‚çš„å·¥å…·å’Œç‰ˆæœ¬ï¼Œå¹¶æ ¹æ®éœ€æ±‚æŸ¥é˜…æœ€æ–°çš„æ–‡æ¡£ã€‚\nOpenOCD è·Ÿæˆ‘ä¸€èµ·å­¦OpenOCD(ä¸€) - çŸ¥ä¹ (zhihu.com)\nOpenOCDæ˜¯ä¸€ä¸ªå¼€æºçš„è°ƒè¯•/ç¼–ç¨‹å·¥å…·ï¼Œä¸»è¦ç”¨äºåµŒå…¥å¼ç³»ç»Ÿï¼Œå®ƒæ”¯æŒå¤šç§ç¡¬ä»¶è®¾å¤‡å’Œè°ƒè¯•åè®®ï¼Œå¦‚JTAGå’ŒSWDã€‚å®ƒé€šå¸¸ä¸GNUå·¥å…·é“¾ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥ä¸ºå¼€å‘äººå‘˜æä¾›ç¡¬ä»¶è°ƒè¯•å’Œçƒ§å½•å›ºä»¶çš„åŠŸèƒ½ã€‚\nOzone Ozoneä½¿ç”¨ä»‹ç»-åŸºç¡€åŠŸèƒ½ - å¼€å‘ç¯å¢ƒ - ç¡¬æ±‰åµŒå…¥å¼è®ºå› - Powered by Discuz! (armbbs.cn)\nMinGW mingw æ˜¯ä¸€ä¸ªä¸º Microsoft Windows å¹³å°ç¼–è¯‘å’Œè¿è¡Œ Unix ç¨‹åºçš„å·¥å…·å¥—è£…ï¼Œå®ƒæä¾›äº†ç±»ä¼¼äº Unix ç¯å¢ƒä¸‹çš„ç¼–è¯‘å™¨ã€é“¾æ¥å™¨ç­‰å·¥å…·ï¼Œä»¥ä¾¿åœ¨ Windows å¹³å°ä¸Šå¼€å‘ä½¿ç”¨ GCCï¼ˆGNU ç¼–è¯‘å™¨é›†åˆï¼‰å’Œå…¶ä»–å¼€æº Unix å·¥å…·çš„è½¯ä»¶ã€‚\nLLVM LLVMåŸºæœ¬æ¦‚å¿µå…¥é—¨ - çŸ¥ä¹\næ¥è‡ªäºç™¾åº¦ç™¾ç§‘çš„è§£é‡Š\nLLVM å‘½åæœ€æ—©æºè‡ªäºåº•å±‚è™šæ‹Ÿæœºï¼ˆLow Level Virtual Machineï¼‰çš„ç¼©å†™ï¼Œç”±äºå‘½åå¸¦æ¥çš„æ··ä¹±ï¼ŒLLVMå°±æ˜¯è¯¥é¡¹ç›®çš„å…¨ç§°ã€‚LLVM æ ¸å¿ƒåº“æä¾›äº†ä¸ç¼–è¯‘å™¨ç›¸å…³çš„æ”¯æŒï¼Œå¯ä»¥ä½œä¸ºå¤šç§è¯­è¨€ç¼–è¯‘å™¨çš„åå°æ¥ä½¿ç”¨ã€‚èƒ½å¤Ÿè¿›è¡Œç¨‹åºè¯­è¨€çš„ç¼–è¯‘å™¨ä¼˜åŒ–ã€é“¾æ¥ä¼˜åŒ–ã€åœ¨çº¿ç¼–è¯‘ä¼˜åŒ–ã€ä»£ç ç”Ÿæˆã€‚LLVMçš„é¡¹ç›®æ˜¯ä¸€ä¸ªæ¨¡å—åŒ–å’Œå¯é‡å¤ä½¿ç”¨çš„ç¼–è¯‘å™¨å’Œå·¥å…·æŠ€æœ¯çš„é›†åˆã€‚ ç°åœ¨çš„LLVMæ˜¯ä¸€ä¸ªç¼–è¯‘å™¨æ¡†æ¶ã€‚LLVMä½œä¸ºç¼–è¯‘å™¨æ¡†æ¶ï¼Œæ˜¯éœ€è¦å„ç§åŠŸèƒ½æ¨¡å—æ”¯æ’‘èµ·æ¥çš„ï¼Œä½ å¯ä»¥å°†clangå’Œlldéƒ½çœ‹åšæ˜¯LLVMçš„ç»„æˆéƒ¨åˆ†ï¼Œæ¡†æ¶çš„æ„æ€æ˜¯ï¼Œä½ å¯ä»¥åŸºäºLLVMæä¾›çš„åŠŸèƒ½å¼€å‘è‡ªå·±çš„æ¨¡å—ï¼Œå¹¶é›†æˆåœ¨LLVMç³»ç»Ÿä¸Šï¼Œå¢åŠ å®ƒçš„åŠŸèƒ½ï¼Œæˆ–è€…å°±å•çº¯è‡ªå·±å¼€å‘è½¯ä»¶å·¥å…·ï¼Œè€Œåˆ©ç”¨LLVMæ¥æ”¯æ’‘åº•å±‚å®ç°ã€‚LLVMç”±ä¸€äº›åº“å’Œå·¥å…·ç»„æˆï¼Œæ­£å› ä¸ºå®ƒçš„è¿™ç§è®¾è®¡æ€æƒ³ï¼Œä½¿å®ƒå¯ä»¥å¾ˆå®¹æ˜“å’ŒIDEé›†æˆï¼ˆå› ä¸ºIDEè½¯ä»¶å¯ä»¥ç›´æ¥è°ƒç”¨åº“æ¥å®ç°ä¸€äº›å¦‚é™æ€æ£€æŸ¥è¿™äº›åŠŸèƒ½ï¼‰ï¼Œä¹Ÿå¾ˆå®¹æ˜“æ„å»ºç”Ÿæˆå„ç§åŠŸèƒ½çš„å·¥å…·ï¼ˆå› ä¸ºæ–°çš„å·¥å…·åªéœ€è¦è°ƒç”¨éœ€è¦çš„åº“å°±è¡Œï¼‰\narm-none-eabi-gcc arm-none-eabi-gcc æ˜¯ä¸€ä¸ªä¸“ä¸º ARM æ¶æ„çš„åµŒå…¥å¼ç³»ç»Ÿè®¾è®¡çš„ GCC ç¼–è¯‘å™¨ç‰ˆæœ¬ã€‚å®ƒå¯ä»¥ç”Ÿæˆè£¸æœºä»£ç ï¼Œé€‚ç”¨äºæ²¡æœ‰æ“ä½œç³»ç»Ÿçš„åº”ç”¨ç¨‹åºã€‚å¼€å‘è€…å¸¸ç”¨å®ƒæ¥ç¼–è¯‘é’ˆå¯¹ ARM Cortex å’Œå…¶ä»– ARM è®¾å¤‡çš„è½¯ä»¶ã€‚\narm-none-eabi-gccÂ å’ŒÂ armclangçš„åŒºåˆ« arm-none-eabi-gccÂ å’ŒÂ armclangÂ æ˜¯ä¸¤ç§ä¸åŒçš„ç¼–è¯‘å·¥å…·é“¾ï¼Œä¸»è¦ç”¨äºåµŒå…¥å¼ç³»ç»Ÿä¸­åŸºäº ARM å¤„ç†å™¨çš„ä»£ç ç¼–è¯‘ã€‚å®ƒä»¬ä¹‹é—´å­˜åœ¨ä¸€äº›å…³é”®çš„åŒºåˆ«ï¼Œä»¥ä¸‹æ˜¯å®ƒä»¬å„è‡ªçš„ç‰¹ç‚¹åŠåŒºåˆ«çš„ç®€è¦æ¦‚è¿°ï¼š\nå¼€å‘è€…å’ŒèƒŒæ™¯ï¼š\narm-none-eabi-gcc: æ˜¯ GNU ç¼–è¯‘å™¨é›†åˆï¼ˆGCCï¼‰çš„ä¸€ä¸ªå˜ä½“ï¼Œä¸“é—¨ç”¨äº ARM å¤„ç†å™¨ã€‚è¿™ä¸ªå·¥å…·é“¾æ˜¯å¼€æºçš„ï¼Œç”± GNU é¡¹ç›®æ”¯æŒã€‚ armclang: æ˜¯ ARM å…¬å¸æ¨å‡ºçš„ç¼–è¯‘å™¨ï¼Œå±äº ARM Compiler å·¥å…·é“¾çš„ä¸€éƒ¨åˆ†ã€‚ARM Compiler 6åŠæ›´é«˜ç‰ˆæœ¬åŸºäºå¼€æºçš„ LLVM/Clang æŠ€æœ¯ï¼Œä½†åŒ…å«è®¸å¤š ARM æä¾›çš„ä¸“æœ‰ä¼˜åŒ–å’Œæ‰©å±•ã€‚ ç¼–è¯‘æŠ€æœ¯å’Œä¼˜åŒ–ï¼š\narm-none-eabi-gcc: åˆ©ç”¨ GCC çš„ä¼˜åŒ–æŠ€æœ¯ï¼Œæä¾›äº†å¹¿æ³›çš„æ¶æ„æ”¯æŒå’Œæˆç†Ÿçš„ä¼˜åŒ–æ–¹æ³•ã€‚ armclang: ä½¿ç”¨ LLVM ç¼–è¯‘æŠ€æœ¯æ¡†æ¶ï¼Œé€šå¸¸æä¾›æ›´ç°ä»£çš„ä¼˜åŒ–ç­–ç•¥å’Œæ›´å¥½çš„ä»£ç ç”Ÿæˆè´¨é‡ï¼Œå°¤å…¶æ˜¯åœ¨ C++ çš„é«˜çº§ç‰¹æ€§æ”¯æŒæ–¹é¢ã€‚ è¯­è¨€æ”¯æŒï¼š\nä¸¤è€…éƒ½æ”¯æŒä¸»è¦çš„ç¼–ç¨‹è¯­è¨€å¦‚ C å’Œ C++ã€‚ä½†æ˜¯ï¼Œç”±äº ARM Compiler åŒ…æ‹¬æ¥è‡ª LLVM/Clang çš„ä¼˜åŠ¿ï¼Œarmclang å¯èƒ½åœ¨æ”¯æŒæœ€æ–° C++ æ ‡å‡†æ–¹é¢æœ‰æ›´å¥½çš„è¡¨ç°ã€‚ è°ƒè¯•å’Œé”™è¯¯ä¿¡æ¯ï¼š\narmclangÂ é€šå¸¸æä¾›æ›´è¯¦ç»†çš„é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯ï¼Œè¿™å¯ä»¥ä½¿è°ƒè¯•è¿‡ç¨‹æ›´åŠ é«˜æ•ˆã€‚ arm-none-eabi-gccÂ çš„é”™è¯¯ä¿¡æ¯è¾ƒä¸ºä¼ ç»Ÿï¼Œä½†ç”±äºå¹¿æ³›ä½¿ç”¨ï¼Œç½‘ä¸Šæœ‰å¤§é‡å…³äºå…¶è°ƒè¯•çš„èµ„æºå’Œç¤¾åŒºæ”¯æŒã€‚ ç”Ÿæ€ç³»ç»Ÿå’Œé›†æˆï¼š\narm-none-eabi-gccÂ ç”±äºæ˜¯å¼€æºå’Œå…è´¹ï¼Œè¢«å¹¿æ³›åº”ç”¨äºå¤šç§å¼€å‘ç¯å¢ƒå’Œé¡¹ç›®ä¸­ã€‚å…¶ç”Ÿæ€ç³»ç»Ÿéå¸¸æˆç†Ÿï¼Œæœ‰å¤§é‡çš„ç¬¬ä¸‰æ–¹åº“å’Œå·¥å…·æ”¯æŒã€‚ armclangÂ å°½ç®¡é›†æˆäº†è®¸å¤š ARM ç‰¹å®šçš„ä¼˜åŒ–ï¼Œä½†ä½œä¸ºå•†ä¸šäº§å“ï¼Œå¯èƒ½åœ¨ä½¿ç”¨ä¸Šä¸å¦‚ GCC çµæ´»ï¼Œç‰¹åˆ«æ˜¯åœ¨ç‰ˆæƒå’Œè®¸å¯è¯ç®¡ç†æ–¹é¢ã€‚ æ€§èƒ½ï¼š\næ€§èƒ½æ¯”è¾ƒå¹¶ä¸ç»å¯¹ï¼Œä¾èµ–äºå…·ä½“çš„åº”ç”¨åœºæ™¯å’Œä»£ç ç‰¹æ€§ã€‚åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œarmclang ç”Ÿæˆçš„ä»£ç è¿è¡Œæ•ˆç‡æ›´é«˜ï¼Œè€Œåœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œarm-none-eabi-gcc å¯èƒ½è¡¨ç°å¾—æ›´å¥½ã€‚ åœ¨é€‰æ‹©å“ªä¸€ä¸ªç¼–è¯‘å™¨è¿›è¡Œé¡¹ç›®å¼€å‘æ—¶ï¼Œéœ€è¦è€ƒè™‘å¤šä¸ªå› ç´ ï¼Œå¦‚å›¢é˜Ÿçš„ç†Ÿæ‚‰åº¦ã€é¡¹ç›®éœ€æ±‚å¯¹ä¼˜åŒ–çš„ä¾èµ–ç¨‹åº¦ã€æˆæœ¬ï¼ˆå°¤å…¶æ˜¯ armclang å¯èƒ½æ¶‰åŠçš„è®¸å¯æˆæœ¬ï¼‰ä»¥åŠä¸å…¶ä»–å·¥å…·çš„å…¼å®¹æ€§ç­‰ã€‚\nclangd clangdæ˜¯llvmé¡¹ç›®æ¨å‡ºçš„C++è¯­è¨€æœåŠ¡å™¨ï¼Œé€šè¿‡LSP(Language Server Protocal)åè®®å‘ç¼–è¾‘å™¨å¦‚vscode/vim/emacsæä¾›è¯­æ³•è¡¥å…¨ã€é”™è¯¯æ£€æµ‹ã€è·³è½¬ã€æ ¼å¼åŒ–ç­‰ç­‰åŠŸèƒ½ã€‚C++çš„LSPæ›¾ç»æ˜¯cquery, ccls, clangdä¸‰è¶³é¼ç«‹ã€‚ä½†æ˜¯clangdæ”¯æŒclang-tidyå®æ—¶æ£€æŸ¥çš„åŠŸèƒ½æ˜¯å¦å¤–ä¸¤è€…ä¸å…·å¤‡çš„ï¼Œè€Œä¸”cqueryå’Œcclséƒ½æ˜¯å•ä¸ªå¼€å‘è€…ä¸»å¯¼çš„é¡¹ç›®ï¼ŒclangdèƒŒååˆ™æ˜¯æœ‰llvmçš„èƒŒä¹¦ã€‚ç›®å‰æ¥çœ‹ï¼Œâ€œå§“èµµâ€çš„clangdåœ¨è¿™åœºc++ lspèµ›è·‘ä¸­å·²ç»æœ‰äº†ä¸å°çš„é¢†å…ˆä¼˜åŠ¿ã€‚\nVScodeçš„IntelliSense IntelliSense æ˜¯ VS Code æä¾›çš„æ™ºèƒ½ä»£ç è¡¥å…¨å’Œç†è§£åŠŸèƒ½ï¼Œå®ƒç»“åˆäº†ä»£ç è¡¥å…¨ã€å‚æ•°ä¿¡æ¯ã€å¿«é€Ÿä¿¡æ¯å’Œæˆå‘˜åˆ—è¡¨ç­‰åŠŸèƒ½ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚\nIntelliSense çš„æ ¸å¿ƒç»„æˆ\nä»£ç è¡¥å…¨ (Code Completion) è¾“å…¥æ—¶è‡ªåŠ¨æ˜¾ç¤ºå»ºè®®åˆ—è¡¨ åŒ…å«å˜é‡ã€å‡½æ•°ã€ç±»ã€æ–¹æ³•ç­‰ æ”¯æŒæ¨¡ç³ŠåŒ¹é… (å¦‚è¾“å…¥Â fs.rmÂ å¯åŒ¹é…Â fs.rmdir) å‚æ•°æç¤º (Parameter Hints) æ˜¾ç¤ºå‡½æ•°å‚æ•°ä¿¡æ¯ å½“å‰å‚æ•°ä½ç½®é«˜äº®æ˜¾ç¤º å‡½æ•°é‡è½½æ—¶å¯é€šè¿‡ç®­å¤´åˆ‡æ¢ å¿«é€Ÿä¿¡æ¯ (Quick Info) æ‚¬åœæ—¶æ˜¾ç¤ºç¬¦å·å®šä¹‰ åŒ…å«æ–‡æ¡£æ³¨é‡Šã€ç±»å‹ä¿¡æ¯ç­‰ é”™è¯¯æ£€æŸ¥ (Error Checking) å®æ—¶è¯­æ³•æ£€æŸ¥ ç±»å‹é”™è¯¯æ£€æµ‹ æœªå®šä¹‰ç¬¦å·æç¤º IntelliSense çš„å·¥ä½œåŸç† VS Code é€šè¿‡ä»¥ä¸‹æ–¹å¼æä¾› IntelliSenseï¼š\nåŸºäºè¯æ³•åˆ†æï¼šç®€å•çš„æ–‡æœ¬åŒ¹é…è¡¥å…¨ åŸºäºè¯­è¨€æœåŠ¡å™¨åè®® (LSP)ï¼šé€šè¿‡è¯­è¨€æœåŠ¡å™¨è·å–æ·±åº¦åˆ†æ åŸºäº TypeScript/JavaScript çš„ TS Serverï¼šä¸“ä¸º JS/TS ä¼˜åŒ– åŸºäºæ ‡ç­¾ (Tag Parser)ï¼šå¦‚ C/C++ æ‰©å±•ä½¿ç”¨çš„æ–¹æ¡ˆ äº¤å‰ç¼–è¯‘å™¨ åœ¨ä¸€ç§è®¡ç®—æœºç¯å¢ƒä¸­è¿è¡Œçš„ç¼–è¯‘ç¨‹åºï¼Œèƒ½ç¼–è¯‘å‡ºåœ¨å¦å¤–ä¸€ç§ç¯å¢ƒä¸‹è¿è¡Œçš„ä»£ç ï¼Œè¿™ä¸ªç¼–è¯‘è¿‡ç¨‹å°±å«äº¤å‰ç¼–è¯‘.ç®€å•åœ°è¯´ï¼Œå°±æ˜¯åœ¨ä¸€ä¸ªå¹³å°ä¸Šç”Ÿæˆå¦ä¸€ä¸ªå¹³å°ä¸Šçš„å¯æ‰§è¡Œä»£ç \narm äº¤å‰ç¼–è¯‘å™¨å„ç§gcc å‚»å‚»åˆ†ä¸æ¸…æ¥šï¼šgnueabi,gnueabhf,none-eaib - çŸ¥ä¹\näº¤å‰ç¼–è¯‘å·¥å…·é“¾çš„å‘½åè§„èŒƒ arch [-vendor] [-os] [-(gnu)eabi]\narch : æ¶æ„çš„æ„æ€ï¼Œå¦‚ARM ï¼ŒMIPS\nvendorï¼š å·¥å…·é“¾çš„æä¾›å‚å•†\nosï¼š æ”¯æŒçš„æ“ä½œç³»ç»Ÿ\neabiï¼šåµŒå…¥å¼åº”ç”¨äºŒè¿›åˆ¶æ¥å£ï¼ˆEmbedded Application Binary Interfaceï¼‰\narm gccè¿˜åˆ†ä¸º æ˜¯å¦æ”¯æŒæ“ä½œç³»ç»Ÿ æ”¯æŒæ“ä½œç³»ç»Ÿï¼šÂ arm-none-linux-eabi-gcc ä¸æ”¯æŒæ“ä½œç³»ç»Ÿï¼š arm-none-eabi-gcc noneè¡¨ç¤ºvendoræ˜¯noneï¼Œä¹Ÿå°±æ˜¯ä¸å±äºæŸä¸€å…¬å¸çš„ ï¼ˆæ›´å¤šçš„è§£é‡Šæ˜¯noneæ˜¯æŒ‡æ— æ“ä½œç³»ç»Ÿï¼‰\nABI å’Œ EABI ABIï¼šäºŒè¿›åˆ¶åº”ç”¨ç¨‹åºæ¥å£(Application Binary Interface (ABI) for the ARM Architecture)ã€‚åœ¨è®¡ç®—æœºä¸­ï¼Œåº”ç”¨äºŒè¿›åˆ¶æ¥å£æè¿°äº†åº”ç”¨ç¨‹åºï¼ˆæˆ–è€…å…¶ä»–ç±»å‹ï¼‰å’Œæ“ä½œç³»ç»Ÿä¹‹é—´æˆ–å…¶ä»–åº”ç”¨ç¨‹åºçš„ä½çº§æ¥å£ã€‚\nEABIï¼šåµŒå…¥å¼ABIã€‚åµŒå…¥å¼åº”ç”¨äºŒè¿›åˆ¶æ¥å£æŒ‡å®šäº†æ–‡ä»¶æ ¼å¼ã€æ•°æ®ç±»å‹ã€å¯„å­˜å™¨ä½¿ç”¨ã€å †ç§¯ç»„ç»‡ä¼˜åŒ–å’Œåœ¨ä¸€ä¸ªåµŒå…¥å¼è½¯ä»¶ä¸­çš„å‚æ•°çš„æ ‡å‡†çº¦å®šã€‚å¼€å‘è€…ä½¿ç”¨è‡ªå·±çš„æ±‡ç¼–è¯­è¨€ä¹Ÿå¯ä»¥ä½¿ç”¨ EABI ä½œä¸ºä¸å…¼å®¹çš„ç¼–è¯‘å™¨ç”Ÿæˆçš„æ±‡ç¼–è¯­è¨€çš„æ¥å£ã€‚\nä¸¤è€…ä¸»è¦åŒºåˆ«æ˜¯ï¼ŒABIæ˜¯è®¡ç®—æœºä¸Šçš„ï¼ŒEABIæ˜¯åµŒå…¥å¼å¹³å°ä¸Šï¼ˆå¦‚ARMï¼ŒMIPSç­‰ï¼‰\nninjaï¼Œmakeï¼Œcmake cmake cmakeæ˜¯ä¸€ä¸ªç”Ÿæˆ .ninja å’Œ .makefile çš„å·¥å…·ã€‚cmakeåªéœ€è¦ç”¨æˆ·é€šè¿‡å¯¹æºç æ–‡ä»¶çš„ç®€å•æè¿°ï¼ˆå°±æ˜¯CMakeLists.txtæ–‡ä»¶ï¼‰ï¼Œå°±èƒ½è‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªprojectçš„makefileæ–‡ä»¶æˆ–è€…ninjaæ–‡ä»¶ï¼Œç„¶åå°±å¯ä»¥é€šè¿‡ninjaæˆ–è€…makeè¿›è¡Œå¯åŠ¨ç¼–è¯‘äº†ï¼Œå¾ˆå¤šIDEéƒ½åœ¨ç”¨cmakeä½œä¸ºé¡¹ç›®ç®¡ç†å·¥å…·ã€‚\nmakeä¸ninja makeåŠŸèƒ½å¼ºå¤§ï¼Œå¯ä»¥ç»™äººçœ‹ï¼Œninjaå¯åŠ¨é€Ÿåº¦å¿«ï¼Œé¡¹ç›®æ„å»ºé€Ÿåº¦å¿«ï¼Œä½†ä¸æ˜¯ç»™äººçœ‹çš„ å¯ä»¥è®¤ä¸ºä¸¤è€…åŒçº§ã€‚\nå±‚çº§å…³ç³» å¼€å‘è€…å±‚ï¼šç¼–å†™CMakeLists.txtå®šä¹‰æ„å»ºè§„åˆ™ ç”Ÿæˆå™¨å±‚ï¼šCMakeè§£æé…ç½®ï¼Œç”Ÿæˆåº•å±‚æ„å»ºæ–‡ä»¶ æ‰§è¡Œå™¨å±‚ï¼šMake/Ninjaæ‰§è¡Œå…·ä½“æ„å»ºå‘½ä»¤ å·¥å…·é“¾å±‚ï¼šç¼–è¯‘å™¨(å¦‚gcc)ã€é“¾æ¥å™¨ç­‰å®é™…æ‰§è¡Œç¼–è¯‘ HALåº“ï¼ˆHardware Abstraction Layer ç¡¬ä»¶æŠ½è±¡å±‚åº“ï¼‰ 1. æ ¸å¿ƒå®šä¹‰ä¸å½’å± HAL åº“æ˜¯Â STMicroelectronicsï¼ˆæ„æ³•åŠå¯¼ä½“ï¼‰Â ä¸ºè‡ªå®¶Â STM32 ç³»åˆ—å¾®æ§åˆ¶å™¨ï¼ˆMCUï¼‰Â é‡èº«æ‰“é€ çš„åº•å±‚è½¯ä»¶åº“ï¼Œæ˜¯ STM32 ç”Ÿæ€ä¸­æ ¸å¿ƒçš„å¼€å‘å·¥å…·ä¹‹ä¸€ï¼ŒåŸºäº ARM çš„ CMSIS æ ‡å‡†æ„å»ºã€‚\n2. æ ¸å¿ƒç»„æˆæ¨¡å— å¤–è®¾é©±åŠ¨æ¨¡å—ï¼šè¦†ç›– STM32 æ‰€æœ‰å¸¸ç”¨å¤–è®¾ï¼ˆGPIOã€UARTã€SPIã€I2Cã€ADCã€DACã€å®šæ—¶å™¨ã€DMAã€CANã€USB ç­‰ï¼‰ï¼Œæ¯ä¸ªå¤–è®¾éƒ½å°è£…äº†å®Œæ•´çš„æ“ä½œæ¥å£ï¼ˆåˆå§‹åŒ–ã€é…ç½®ã€æ•°æ®æ”¶å‘ / é‡‡é›†ã€ä¸­æ–­å¤„ç†ç­‰ï¼‰ã€‚ ç³»ç»Ÿçº§åŠŸèƒ½æ¨¡å—ï¼šåŒ…å«æ—¶é’Ÿæ ‘é…ç½®ï¼ˆHAL_RCC_XXX ç³»åˆ—å‡½æ•°ï¼‰ã€ä¸­æ–­æ§åˆ¶å™¨é…ç½®ã€ä½åŠŸè€—æ¨¡å¼ï¼ˆç¡çœ  / åœæœº / å¾…æœºï¼‰ç®¡ç†ã€å¤ä½å¤„ç†ç­‰æ ¸å¿ƒç³»ç»ŸåŠŸèƒ½ã€‚ å·¥å…·é“¾é€‚é…æ¨¡å—ï¼šå…¼å®¹ä¸»æµå¼€å‘ç¯å¢ƒï¼ˆSTM32CubeIDEã€Keil MDKã€IAR EWARMï¼‰ï¼Œæ”¯æŒä¸ STM32CubeMXï¼ˆå›¾å½¢åŒ–é…ç½®å·¥å…·ï¼‰è”åŠ¨ï¼Œå¯è‡ªåŠ¨ç”Ÿæˆåˆå§‹åŒ–ä»£ç ï¼Œå¤§å¹…å‡å°‘æ‰‹åŠ¨ç¼–ç å·¥ä½œé‡ã€‚ è¾…åŠ©åŠŸèƒ½æ¨¡å—ï¼šæä¾›å»¶æ—¶å‡½æ•°ï¼ˆHAL_Delayï¼‰ã€é”™è¯¯å¤„ç†æœºåˆ¶ã€å¤–è®¾çŠ¶æ€æŸ¥è¯¢ç­‰é€šç”¨å·¥å…·å‡½æ•°ï¼Œæå‡å¼€å‘ä¾¿æ·æ€§ã€‚ CMSISï¼ˆCortex Microcontroller Software Interface Standardï¼‰ 1. æ ¸å¿ƒå®šä¹‰ä¸å½’å± CMSIS æ˜¯Â ARM å…¬å¸Â åˆ¶å®šçš„Â è¡Œä¸šç»Ÿä¸€è½¯ä»¶æ¥å£æ ‡å‡†ï¼ˆæ³¨æ„ï¼šä¸æ˜¯å…·ä½“çš„è½¯ä»¶åº“ï¼Œè€Œæ˜¯ â€œè§„èŒƒ / åè®®â€ï¼‰ï¼Œé¢å‘æ‰€æœ‰åŸºäº ARM Cortex-M å†…æ ¸ï¼ˆM0/M0+/M3/M4/M7 ç­‰ï¼‰çš„å¾®æ§åˆ¶å™¨ï¼Œæ‰€æœ‰ä¸»æµ MCU å‚å•†ï¼ˆSTã€NXPã€Microchipã€TIã€ç‘è¨ç­‰ï¼‰å‡éœ€éµå¾ªè¯¥æ ‡å‡†ã€‚\n2. æ ¸å¿ƒç»„æˆæ¨¡å—ï¼ˆå…³é”®å­è§„èŒƒï¼‰ CMSIS-Coreï¼ˆå†…æ ¸æ ¸å¿ƒå±‚ï¼‰ï¼šæœ€åŸºç¡€ã€æœ€æ ¸å¿ƒçš„æ¨¡å—ï¼Œå®šä¹‰äº†ï¼š å†…æ ¸å¯„å­˜å™¨çš„ç»Ÿä¸€è®¿é—®æ¥å£ï¼ˆå¦‚ NVIC ä¸­æ–­æ§åˆ¶å™¨ã€Systick å®šæ—¶å™¨ã€MPU å†…å­˜ä¿æŠ¤å•å…ƒçš„é…ç½®å‡½æ•°ï¼‰ï¼› ç³»ç»Ÿåˆå§‹åŒ–å‡½æ•°ï¼ˆSystemInit()ï¼‰ã€æ—¶é’Ÿé…ç½®æ¥å£ï¼Œç»Ÿä¸€ä¸åŒå‚å•† Cortex-M MCU çš„å†…æ ¸å¯åŠ¨æµç¨‹ï¼› å†…æ ¸çŠ¶æ€æŸ¥è¯¢ã€ä¸­æ–­ä¼˜å…ˆçº§ç®¡ç†ç­‰é€šç”¨ APIï¼Œé¿å…å¼€å‘è€…ç›´æ¥æ“ä½œå†…æ ¸å¯„å­˜å™¨å¯¼è‡´çš„å…¼å®¹æ€§é—®é¢˜ã€‚ CMSIS-Driverï¼ˆå¤–è®¾é©±åŠ¨æ¥å£å±‚ï¼‰ï¼šå®šä¹‰äº†å¤–è®¾é©±åŠ¨çš„ç»Ÿä¸€æ¥å£æ¨¡æ¿ï¼ˆå¦‚ UARTã€SPIã€GPIOã€ADC ç­‰ï¼‰ï¼Œå‚å•†éœ€æŒ‰è¯¥æ¨¡æ¿å®ç°é©±åŠ¨å‡½æ•°ï¼ˆå¦‚UART_Transmitã€SPI_Receiveï¼‰ï¼Œç¡®ä¿ä¸åŒå‚å•†çš„å¤–è®¾é©±åŠ¨æ¥å£ä¸€è‡´ã€‚ CMSIS-RTOSï¼ˆå®æ—¶æ“ä½œç³»ç»Ÿæ¥å£å±‚ï¼‰ï¼šå®šä¹‰äº† RTOS çš„ç»Ÿä¸€ API è§„èŒƒï¼ˆå¦‚ä»»åŠ¡åˆ›å»ºã€ä¿¡å·é‡ã€æ¶ˆæ¯é˜Ÿåˆ—ã€å®šæ—¶å™¨ç­‰ï¼‰ï¼Œä¸»æµ RTOSï¼ˆFreeRTOSã€RTX5ã€Î¼C/OS-IIIï¼‰å‡éµå¾ªè¯¥æ ‡å‡†ï¼Œä½¿ RTOS èƒ½è·¨å‚å•† MCU æ— ç¼ç§»æ¤ã€‚ CMSIS-DSPï¼ˆæ•°å­—ä¿¡å·å¤„ç†åº“æ¥å£å±‚ï¼‰ï¼šå®šä¹‰äº† DSP åŠŸèƒ½çš„ç»Ÿä¸€æ¥å£ï¼ˆå¦‚ FFTã€æ»¤æ³¢ã€çŸ©é˜µè¿ç®—ã€PID æ§åˆ¶ç­‰ï¼‰ï¼ŒARM æä¾›äº†æ ‡å‡†çš„ CMSIS-DSP åº“å®ç°ï¼Œå¼€å‘è€…å¯ç›´æ¥è°ƒç”¨ï¼Œæ— éœ€å…³æ³¨åº•å±‚ç®—æ³•ç»†èŠ‚ã€‚ CMSIS-Packï¼ˆè½¯ä»¶åŒ…æ ¼å¼å±‚ï¼‰ï¼šç»Ÿä¸€äº† MCU è®¾å¤‡æè¿°ã€é©±åŠ¨åº“ã€ä¸­é—´ä»¶ã€ç¤ºä¾‹ä»£ç çš„æ‰“åŒ…æ ¼å¼ï¼Œæ–¹ä¾¿å¼€å‘å·¥å…·ï¼ˆå¦‚ Keil MDKã€STM32CubeIDEï¼‰è‡ªåŠ¨è¯†åˆ«ã€å¯¼å…¥å’Œç®¡ç†è½¯ä»¶èµ„æºã€‚ 3. ç‰¹ç‚¹ä¸é€‚ç”¨åœºæ™¯ ä¼˜ç‚¹ï¼šé€šç”¨æ€§æå¼ºã€è·¨å¹³å°æ€§å¥½ã€ç”Ÿæ€å®Œå–„ï¼Œæ˜¯ Cortex-M MCU å¼€å‘çš„ â€œé€šç”¨è¯­è¨€â€ï¼Œé€‚ç”¨äºæ‰€æœ‰åŸºäº Cortex-M å†…æ ¸çš„ MCU é¡¹ç›®ï¼Œå°¤å…¶é€‚åˆéœ€è¦è·¨å‚å•†ç§»æ¤ã€ä½¿ç”¨ä¸­é—´ä»¶ï¼ˆRTOS/DSPï¼‰çš„å¤æ‚é¡¹ç›®ã€‚ ç¼ºç‚¹ï¼šä»…å®šä¹‰æ¥å£è§„èŒƒï¼Œä¸æä¾›å…·ä½“çš„é©±åŠ¨å®ç°ï¼ˆéœ€å‚å•†æˆ–ç¬¬ä¸‰æ–¹åŸºäºè§„èŒƒå¼€å‘ï¼‰ï¼Œå¼€å‘è€…æ— æ³•ç›´æ¥ä½¿ç”¨ CMSISï¼Œå¿…é¡»ç»“åˆå‚å•†åº“ï¼ˆå¦‚ HAL åº“ï¼‰æˆ–ç¬¬ä¸‰æ–¹åº“æ‰èƒ½è½åœ°ã€‚ HAL åº“ä¸ CMSIS çš„å…³ç³» å±‚çº§å…³ç³»ï¼šCMSIS æ˜¯Â åº•å±‚æ ‡å‡†ï¼ŒHAL åº“æ˜¯Â åŸºäº CMSIS æ ‡å‡†çš„å…·ä½“å®ç°â€”â€”HAL åº“çš„å†…æ ¸æ“ä½œï¼ˆå¦‚ä¸­æ–­é…ç½®ã€Systick å®šæ—¶å™¨ã€æ—¶é’Ÿåˆå§‹åŒ–ï¼‰å®Œå…¨éµå¾ª CMSIS-Core è§„èŒƒï¼Œå¤–è®¾é©±åŠ¨æ¥å£ä¹Ÿå…¼å®¹ CMSIS-Driver æ¨¡æ¿ã€‚ ä½œç”¨äº’è¡¥ï¼š CMSIS è§£å†³ â€œè·¨å‚å•†å…¼å®¹æ€§â€ï¼šè®©ä»£ç èƒ½åœ¨ STã€NXPã€TI ç­‰ä¸åŒå‚å•†çš„ Cortex-M MCU é—´ç§»æ¤ï¼› HAL åº“è§£å†³ â€œST å†…éƒ¨è·¨å‹å·å¼€å‘æ•ˆç‡â€ï¼šè®© STM32 ç”¨æˆ·æ— éœ€å…³æ³¨ CMSIS åº•å±‚ç»†èŠ‚ï¼Œå¿«é€Ÿè°ƒç”¨å°è£…å¥½çš„ API å¼€å‘åŠŸèƒ½ã€‚ ä¾èµ–å…³ç³»ï¼šHAL åº“å¿…é¡»éµå¾ª CMSIS æ ‡å‡†æ‰èƒ½ä¿è¯å…¼å®¹æ€§ï¼ˆå¦åˆ™æ— æ³•é€‚é… Cortex-M å†…æ ¸ï¼‰ï¼›è€Œ CMSIS éœ€è¦ HAL åº“è¿™ç±»å‚å•†åº“æ¥è½åœ°å®ç°ï¼Œæ‰èƒ½è¢«å¼€å‘è€…ç›´æ¥ä½¿ç”¨ï¼ˆCMSIS æœ¬èº«åªæ˜¯ â€œè§„åˆ™â€ï¼Œä¸æ˜¯å¯æ‰§è¡Œä»£ç ï¼‰ã€‚ ç®€å•æ€»ç»“ï¼šCMSIS æ˜¯ â€œé€šç”¨æ¥å£è§„åˆ™â€ï¼ŒHAL åº“æ˜¯ ST æŒ‰è§„åˆ™ä¸º STM32 å®šåˆ¶çš„ â€œå·¥å…·åŒ…â€ï¼Œä¸¤è€…ç»“åˆæ—¢ä¿è¯äº†è·¨å¹³å°å…¼å®¹æ€§ï¼Œåˆæå‡äº† STM32 çš„å¼€å‘æ•ˆç‡ã€‚ ","date":"2025-06-26T15:21:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/%E5%B7%A5%E5%85%B7%E9%93%BE%E7%9A%84%E4%B8%80%E4%BA%9B%E6%9D%82%E7%9F%A5%E8%AF%86/","title":"å·¥å…·é“¾çš„ä¸€äº›æ‚çŸ¥è¯†"},{"content":"ä¸­æ–­ç®€ä»‹ ä¸­æ–­å®šä¹‰ CPUæ‰§è¡Œç¨‹åºä¸­ï¼Œç”±äºå‘ç”Ÿäº†æŸç§éšæœºçš„äº‹ä»¶(å¤–éƒ¨æˆ–å†…éƒ¨)ï¼Œå¼•èµ·CPUæš‚æ—¶ ä¸­æ–­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œè½¬å»æ‰§è¡Œä¸€æ®µç‰¹æ®Šçš„æœåŠ¡ç¨‹åº(ç§°ä¸ºä¸­æ–­æœåŠ¡ç¨‹åºæˆ– ä¸­æ–­å¤„ç†ç¨‹åº)ï¼Œä»¥å¤„ç†è¯¥äº‹ä»¶ï¼Œè¯¥äº‹ä»¶å¤„ç†å®Œååˆè¿”å›è¢«ä¸­æ–­çš„ç¨‹åºç»§ç»­ æ‰§è¡Œï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºä¸­æ–­ å¯¹äºå•ç‰‡æœºæ¥è¯´\nä¸­æ–­äº‹ä»¶å‘ç”Ÿ äº§ç”Ÿä¸­æ–­ä¿¡å· å•ç‰‡æœºæ¥æ”¶åˆ°ä¸­æ–­ä¿¡å·ï¼Œåœæ­¢æ‰§è¡Œå½“å‰å‡½æ•°ï¼Œè·³è½¬è‡³ä¸­æ–­å¤„ç†å‡½æ•° æ‰§è¡Œå®Œä¸­æ–­å¤„ç†å‡½æ•°åï¼Œå•ç‰‡æœºè‡ªåŠ¨è·³è½¬å›ä¸»å‡½æ•°æ‰§è¡Œè¢«ä¸­æ–­å¤„ NVIC NVICæ˜¯åµŒå¥—å‘é‡ä¸­æ–­æ§åˆ¶å™¨ï¼Œæ§åˆ¶ç€æ•´ä¸ªèŠ¯ç‰‡ä¸­æ–­ç›¸å…³çš„åŠŸèƒ½ï¼Œå®ƒè·Ÿå†…æ ¸ç´§å¯†è€¦åˆï¼Œæ˜¯å†…æ ¸é‡Œé¢çš„ä¸€ä¸ªå¤–è®¾ã€‚åŒæ—¶æŒæ§ä¸­æ–­ä¼˜å…ˆçº§å’Œä¸­æ–­å‘é‡è¡¨ã€‚\nä¸­æ–­æµç¨‹ è¯·æ±‚æŒ‚èµ·å¯„å­˜å™¨çš„æ”¹å˜ç”±å¤–è®¾å¯¼è‡´ ä¸­æ–­ä¿¡å·ä¼ é€’è‡³NVICï¼Œç„¶åNVICæŸ¥æ‰¾å¯¹åº”ä¸­æ–­å‘é‡ï¼Œæ‰§è¡Œä¸­æ–­å¤„ç†å‡½æ•° å¦å¤–ä¸­æ–­å¤„ç†å‡½æ•°éƒ½éœ€è¦å»æ¸…é™¤è¯·æ±‚æŒ‚èµ·å¯„å­˜å™¨å¯¹åº”ä½ï¼Œé¿å…ä¸­æ–­å¤„ç†å‡½æ•°è¢«é‡å¤è°ƒç”¨ HALåº“çš„ä¸­æ–­å¤„ç†åŠå›è°ƒå‡½æ•°å®ç°æµç¨‹ é¦–å…ˆæ˜¯å¤–è®¾å‘å‡ºä¸­æ–­è¯·æ±‚ä¿¡å·ï¼ŒNVICæ¥æ”¶åˆ°åä¼šæ ¹æ®ä¸­æ–­å‘é‡è¡¨æŸ¥è¯¢å¯¹åº”ä¸­æ–­å¤„ç†å‡½æ•°çš„å…¥å£ï¼Œåœ¨HALä¸­æ˜¯å¯¹åº”å¤–è®¾çš„å¤–è®¾number_IRQHandlerï¼Œç„¶åå†è¿›å…¥HALåº“ç»Ÿä¸€çš„å¤–è®¾ä¸­æ–­å¤„ç†å‡½æ•°HAL_å¤–è®¾_IRQHandlerï¼Œå†è°ƒç”¨å¯¹åº”çš„å›è°ƒå‡½æ•° NVICåµŒå¥—å‘é‡ä¸­æ–­æ§åˆ¶å™¨ NVICä¼šä¸€ç›´æ£€æµ‹æŸä¸€ä¸ªä¸­æ–­çº¿æ˜¯å¦å¤„äºæ¿€æ´»çŠ¶æ€ï¼Œå½“ä¸­æ–­å¤„ç†å‡½æ•°è¿è¡Œå®Œæˆåï¼Œéœ€è¦åœ¨ä¸­æ–­å¤„ç†å‡½æ•°ä¸­å°†è¯·æ±‚æŒ‚èµ·å¯„å­˜å™¨å¯¹åº”çš„ä½æ¸…é™¤ä¸º0ï¼Œé¿å…NVICä¸€ç›´æ£€æµ‹åˆ°1ï¼Œä¸€ç›´é‡å¤æ‰§è¡Œä¸­æ–­å¤„ç†å‡½æ•°ï¼Œè€Œè¿™ä¸€éƒ¨åˆ†ä»£ç ï¼Œåœ¨HALåº“å†™çš„æ€»IRQHandlerä¸­å·²ç»å®Œæˆã€‚\nå¦å¤–ï¼ŒNVICå¯¹äºä¸­æ–­è¿˜æœ‰ä¸­æ–­ä¼˜å…ˆçº§çš„è®¾ç½®ï¼Œstm32f103c8t6ä¸­æ–­ä¼˜å…ˆçº§ç”±NVICçš„ä¼˜å…ˆçº§å¯„å­˜å™¨é‡Œçš„4ä½å†³å®šã€‚ä¸­æ–­ä¼˜å…ˆçº§åˆ†ä¸ºæŠ¢å ä¼˜å…ˆçº§å’Œå“åº”ä¼˜å…ˆçº§ï¼ˆå®ƒä»¬ä¸€èµ·ç”¨è¿™4ä½ï¼‰\næŠ¢å ä¼˜å…ˆçº§çš„çº§åˆ«è¶Šé«˜ï¼Œè¶Šèƒ½å¤ŸæŠ¢å ä¸­æ–­é€šé“ï¼Œä¼˜å…ˆæ‰§è¡Œä¸­æ–­ 2. å“åº”ä¼˜å…ˆçº§çš„çº§åˆ«è¶Šé«˜ï¼Œå¯ä»¥ä¼˜å…ˆæ’é˜Ÿã€‚ ä¸­æ–­çš„ä¼˜å…ˆçº§ï¼Œéƒ½æ˜¯æ•°å­—è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ EXTIå¤–éƒ¨ä¸­æ–­ EXTIå¤–éƒ¨ä¸­æ–­å®ç° EXTI å¯åˆ†ä¸ºä¸¤å¤§éƒ¨åˆ†åŠŸèƒ½ï¼Œä¸€ä¸ªæ˜¯äº§ç”Ÿä¸­æ–­ï¼Œå¦ä¸€ä¸ªæ˜¯äº§ç”Ÿäº‹ä»¶ï¼Œè¿™ä¸¤ä¸ªåŠŸèƒ½ä»ç¡¬ä»¶ä¸Šå°±æœ‰æ‰€ä¸åŒã€‚æˆ‘ä»¬çš„ä¸»è¦å…³æ³¨ç‚¹æ˜¯ä¸­æ–­ã€‚ è¾¹æ²¿æ£€æµ‹ç”µè·¯ç”¨æ¥æ£€æµ‹è¾“å…¥çš„ç”µå¹³ä¿¡å·çš„é«˜ä½ç”µå¹³çš„è½¬æ¢ï¼ŒåŒæ—¶ä¼šæ ¹æ® ä¸Šå‡æ²¿/ä¸‹é™æ²¿è§¦å‘é€‰æ‹©å¯„å­˜å™¨æ¥å†³å®šæ˜¯å¦å‘åäº§ç”Ÿé«˜ç”µå¹³ä¿¡å· è½¯ä»¶ä¸­æ–­äº‹ä»¶å¯„å­˜å™¨ä½¿ç”¨è½¯ä»¶æ¥æ¨¡æ‹Ÿäº§ç”Ÿä¸€ä¸ªä¸­æ–­ è¯·æ±‚æŒ‚èµ·å¯„å­˜å™¨æ¥æ”¶åˆ°é«˜ç”µå¹³åä¼šå°†å¯¹åº”é€šé“çš„ä½ç½®1ï¼ˆä¾‹å¦‚EXTI_9äº§ç”Ÿé«˜ç”µå¹³è¿›å…¥è¯·æ±‚æŒ‚èµ·å¯„å­˜å™¨ï¼Œåˆ™è¯¥å¯„å­˜å™¨ä¼šå°†ç¬¬9ä½ç½®1ï¼‰ æœ€åä¸Šé¢çš„çº¿è·¯å°±ä¼šè¿›å…¥NVIC(åµŒå¥—å‘é‡ä¸­æ–­æ§åˆ¶å™¨) ä¸‹é¢çš„çº¿è·¯ï¼Œè„‰å†²å‘ç”Ÿå™¨ä½œä¸ºäº‹ä»¶ä¿¡å·é€åˆ°å¯¹åº”å¤–è®¾ï¼Œè¿™ä¸ªè„‰å†²ä¿¡å·å¯ä»¥ç»™å…¶ä»–å¤–è®¾ç”µè·¯ä½¿ç”¨ï¼Œæ¯”å¦‚å®šæ—¶å™¨TIMã€æ¨¡æ‹Ÿæ•°å­—è½¬æ¢å™¨ADCç­‰ç­‰ï¼Œè¿™æ ·çš„è„‰å†²ä¿¡å·ä¸€èˆ¬ç”¨æ¥è§¦å‘TIMæˆ–è€…ADCå¼€å§‹è½¬æ¢ äº§ç”Ÿä¸­æ–­çº¿è·¯ç›®çš„æ˜¯æŠŠè¾“å…¥ä¿¡å·è¾“å…¥åˆ°NVICï¼Œè¿›ä¸€æ­¥ä¼šè¿è¡Œä¸­æ–­æœåŠ¡å‡½æ•°ï¼Œå®ç°åŠŸèƒ½ï¼Œè¿™æ ·æ˜¯è½¯ä»¶çº§çš„ã€‚ äº§ç”Ÿäº‹ä»¶çº¿è·¯ç›®çš„å°±æ˜¯ä¼ è¾“ä¸€ä¸ªè„‰å†²ä¿¡å·ç»™å…¶ä»–å¤–è®¾ä½¿ç”¨ï¼Œå¹¶ä¸”æ˜¯ç”µè·¯çº§åˆ«çš„ä¿¡å·ä¼ è¾“ï¼Œå±äºç¡¬ä»¶çº§çš„ã€‚ è°ƒç”¨æµç¨‹ ä»¥EXTI1ä¸ºä¾‹ï¼Œä¸‹é™æ²¿è§¦å‘ï¼Œå½“å‡ºç°ä¸‹é™æ²¿æ—¶ï¼Œå°±ä¼šè§¦å‘EXTI5çš„å¤–éƒ¨ä¸­æ–­ï¼Œè¿›å…¥EXTI9_5_IRQHandlerï¼Œåœ¨EXTI9_5_IRQHandlerä¸­è°ƒç”¨HAL_GPIO_EXTI_IRQHandlerå‡½æ•°ç»Ÿä¸€å¤„ç†å¤–éƒ¨ä¸­æ–­ï¼Œåœ¨è¯¥å‡½æ•°ä¸­å¯¹æŒ‚èµ·å¯„å­˜å™¨è¿›è¡Œæ¸…0æ“ä½œï¼Œå¹¶è°ƒç”¨HAL_GPIO_EXTI_Callbackä¸­æ–­å›è°ƒå‡½æ•°\næŒ‰é”®å®ç°å¤–éƒ¨ä¸­æ–­æ§åˆ¶å°ç¯äº®ç­ Cubeé…ç½® EXTIé…ç½® æ‰“å¼€ä¸­æ–­\né…ç½®çš„æ˜¯ä¸‹é™æ²¿è§¦å‘ï¼Œæ£€æµ‹ä¸‹é™æ²¿ï¼Œä¸Šæ‹‰æ¨¡å¼ é…ç½®å‚æ•°è§£é‡Š\nä¸Šå‡æ²¿è§¦å‘ï¼šæŒ‡çš„æ˜¯å½“å¼•è„šç”µå¹³ä»ä½ç”µå¹³(0)è½¬å˜ä¸ºé«˜ç”µå¹³(1)æ—¶ï¼Œè§¦å‘äº‹ä»¶ ä¸‹é™æ²¿è§¦å‘ï¼šæŒ‡çš„æ˜¯å½“å¼•è„šç”µå¹³ä»é«˜ç”µå¹³(1)è½¬å˜ä¸ºä½ç”µå¹³(0)æ—¶ï¼Œè§¦å‘äº‹ä»¶ åŒè¾¹æ²¿è§¦å‘ï¼šæŒ‡çš„æ˜¯å½“å¼•è„šçš„ç”µå¹³å‘ç”Ÿä»»ä½•å˜åŒ–ï¼ˆå³ä»ä½ç”µå¹³åˆ°é«˜ç”µå¹³æˆ–ä»é«˜ç”µå¹³åˆ°ä½ç”µå¹³ï¼‰æ—¶ï¼Œéƒ½ä¼šè§¦å‘äº‹ä»¶ ä¸Šæ‹‰ï¼šæŒ‡ä½¿å¼•è„šåœ¨æœªè¿æ¥ï¼ˆæ‚¬ç©ºï¼‰æ—¶é»˜è®¤ä¸º é«˜ç”µå¹³(1) ä¸‹æ‹‰ï¼šæŒ‡ä½¿å¼•è„šåœ¨æœªè¿æ¥ï¼ˆæ‚¬ç©ºï¼‰æ—¶é»˜è®¤ä¸º ä½ç”µå¹³(0) GPIOé…ç½® æ¨æŒ½æ¨¡å¼ï¼Œåˆå§‹è¾“å‡ºä¸ºLowä½ç”µå¹³\næŒ‰é”®æ¶ˆæŠ– æ–¹å¼1 1 2 3 4 5 6 7 void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin) {//å¤–éƒ¨ä¸­æ–­å›è°ƒå‡½æ•° if( GPIO_Pin == GPIO_PIN_5 ) { //HAL_Delay(10); for( int i = 0 ; i \u0026lt;= 72000*100 ; ++ i );//ç©ºå¾ªç¯å»¶æ—¶ HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_2); } } æ–¹å¼2 1 2 3 4 5 6 7 8 9 int lastTick = 0 ; void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin) {//å¤–éƒ¨ä¸­æ–­å›è°ƒå‡½æ•° if( GPIO_Pin == GPIO_PIN_5 ) { if( HAL_GetTick()-lastTick \u0026gt; 150 ) { HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_2); lastTick = HAL_GetTick(); } } } ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 int lastTick = 0 ; void HAL_GPIO_EXTI_Callback(uint16_t GPIO_Pin) {//å¤–éƒ¨ä¸­æ–­å›è°ƒå‡½æ•° if( GPIO_Pin == GPIO_PIN_5 ) { if( HAL_GetTick()-lastTick \u0026gt; 150 ) { HAL_GPIO_TogglePin(GPIOA, GPIO_PIN_2); lastTick = HAL_GetTick(); } } } TIMå®šæ—¶å™¨å®šæ—¶ä¸­æ–­ åœ¨f103c8t6ä¸­ï¼ŒTIM1æ˜¯é«˜çº§å®šæ—¶å™¨ï¼ŒTIM2ï¼ŒTIM3ï¼ŒTIM4æ˜¯é€šç”¨è®¡æ—¶å™¨ ä¸‹é¢ä¾‹å­ä¸­é…ç½®çš„æ˜¯TIM1ï¼Œå®ç°æ¯ç§’ç¿»è½¬1æ¬¡å°ç¯äº®ç­\nè°ƒç”¨æµç¨‹ è§¦å‘æ›´æ–°ä¸­æ–­åè¿›å…¥æ›´æ–°ä¸­æ–­æœåŠ¡å‡½æ•°TIM1_UP_IRQHandlerï¼Œå…¶ä¸­è°ƒç”¨HAL_TIM_IRQHandlerï¼Œåœ¨è¯¥å‡½æ•°ä¸­è°ƒç”¨äº†HAL_TIM_PeriodElapsedCallbackå›è°ƒå‡½æ•°\nCubeMXå‚æ•°é…ç½® ä½¿ç”¨å†…éƒ¨æ—¶é’Ÿæ¨¡å¼\nå‚æ•°é…ç½®å¦‚ä¸‹ï¼Œå®ç°1sè§¦å‘ä¸€æ¬¡å®šæ—¶å™¨æ›´æ–°ä¸­æ–­\nPrescaker:é¢„åˆ†é¢‘ï¼Œå®é™…åˆ†é¢‘æ•°æ˜¯number+1 Counter Mode:è®¡æ•°æ¨¡å¼è®¾ç½® Counter Period:è‡ªåŠ¨é‡è£…è½½è®¡æ•°å™¨è®¡æ•°å€¼ Internal Clock Division:å†…éƒ¨æ—¶é’Ÿé¢„åˆ†é¢‘ Repetiton Counter:é‡å¤è®¡æ•°å™¨ (RCRÂ -8 bits)ï¼Œå±äºé«˜çº§æ§åˆ¶å¯„å­˜å™¨ä¸“ç”¨å¯„å­˜å™¨ä½ï¼Œåˆ©ç”¨å®ƒå¯ä»¥éå¸¸å®¹æ˜“æ§åˆ¶è¾“å‡º PWM çš„ä¸ªæ•°ï¼Œä¸å†…éƒ¨æ—¶é’Ÿæ¨¡å¼æ— å…³ auto-reload preload:æ˜¯å¦å¼€å¯å½±å­å¯„å­˜å™¨æ¨¡å¼ è¿˜éœ€è¦å¼€å¯å®šæ—¶å™¨æ›´æ–°ä¸­æ–­ ä»£ç å®ç° ç”¨çš„PA2ä½œGPIOè¾“å‡º\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef *htim) { if( htim == \u0026amp;htim1 ) { HAL_GPIO_TogglePin(GPIOA,GPIO_PIN_2); } } int main(void) { /* USER CODE BEGIN 1 */ /* USER CODE END 1 */ /* MCU Configuration--------------------------------------------------------*/ /* Reset of all peripherals, Initializes the Flash interface and the Systick. */ HAL_Init(); /* USER CODE BEGIN Init */ /* USER CODE END Init */ /* Configure the system clock */ SystemClock_Config(); /* USER CODE BEGIN SysInit */ /* USER CODE END SysInit */ /* Initialize all configured peripherals */ MX_GPIO_Init(); MX_TIM1_Init(); /* USER CODE BEGIN 2 */ HAL_TIM_Base_Start_IT(\u0026amp;htim1); /* USER CODE END 2 */ /* Infinite loop */ /* USER CODE BEGIN WHILE */ while (1) { /* USER CODE END WHILE */ /* USER CODE BEGIN 3 */ } /* USER CODE END 3 */ } USARTä¸­æ–­ USARTçš„è½®è¯¢æ¨¡å¼ä¼šé˜»å¡ç¨‹åºè¿è¡Œï¼Œæµªè´¹CPUèµ„æº\nè½®è¯¢æ¨¡å¼ CPUä¸æ–­æŸ¥è¯¢å‘é€æ•°æ®å¯„å­˜å™¨æˆ–è€…æ¥å—æ•°æ®å¯„å­˜å™¨å¯¼è‡´ç¨‹åºçš„é˜»å¡\nå‘é€ åœ¨UARTåº•å±‚æœ‰å‘é€ç§»ä½å¯„å­˜å™¨å’Œå‘é€æ•°æ®å¯„å­˜å™¨ï¼Œå‘é€æ•°æ®æ—¶ï¼Œéœ€è¦CPUå°†å‘é€æ•°æ®å¯„å­˜å™¨çš„æ•°æ®ç§»åŠ¨è‡³å‘é€ç§»ä½å¯„å­˜å™¨ï¼Œç„¶åUARTæŒ‰ç…§æŒ‡å®šçš„æ³¢ç‰¹ç‡å‘é€æ•°æ®ï¼ŒCPUåˆ™ä¸æ–­æŸ¥è¯¢æ•°æ®å‘é€å¯„å­˜å™¨æ˜¯å¦ç©ºï¼Œå¦‚æœç©ºåˆ™éœ€è¦ç§»åŠ¨æ•°æ®è¿›æ¥\næ¥æ”¶ åœ¨UARTåº•å±‚æœ‰æ¥æ”¶ç§»ä½å¯„å­˜å™¨å’Œæ¥æ”¶æ•°æ®å¯„å­˜å™¨ï¼Œæ¥æ”¶æ•°æ®æ—¶ï¼ŒUARTæŒ‰ç…§æŒ‡å®šçš„æ³¢ç‰¹ç‡æ¥æ”¶æ•°æ®è‡³æ¥æ”¶ç§»ä½å¯„å­˜å™¨ï¼Œç„¶åæ•°æ®ä¼šå­˜å‚¨åœ¨æ¥æ”¶æ•°æ®å¯„å­˜å™¨ï¼ŒCPUåˆ™ä¸æ–­æŸ¥è¯¢æ•°æ®æ¥æ”¶å¯„å­˜å™¨æ˜¯å¦æœ‰æ•°æ®ï¼Œå¦‚æœæœ‰æ•°æ®ï¼ŒCPUä¼šæŠŠå¯„å­˜å™¨çš„æ•°æ®ç§»åŠ¨è‡³æˆ‘ä»¬ç”¨æ¥æ¥æ”¶æ•°æ®çš„å˜é‡çš„å†…å­˜é‡Œ\nå½“HAL_UART_Receiveæ‰§è¡Œå®Œæˆï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ•°æ®æ¥æ”¶å®Œæˆ ä¸­æ–­æ¨¡å¼ åº•å±‚ä¸­æ–­å®ç°æ•°æ®æ¯ä¼ é€ä¸€å­—èŠ‚ï¼Œå¬å›CPUç»§ç»­è¿è¾“æ•°æ®ï¼Œä¸éœ€è¦æˆ‘ä»¬è€ƒè™‘ï¼ŒHALåº“åº•å±‚å·²ç»å¸®æˆ‘ä»¬å®ç° ä¸Šå±‚ä¸­æ–­å®ç°æ•°æ®æ¥æ”¶å®Œæˆåçš„æ•°æ®å¤„ç†ï¼Œé€šè¿‡ä¸­æ–­å›è°ƒå‡½æ•°å®ç°ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±è®¾è®¡\nå‘é€ CPUå°†æ•°æ®é€å…¥ å‘é€æ•°æ®å¯„å­˜å™¨ï¼Œç„¶åå°±å»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œå½“å‘é€ç§»ä½å¯„å­˜å™¨çš„æ•°æ®å‘é€åï¼Œå‘é€æ•°æ®å¯„å­˜å™¨ç©ºï¼Œä¼šè§¦å‘å‘é€æ•°æ®å¯„å­˜å™¨ç©ºä¸­æ–­ï¼ŒCPUå†æ¬¡å°†æ•°æ®é€å…¥ å‘é€æ•°æ®å¯„å­˜å™¨ï¼Œç„¶ååˆå»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œæ‰€æœ‰æ•°æ®å‘é€å®Œæˆåä¼šè§¦å‘ ä¼ é€å®Œæˆä¸­æ–­ï¼Œè°ƒç”¨HAL_UART_TxCpltCallbackä¸­æ–­å›è°ƒå‡½æ•° æ¥æ”¶ CPUåœ¨å¤„ç†å…¶ä»–ä»£ç ï¼Œæ¥æ”¶ç§»ä½å¯„å­˜å™¨å°†ä¸€å¸§æ•°æ®ç§»åŠ¨è‡³ æ¥å—æ•°æ®å¯„å­˜å™¨åï¼Œä¼šè§¦å‘ æ¥æ”¶æ•°æ®å¯„å­˜å™¨éç©ºä¸­æ–­ï¼ŒCPUä¼šå›æ¥å°† æ¥æ”¶æ•°æ®å¯„å­˜å™¨ çš„æ•°æ®ç§»åŠ¨è‡³æˆ‘ä»¬ç”¨æ¥æ¥æ”¶æ•°æ®çš„å˜é‡çš„å†…å­˜é‡Œï¼Œç„¶ååˆå»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œæ‰€æœ‰æ•°æ®å®Œæˆåä¼šè°ƒç”¨_HAL_UART_RxCpltCallback_ä¸­æ–­å›è°ƒå‡½æ•°å¤„ç†æ¥æ”¶çš„æ•°æ® è€Œæ‰§è¡ŒHAL_UART_Receive_ITåï¼Œæˆ‘ä»¬ä¸èƒ½ç›´æ¥å¯¹æ•°æ®ç»§ç»­å¤„ç†ï¼Œæ•°æ®è¿˜æ²¡æ¥æ”¶å®Œæˆï¼Œå› ä¸ºCPUä¸ä¼šè¿›å…¥é˜»å¡æ€ï¼Œä¼šå»æ‰§è¡Œå…¶ä»–ä»£ç ï¼Œéœ€è¦é€šè¿‡HAL_UART_RxCpltCallbackå›è°ƒå‡½æ•°å¤„ç†æ¥æ”¶çš„æ•°æ®\n","date":"2025-06-25T21:48:07+08:00","permalink":"https://NomadJoeviolet.github.io/p/stm32%E4%B8%AD%E6%96%AD/","title":"STM32â€”â€”ä¸­æ–­"},{"content":"å¸¸è§åè¯ CPUï¼Œä¸­å¤®å¤„ç†å•å…ƒï¼ŒCentral Processing Unit\nALUï¼Œç®—æœ¯é€»è¾‘å•å…ƒï¼ŒArithmetic and Logic Units\nCUï¼Œæ§åˆ¶å•å…ƒï¼Œæ§åˆ¶å™¨ï¼ŒControl Unit\nCPUé€šå¸¸ç”±ä¸­å¤®å¤„ç†å•å…ƒï¼Œç®—æœ¯é€»è¾‘å•å…ƒï¼Œå¯„å­˜å™¨ç»„ä¸‰éƒ¨åˆ†ç»„æˆ\nEUï¼Œæ‰§è¡Œå•å…ƒï¼ŒExecution Unit\nBIUï¼Œæ€»çº¿æ¥å£å•å…ƒï¼ŒBus Interface Unit\nPCï¼Œç¨‹åºè®¡æ•°å™¨ï¼ŒProgram Counter\nIRï¼ŒæŒ‡ä»¤å¯„å­˜å™¨ï¼ŒInstruction Register\nGRï¼Œé€šç”¨å¯„å­˜å™¨ï¼ŒGeneral Register\næ³¨æ„$IO$ç«¯å£å’Œ$IO$æ¥å£ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿\næ“ä½œç³»ç»ŸçŸ¥è¯†ï¼šç¨‹åºè®¡æ•°å™¨ï¼ˆpcï¼‰ã€æŒ‡ä»¤å¯„å­˜å™¨ï¼ˆIRï¼‰ã€é€šç”¨å¯„å­˜å™¨ï¼ˆGRï¼‰ã€çŠ¶æ€å¯„å­˜å™¨ï¼ˆSRï¼‰ã€ç¨‹åºçŠ¶æ€å­—PSW_pcå’Œir-CSDNåšå®¢\nç‰¹æ®Šè¿ç®—ç¬¦å’ŒæŒ‡ä»¤ PTRç”¨æ¥æŒ‡å®šå­˜å‚¨å™¨æ“ä½œæ•°çš„å­—é•¿ Byte PTR[BX]\næ‰€æœ‰å•æ“ä½œæ•°æŒ‡ä»¤è¦æ±‚æ“ä½œæ•°ä¸èƒ½æ˜¯ç«‹å³æ•°ï¼Œå¦‚æœæ˜¯å­˜å‚¨å™¨æ“ä½œæ•°ï¼Œéœ€è¦æŒ‡å®šå­—é•¿\nå¾®å‹è®¡ç®—æœºåŸºç¡€æ¦‚è®º å¾®å‹è®¡ç®—æœºç³»ç»Ÿ å¾®å‹è®¡ç®—æœºç³»ç»Ÿ ç”± ç¡¬ä»¶ç³»ç»Ÿ å’Œ è½¯ä»¶ç³»ç»Ÿ ç»„æˆ ç¡¬ä»¶ç³»ç»Ÿ ç¡¬ä»¶ç³»ç»Ÿ ç”± å¾®å‹è®¡ç®—æœºï¼ˆä¸»æœºï¼‰ å’Œ å¤–è®¾ç»„æˆ\nå¾®å‹è®¡ç®—æœºï¼ˆä¸»æœºï¼‰ç”± å¾®å¤„ç†å™¨ï¼ˆCPUï¼‰ï¼Œå­˜å‚¨å™¨ ï¼ŒIOæ¥å£ ï¼Œæ€»çº¿ ç»„æˆ å¤–è®¾ å°±åŒ…æ‹¬é”®ç›˜ï¼Œé¼ æ ‡ï¼Œæ˜¾ç¤ºå™¨ï¼Œç¡¬ç›˜ç­‰ è½¯ä»¶ç³»ç»Ÿ è½¯ä»¶ç³»ç»Ÿ ç”± ç³»ç»Ÿè½¯ä»¶ å’Œ åº”ç”¨è½¯ä»¶ æ„æˆ\nå¾®å‹è®¡ç®—æœºè¿è¡Œæµç¨‹ å¾®æœºè¿è¡Œçš„åŸºæœ¬æµç¨‹ä¸ºï¼Œç¨‹åºå­˜å‚¨åœ¨å­˜å‚¨å™¨ä¸­ï¼ŒæŒ‰ç¨‹åºæµç¨‹è‡ªåŠ¨è¿ç»­å–å‡ºæŒ‡ä»¤å¹¶æ‰§è¡Œï¼›è‡ªåŠ¨è¿ç»­çš„å®ç°æ˜¯ç¨‹åºè®¡æ•°å™¨ PC çš„è‡ªå¢ï¼›æ­¥éª¤å¯æ¦‚æ‹¬ä¸ºå–æŒ‡ä»¤ã€è¯‘ç ã€æ‰§è¡Œã€‚ä¿®æ”¹ PC æŒ‡é’ˆçš„å€¼ï¼Œå¯å®ç°ç¨‹åºçš„é¡ºåºæ‰§è¡Œã€è·³è½¬ã€å¾ªç¯ã€è¿‡ç¨‹è°ƒç”¨å’Œä¸­æ–­æœåŠ¡ç­‰åŠŸèƒ½ã€‚\nè®¡ç®—æœºä¸­çš„æ•°åˆ¶ä¸ç¼–ç  åè¿›åˆ¶Dï¼ŒäºŒè¿›åˆ¶Bï¼Œåå…­è¿›åˆ¶Hï¼Œå…«è¿›åˆ¶O\næœ‰ç¬¦å·äºŒè¿›åˆ¶æ•°çš„è¡¨ç¤º æœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œ0è¡¨ç¤ºæ­£å·ï¼Œ1è¡¨ç¤ºè´Ÿå·\nåŸç  æ•°å€¼éƒ¨åˆ†ä¿æŒä¸å˜ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ åç  æ­£æ•°çš„åç ä¸æ­£æ•°çš„åŸç ä¸€æ · è´Ÿæ•°çš„åç  ç­‰äº è´Ÿæ•°åŸç  æ•°å€¼éƒ¨åˆ† æŒ‰ä½å–å è¡¥ç  æ­£æ•°çš„è¡¥ç ä¸æ­£æ•°çš„åç å’ŒåŸç ä¸€æ · è´Ÿæ•°çš„è¡¥ç  çš„ç¬¦å·ä½ ä¸ è´Ÿæ•°åŸç ä¸€è‡´ï¼Œæ•°å€¼éƒ¨åˆ†ç­‰äº è´Ÿæ•°åŸç  æ•°å€¼éƒ¨åˆ†å–ååå†åŠ 1\nç‰¹æ®Šæ•°-128çš„è¡¥ç è¡¨ç¤ºä¸º10000000\nå¾®å¤„ç†å™¨ä¸æ€»çº¿ CPUä¸­å¤®å¤„ç†å•å…ƒ CPUæ˜¯å¾®å‹è®¡ç®—æœºçš„è¿ç®—å’ŒæŒ‡æŒ¥æ§åˆ¶ä¸­å¿ƒ ä¸€èˆ¬ç”±ALUï¼ˆè¿ç®—å™¨ï¼‰ï¼ŒCUï¼ˆæ§åˆ¶å•å…ƒï¼‰ï¼Œå¯„å­˜å™¨ç»„ç»„æˆ CPUå†…è¿˜æœ‰ä¸¤ä¸ªç‹¬ç«‹éƒ¨ä»¶ï¼šEUï¼ˆæ‰§è¡Œå•å…ƒï¼‰å’ŒBIUï¼ˆæ€»çº¿æ¥å£å•å…ƒï¼‰ å¾®å¤„ç†å™¨ä¸»è¦æ€§èƒ½æŒ‡æ ‡ CPUçš„å­—é•¿/ä½æ•°ï¼ŒåŠå…¶ä¸€æ¬¡æ€§èƒ½å¤„ç†çš„ä½æ•° CPUä¸»é¢‘ï¼ŒæŒ‡çš„æ˜¯CPUæ—¶é’Ÿé¢‘ç‡\nCUæ§åˆ¶å•å…ƒ æ§åˆ¶å™¨çš„ä½œç”¨æ˜¯æ§åˆ¶ç¨‹åºçš„æ‰§è¡Œï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æŒ‡æŒ¥ä¸­å¿ƒ å…·å¤‡ä»¥ä¸‹åŠŸèƒ½\næŒ‡ä»¤æ§åˆ¶ æ—¶åºæ§åˆ¶ æ“ä½œæ§åˆ¶ EUæ‰§è¡Œå•å…ƒ EUè´Ÿè´£åˆ†ææŒ‡ä»¤ï¼ˆæŒ‡ä»¤è¯‘ç ï¼‰ï¼Œæ‰§è¡ŒæŒ‡ä»¤ åœ¨å·¥ä½œæ—¶ä¸æ–­ä»BIUçš„æŒ‡ä»¤é˜Ÿåˆ—å–æŒ‡ä»¤\nBIUæ€»çº¿æ¥å£å•å…ƒ BIUä¸»è¦åŠŸèƒ½æ˜¯è´Ÿè´£CPUä¸å­˜å‚¨å™¨ï¼ŒIOæ¥å£ä¹‹é—´çš„ä¿¡æ¯ä¼ é€ BIUå¯ä»¥è´Ÿè´£å–æŒ‡ä»¤ï¼Œå–æ“ä½œæ•°ï¼Œå†™ç»“æœ BIUå†…éƒ¨æœ‰ä¸€ä¸ªæŒ‡ä»¤é˜Ÿåˆ—å’Œåœ°å€åŠ æ³•å™¨ åœ°å€åŠ æ³•å™¨èƒ½äº§ç”Ÿ20ä½çš„ç‰©ç†åœ°å€\nCPUç¨‹åºæ‰§è¡Œæ­¥éª¤ ä»å­˜å‚¨å™¨å–å‡ºä¸‹ä¸€æ¡æŒ‡ä»¤ æŒ‡ä»¤è¯‘ç  å¦‚æœæŒ‡ä»¤éœ€è¦ï¼Œä»å­˜å‚¨å™¨ä¸­è¯»å–æ“ä½œæ•° æ‰§è¡ŒæŒ‡ä»¤ï¼ˆç®—æœ¯é€»è¾‘è¿ç®—ï¼ŒIOæ“ä½œï¼Œæ•°æ®ä¼ è¾“ç­‰ï¼‰ å¦‚æœéœ€è¦ï¼Œå†™å…¥å­˜å‚¨å™¨ æ ¸å¿ƒæ­¥éª¤ï¼Œå–æŒ‡ä»¤ï¼Œè¯‘ç æŒ‡ä»¤ï¼Œæ‰§è¡ŒæŒ‡ä»¤ å·¥ä½œæ—¶åº æ—¶é’Ÿå‘¨æœŸï¼šæ¯ä¸ªæ—¶é’Ÿè„‰å†²æŒç»­çš„æ—¶é—´ æ€»çº¿å‘¨æœŸï¼šé€šè¿‡æ€»çº¿è¿›è¡Œä¸€æ¬¡è¯»æˆ–å†™æ“ä½œçš„è¿‡ç¨‹ç§°ä¸ºä¸€ä¸ªæ€»çº¿å‘¨æœŸï¼Œä¸€ä¸ªæ€»çº¿å‘¨æœŸåŒ…å«å¤šä¸ªæ—¶é’Ÿå‘¨æœŸ æŒ‡ä»¤å‘¨æœŸï¼šæ‰§è¡Œä¸€æ¡æŒ‡ä»¤æ‰€éœ€çš„æ—¶é—´ï¼Œä¸€ä¸ªæŒ‡ä»¤å‘¨æœŸåŒ…å«å¤šä¸ªæ€»çº¿å‘¨æœŸ ä¸€ä¸ªåŸºæœ¬çš„æ€»çº¿å‘¨æœŸç”±å››ä¸ªæ—¶é’Ÿå‘¨æœŸæ„æˆï¼Œè‹¥å†…å­˜æˆ– IO æ¥å£é€Ÿåº¦è¾ƒæ…¢ï¼Œåˆ™è¿˜ä¼šåœ¨ T3 åæ’å…¥ Tw ç­‰å¾…å‘¨æœŸã€‚ å†™æ“ä½œä¸ºä¾‹çš„æ€»çº¿å‘¨æœŸ åŒ…å«4ä¸ªæ—¶é’Ÿå‘¨æœŸï¼ˆT1,T2,T3,T4ï¼‰ T1åœ°å€è¾“å‡ºï¼ŒT2ç¼“å­˜ï¼ŒT3å’ŒT4æ•°æ®è¾“å‡º\n8088/8086 CPU 8088ä¸8086å¤„ç†å™¨çš„åŒºåˆ« 8088 å¤–éƒ¨æ•°æ®çº¿ä¸º8æ ¹ï¼ˆ8086ä¸º16æ ¹ï¼‰ï¼Œä¸ºå‡†16ä½CPUï¼Œ16 ä½æ•°æ®è¦åˆ†ä¸¤æ¬¡ä¼ é€ï¼›ï¼ˆ æ³¨æ„ï¼š8088å’Œ8086å‡ä¸º16ä½å¤„ç† å™¨ï¼Œå†…éƒ¨æ•°æ®çº¿å‡ä¸º16ä½ï¼Œä¸”åœ°å€æ€»çº¿å‡ä¸º20ä½ï¼‰ æŒ‡ä»¤é¢„å–é˜Ÿåˆ—ï¼š8088ä¸º4å­—èŠ‚ï¼Œ8086ä¸º6å­—èŠ‚\nä¸¤è€…å‡æœ‰ä¸¤ç§å·¥ä½œæ¨¡å¼ï¼Œæœ€å°å·¥ä½œæ¨¡å¼å’Œæœ€å¤§å·¥ä½œæ¨¡å¼\n8088/8086æŒ‡ä»¤æµæ°´çº¿ é‡‡ç”¨EUï¼ˆæ‰§è¡Œå•å…ƒï¼‰å’ŒBIUï¼ˆæ€»çº¿æ¥å£å•å…ƒï¼‰å¹¶è¡Œå·¥ä½œï¼Œå¯åŒæ—¶å–æŒ‡ä»¤ï¼Œæ‰§è¡ŒæŒ‡ä»¤ï¼Œåˆ†ææŒ‡ä»¤ è¡¥å……-æµæ°´çº¿æŠ€æœ¯ åœ¨æŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œæœ‰å‡ ç±»æŒ‡ä»¤ç›¸å…³å½±å“æµæ°´çº¿ä¸­æŒ‡ä»¤çš„æ‰§è¡Œï¼Œä½¿å¾—æŒ‡ä»¤ä¸èƒ½åœ¨é¢„å…ˆè®¾å®šçš„æ‰§è¡Œå‘¨æœŸä¸­æ‰§è¡Œï¼Œé€ æˆæµæ°´çº¿æ–­æµ ç›¸å…³é—®é¢˜ ç»“æ„ç›¸å…³ï¼›æ•°æ®ç›¸å…³ï¼›æ§åˆ¶ç›¸å…³\nç»“æ„ç›¸å…³ å½“CPUçš„ç¡¬ä»¶ç»“æ„ä¸èƒ½å¤ŸåŒæ—¶æ”¯æŒå‡ æ¡æŒ‡ä»¤çš„æ‰§è¡Œæ—¶ï¼Œè¿™å‡ æ¡æŒ‡ä»¤å°†å‘ç”Ÿç»“æ„ç›¸å…³ï¼Œæ¯”å¦‚æµæ°´çº¿åŒæ—¶è®¿é—®åŒä¸€ä¸ªå­˜å‚¨å™¨\næ•°æ®ç›¸å…³ ä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œéœ€è¦ä¸Šä¸€æ¡æˆ–è€…ä¸Šå‡ æ¡æŒ‡ä»¤çš„æ‰§è¡Œç»“æœæ—¶ ï¼Œä¼šé€ æˆæµæ°´çº¿çš„æ–­æµç°è±¡ã€‚\næ‰€ä»¥ï¼Œå½“å‘ç”Ÿæ•°æ®ç›¸å…³æ—¶ï¼Œéœ€è¦å°½å¯èƒ½æ—©çš„æŠŠä¸Šä¸€æ¡æˆ–ä¸Šå‡ æ¡æŒ‡ä»¤çš„æ‰§è¡Œç»“æœ äº¤ç»™ç›¸å…³æŒ‡ä»¤ä½œä¸ºæ“ä½œæ•°ã€‚è¿™å°±éœ€è¦â€œå†…éƒ¨å‰æ¨\næ§åˆ¶ç›¸å…³ å½“æŒ‡ä»¤æ‰§è¡Œåˆ°åˆ†æ”¯æŒ‡ä»¤æˆ–è€…è·³è½¬æŒ‡ä»¤æ—¶ï¼Œå°†äº§ç”Ÿæ§åˆ¶ç›¸å…³ï¼Œæ­¤æ—¶ä¼šäº§ç”Ÿæµæ°´çº¿æ–­æµã€‚ è§£å†³æ–¹æ³•ï¼š\né˜»å¡æµæ°´çº¿ç›´åˆ°ç¡®å®šèµ°å‘ é¢„æµ‹åˆ†æ”¯æ˜¯å¦å‘ç”Ÿï¼Œå¹¶ç»™äºˆè¯¥é¢„æµ‹æ‰§è¡ŒæŒ‡ä»¤ 8088/8086å†…å­˜åˆ†æ®µ 8088/8086å†…éƒ¨ç»“æ„ä¸º16ä½ï¼Œä¸ºäº†å¢å¤§å†…å­˜ç®¡ç†èƒ½åŠ›ä½¿å…¶èƒ½äº§ç”Ÿ20ä½çš„ç‰©ç†åœ°å€ï¼Œé‡‡ç”¨äº†åˆ†æ®µç®¡ç†æ–¹æ³•\næ®µé¦–åœ°å€å³æ®µåŸºåœ°å€ 20ä½ç‰©ç†åœ°å€=æ®µåŸºåœ°å€ * 16+æ®µåç§»åœ°å€ 8088/8086å†…éƒ¨å¯„å­˜å™¨ 8088/8086å†…éƒ¨å¯„å­˜å™¨åˆ†ä¸º é€šç”¨å¯„å­˜å™¨ï¼ˆ8ä¸ªï¼‰ï¼Œæ®µå¯„å­˜å™¨ï¼ˆ4ä¸ªï¼‰ï¼Œæ§åˆ¶å¯„å­˜å™¨ï¼ˆ2ä¸ªï¼‰ é€šç”¨å¯„å­˜å™¨ é€šç”¨å¯„å­˜å™¨åŒ…æ‹¬ æ•°æ®å¯„å­˜å™¨ï¼Œåœ°å€æŒ‡é’ˆå¯„å­˜å™¨ï¼Œå˜å€å¯„å­˜å™¨\næ•°æ®å¯„å­˜å™¨ AXï¼ˆAccumulatorï¼‰ï¼šç´¯åŠ å™¨ï¼Œå¸¸ç”¨äºå­˜æ”¾ç®—æœ¯é€»è¾‘è¿ç®—ä¸­çš„æ“ä½œæ•°ï¼Œå¦å¤–æ‰€æœ‰çš„IOæŒ‡ä»¤éƒ½æ˜¯ç”¨ç´¯åŠ å™¨ä¸å¤–è®¾æ¥å£ä¼ é€ä¿¡æ¯ BXï¼ˆBaseï¼‰ï¼šåŸºå€å¯„å­˜å™¨ï¼Œå¸¸ç”¨æ¥å­˜æ”¾è®¿é—®å†…å­˜æ—¶çš„åç§»åœ°å€ï¼ˆä¸€èˆ¬å’ŒDSä¸€èµ·ç”¨DS:[BX]ï¼‰ CXï¼ˆCountï¼‰ï¼šè®¡æ•°å¯„å­˜å™¨ï¼Œåœ¨å¾ªç¯å’Œä¸²æ“ä½œæŒ‡ä»¤ä¸­ç”¨ä½œè®¡æ•°å™¨ DXï¼ˆDataï¼‰ï¼šæ•°æ®å¯„å­˜å™¨ï¼Œåœ¨å¯„å­˜å™¨é—´æ¥å¯»å€çš„IOæŒ‡ä»¤ä¸­å­˜æ”¾IOç«¯å£åœ°å€ éƒ½å¯æ‹†åˆ†ä¸ºHï¼ŒLä¸¤ä¸ª8ä½å¯„å­˜å™¨\nåœ¨åšåŒå­—èŠ‚ä¹˜é™¤æ³•è¿ç®—æ—¶ï¼ŒDXä¸AXå¯ä»¥åˆèµ·æ¥å­˜ä¸€ä¸ªåŒå­—é•¿çš„æ•°ï¼ˆ32ä½ï¼‰ï¼ŒDXå­˜é«˜16ä½ï¼ŒAXå­˜ä½16ä½\nåœ°å€æŒ‡é’ˆå¯„å­˜å™¨ SPï¼ˆStack Pointerï¼‰ï¼šå †æ ˆæŒ‡é’ˆå¯„å­˜å™¨ï¼Œå¸¸ç”¨æ¥å­˜æ”¾ æ ˆé¡¶åç§»åœ°å€ BPï¼ˆBase Pointerï¼‰ï¼šåŸºå€æŒ‡é’ˆå¯„å­˜å™¨ï¼Œä¸€èˆ¬ä¹Ÿç”¨æ¥å­˜æ”¾è®¿é—®å†…å­˜æ—¶çš„åç§»åœ°å€ï¼ˆä¸€èˆ¬å’ŒSSä¸€èµ·ç”¨SS:[BP]ï¼‰ BXå’ŒBPåŒºåˆ«: (1)ä½œä¸ºé€šç”¨å¯„å­˜å™¨ï¼ŒäºŒè€…å‡å¯ç”¨äºå­˜æ”¾æ•°æ®ï¼›(2)ä½œä¸ºåŸºå€å¯„å­˜å™¨ï¼Œç”¨BXè¡¨ç¤º æ‰€å¯»æ‰¾çš„æ•°æ®åœ¨ æ•°æ®æ®µ ï¼›ç”¨BPåˆ™è¡¨ç¤ºæ•°æ®åœ¨ å †æ ˆæ®µ\nå˜å€å¯„å­˜å™¨ SIï¼ˆSource Indexï¼‰ï¼šæºå˜å€å¯„å­˜å™¨ DIï¼ˆDestination Indexï¼‰ï¼šç›®çš„å˜å€å¯„å­˜å™¨ æ®µå¯„å­˜å™¨ æ®µå¯„å­˜å™¨ï¼Œç”¨äºå­˜æ”¾æ®µåŸºå€ï¼Œå³æ®µèµ·å§‹åœ°å€çš„é«˜16ä½\nCSï¼ˆCode Segmentï¼‰ï¼šä»£ç æ®µå¯„å­˜å™¨ SSï¼ˆStack Segmentï¼‰ï¼šå †æ ˆæ®µå¯„å­˜å™¨ DSï¼ˆData Segmentï¼‰ï¼šæ•°æ®æ®µå¯„å­˜å™¨ ESï¼ˆExtra Segmentï¼‰ï¼šé™„åŠ æ•°æ®æ®µå¯„å­˜å™¨ æ§åˆ¶å¯„å­˜å™¨ IPï¼ˆInstruction Pointerï¼‰ï¼šæŒ‡ä»¤æŒ‡é’ˆå¯„å­˜å™¨ï¼Œå…¶å†…å®¹ä¸ºä¸‹ä¸€æ¡è¦æ‰§è¡ŒæŒ‡ä»¤çš„åç§»åœ°å€ï¼ˆCSæ®µä¸­ï¼‰ æ ‡å¿—å¯„å­˜å™¨ FLAGSï¼šçŠ¶æ€å¯„å­˜å™¨ï¼Œ16ä½å¯„å­˜å™¨ çŠ¶æ€æ ‡å¿—ä½ CFï¼ˆCarry Flagï¼‰ï¼šè¿›ä½æ ‡å¿—ä½ï¼Œè¿›è¡ŒåŠ å‡è¿ç®—æ—¶ï¼Œè‹¥æœ€é«˜ä½å‘å‰æœ‰è¿›ä½é”™ä½ï¼Œåˆ™CF=1 PFï¼ˆParity Flagï¼‰ï¼šå¥‡å¶æ ‡å¿—ä½ï¼Œè¿ç®—ç»“æœä½8ä½ä¸­1çš„ä¸ªæ•°ä¸ºå¶æ•°ï¼ŒPF=1 AFï¼ˆAuxiliary Carry Flagï¼‰ï¼šè¾…åŠ©è¿›ä½æ ‡å¿—ä½ï¼ŒåŠ å‡æ³•è¿ç®—ï¼ŒD3å‘D4è¿›ä½æ—¶ï¼ŒAF=1 ZFï¼ˆZero Flagï¼‰ï¼šé›¶æ ‡å¿—ä½ï¼Œè¿ç®—ç»“æœä¸º0æ—¶ï¼ŒZF=1 SFï¼ˆSign Flagï¼‰ï¼šå½“è¿ç®—ç»“æœæœ€é«˜ä½ä¸º1æ—¶ï¼ŒSF=1 OFï¼ˆOverflow Flagï¼‰ï¼šå½“ç®—æœ¯ç»“æœè¶…å‡ºäº† å¸¦ç¬¦å·æ•°çš„èŒƒå›´æ—¶ï¼Œå³æº¢å‡ºæ—¶ï¼ŒOF=1 æ§åˆ¶æ ‡å¿—ä½\nTFï¼ˆTrap Flagï¼‰ï¼šé™·äº•æ ‡å¿—ä½ï¼Œä¹Ÿå«è·Ÿè¸ªæ ‡å¿—ä½ã€‚TF=1æ—¶ï¼Œä½¿CPUå¤„äºå•æ­¥æ‰§è¡ŒæŒ‡ä»¤çš„å·¥ä½œæ–¹å¼ IFï¼ˆInterrupt Enable Flagï¼‰ï¼šä¸­æ–­å…è®¸æ ‡å¿—ä½ã€‚IF=1ä½¿CPUå¯ä»¥å“åº”å¯å±è”½ä¸­æ–­è¯·æ±‚ DFï¼ˆDirection Flagï¼‰ï¼šæ–¹å‘æ ‡å¿—ä½ã€‚åœ¨æ•°æ®ä¸²æ“ä½œæ—¶ç¡®å®šæ“ä½œçš„æ–¹å‘ IF=1ï¼Œå…è®¸å“åº”å¯å±è”½ä¸­æ–­è¯·æ±‚ï¼Œå¯¹åº”æŒ‡ä»¤ï¼šSTI IF=0ï¼Œç¦æ­¢å“åº”å¯å±è”½ä¸­æ–­è¯·æ±‚ï¼Œå¯¹åº”æŒ‡ä»¤ï¼šCLI\nDF=0ï¼Œä¸²æ“ä½œæŒ‡ä»¤ä¸­çš„åœ°å€æ˜¯å¢åŠ æ–¹å‘ï¼Œå¯¹åº”æŒ‡ä»¤ï¼šCLD DF=1ï¼Œä¸²æ“ä½œæŒ‡ä»¤ä¸­çš„åœ°å€æ˜¯å‡å°‘æ–¹å‘ï¼Œå¯¹åº”æŒ‡ä»¤ï¼šSTD\nTF=1ï¼ŒCPUæŒ‰è·Ÿè¸ªæ–¹å¼ï¼ˆå•æ­¥æ–¹å¼ï¼‰æ‰§è¡Œç¨‹åº\n8088å¤–éƒ¨å¼•è„šåŠå…¶åŠŸèƒ½ æœ€å°æ¨¡å¼ä¸‹çš„å¼•è„šæè¿°\næŒ‰åŠŸèƒ½å¯¹å¼•è„šè¿›è¡Œåˆ’åˆ†ï¼š\nåŸºç¡€å·¥ä½œå¼•è„šï¼š$Vcc,GND,CLK(4.77Mhz)$ åœ°å€æ€»çº¿ï¼š${AD}0-{AD}7,A_8-A{15},A{16}-A_{19}$ æ•°æ®æ€»çº¿ï¼š${AD}_0-{AD}_7$ æ¨¡å¼æ§åˆ¶å¼•è„šï¼š$MN/\\overline{MX}$ è¯»å†™æ§åˆ¶å¼•è„šï¼š$IO/\\overline M,\\overline{RD},\\overline{WR}$ ä¸­æ–­æ§åˆ¶å¼•è„šï¼š$INTR,NMI,INTA$ å¤ä½ï¼š$RESET$ æ€»çº¿ä¿æŒè¯·æ±‚/å“åº”ï¼š$HOLD,HLDA$ åœ°å€é”å­˜ä¿¡å·ï¼š$ALE$ å¤–éƒ¨å°±ç»ªä¿¡å·ï¼š$READY$ æµ‹è¯•ä¿¡å·è¾“å…¥ï¼š$\\overline {TEST}$ æ•°æ®ä¼ è¾“æ–¹å‘æ§åˆ¶ï¼š$DT/\\overline R$ æ•°æ®å…è®¸ä¿¡å·ï¼š$\\overline {DEN}$ ç³»ç»ŸçŠ¶æ€è¾“å‡ºï¼š$\\overline{{SS}_0}$ï¼ˆä¸$IO/\\overline M,DT/\\overline R$åˆä½œï¼‰ å„å¼•è„šå…·ä½“åŠŸèƒ½ $A_{16}-A_{19}/S_3-S_6$ï¼šåœ°å€ï¼ŒçŠ¶æ€å¤ç”¨çš„å¼•è„šï¼Œä¸‰æ€è¾“å‡ºã€‚ï¼ˆåˆ†æ—¶å¤ç”¨ï¼‰çŠ¶æ€ä¿¡å·ä¸­$S_6$æ’ç­‰äº0ï¼Œ$S_5$æŒ‡ç¤ºä¸­æ–­å…è®¸æ ‡å¿—ä½$IF$çš„çŠ¶æ€ï¼Œ$S_4,S_5$ç»„åˆæŒ‡ç¤ºCPUæ­£åœ¨ä½¿ç”¨çš„æ®µå¯„å­˜å™¨\n$A_8-A_{15}$ï¼š8ä½åœ°å€ä¿¡å·ï¼Œä¸‰æ€è¾“å‡º\n${AD}{0}-{AD}{7}$ï¼šåœ°å€ï¼Œæ•°æ®åˆ†æ—¶å¤ç”¨çš„åŒå‘ä¿¡å·çº¿ï¼Œä¸‰æ€ã€‚å½“$ALE=1$æ—¶ï¼Œè¿™äº›å¼•è„šä¸Šä¼ è¾“çš„æ˜¯åœ°å€ä¿¡å·ï¼Œå½“$\\overline {DEN}=0$æ—¶ï¼Œè¿™äº›å¼•è„šä¸Šä¼ è¾“çš„æ˜¯æ•°æ®ä¿¡å·\n$IO/\\overline M$ï¼šè¾“å…¥è¾“å‡º/å­˜å‚¨å™¨æ§åˆ¶ä¿¡å·ï¼Œä¸‰æ€ã€‚è¯¥å¼•è„šæ˜¯ç”¨æ¥åŒºåˆ†å½“å‰æ“ä½œæ˜¯è®¿é—®å­˜å‚¨å™¨è¿˜æ˜¯è®¿é—®$IO$ç«¯å£\n$\\overline {WR}$ï¼šå†™ä¿¡å·è¾“å‡ºï¼Œä¸‰æ€ã€‚å½“æ­¤å¼•è„šè¾“å‡ºä¸ºä½ç”µå¹³æ—¶ï¼Œè¡¨ç¤ºCPUæ­£åœ¨å¯¹å­˜å‚¨å™¨æˆ–IOç«¯å£è¿›è¡Œå†™æ“ä½œ\n$DT/\\overline {R}$ï¼šæ•°æ®ä¼ é€æ–¹å‘æ§åˆ¶ä¿¡å·ï¼Œä¸‰æ€ã€‚é«˜ç”µå¹³æ—¶ï¼ŒCPUå‘å­˜å‚¨å™¨æˆ–IOç«¯å£å‘é€æ•°æ®ï¼›ä½ç”µå¹³æ—¶ï¼ŒCPUä»å­˜å‚¨å™¨æˆ–IOæ¥å£æ¥æ”¶æ•°æ®\n$\\overline {DEN}$ï¼šæ•°æ®å…è®¸ä¿¡å·ï¼Œä¸‰æ€ã€‚è¯¥ä¿¡å·æœ‰æ•ˆæ—¶ï¼Œè¡¨ç¤º æ•°æ®æ€»çº¿ ä¸Šå…·æœ‰æœ‰æ•ˆä¿¡å·ã€‚å®ƒåœ¨æ¯æ¬¡ è®¿é—®å†…å­˜æˆ–IOæ¥å£ä»¥åŠåœ¨ä¸­æ–­å“åº”æœŸé—´æœ‰æ•ˆï¼Œå¸¸ç”¨ä½œæ•°æ®æ€»çº¿é©±åŠ¨ä¿¡å·\n$ALE$ï¼šåœ°å€é”å­˜ä¿¡å·ï¼Œä¸‰æ€è¾“å‡ºï¼Œé«˜ç”µå¹³æœ‰æ•ˆã€‚å®ƒä¸ºé«˜ç”µå¹³æ—¶ï¼Œè¡¨ç¤ºCPUåœ°å€çº¿ä¸Šæœ‰æœ‰æ•ˆåœ°å€\n$\\overline {RD}$ï¼šè¯»é€‰é€šä¿¡å·ï¼Œä¸‰æ€è¾“å‡ºï¼Œä½ç”µå¹³æœ‰æ•ˆã€‚å…¶æœ‰æ•ˆæ—¶ï¼Œè¡¨ç¤ºCPUæ­£åœ¨å¯¹å­˜å‚¨å™¨æˆ–IOæ¥å£è¿›è¡Œè¯»æ“ä½œ\n$READY$ï¼šå¤–éƒ¨åŒæ­¥æ§åˆ¶è¾“å…¥ä¿¡å·ï¼Œé«˜ç”µå¹³æœ‰æ•ˆã€‚å®ƒæ˜¯ç”±è¢«è®¿é—®çš„å†…å­˜æˆ–IOè®¾å¤‡æ‰€å‘å‡ºçš„å“åº”ä¿¡å·ã€‚å®ƒä¸ºé«˜ç”µå¹³æ—¶ï¼Œè¡¨ç¤ºå­˜å‚¨å™¨æˆ–IOè®¾å¤‡å·²ç»å‡†å¤‡å¥½ï¼ŒCPUå¯ä»¥è¿›è¡Œæ•°æ®ä¼ é€ ã€‚CPUåœ¨T3çš„å‘¨æœŸé‡‡æ ·$READY$ä¿¡å·ï¼Œè‹¥å…¶ä¸ºä½ï¼ŒCPUè‡ªåŠ¨æ’å…¥ç­‰å¾…å‘¨æœŸ$T_w$\n$INTR$ ï¼šå¯å±è”½ä¸­æ–­è¯·æ±‚è¾“å…¥ä¿¡å·ï¼Œé«˜ç”µå¹³æœ‰æ•ˆã€‚CPUåœ¨æ¯æ¡æŒ‡ä»¤çš„æœ€åä¸€ä¸ªå‘¨æœŸé‡‡æ ·è¯¥ä¿¡å·ï¼Œä»¥å†³å®šæ˜¯å¦è¿›å…¥ä¸­æ–­å“åº”å‘¨æœŸ\n$\\overline {TEST}$ï¼šæµ‹è¯•ä¿¡å·è¾“å…¥å¼•è„š\n$NMI$ï¼šéå±è”½ä¸­æ–­è¯·æ±‚è¾“å…¥ä¿¡å·ï¼Œä¸Šå‡æ²¿è§¦å‘ã€‚è¿™ä¸ªå¼•è„šä¸Šçš„ä¸­æ–­è¯·æ±‚ä¿¡å·ä¸èƒ½ç”¨è®©è½¯ä»¶å±è”½ï¼ŒCPUåœ¨å½“å‰æŒ‡ä»¤\n$RESET$ï¼šç³»ç»Ÿå¤ä½è¾“å…¥ä¿¡å·ï¼Œé«˜ç”µå¹³æœ‰æ•ˆã€‚\n$\\overline {INTA}$ï¼šä¸­æ–­å“åº”ä¿¡å·è¾“å‡ºï¼Œä½ç”µå¹³æœ‰æ•ˆï¼Œæ­¤ä¿¡å·æ˜¯CPUå¯¹ä¸­æ–­è¯·æ±‚ä¿¡å·$INTR$ çš„å“åº”ã€‚ åœ¨å“åº”è¿‡ç¨‹ä¸­ï¼ŒCPUåœ¨$\\overline {INTA}$ä¸Šè¿ç»­è¾“å‡ºä¸¤ä¸ªè´Ÿè„‰å†²ç”¨ä½œå¤–éƒ¨ä¸­æ–­çš„ä¸­æ–­å‘é‡ç çš„è¯»é€‰é€šä¿¡å·\n$HOLD$ï¼šæ€»çº¿ä¿æŒè¯·æ±‚ä¿¡å·è¾“å…¥ï¼Œé«˜ç”µå¹³æœ‰æ•ˆã€‚å½“æŸä¸€æ€»çº¿ä¸»æ§è®¾å¤‡è¦å ç”¨ç³»ç»Ÿæ€»çº¿æ—¶ï¼Œé€šè¿‡æ­¤å¼•è„šå‘CPUæå‡ºè¯·æ±‚\n$HLDA$ï¼šæ€»çº¿ä¿æŒå“åº”ä¿¡å·è¾“å‡ºï¼Œé«˜ç”µå¹³æœ‰æ•ˆã€‚è¿™æ˜¯CPUå¯¹$HOLD$è¯·æ±‚çš„å“åº”ä¿¡å·ã€‚CPUæ”¶åˆ°$HOLD$ä¿¡å·åï¼Œå°±ä¼šå¯¹å…¶åšå‡ºå“åº”ï¼Œä¸€æ–¹é¢ä¼šä½¿CPUçš„æ‰€æœ‰ä¸‰æ€è¾“å‡ºçš„åœ°å€ä¿¡å·ï¼Œæ•°æ®ä¿¡å·å’Œå¯¹åº”çš„æ§åˆ¶ä¿¡å·å˜ä¸ºé«˜é˜»æ€ï¼›åŒæ—¶è¾“å‡ºä¸€ä¸ªæœ‰æ•ˆçš„$HLDA$ï¼Œè¡¨ç¤ºCPUå·²æ”¾å¼ƒå¯¹æ€»çº¿çš„æ§åˆ¶ã€‚å½“CPUæ£€æµ‹åˆ°$HOLD$ä¿¡å·å˜ä½åï¼Œå°±ç«‹å³ä½¿$HLDA$å˜ä½ï¼ŒåŒæ—¶æ¢å¤å¯¹æ€»çº¿çš„æ§åˆ¶\n${SS}_0$ï¼šç³»ç»ŸçŠ¶æ€ä¿¡å·è¾“å‡º\n$CLK$ï¼š æ—¶é’Ÿä¿¡å·è¾“å…¥å¼•è„š\n$Vcc$ï¼š5Vç”µæºè¾“å…¥å¼•è„š\n$GND$ï¼šåœ°çº¿\n8088/8086ç»“æ„åŠŸèƒ½ å¤–éƒ¨ç»“æ„ æ€»çº¿ æ€»çº¿å®šä¹‰ æ€»çº¿æ˜¯ä¼ è¾“ä¿¡å·æˆ–ä¿¡æ¯çš„å…¬å…±è·¯å¾„ï¼Œæ˜¯éµå¾ªåŒä¸€æŠ€æœ¯è§„èŒƒçš„è¿æ¥ä¸æ“ä½œæ–¹å¼\næ€»çº¿ç‰¹ç‚¹ å…¬å…±æ€§ï¼Œå¯åŒæ—¶æŒ‚åœ¨å¤šä¸ªè®¾å¤‡\næ€»çº¿åˆ†ç±» æŒ‰ä¼ é€çš„ä¿¡æ¯ç±»å‹åˆ†ç±»\næ•°æ®æ€»çº¿ï¼ˆData Busï¼‰ åœ°å€æ€»çº¿ï¼ˆAddress Busï¼‰ æ§åˆ¶æ€»çº¿ï¼ˆControl Busï¼‰ æŒ‰æ€»çº¿çš„å±‚æ¬¡ç»“æ„åˆ’åˆ†\nå‰ç«¯æ€»çº¿ ç³»ç»Ÿæ€»çº¿ å¤–è®¾æ€»çº¿ æ€»çº¿ç»“æ„ å•æ€»çº¿ç»“æ„ï¼Œå¤šæ€»çº¿ç»“æ„\næ€»çº¿åŸºæœ¬åŠŸèƒ½ æ€»çº¿ä¸Šä»»æ„æ—¶åˆ»åªèƒ½å…è®¸ä¸€å¯¹è®¾å¤‡è¿›è¡Œä¿¡æ¯äº¤æ¢\næ€»çº¿ä¼ è¾“åŒæ­¥ï¼šåè°ƒé€šä¿¡åŒæ–¹çš„ä¼ è¾“æ“ä½œ æ€»çº¿ä»²è£æ§åˆ¶ï¼šé¿å…å¤šä¸ªè®¾å¤‡åŒæ—¶ä½¿ç”¨æ€»çº¿é€ æˆçš„å†²çªï¼Œç¡®å®šæ€»çº¿ä¸Šå“ªä¸ªè®¾å¤‡å¯ä»¥å ç”¨æ€»çº¿ä¼ è¾“æ•°æ® å‡ºé”™å¤„ç†ï¼šæ£€é”™å’Œå¤„ç† æ€»çº¿é©±åŠ¨ï¼šå¢åŠ é©±åŠ¨èƒ½åŠ› æ€»çº¿çš„æ•°æ®ä¼ é€ 1.åŒæ­¥å®šæ—¶çš„ä¼ è¾“æ–¹å¼ ç”¨å…¬å…±çš„æ—¶é’Ÿç»Ÿä¸€å„éƒ¨ä»¶æ•°æ®å‘é€å’Œæ¥æ”¶çš„æ—¶æœº ï¼ˆä¸¥æ ¼æŒ‰èŠ‚æ‹è¿›è¡Œï¼Œä¸éœ€è¦æ¡æ‰‹ä¿¡å·ï¼Œæ•ˆç‡é«˜ï¼‰\n2.å¼‚æ­¥å®šæ—¶çš„ä¼ è¾“æ–¹å¼ ç”¨æ§åˆ¶å’ŒçŠ¶æ€ä¿¡å·åè°ƒå„éƒ¨ä»¶æ•°æ®å‘é€å’Œæ¥æ”¶çš„æ—¶æœºï¼ˆåº”ç­”å¼ï¼‰\n3.åŠåŒæ­¥å®šæ—¶çš„ä¼ è¾“æ–¹å¼ å…è®¸ä¸åŒé€Ÿåº¦çš„éƒ¨ä»¶ååŒå·¥ä½œï¼Œä¸»æ§è®¾å¤‡å¯ä»¥æ ¹æ®ä»è®¾å¤‡çš„çŠ¶æ€å»¶é•¿æ€»çº¿ æ—¶é’Ÿå‘¨æœŸï¼Œä½†æ€»çº¿å‘¨æœŸä¸€å®šæ˜¯æ—¶é’Ÿå‘¨æœŸçš„æ•´æ•°å€\nå¸¸ç”¨ç³»ç»Ÿæ€»çº¿å’Œå¤–è®¾æ€»çº¿æ ‡å‡† å¸¸ç”¨çš„ç³»ç»Ÿæ€»çº¿æ ‡å‡†åŒ…æ‹¬ï¼šISA æ€»çº¿ã€PCI æ€»çº¿ã€PCIE æ€»çº¿ã€AGP æ€»çº¿ å¸¸ç”¨çš„å¤–è®¾æ€»çº¿æ ‡å‡†åŒ…æ‹¬ï¼šSATA æ€»çº¿ã€USB æ€»çº¿ã€RS485 æ€»çº¿ã€IDE æ€»çº¿ã€RS232 æ€»çº¿\næŒ‡ä»¤ç³»ç»Ÿ æŒ‡ä»¤ï¼šæ§åˆ¶è®¡ç®—æœºå®ŒæˆæŒ‡å®šæ“ä½œå¹¶èƒ½å¤Ÿè¢«è®¡ç®—æœºæ‰€è¯†åˆ«çš„å‘½ä»¤ã€‚ æŒ‡ä»¤ç³»ç»Ÿï¼šä¸€å°è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„æ‰€æœ‰æŒ‡ä»¤çš„é›†åˆç§°ä¸ºè¯¥æœºçš„æŒ‡ä»¤ç³»ç»Ÿ\næŒ‡ä»¤æ ¼å¼ï¼š æ“ä½œç  æ“ä½œæ•°1ï¼Œæ“ä½œæ•°2 æ“ä½œæ•°æ•°é‡ï¼šé›¶æ“ä½œæ•°æŒ‡ä»¤ï¼Œå•æ“ä½œæ•°æŒ‡ä»¤ï¼ŒåŒæ“ä½œæ•°æŒ‡ä»¤\næŒ‡ä»¤ä¸­æ“ä½œæ•°ç±»å‹ï¼šç«‹å³æ“ä½œæ•°ï¼Œå¯„å­˜å™¨æ“ä½œæ•°ï¼Œå­˜å‚¨å™¨æ“ä½œæ•° å¯„å­˜å™¨æ“ä½œæ•°çš„æŒ‡ä»¤æ‰§è¡Œé€Ÿåº¦\u0026gt; ç«‹å³æ•°æ“ä½œæ•°\u0026gt; å­˜å‚¨å™¨æ“ä½œæ•°\nCISCï¼ˆComplex Instruction Set Computerï¼‰ï¼Œå¤æ‚æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—æœº RISCï¼ˆReduced Instruction Set Computerï¼‰ï¼Œç²¾ç®€æŒ‡ä»¤ç³»ç»Ÿè®¡ç®—æœº\næŒ‡ä»¤æ€§æŒ‡ä»¤æ˜¯CPUä¸­å®é™…å­˜åœ¨çš„å¯æ‰§è¡Œçš„è¯­å¥ã€‚æŒ‡ç¤ºæ€§è¯­å¥æ˜¯ç”¨äºè¯´æ˜ç¨‹åºç»“æ„ï¼Œå˜é‡ç­‰çš„è¯­å¥ï¼Œåè€…åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­æ‰§è¡Œï¼Œç¼–è¯‘å®Œæˆåä¸å†å­˜åœ¨\nå¯¹äºæ¯ä¸ªæŒ‡ä»¤ æŒ‡ä»¤ç çš„å«ä¹‰ æŒ‡ä»¤å¯¹æ“ä½œæ•°çš„è¦æ±‚ æŒ‡ä»¤å¯¹æ ‡å¿—ä½çš„å½±å“ æŒ‡ä»¤çš„åŠŸèƒ½ å¯»å€æ–¹å¼ ç«‹å³å¯»å€ï¼ˆImmediate Addressingï¼‰ æºæ“ä½œæ•°æ˜¯ç«‹å³æ•°ï¼Œç«‹å³æ•°å­˜æ”¾åœ¨ä»£ç æ®µ MOV AX,3102H\nç›´æ¥å¯»å€ï¼ˆDirect Addressingï¼‰ æ“ä½œæ•°æ˜¯å­˜å‚¨å™¨æ“ä½œæ•°ï¼Œå­˜æ”¾çš„åœ°å€ç”±æŒ‡ä»¤ç›´æ¥ç»™å‡º MOV AX,[3102H]\nå¯„å­˜å™¨å¯»å€ï¼ˆRegister Addressingï¼‰ æ“ä½œæ•°ä¸ºCPUå†…éƒ¨å¯„å­˜å™¨ MOV AX,BX\nå¯„å­˜å™¨é—´æ¥å¯»å€ï¼ˆRegister Indirect Addressingï¼‰ å¯„å­˜å™¨å­˜æ”¾çš„ä¸æ˜¯æ•°æ®æœ¬èº«ï¼Œè€Œæ˜¯å­˜æ”¾æ•°æ®çš„åç§»åœ°å€ å¯„å­˜å™¨é—´æ¥å¯»å€æ–¹å¼ä¸­ å­˜æ”¾æ“ä½œæ•°åç§»åœ°å€ çš„å¯„å­˜å™¨åªå…è®¸æ˜¯ $SI,DI,BX,BP$ï¼Œå®ƒä»¬ä¹Ÿè¢«ç§°ä¸ºé—´å€å¯„å­˜å™¨\né€‰æ‹©$SI,DI,BX$ä½œä¸ºé—´å€å¯„å­˜å™¨æ—¶ï¼Œæ“ä½œæ•°åœ¨æ•°æ®æ®µï¼Œæ®µåŸºå€ç”±$DS$å†³å®š é€‰æ‹©$BP$ä½œä¸ºé—´å€å¯„å­˜å™¨ï¼Œåˆ™æ“ä½œæ•°åœ¨å †æ ˆæ®µï¼Œæ®µåŸºåœ°å€ç”±$SS$å†³å®š å…è®¸æ®µé‡è®¾ MOV AX,[BX] MOV AX,ES:[SI] å¯„å­˜å™¨ç›¸å¯¹å¯»å€ æ“ä½œæ•°åœ¨å†…å­˜ä¸­çš„åå€åœ°å€ç”±é—´å€å¯„å­˜å™¨çš„å€¼åŠ ä¸Šä¸€ä¸ª8ä½æˆ–16ä½çš„åç§»é‡ MOV AX,DATA[BX] MOV AX,[BX+DATA]\nåŸºå€-å˜å€å¯»å€ åŸºå€-å˜å€å¯»å€æ–¹å¼ç”±ä¸€ä¸ªåŸºå€å¯„å­˜å™¨å­˜çš„å€¼å’Œä¸€ä¸ªå˜å€å¯„å­˜å™¨å­˜çš„å€¼ ç›¸åŠ å¾—åˆ°åç§»åœ°å€\nä¸å…è®¸å‡ºç°ä¸¤ä¸ªåŸºå€å¯„å­˜å™¨ ä¸å…è®¸å‡ºç°ä¸¤ä¸ªå˜å€å¯„å­˜å™¨ MOV AX,[BX][SI] MOV AX,[SI][BX] MOV AX,[BX+SI] åŸºå€-å˜å€-ç›¸å¯¹å¯»å€ æ‰€å¯»åœ°å€åœ¨å†…å­˜ä¸­ï¼Œåç§»åœ°å€ç”±ä¸€ä¸ªåŸºå€å¯„å­˜å™¨ã€ä¸€ä¸ªå˜å€å¯„å­˜å™¨å’Œæ•°å€¼åç§» é‡ç›¸åŠ ç»™å‡ºã€‚å…¶å®ƒè§„å®šåŒâ€œåŸºå€-å˜å€å¯»å€â€ MOV AX,DATA[SI][BX] MOV AX,[BX+DATA][SI] MOV AX,[BX+SI+DATA] MOV AX,[BX+SI]DATA MOV AX,[BX]DATA[SI]\néšå«å¯»å€ æŒ‡ä»¤ä¸­éšå«äº†éƒ¨åˆ†å›ºå®šçš„æ“ä½œæ•°çš„åœ°å€ MUL BL æŠŠALä¸BLç›¸ä¹˜çš„ä¹˜ç§¯æ”¾å…¥AX\nå †æ ˆæ®µ è§„å®šç”±SSæŒ‡ç¤ºå †æ ˆæ®µçš„æ®µåŸºå€ï¼Œå †æ ˆçš„æœ€ä½åœ°å€ å †æ ˆæŒ‡é’ˆSPå§‹ç»ˆæŒ‡å‘å †æ ˆçš„é¡¶éƒ¨ï¼ˆæ ˆé¡¶ï¼‰ã€‚å †æ ˆçš„æœ€é«˜åœ°å€å«æ ˆåº• æ ˆçš„å‹å…¥æŒ‡ä»¤ PUSH src æ ˆçš„å¼¹å‡ºæŒ‡ä»¤ POP dest\næ“ä½œåŸåˆ™\næ“ä½œæ•°ä¸º1ä¸ªå­—ï¼Œä¸”åªèƒ½æ˜¯å¯„å­˜å™¨æˆ–å­˜å‚¨å™¨æ“ä½œ å­˜æ”¾æ•°æ®ä»é«˜åœ°å€å‘ä½åœ°å€æ–¹å‘å¢é•¿ å †æ ˆæ®µä½ç½®ç”±SSå†³å®šï¼ŒSPæŒ‡å‘æ ˆé¡¶ PUSHå‹å…¥è¿‡ç¨‹ä¸ºå…ˆå‡SPå†å‹æ•°æ® 1 2 3 SP-2 -\u0026gt; SP srcé«˜8ä½-\u0026gt;[SP+1] srcä½8ä½-\u0026gt;[SP] POPå¼¹å‡ºè¿‡ç¨‹ä¸ºå…ˆå¼¹æ•°æ®å†åŠ SP 1 2 3 [SP]-\u0026gt;destä½8ä½ [SP+1]-\u0026gt;desté«˜8ä½ SP+2-\u0026gt;SP å †æ ˆä¸»è¦ç”¨é€”ï¼šä¿æŠ¤ç°åœº\næ•°æ®ä¼ é€æŒ‡ä»¤ æ•°æ®ä¼ é€æŒ‡ä»¤çš„æ‰§è¡Œå‡ä¸å½±å“æ ‡å¿—ä½\nä¸€èˆ¬ä¼ é€æŒ‡ä»¤MOV MOV dest,src å¯¹æ“ä½œæ•°è¦æ±‚ï¼š\nä¸¤ä¸ªæ“ä½œæ•°å­—é•¿ç›¸åŒ ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½åŒæ—¶ä¸ºå­˜å‚¨å™¨æ“ä½œæ•° ä¸èƒ½ç”¨ç«‹å³æ•°ç›´æ¥ç»™æ®µå¯„å­˜å™¨èµ‹å€¼ ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½åŒæ—¶ä¸ºæ®µå¯„å­˜å™¨ IPå’ŒCSåªä½œä¸ºMOVçš„æºæ“ä½œæ•°ï¼Œä¸åšç›®æ ‡æ“ä½œæ•° FLAGSæ•´ä½“ä¸èƒ½ä½œä¸ºæ“ä½œæ•° ä¸¤ä¸ªæ“ä½œæ•°ä¸èƒ½åŒæ—¶ä¸ºå­˜å‚¨å™¨æ“ä½œæ•°ï¼ŒåŸå› æ˜¯å­˜å‚¨å™¨ä¸èƒ½ç¡®å®šå­—é•¿ï¼Œæ˜¯åœ¨å­˜å‚¨å™¨ä¸­å–1ä¸ªå­—èŠ‚è¿˜æ˜¯å¤šä¸ªå­—èŠ‚ï¼Œæ²¡æœ‰é™å®š\nå †æ ˆæ“ä½œæŒ‡ä»¤PUSHå’ŒPOP PUSH src POP dest æ“ä½œæ•°ä¸º1ä¸ªå­—ï¼Œä¸”åªèƒ½æ˜¯å¯„å­˜å™¨æˆ–å­˜å‚¨å™¨æ“ä½œï¼Œä¸èƒ½æ˜¯ç«‹å³æ•°\näº¤æ¢æŒ‡ä»¤XCHG åŠŸèƒ½ï¼šäº¤æ¢æºåœ°å€ä¸ç›®æ ‡åœ°å€ä¸­çš„å†…å®¹ XCHG OPRD1,OPRD2\nè¾“å…¥/è¾“å‡ºæŒ‡ä»¤INå’ŒOUT åŠŸèƒ½ï¼šå¯¹è¾“å…¥/è¾“å‡ºç«¯å£è¿›è¡Œè¯»å†™ è¾“å…¥æŒ‡ä»¤INç”¨äºä»IOç«¯å£è¯»æ•°æ®åˆ°ç´¯åŠ å™¨ALï¼ˆAXï¼‰ä¸­ è¾“å‡ºæŒ‡ä»¤OUTç”¨äºæŠŠç´¯åŠ å™¨ALï¼ˆAXï¼‰çš„å†…å®¹å†™åˆ°IOç«¯å£ IOç«¯å£å¯»å€\nç›´æ¥å¯»å€ï¼šæŒ‡ä»¤ä¸­çš„IOç«¯å£åœ°å€ä¸º8ä½ 1 2 IN AL/AX,port OUT port,AL/AX å¯„å­˜å™¨é—´æ¥å¯»å€ï¼šç«¯å£åœ°å€ä¸º16ä½ï¼Œç”±DXå¯„å­˜å™¨æŒ‡å®š 1 2 IN AL/AX,DX OUT DX,AL/AX æ“ä½œåŸåˆ™\nåªæœ‰ALæˆ–AXå¯ä»¥ä¸I/Oç«¯å£è¿›è¡Œæ•°æ®äº¤æ¢ IOç«¯å£åœ°å€å¯ä»¥æ˜¯8ä½ç«‹å³æ•°æŒ‡å‘çš„åœ°å€ï¼ˆå³ç›´æ¥å¯»å€ï¼‰æˆ–ç”±DXä¿å­˜çš„16 ä½åœ°å€ï¼ˆå³é—´æ¥å¯»å€ï¼‰ å½“ç«¯å£åœ°å€æ˜¯16ä½æ—¶ï¼Œåªèƒ½ç”¨DXå–ç»™å®šç«¯å£åœ°å€ å–åç§»åœ°å€æŒ‡ä»¤LEA ï¼ˆLoad Effect Addressï¼‰ åŠŸèƒ½ï¼šå°†å­˜å‚¨å™¨æ“ä½œæ•°çš„16ä½åç§»åœ°å€é€åˆ°æŒ‡å®šå¯„å­˜å™¨ LEA reg16, mem æ“ä½œåŸåˆ™\næºæ“ä½œæ•°å¿…é¡»æ˜¯å­˜å‚¨å™¨æ“ä½œæ•°ï¼Œå¦‚ï¼š LEA BX, BUFFER LEA BX, [SI] ç›®æ ‡æ“ä½œæ•°å¿…é¡»æ˜¯16ä½é€šç”¨å¯„å­˜å™¨ï¼Œæœ€å¥½ä½¿ç”¨é—´å€å¯„å­˜å™¨ï¼ˆBX, SI, DI, BPï¼‰ æºæ“ä½œæ•°å¿…é¡»æ˜¯å­˜å‚¨å™¨æ“ä½œæ•° ç®—æ•°è¿ç®—æŒ‡ä»¤ ä¸å¸¦è¿›ä½å’Œå¸¦è¿›ä½çš„åŠ å‡æŒ‡ä»¤ æ— ç¬¦å·å’Œæœ‰ç¬¦å·çš„ä¹˜é™¤æŒ‡ä»¤\nç®—æœ¯è¿ç®—æŒ‡ä»¤çš„æ‰§è¡Œä¼šå½±å“çŠ¶æ€æ ‡å¿—ä½ ä¹˜æ³•æŒ‡ä»¤æ‰§è¡Œç»“æœä¸ºç›¸ä¹˜æ•°çš„åŒå€å­—é•¿ é™¤æ³•æŒ‡ä»¤è¢«é™¤æ•°æ˜¯é™¤æ•°çš„åŒå€å­—é•¿\nä¹˜æ³•æŒ‡ä»¤ ä¹˜æ³•æŒ‡ä»¤é‡‡ç”¨éšå«å¯»å€ï¼Œéšå«äº†å­˜æ”¾è¢«ä¹˜æ•°çš„ç´¯åŠ å™¨ALæˆ–AXï¼Œä»¥åŠå­˜æ”¾ç»“æœçš„AXæˆ–AXï¼ŒDX\næ— ç¬¦å·ä¹˜æ³•æŒ‡ä»¤ MUL BYTE PTR[BX] æœ‰ç¬¦å·ä¹˜æ³•æŒ‡ä»¤ IMUL OPRD\né™¤æ³•æŒ‡ä»¤ DIV OPRD å¦‚æœ$OPRD$æ˜¯å•å­—èŠ‚æ•° æ„æ€æ˜¯$AX/OPRD$ ç»“æœï¼šAL=å•†ï¼ŒAH=ä½™æ•° å¦‚æœ$OPRD$æ˜¯åŒå­—èŠ‚æ•° æ„æ€æ˜¯$DX,AX/OPRD$ ç»“æœï¼šAX=å•†ï¼ŒDX=ä½™æ•°\nç®—æ•°ç§»ä½æŒ‡ä»¤ éå¾ªç¯ç§»ä½ ç®—æ•°ç§»ä½ï¼Œé€»è¾‘ç§»ä½ å·¦ç§»ï¼Œå³ç§»\nå¾ªç¯ç§»ä½ åˆ†ä¸ºå¸¦è¿›ä½ç§»ä½å’Œä¸å¸¦è¿›ä½ç§»ä½\nå­˜å‚¨å™¨ RAMï¼ˆRandom-Acess Memoryï¼‰ä¸€èˆ¬å¯åˆ†ä¸ºSRAMï¼ˆé™æ€RAMï¼‰ï¼ŒDRAMï¼ˆåŠ¨æ€RAMï¼‰ ROMï¼ˆRead Only Memoryï¼‰ä¸€èˆ¬å¯åˆ†ä¸º æ©è†œROMï¼Œä¸€æ¬¡æ€§å¯å†™ROMï¼ŒEPROMï¼ŒEEPROMï¼Œé—ªé€Ÿå­˜å‚¨å™¨Flash\né«˜ä½åœ°å€ï¼Œé€‰é€šèŠ¯ç‰‡ ä½ä½åœ°å€ï¼Œé€‰èŠ¯ç‰‡çš„è¯»å†™å•å…ƒ\nè¯‘ç ï¼Œå°†è¾“å…¥çš„ä¸€ç»„é«˜ä½åœ°å€ä¿¡å·é€šè¿‡å˜æ¢ï¼Œäº§ç”Ÿä¸€ä¸ªæœ‰æ•ˆçš„è¾“å‡ºä¿¡å·ï¼Œç”¨äºé€‰ä¸­æŸä¸€ä¸ªå­˜å‚¨å™¨èŠ¯ç‰‡ï¼Œä»è€Œç¡®å®šäº†è¯¥å­˜å‚¨å™¨èŠ¯ç‰‡åœ¨å†…å­˜çš„åœ°å€èŒƒå›´\nå…¨åœ°å€è¯‘ç  ç”¨å…¨éƒ¨é«˜ä½åœ°å€ä¿¡å·ä½œä¸ºè¯‘ç ä¿¡å·ï¼Œä½¿å¾—å­˜å‚¨å™¨èŠ¯ç‰‡çš„æ¯ä¸€ä¸ªå•å…ƒéƒ½å æ®ä¸€ä¸ªå”¯ä¸€çš„å†…å­˜åœ°å€ éƒ¨åˆ†åœ°å€è¯‘ç  ç”¨éƒ¨åˆ†é«˜ä½åœ°å€ä¿¡å·ä½œä¸ºè¯‘ç ä¿¡å·ï¼Œä½¿å¾—è¢«é€‰ä¸­å­˜å‚¨å™¨èŠ¯ç‰‡å æœ‰å‡ ç»„ä¸åŒçš„åœ°å€èŒƒå›´\nCacheé«˜é€Ÿç¼“å†²å™¨ Cacheé«˜é€Ÿç¼“å†²å­˜å‚¨å™¨ï¼ŒCacheæ˜¯æ„æˆå†…å­˜å‚¨å™¨çš„éƒ¨ä»¶ä¹‹ä¸€ï¼Œè®¾ç½®Cahceçš„åŸå› æ˜¯å†…å­˜çš„é€Ÿåº¦ä¸å¤„ç†å™¨çš„å·¥ä½œé€Ÿåº¦ä¸åŒ¹é…\nå¾®æœºä¸­çš„å­˜å‚¨å™¨ç³»ç»Ÿ\nCacheå­˜å‚¨å™¨ç³»ç»Ÿ è™šæ‹Ÿå­˜å‚¨å™¨ç³»ç»Ÿ Cacheå­˜å‚¨ç³»ç»Ÿ Cacheå­˜å‚¨ç³»ç»Ÿä¸»è¦æœ‰Cacheé«˜é€Ÿç¼“å†²å™¨å’Œä¸»å†…å­˜æ„æˆï¼Œæœ‰ç¡¬ä»¶ç³»ç»Ÿè´Ÿè´£ç®¡ç† IOç³»ç»Ÿ è¾“å…¥è¾“å‡ºç³»ç»Ÿ åœ¨è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œé€šå¸¸æŠŠå¤„ç†å™¨å’Œä¸»å­˜å‚¨å™¨ä¹‹å¤–çš„éƒ¨åˆ†ç»Ÿç§°ä¸ºè¾“å…¥/è¾“å‡ºç³»ç»Ÿï¼Œ åŒ…æ‹¬è¾“å…¥/è¾“å‡ºè®¾å¤‡ã€è¾“å…¥/è¾“å‡ºæ¥å£å’Œè¾“å…¥/è¾“å‡ºè½¯ä»¶\nIOæ¥å£ IOæ¥å£å°±æ˜¯å¤–è®¾è¿æ¥åˆ°ç³»ç»Ÿæ€»çº¿ä¸Šçš„ä¸€ç»„é€»è¾‘ç”µè·¯çš„æ€»ç§°\nIOç«¯å£ ç«¯å£æ˜¯æ¥å£ç”µè·¯ä¸­ç”¨äºç¼“å­˜æ•°æ®åŠæ§åˆ¶ä¿¡æ¯çš„éƒ¨ä»¶ CPUä¸I/Oæ¥å£è¿›è¡Œé€šä¿¡å®é™…ä¸Šæ˜¯é€šè¿‡I/Oæ¥å£å†…éƒ¨çš„ä¸€ç»„å¯„å­˜å™¨å®ç°çš„ï¼Œè¿™äº›å¯„å­˜å™¨é€šå¸¸ç§°ä¸ºI/Oç«¯å£ï¼ˆI/O Portï¼‰ã€‚å®ƒåŒ…æ‹¬3ç§ç±»å‹ï¼šæ•°æ®ç«¯å£ã€çŠ¶æ€ç«¯å£å’Œå‘½ä»¤ï¼ˆæ§åˆ¶ï¼‰ç«¯å£\nIOç«¯å£ç¼–å€æ–¹å¼ åˆ†ä¸ºç»Ÿä¸€ç¼–å€å’Œç‹¬ç«‹ç¼–å€\nI/Oç«¯å£ä¸å†…å­˜å•å…ƒç»Ÿä¸€ç¼–å€ï¼ŒæŒ‡ä»¤åŠæ§åˆ¶ä¿¡å·ç»Ÿä¸€ï¼Œå†…å­˜åœ°å€èµ„æºå‡å°‘ I/Oç«¯å£ç‹¬ç«‹ç¼–å€ï¼Œå†…å­˜åœ°å€èµ„æºå……åˆ†åˆ©ç”¨ï¼Œä½¿ç”¨ä¸åŒçš„æ§åˆ¶ä¿¡å·ï¼Œèƒ½å¤Ÿåº”ç”¨äºç«¯å£çš„æŒ‡ä»¤è¾ƒå°‘ è¾“å…¥æ¥å£éœ€è¦å…·å¤‡æ•°æ®æ§åˆ¶èƒ½åŠ›ï¼Œä¸€èˆ¬é‡‡ç”¨ä¸‰æ€é—¨æ¥å£ï¼Œé˜²æ­¢å¤–è®¾çš„è¾“å…¥å½±å“æ•°æ®æ€»çº¿ï¼Œå¦‚74LS244\nè¾“å‡ºæ¥å£éœ€è¦å…·å¤‡æ•°æ®é”å­˜èƒ½åŠ›ï¼Œä¸€èˆ¬é‡‡ç”¨é”å­˜å™¨æ¥å£ï¼Œå¦‚74LS273\nåŸºæœ¬è¾“å…¥è¾“å‡ºæ–¹å¼ 1.æ— æ¡ä»¶ä¼ é€æ–¹å¼ 2.æŸ¥è¯¢æ–¹å¼ 3.ä¸­æ–­æ–¹å¼ 4.ç›´æ¥å­˜å‚¨å™¨å­˜å–æ–¹å¼ï¼ˆDMAï¼‰\nä¸­æ–­ CPUæ‰§è¡Œç¨‹åºä¸­ï¼Œç”±äºå‘ç”Ÿäº†æŸç§éšæœºçš„äº‹ä»¶(å¤–éƒ¨æˆ–å†…éƒ¨)ï¼Œå¼•èµ·CPUæš‚æ—¶ ä¸­æ–­æ­£åœ¨è¿è¡Œçš„ç¨‹åºï¼Œè½¬å»æ‰§è¡Œä¸€æ®µç‰¹æ®Šçš„æœåŠ¡ç¨‹åº(ç§°ä¸ºä¸­æ–­æœåŠ¡ç¨‹åºæˆ– ä¸­æ–­å¤„ç†ç¨‹åº)ï¼Œä»¥å¤„ç†è¯¥äº‹ä»¶ï¼Œè¯¥äº‹ä»¶å¤„ç†å®Œååˆè¿”å›è¢«ä¸­æ–­çš„ç¨‹åºç»§ç»­ æ‰§è¡Œï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºä¸­æ–­ ä¸­æ–­å“åº”è¿‡ç¨‹ å¯å±è”½å¤–éƒ¨ä¸­æ–­å“åº”è¿‡ç¨‹ é€šè¿‡ä¸¤ä¸ªè¿ç»­çš„ä¸­æ–­å“åº”æ€»çº¿å‘¨æœŸè·å–ä¸­æ–­ç±»å‹ç  è·å–ä¸­æ–­å‘é‡åå¹¶è°ƒç”¨ä¸­æ–­ï¼ŒæœåŠ¡ç¨‹åº\nå†…éƒ¨ä¸­æ–­å“åº”è¿‡ç¨‹ æ— ä¸­æ–­å“åº”æ€»çº¿å‘¨æœŸ ä¸­æ–­ç±»å‹ç å›ºå®šæˆ–ç”±æŒ‡ä»¤ï¼ˆINT nï¼‰ç»™å‡º\nä¸»è¦èŠ¯ç‰‡ 1.è®¡æ•°å™¨8253 ç‰¹æ®Šå¼•è„š CLKâ€”â€”æ—¶é’Ÿè„‰å†²è¾“å…¥ GATEâ€”â€”é—¨æ§ä¿¡å·è¾“å…¥ OUTâ€”â€”å®šæ—¶è¾“å‡º ç¼–ç¨‹æ–¹å¼ æ§åˆ¶å­—ç›´æ¥å†™å…¥æ§åˆ¶å¯„å­˜å™¨ è®¡æ•°å€¼å†™å…¥å¯¹åº”è®¡æ•°å™¨ å·¥ä½œæ–¹å¼ æ€»è§ˆ\n16ä½å‡æ³•è®¡æ•°ï¼Œè®¡æ•°å€¼å‡ä¸º0æ—¶è¾“å‡ºç›¸åº”æ§åˆ¶ä¿¡å· è¾“å‡ºæ§åˆ¶ä¿¡å·çš„å½¢å¼å¯é€šè¿‡è½¯ä»¶è®¾ç½® æ–¹å¼0â€”â€”è®¡æ•°ç»“æŸä¸­æ–­ è½¯ä»¶å¯åŠ¨ï¼Œä¸è‡ªåŠ¨é‡å¤è®¡æ•° è®¡æ—¶ç»“æŸè¾“å‡ºé«˜ç”µå¹³ï¼Œè¾“å‡ºå¯ä»¥ç”¨ä½œä¸­æ–­è¯·æ±‚ä¿¡å·\nä¸è‡ªåŠ¨é‡å¤è®¡æ•°æ˜¯æŒ‡ æ¯å†™å…¥ä¸€æ¬¡è®¡æ•°åˆå€¼åªè®¡æ•°ä¸€ä¸ªå‘¨æœŸ\næ–¹å¼1â€”â€”å¯é‡å¤è§¦å‘çš„å•ç¨³æ€è§¦å‘å™¨ ç¡¬ä»¶å¯åŠ¨ï¼Œä¸è‡ªåŠ¨é‡å¤è®¡æ•° ä½†æ˜¯å¯ä»¥é€šè¿‡GATEé‡å¤è§¦å‘è®¡æ•°ï¼Œå½“GATEå‡ºç°ä¸Šå‡æ²¿æ—¶ï¼Œä¸‹ä¸€ä¸ªCLKçš„ä¸‹é™æ²¿å¼€å§‹è®¡æ•° è®¡æ•°ç»“æŸåï¼ŒOUTç«¯è¾“å‡ºé«˜ç”µå¹³\næ–¹å¼2â€”â€”é¢‘ç‡å‘ç”Ÿå™¨ æ—¢å¯ä»¥è½¯ä»¶å¯åŠ¨ï¼Œä¹Ÿå¯ä»¥ç¡¬ä»¶å¯åŠ¨ è‡ªåŠ¨é‡å¤è®¡æ•°ï¼ŒOUTç«¯è¾“å‡ºN-1ä¸ªæ—¶é’Ÿå‘¨æœŸçš„é«˜ç”µå¹³ï¼Œ1ä¸ªæ—¶é’Ÿå‘¨æœŸçš„ä½ç”µå¹³\næ–¹å¼3â€”â€”æ–¹æ³¢å‘ç”Ÿå™¨ è½¯ç¡¬ä»¶å¯åŠ¨ï¼Œè‡ªåŠ¨é‡å¤è®¡æ•° è¾“å‡ºå¯¹ç§°æ–¹æ³¢ï¼ˆè¿ç»­æ–¹æ³¢ï¼‰ Nä¸ºå¶æ•°ï¼Œå®Œå…¨å¯¹ç§°ï¼ŒNä¸ºå¥‡æ•°ï¼Œæ­£è„‰å†²ä¼šé•¿ä¸€ç‚¹\næ–¹å¼4â€”â€”è½¯ä»¶è§¦å‘é€‰é€š è½¯ä»¶å¯åŠ¨ï¼Œä¸è‡ªåŠ¨é‡å¤è®¡æ•° è®¡æ•°ç»“æŸè¾“å‡ºä¸€ä¸ªCLKå®½åº¦çš„ä½ç”µå¹³\næ–¹å¼5â€”â€”ç¡¬ä»¶è§¦å‘é€‰é€š ç¡¬ä»¶å¯åŠ¨ï¼Œä¸è‡ªåŠ¨é‡å¤è®¡æ•° æ³¢å½¢ä¸æ–¹å¼4ä¸€è‡´ï¼Œè®¡æ•°ç»“æŸè¾“å‡ºä¸€ä¸ªCLKå®½åº¦çš„ä½ç”µå¹³\nå°ç»“ éœ€è¦ä¸¤ä¸ªå†™è„‰å†²â€”â€”ä¸¤æ¬¡å†™æ“ä½œ\nç¬¬ä¸€æ¬¡å†™è„‰å†²å†™å…¥æ§åˆ¶å­— ç¬¬äºŒæ¬¡å†™è„‰å†²å†™å…¥è®¡æ•°åˆå€¼ èƒ½è¾“å‡ºè¿ç»­æ³¢å½¢çš„åªæœ‰æ–¹å¼2å’Œæ–¹å¼3\n2.å¯ç¼–ç¨‹å¹¶è¡Œæ¥å£8255 ä¸‰ä¸ªç«¯å£ Aå£ï¼šæ”¯æŒ0ï¼Œ1ï¼Œ2å·¥ä½œæ–¹å¼ Bå£ï¼šæ”¯æŒ0ï¼Œ1å·¥ä½œæ–¹å¼ Cå£ï¼Œæ”¯æŒ0å·¥ä½œæ–¹å¼\nå·¥ä½œæ–¹å¼ æ–¹å¼0â€”â€”åŸºæœ¬è¾“å…¥è¾“å‡ºæ–¹å¼ æ–¹å¼1â€”â€”é€‰é€šå·¥ä½œæ–¹å¼ æ–¹å¼1è¾“å‡ºæ¥å£A\n$\\overline {OBF}$ï¼šæ¥å£è¾“å‡ºç¼“å†²å™¨æ»¡ä¿¡å·ï¼Œå‘Šè¯‰å¤–è®¾å¯ä»¥ä»è¯¥ç«¯å£è¯»èµ°ä¿¡å· $\\overline {ACK}$ï¼šå¤–è®¾ä»ç«¯å£å–èµ°æ•°æ®ï¼Œå‘å‡ºå“åº”ä¿¡å· å¤–è®¾å–èµ°ä¿¡å·åï¼Œå‘å‡º$\\overline {ACK}$å“åº”ä¿¡å·ï¼ŒåŒæ—¶ä½¿$\\overline {OBF}=1$ï¼ŒåŒæ—¶è¿˜ä¼šäº§ç”Ÿä¸€ä¸ªæœ‰æ•ˆçš„$INTR$ä¿¡å·\næ–¹å¼1è¾“å…¥æ¥å£A\n$\\overline {{STB}_A}$ï¼šå¤–è®¾å†™å…¥ ${{IBF}_A}$ï¼šå½“è¾“å…¥ç¼“å†²å™¨æ»¡åï¼Œæ¥å£å‘å‡ºçš„é«˜ç”µå¹³æœ‰æ•ˆä¿¡å·\næ–¹å¼2â€”â€”åŒå‘ä¼ é€æ–¹å¼ å¯ä»¥æ—¢ä½œä¸ºè¾“å…¥å£ï¼Œåˆä½œä¸ºè¾“å‡ºå£ åªæœ‰Aå£å¯ä»¥å·¥ä½œåœ¨æ­¤æ¨¡å¼ä¸‹ï¼Œå½“Aå£å·¥ä½œåœ¨æ–¹å¼2æ—¶ï¼ŒBå£å¯ä»¥å·¥ä½œåœ¨æ–¹å¼0æˆ–1\næ§åˆ¶å­— æ–¹å¼æ§åˆ¶å­—ï¼šç”¨äºç¡®å®š3ä¸ªç«¯å£çš„å·¥ä½œæ–¹å¼åŠæ•°æ®ä¼ é€æ–¹å‘ ä½æ§åˆ¶å­—ï¼šä»…ç”¨äºCç«¯å£ï¼Œå¯è®¾ç½®Cå£æŸä½çš„åˆå§‹çŠ¶æ€ï¼ˆé«˜ä½ç”µå¹³ï¼‰\nD7=1ï¼Œæ–¹å¼æ§åˆ¶å­— D7=0ï¼Œä½æ§åˆ¶å­—\n3.DAè½¬æ¢èŠ¯ç‰‡DAC0832 å·®åŠ¨è¾“å‡ºï¼ŒåŒç¼“å†²\nå·¥ä½œæ–¹å¼ å•ç¼“å†²å·¥ä½œæ–¹å¼ åŒç¼“å†²å·¥ä½œæ–¹å¼ 4.ADè½¬æ¢èŠ¯ç‰‡ADC0809 5.å¯ç¼–ç¨‹ä¸­æ–­æ§åˆ¶å™¨8259A ç‰¹æ®Šå¼•è„š $INT$ï¼šæ¥CPUçš„ä¸­æ–­è¯·æ±‚å¼•è„š $\\overline {INTA}$ï¼šæ¥CPUçš„ä¸­æ–­å“åº”å¼•è„š $A0$ï¼š8259Aå†…éƒ¨å¯„å­˜å™¨é€‰æ‹©ä¿¡å· $CAS0-CAS2$ï¼šå¤šä¸ª8259çº§è”å¼•è„šæ—¶ä½¿ç”¨ï¼Œçº§è”æ§åˆ¶çº¿ $\\overline {SP}$ï¼šåœ¨éç¼“å†²æ¨¡å¼ä¸‹ï¼Œç”¨æ¥æŒ‡å®š8259Aæ˜¯ä»ç‰‡è¿˜æ˜¯ä¸»ç‰‡ï¼Œ$\\overline {SP}$=1çš„8259æ˜¯ä¸»ç‰‡\nå†…éƒ¨ç»“æ„ å·¥ä½œè¿‡ç¨‹ å·¥ä½œæ–¹å¼ ä¸­æ–­ä¼˜å…ˆæ–¹å¼ä¸ä¸­æ–­åµŒå¥— ï¼ˆ1ï¼‰å›ºå®šä¼˜å…ˆçº§æ–¹å¼ ï¼ˆ2ï¼‰å¾ªç¯ä¼˜å…ˆçº§æ–¹å¼\nå±è”½ä¸­æ–­æºçš„æ–¹å¼ æ™®é€šå±è”½æ–¹å¼ï¼šå¯¹IMRæŸä½ç½®1ï¼Œåˆ™å±è”½è¯¥ä½å¯¹åº”çš„ä¸­æ–­è¯·æ±‚\nçº§è”å·¥ä½œæ–¹å¼ ï¼ˆ1ï¼‰ä¸»ç‰‡ã€ä»ç‰‡æœ‰ä¸åŒçš„åœ°å€ ï¼ˆ2ï¼‰ä¸»ç‰‡ã€ä»ç‰‡åˆ†åˆ«è¿›è¡Œç¼–ç¨‹\n8259Açš„ç¼–ç¨‹ åˆå§‹åŒ–ç¼–ç¨‹ åˆå§‹åŒ–å‘½ä»¤å­—ICW1ï¼ˆåˆå§‹åŒ–å­—ï¼‰ï¼šå•ç‰‡/å¤šç‰‡çº§è”ã€ç”µå¹³/è¾¹æ²¿è§¦å‘ åˆå§‹åŒ–å‘½ä»¤å­—ICW2ï¼ˆä¸­æ–­å‘é‡ç ï¼‰ï¼šç»™CPUæä¾›ä¸­æ–­å‘é‡ æ³¨æ„ï¼šä¾‹å¦‚ï¼Œå†™å…¥ICW1ï¼Œç«¯å£åœ°å€ä¸º20Hï¼Œå†™å…¥ICW2æ—¶ï¼Œç«¯å£åœ°å€ä¸º21H\nåˆå§‹åŒ–å‘½ä»¤å­—ICW3ï¼ˆçº§è”æ§åˆ¶å­—ï¼‰ï¼šæŒ‡å‡ºå“ªä¸ªå¼•è„šè¿›è¡Œäº†çº§è” åˆå§‹åŒ–å‘½ä»¤å­—ICW4ï¼ˆä¸­æ–­ç»“æŸæ–¹å¼å­—ï¼‰ï¼šç»™å‡º8259Aç»“æŸä¸­æ–­å¤„ç†çš„æ–¹å¼\næ“ä½œæ–¹å¼ç¼–ç¨‹ æ“ä½œå‘½ä»¤å­—OCW1ï¼ˆä¸­æ–­å±è”½å­—ï¼‰ï¼šæŸä½ä¸º1åˆ™è¯¥å¼•è„šä¸­æ–­è¢«å±è”½ æ“ä½œå‘½ä»¤å­—OCW2ï¼ˆä¸­æ–­ç»“æŸå’Œä¼˜å…ˆçº§å¾ªç¯ï¼‰ï¼šæŒ‡å®šä¼˜å…ˆçº§é¡ºåºå’Œä¸­æ–­ç»“æŸæ–¹å¼ æ“ä½œå‘½ä»¤å­—OCW3ï¼ˆå±è”½æ–¹å¼å’ŒçŠ¶æ€è¯»å‡ºæ§åˆ¶å­—ï¼‰ï¼šè®¾ç½®ç‰¹æ®Šå±è”½ã€æŸ¥è¯¢æ–¹å¼\n","date":"2025-06-24T23:16:11+08:00","permalink":"https://NomadJoeviolet.github.io/p/%E5%BE%AE%E6%9C%BA%E5%8E%9F%E7%90%86/","title":"å¾®æœºåŸç†"},{"content":"STM32F103C8T6 çš„ CAN æ§åˆ¶å™¨å’Œ CAN æ”¶å‘å™¨ 1. CAN æ§åˆ¶å™¨ STM32F103C8T6 å†…ç½® CAN æ§åˆ¶å™¨ï¼šè¯¥èŠ¯ç‰‡å†…ç½®äº† bxCANï¼ˆBasic Extended CANï¼‰æ§åˆ¶å™¨ï¼Œæ”¯æŒ CAN 2.0A å’Œ 2.0B åè®® åŠŸèƒ½ï¼š æ•°æ®å¸§çš„å°è£…ä¸è§£æ é”™è¯¯æ£€æµ‹ä¸å¤„ç† æ€»çº¿ä»²è£ ä½å®šæ—¶ä¸åŒæ­¥ å¼•è„šï¼š CAN_RXï¼ˆPA11ï¼‰ï¼šæ¥æ”¶æ•°æ® CAN_TXï¼ˆPA12ï¼‰ï¼šå‘é€æ•°æ® 2. CAN æ”¶å‘å™¨ STM32F103C8T6 æ²¡æœ‰å†…ç½® CAN æ”¶å‘å™¨ï¼šCAN æ”¶å‘å™¨è´Ÿè´£å°† CAN æ§åˆ¶å™¨çš„é€»è¾‘ä¿¡å·è½¬æ¢ä¸º CAN æ€»çº¿çš„å·®åˆ†ä¿¡å·ï¼ˆCAN_H å’Œ CAN_Lï¼‰ï¼Œåä¹‹äº¦ç„¶ éœ€è¦å¤–æ¥ CAN æ”¶å‘å™¨ï¼šå¸¸è§çš„ CAN æ”¶å‘å™¨åŒ…æ‹¬ TJA1050ã€MCP2551 ç­‰ åŠŸèƒ½ï¼š å°† CAN æ§åˆ¶å™¨çš„é€»è¾‘ä¿¡å·è½¬æ¢ä¸ºå·®åˆ†ä¿¡å· æä¾›ç”µæ°”éš”ç¦»ï¼ˆéƒ¨åˆ†å‹å·ï¼‰ ä¿æŠ¤ CAN æ§åˆ¶å™¨å…å—æ€»çº¿ç”µæ°”å¹²æ‰° æ€»ç»“ CAN æ§åˆ¶å™¨ï¼šSTM32F103C8T6 å†…ç½®äº† CAN æ§åˆ¶å™¨ï¼Œæ”¯æŒ CAN 2.0A å’Œ 2.0B åè®® CAN æ”¶å‘å™¨ï¼šSTM32F103C8T6 æ²¡æœ‰å†…ç½® CAN æ”¶å‘å™¨ï¼Œéœ€å¤–æ¥ï¼ˆå¦‚ TJA1050 æˆ– MCP2551ï¼‰ è¿æ¥æ–¹å¼ CAN æ§åˆ¶å™¨ï¼šé€šè¿‡ CAN_RXï¼ˆPA11ï¼‰å’Œ CAN_TXï¼ˆPA12ï¼‰ä¸ CAN æ”¶å‘å™¨è¿æ¥ã€‚ CAN æ”¶å‘å™¨ï¼šå°† CAN_H å’Œ CAN_L è¿æ¥åˆ° CAN æ€»çº¿ ç¤ºä¾‹ç”µè·¯ STM32F103C8T6ï¼š PA11ï¼ˆCAN_RXï¼‰ â†’ CAN æ”¶å‘å™¨çš„ RXD PA12ï¼ˆCAN_TXï¼‰ â†’ CAN æ”¶å‘å™¨çš„ TXD CAN æ”¶å‘å™¨ï¼ˆå¦‚ TJA1050ï¼‰ï¼š CAN_H å’Œ CAN_L è¿æ¥åˆ° CAN æ€»çº¿ æ€»ç»“ STM32F103C8T6 å†…ç½® CAN æ§åˆ¶å™¨ï¼Œä½†éœ€å¤–æ¥ CAN æ”¶å‘å™¨ æ‰èƒ½å®ç°å®Œæ•´çš„ CAN é€šä¿¡åŠŸèƒ½ ","date":"2025-06-24T23:11:52+08:00","permalink":"https://NomadJoeviolet.github.io/p/can%E6%8E%A7%E5%88%B6%E5%99%A8%E5%92%8Ccan%E6%94%B6%E5%8F%91%E5%99%A8/","title":"CANæ§åˆ¶å™¨å’ŒCANæ”¶å‘å™¨"},{"content":"STM32H743-æ¢³ç†ADCæ¨¡æ•°è½¬æ¢å™¨åœ¨CubeMXä¸Šçš„é…ç½®_overrun behaviour-CSDNåšå®¢ï¼ˆå†™çš„å¾ˆå¥½ï¼Œå¾ˆè¯¦ç»†ï¼‰\nSTM32-HALåº“-ADCå­¦ä¹  - æ›²æ¨ - åšå®¢å›­\nADCå®šä¹‰ æ¨¡æ•°è½¬æ¢å™¨(Analog to Digital Converter,ADC) æ¨¡æ‹Ÿä¿¡å·-\u0026gt;æ•°å­—ä¿¡å·è½¬æ¢å™¨\né€šè¿‡å¯¹è¾“å…¥çš„æ¨¡æ‹Ÿä¿¡å·è¿›è¡Œæµ‹é‡ï¼Œå°†å…¶åˆ†çº§è½¬æ¢ä¸ºæ•°å­—ä¿¡å·\nSTM32å•ç‰‡æœºä¸­çš„ADC ä¸€èˆ¬è®¡ç®—é‡‡ç”¨ä¸€ä¸‹é€»è¾‘æ–¹å¼è¿›è¡Œè½¬æ¢\n1 2 3 4 5 6 7 if( V\u0026gt;V_ref_low \u0026amp;\u0026amp; V\u0026lt;V_ref_high ) { return (V-V_ref_low)/(V_ref_high-V_ref_low) * (2\u0026lt;\u0026lt;X-1); //å½’ä¸€åŒ–ï¼Œå†æŒ‰ç…§é…ç½®çš„xè¿›è¡Œè½¬æ¢ } else { return erro ; } STM32å•ç‰‡æœºä¸­çš„ADCï¼Œxä¸€èˆ¬æ˜¯12ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–æ•°å€¼ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå‚è€ƒç”µå‹ä¸º0Vï¼Œå‚è€ƒé«˜ç”µå‹ä¸º3.3V\nåˆ†è¾¨ç‡ä¸ç²¾åº¦ åˆ†è¾¨ç‡ä¸ä½æ•°æœ‰å…³ï¼Œç²¾åº¦ä¸æ€§èƒ½æœ‰å…³ï¼Œä½æ•°è¶Šé«˜ï¼Œåˆ†è¾¨ç‡è¶Šé«˜ï¼Œæ€§èƒ½è¶Šé«˜ï¼Œæ³¢åŠ¨è¶Šå°ï¼Œç²¾åº¦è¶Šå¼º ADCä½æ•°ä¸º12ä½ï¼Œåˆ™åˆ†è¾¨ç‡æ˜¯1/4096\nä½¿ç”¨æ—¶PLCKé¢‘ç‡æ§åˆ¶åœ¨36MHzä»¥å†…ï¼Œä¸ç„¶ADCæ¨¡å—çš„ç²¾åº¦ä¼šå¤§å¹…é™ä½\nSTM32CubeMXé…ç½® è¿™é‡Œä»¥STM32C8T6ä¸ºä¾‹\nxå³Resolution 12bits( 15ADCæ—¶é’Ÿå‘¨æœŸ )ï¼ˆçœ‹èŠ¯ç‰‡å‹å·ï¼Œæœ‰çš„éœ€è¦é…ç½®ï¼‰ æ•°æ®é€‰æ‹©å³å¯¹é½ï¼Œå¾—åˆ°çš„æ•°æ®å°±æ˜¯è½¬æ¢åçš„å€¼ Modeé€‰æ‹©Independent mode Scan Conversion Modeï¼ˆæ‰«æè½¬æ¢æ¨¡å¼ï¼‰ï¼Œä¼šé‡‡é›†ADCå¼€å¯çš„æ‰€æœ‰é€šé“ï¼ŒæŒ‰é¡ºåºé‡‡é›†æ‰€æœ‰é€šé“ Continuous Conversion Modeï¼ˆè¿ç»­è½¬æ¢æ¨¡å¼ï¼‰ï¼Œå¯ä»¥åœ¨ä½¿èƒ½ADCæ—¶è‡ªåŠ¨å¼€å§‹é‡‡é›†ï¼Œè€Œéæ‰‹åŠ¨é‡‡é›† Discontinuous Conversion Modeï¼ˆé—´æ–­é‡‡é›†æ¨¡å¼ï¼‰ï¼Œå¯ä»¥åœ¨ä¸€è½®é‡‡é›†å®Œæˆåæš‚åœç­‰å¾…æŒ‡ä»¤æ§åˆ¶ä¸‹ä¸€è½®é‡‡é›†\nNumber Of Discontinuous Conversionsï¼ˆå•æ¬¡è½¬æ¢æ¬¡æ•°ï¼‰æ­¤å‚æ•°å®šä¹‰æ¯æ¬¡è§¦å‘åADCæ‰§è¡Œçš„è½¬æ¢æ¬¡æ•°ï¼Œæ¯æ¬¡è½¬æ¢å®Œéƒ½éœ€è¦HAL_ADC_GetValueæ¥è·å–å€¼ã€‚ å¦‚æœå®ƒè®¾ä¸º2ï¼Œä¸”ADC1ä½¿èƒ½äº†é€šé“1ï¼Œ2ï¼Œ5ï¼Œ7çš„è¯ï¼Œé‚£ä¹ˆç¬¬ä¸€æ¬¡è§¦å‘ADC1é‡‡æ ·æ—¶ï¼Œå°±ä¼šé‡‡æ ·é€šé“1ä¸é€šé“2çš„å€¼ï¼Œå†ä¸€æ¬¡è§¦å‘ADC1é‡‡æ ·çš„è¯ï¼Œå°±ä¼šé‡‡æ ·é€šé“5ä¸é€šé“7å€¼ï¼Œå¦‚æ­¤ç±»æ¨ã€‚\nADC_Regular_ConversionMode å¯ä»¥é…ç½®æ¯ä¸ªé€šé“çš„é‡‡é›†é¡ºåºå’Œé‡‡æ ·æ—¶é—´\nä»£ç ä½¿ç”¨ 1.å¼€å§‹é‡‡é›†\n1 HAL_ADC_Start(\u0026amp;hadc2); 2.é‡‡é›†åè½¬æ¢\n1 HAL_ADC_PollForConversion(\u0026amp;hadc2,20);//åœ°å€ï¼Œç­‰å¾…æ—¶é—´ å…³äºå¤šæ•°æ®é€šé“é‡‡é›† ADC_value[1]å¯¹åº”rank_1çš„é€šé“çš„å€¼ï¼Œç¬¬ä¸€æ¬¡é‡‡é›†rank1é€šé“ ADC_value[2]å¯¹åº”rank_2çš„é€šé“çš„å€¼ï¼Œç¬¬ä¸€æ¬¡é‡‡é›†rank2é€šé“ rankæŒ‡åœ¨ADC_Regular_ConversionModeä¸­çš„rankè®¾ç½®\n1 2 3 4 5 6 7 for( int t = 1 ; t \u0026lt;= 10 ; ++ t ) { for( int i = 0 ; i \u0026lt; 2 ; ++ i ) { HAL_ADC_Start(\u0026amp;hadc2); HAL_ADC_PollForConversion(\u0026amp;hadc2,20);//é‡‡é›†åè½¬æ¢ AD_value[i] += HAL_ADC_GetValue(\u0026amp;hadc2) ;//é‡‡é›†åæ¬¡ï¼Œå¹³å‡å€¼å¤„ç† } } æ£€æµ‹ 1 2 3 if(HAL_IS_BIT_SET( HAL_ADC_GetState(\u0026amp;hadc2),HAL_ADC_STATE_REG_EOC) ) {//æ£€æµ‹æ˜¯å¦æ­£å¸¸é‡‡é›† ADC_value += HAL_ADC_GetValue(\u0026amp;hadc2); } å…³äºNumber Of Discontinuous Conversions åœ¨STM32CubeMXä¸­ï¼ŒNumber Of Discontinuous Conversionsï¼ˆå•æ¬¡è½¬æ¢æ¬¡æ•°ï¼‰æ˜¯ADCï¼ˆæ¨¡æ•°è½¬æ¢å™¨ï¼‰çš„ä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œä¸»è¦ç”¨äºæ§åˆ¶ADCåœ¨**éè¿ç»­é‡‡æ ·æ¨¡å¼ï¼ˆDiscontinuous Modeï¼‰**ä¸‹çš„è½¬æ¢è¡Œä¸ºã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†è§£é‡Šå’Œä½¿ç”¨æ–¹æ³•ï¼š\n1. åŠŸèƒ½å«ä¹‰ ä½œç”¨ï¼š\nå½“ADCé…ç½®ä¸ºéè¿ç»­æ¨¡å¼ï¼ˆDiscontinuous Modeï¼‰æ—¶ï¼Œæ­¤å‚æ•°å®šä¹‰æ¯æ¬¡è§¦å‘åADCæ‰§è¡Œçš„è½¬æ¢æ¬¡æ•°ã€‚ ä¾‹å¦‚ï¼Œè®¾ç½®ä¸º3ï¼Œåˆ™æ¯æ¬¡è§¦å‘ADCåï¼Œä¼šè‡ªåŠ¨è¿ç»­å®Œæˆ3æ¬¡è½¬æ¢ï¼ˆæ— éœ€é¢å¤–è§¦å‘ä¿¡å·ï¼‰ã€‚ è‹¥è®¾ç½®ä¸º1ï¼Œåˆ™æ¯æ¬¡è§¦å‘ä»…æ‰§è¡Œ1æ¬¡è½¬æ¢ï¼ˆç­‰åŒäºæ ‡å‡†å•æ¬¡æ¨¡å¼ï¼‰ã€‚ åº”ç”¨åœºæ™¯ï¼š\né€‚ç”¨äºéœ€è¦åˆ†ç»„é‡‡æ ·çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼š å‘¨æœŸæ€§è§¦å‘ADCï¼Œä½†æ¯æ¬¡è§¦å‘éœ€é‡‡é›†å¤šä¸ªé€šé“çš„æ•°æ®ã€‚ é™ä½CPUå¹²é¢„é¢‘ç‡ï¼ˆé€šè¿‡ä¸€æ¬¡è§¦å‘å®Œæˆå¤šæ¬¡è½¬æ¢ï¼‰ã€‚ 2. é…ç½®æ­¥éª¤ï¼ˆSTM32CubeMXï¼‰ å¯ç”¨Discontinuous Modeï¼š åœ¨ADCé…ç½®ç•Œé¢ï¼Œå‹¾é€‰ Discontinuous Modeï¼ˆé€šå¸¸åœ¨Parameter Settingsé€‰é¡¹å¡ä¸­ï¼‰ã€‚ æ­¤æ—¶ï¼ŒNumber Of Discontinuous Conversionsé€‰é¡¹ä¼šç”Ÿæ•ˆã€‚ è®¾ç½®è½¬æ¢æ¬¡æ•°ï¼š è¾“å…¥éœ€è¦çš„è½¬æ¢æ¬¡æ•°ï¼ˆå–å€¼èŒƒå›´å–å†³äºå‹å·ï¼Œé€šå¸¸ä¸º1~8ï¼‰ã€‚ è¯¥å€¼å¿…é¡» â‰¤ æ€»å¯ç”¨é€šé“æ•°ï¼ˆä¾‹å¦‚ï¼Œè‹¥å¯ç”¨5ä¸ªé€šé“ï¼Œæœ€å¤šå¯è®¾ç½®ä¸º5ï¼‰ã€‚ é…ç½®è§¦å‘æºï¼š é€‰æ‹©è§¦å‘æ–¹å¼ï¼ˆå¦‚å®šæ—¶å™¨è§¦å‘ã€å¤–éƒ¨å¼•è„šè§¦å‘ç­‰ï¼‰ã€‚ æ¯æ¬¡è§¦å‘ä¿¡å·åˆ°æ¥æ—¶ï¼ŒADCä¼šè‡ªåŠ¨å®Œæˆè®¾å®šçš„è½¬æ¢æ¬¡æ•°ã€‚ 3. å·¥ä½œæµç¨‹ç¤ºä¾‹ ç¡¬ä»¶ç¯å¢ƒï¼š ADCé€šé“ï¼šCH0ã€CH1ã€CH2 é…ç½®ï¼šDiscontinuous Mode + Number Of Discontinuous Conversions = 2 è¡Œä¸ºï¼š è§¦å‘ä¿¡å·åˆ°æ¥ï¼ˆå¦‚å®šæ—¶å™¨æº¢å‡ºï¼‰ã€‚ ADCè‡ªåŠ¨è¿ç»­è½¬æ¢2ä¸ªé€šé“ï¼ˆä¾‹å¦‚CH0â†’CH1ï¼‰ã€‚ è½¬æ¢å®Œæˆåäº§ç”Ÿä¸­æ–­/DMAè¯·æ±‚ã€‚ ä¸‹æ¬¡è§¦å‘æ—¶ï¼Œç»§ç»­ä»ä¸‹ä¸€ä¸ªé€šé“å¼€å§‹ï¼ˆCH2â†’CH0ï¼Œä¾æ­¤ç±»æ¨ï¼‰ã€‚ åœ¨è¯¥é…ç½®ä¸‹ï¼ˆDiscontinuous Mode + Number Of Discontinuous Conversions = 2ï¼‰ï¼Œæ¯æ¬¡è§¦å‘åADCä¼šè¿ç»­è½¬æ¢2ä¸ªé€šé“ï¼ˆä¾‹å¦‚CH0â†’CH1ï¼‰ï¼Œå› æ­¤ä½ éœ€è¦è°ƒç”¨ä¸¤æ¬¡ HAL_ADC_GetValue(\u0026amp;hadc2) æ¥åˆ†åˆ«è¯»å–è¿™ä¸¤ä¸ªé€šé“çš„è½¬æ¢ç»“æœã€‚ä»¥ä¸‹æ˜¯å…·ä½“è¯´æ˜å’Œæ³¨æ„äº‹é¡¹ï¼š\n1. æ•°æ®è¯»å–æ–¹å¼ æ–¹æ³•ä¸€ï¼šè½®è¯¢æ¨¡å¼ï¼ˆPollingï¼‰ æ¯æ¬¡è§¦å‘åï¼Œéœ€æ‰‹åŠ¨è¯»å–ä¸¤æ¬¡ADCå€¼ï¼š\n1 2 3 4 5 6 7 8 HAL_ADC_Start(\u0026amp;hadc2); // å¯åŠ¨ADCï¼ˆæˆ–é€šè¿‡è§¦å‘ä¿¡å·å¯åŠ¨ï¼‰ //å¼€å¯ä¸€æ¬¡ï¼Œé‡‡é›†ä¸¤æ¬¡ if (HAL_ADC_PollForConversion(\u0026amp;hadc2, timeout) == HAL_OK) {//é‡‡é›†åç¬¬ä¸€æ¬¡è½¬æ¢ uint32_t ch0_value = HAL_ADC_GetValue(\u0026amp;hadc2); // è¯»å–CH0ç»“æœ } if (HAL_ADC_PollForConversion(\u0026amp;hadc2, timeout) == HAL_OK) {//é‡‡é›†åç¬¬äºŒæ¬¡è½¬æ¢ uint32_t ch1_value = HAL_ADC_GetValue(\u0026amp;hadc2); // è¯»å–CH1ç»“æœ } æ³¨æ„ï¼šæ¯æ¬¡è°ƒç”¨ HAL_ADC_GetValue() ä¼šè¿”å›æœ€åä¸€æ¬¡å®Œæˆçš„è½¬æ¢ç»“æœï¼Œå› æ­¤éœ€æŒ‰é¡ºåºè¯»å–ã€‚ æ–¹æ³•äºŒï¼šä¸­æ–­æ¨¡å¼ï¼ˆInterruptï¼‰ åœ¨ADCè½¬æ¢å®Œæˆä¸­æ–­ä¸­è¯»å–ï¼š\n1 2 3 4 5 6 void HAL_ADC_ConvCpltCallback(ADC_HandleTypeDef* hadc) { if (hadc == \u0026amp;hadc2) { uint32_t ch0_value = HAL_ADC_GetValue(\u0026amp;hadc2); // ç¬¬ä¸€æ¬¡è½¬æ¢ç»“æœï¼ˆCH0ï¼‰ uint32_t ch1_value = HAL_ADC_GetValue(\u0026amp;hadc2); // ç¬¬äºŒæ¬¡è½¬æ¢ç»“æœï¼ˆCH1ï¼‰ } } å…³é”®ç‚¹ï¼šåœ¨ä¸­æ–­å›è°ƒä¸­éœ€è¿ç»­è¯»å–ä¸¤æ¬¡ï¼Œé¡ºåºç”±ADCçš„Ranké…ç½®å†³å®šã€‚ æ–¹æ³•ä¸‰ï¼šDMAæ¨¡å¼ï¼ˆæ¨èï¼‰ è‹¥å¯ç”¨DMAï¼ŒADCä¼šè‡ªåŠ¨å°†å¤šæ¬¡è½¬æ¢ç»“æœå­˜å…¥æŒ‡å®šæ•°ç»„ï¼Œæ— éœ€æ‰‹åŠ¨è°ƒç”¨ HAL_ADC_GetValue()ï¼š\n1 2 uint32_t adc_results[2]; // å­˜å‚¨2æ¬¡è½¬æ¢ç»“æœ HAL_ADC_Start_DMA(\u0026amp;hadc2, adc_results, 2); // å¯åŠ¨DMAä¼ è¾“ ç»“æœå­˜å‚¨ï¼š\nadc_results[0] â†’ CH0çš„å€¼ï¼Œadc_results[1] â†’ CH1çš„å€¼ï¼ˆé¡ºåºç”±Rankå†³å®šï¼‰ã€‚ 4. æ³¨æ„äº‹é¡¹ ä¸è¿ç»­æ¨¡å¼ï¼ˆContinuous Modeï¼‰çš„åŒºåˆ«ï¼š è¿ç»­æ¨¡å¼ï¼šADCæ— é™å¾ªç¯è½¬æ¢æ‰€æœ‰å¯ç”¨é€šé“ï¼Œæ— éœ€è§¦å‘ã€‚ éè¿ç»­æ¨¡å¼ï¼šéœ€å¤–éƒ¨è§¦å‘ï¼Œä¸”æ¯æ¬¡è§¦å‘ä»…è½¬æ¢è®¾å®šçš„æ¬¡æ•°ã€‚ DMAé…åˆï¼š å»ºè®®å¯ç”¨DMAï¼Œä»¥é«˜æ•ˆæ¬è¿å¤šç»„è½¬æ¢ç»“æœï¼ˆå°¤å…¶æ˜¯é«˜é¢‘è§¦å‘åœºæ™¯ï¼‰ã€‚ DMAç¼“å†²åŒºå¤§å°éœ€ â‰¥ è½¬æ¢æ¬¡æ•° Ã— é€šé“æ•°ã€‚ é€šé“é¡ºåºï¼š è½¬æ¢é¡ºåºç”±Rankï¼ˆåœ¨ADCé…ç½®ä¸­å®šä¹‰ï¼‰å†³å®šï¼Œè€Œéé€šé“ç¼–å·ã€‚ æ€»ç»“ Number Of Discontinuous Conversions æ˜¯ADCéè¿ç»­æ¨¡å¼ä¸‹æ¯æ¬¡è§¦å‘çš„è½¬æ¢æ¬¡æ•°ã€‚ å…³é”®é…ç½®ï¼šå¯ç”¨Discontinuous Mode â†’ è®¾ç½®è½¬æ¢æ¬¡æ•° â†’ é…ç½®è§¦å‘æºã€‚ ä¼˜åŠ¿ï¼šçµæ´»æ§åˆ¶é‡‡æ ·èŠ‚å¥ï¼Œå‡å°‘CPUè´Ÿæ‹…ï¼Œé€‚åˆåˆ†ç»„é‡‡æ ·éœ€æ±‚ã€‚ ","date":"2025-06-24T22:44:59+08:00","permalink":"https://NomadJoeviolet.github.io/p/stm32adc%E6%A8%A1%E5%9D%97/","title":"STM32â€”â€”â€”â€”ADCæ¨¡å—"},{"content":"è§†é¢‘æ¨èï¼š ã€c/cppç¨‹åºç¼–è¯‘è¿‡ç¨‹ã€‘https://www.bilibili.com/video/BV1JM4m127y7?vd_source=5a0790755035f26a67935abfbfcdfd5b\næ–‡ç« æ¨èï¼š è¯¦è§£C/C++ä»£ç çš„é¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥å…¨è¿‡ç¨‹ - çŸ¥ä¹ (zhihu.com) C++ é¢„ç¼–è¯‘ï¼Œç¼–è¯‘ï¼Œæ±‡ç¼–ï¼Œé“¾æ¥ - Suarezz - åšå®¢å›­ (cnblogs.com) C/C++ç¼–è¯‘é“¾æ¥ - çŸ¥ä¹ (zhihu.com)(è¿›é˜¶)\nå…³äºç¼–è¯‘å™¨ä¸ä¸åŒç³»ç»Ÿçš„æ–‡ä»¶ ä¸€èˆ¬ç¼–è¯‘å™¨å¯ä»¥åˆ†ä¸ºå‰ç«¯å’Œåç«¯ï¼Œå‰ç«¯ä¸»è¦è´Ÿè´£ è¯­ä¹‰åˆ†æï¼Œåç«¯ä¸»è¦è´Ÿè´£ ä»£ç ç”Ÿæˆ\nLinux macOS Windows å¯æ‰§è¡Œæ–‡ä»¶ .outæˆ–/ .outæˆ–/ .exe ç›®æ ‡æ–‡ä»¶ .o .o .obj é™æ€åº“ .a .a .lib åŠ¨æ€åº“ .so .dylib .dll GCCè´Ÿè´£ç¼–è¯‘ï¼Œç”Ÿæˆå„ç±»åº“å’Œç›®æ ‡æ–‡ä»¶ï¼Œç„¶åè°ƒç”¨å¤–éƒ¨é“¾æ¥å™¨è¿›è¡Œé“¾æ¥ç„¶åç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶\nLLVMåŒæ—¶æœ‰ç¼–è¯‘å™¨å’Œé“¾æ¥å™¨ï¼ˆä¾‹å¦‚ï¼šarmclangå’Œarmlinkï¼‰\nè¿è¡Œç¨‹åºçš„è¿è¡Œé˜¶æ®µï¼Œæ˜¯è®©åŠ è½½å™¨å°†æœ€åç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶æ”¾åˆ°å†…å­˜ä¸­\nGCCã€GNUã€gccä¸g++ GNUï¼šä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼Œå…·ä½“å†…å®¹ä¸é‡è¦ï¼Œæ„Ÿå…´è¶£å¯ä»¥å‚è€ƒï¼š\nGCCã€GNUåˆ°åº•å•¥æ„æ€ï¼Ÿ_ä¸€åªæ¨é˜³ç¾Šçš„åšå®¢-CSDNåšå®¢â€‹blog.csdn.net/qq_43617936/article/details/104504992\nGCCï¼šGNU Compiler Collectionï¼ˆGNUç¼–è¯‘å™¨é›†åˆï¼‰çš„ç¼©å†™ï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ç»„GNUæ“ä½œç³»ç»Ÿä¸­çš„ç¼–è¯‘å™¨é›†åˆï¼Œå¯ä»¥ç”¨äºç¼–è¯‘Cã€C++ã€Javaã€Goã€Fortanã€Pascalã€Objective-Cç­‰è¯­è¨€ gccï¼šGCCï¼ˆç¼–è¯‘å™¨é›†åˆï¼‰ä¸­çš„GNU C Compiler(C ç¼–è¯‘å™¨) g++ï¼šGCCï¼ˆç¼–è¯‘å™¨é›†åˆï¼‰ä¸­çš„GNU C++ Compiler(C++ ç¼–è¯‘å™¨) ç®€å•æ¥è¯´ï¼Œgccè°ƒç”¨äº†GCCä¸­çš„C Compilerï¼Œè€Œg++è°ƒç”¨äº†GCCä¸­çš„C++ Compiler å¯¹äºÂ *.cÂ å’ŒÂ *.cppÂ æ–‡ä»¶ï¼Œgccåˆ†åˆ«å½“ä½œ c å’Œ cppæ–‡ä»¶ç¼–è¯‘ï¼Œè€Œg++åˆ™ç»Ÿä¸€å½“ä½œcppæ–‡ä»¶ç¼–è¯‘\n![[Pasted image 20241126223616.png]]\nGDB(gdb) GDBï¼ˆgdbï¼‰å…¨ç§°â€œGNU symbolic debuggerâ€ï¼Œæ˜¯ Linux ä¸‹å¸¸ç”¨çš„ç¨‹åºè°ƒè¯•å™¨ã€‚ ä¸ºäº†èƒ½å¤Ÿä½¿ç”¨ gdb è°ƒè¯•ï¼Œéœ€è¦åœ¨ä»£ç ç¼–è¯‘çš„æ—¶å€™åŠ ä¸Š-gï¼Œå¦‚\n1 g++ -g -o test test.cpp å¸¸ç”¨æŒ‡ä»¤ ![[Pasted image 20241027090624.png]]\nç¼–è¯‘è¿‡ç¨‹ ![[Pasted image 20241027085312.png]]\n![[Pasted image 20241027092346.png]]\nstep1. é¢„å¤„ç† ![[Pasted image 20241026230159.png]] å‘½ä»¤ï¼š\n1 g++ -E test.cpp -o test.i ä½œç”¨ï¼š\nå»æ‰æ³¨é‡Š é¢„å¤„ç†æŒ‡ä»¤æ›¿æ¢ï¼ˆifndef ï¼Œå®å®šä¹‰ç­‰ï¼‰ include å¯¼å…¥çš„å¤´æ–‡ä»¶æ›¿æ¢ é¢„å¤„ç†å®ä¾‹å¯¹æ¯” .cpp æ–‡ä»¶ ![[Pasted image 20241026230758.png]]\né¢„å¤„ç†åçš„ .i æ–‡ä»¶\nè¿˜æœ‰æ›¿æ¢çš„\n1 #include\u0026lt;iostream\u0026gt; è¢«çœç•¥äº†ï¼Œæ›¿æ¢çš„å†…å®¹æœ‰3ä¸‡å¤šè¡Œ\nç¿»åˆ°æœ€ä¸‹é¢æŸ¥çœ‹\n![[Pasted image 20241026230952.png]]\nå…·ä½“è§£é‡Š é¢„å¤„ç†ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯ç¼–è¯‘å‰çš„ä¸€äº›å‡†å¤‡å·¥ä½œ\né¢„ç¼–è¯‘æŠŠä¸€äº›#defineçš„å®å®šä¹‰å®Œæˆæ–‡æœ¬æ›¿æ¢ï¼Œç„¶åå°†#includeçš„æ–‡ä»¶é‡Œçš„å†…å®¹å¤åˆ¶åˆ°.cppæ–‡ä»¶é‡Œï¼Œå¦‚æœ.hæ–‡ä»¶é‡Œè¿˜æœ‰.hæ–‡ä»¶ï¼Œå°±é€’å½’å±•å¼€ã€‚åœ¨é¢„å¤„ç†è¿™ä¸€æ­¥ï¼Œä»£ç æ³¨é‡Šç›´æ¥è¢«å¿½ç•¥ï¼Œä¸ä¼šè¿›å…¥åˆ°åç»­çš„å¤„ç†ä¸­ï¼Œæ‰€ä»¥æ³¨é‡Šåœ¨ç¨‹åºä¸­ä¸ä¼šæ‰§è¡Œ\nstep2. ç¼–è¯‘é˜¶æ®µ ![[Pasted image 20241027001928.png]]\nå‘½ä»¤ï¼š\n1 g++ -S test.i -o test.s å¯¹ .i æ–‡ä»¶è¿›è¡Œç¼–è¯‘ ä¹Ÿå¯ä»¥å¯¹ .cpp æ–‡ä»¶è¿›è¡Œç¼–è¯‘\n1 g++ -S test.cpp -o test.s ä½œç”¨ï¼š\nç¿»è¯‘æˆæ±‡ç¼–è¯­è¨€ æ£€æŸ¥ä»£ç æŠ¥é”™ å…·ä½“è§£é‡Š ç¼–è¯‘åªæ˜¯æŠŠæˆ‘ä»¬å†™çš„ä»£ç è½¬ä¸ºæ±‡ç¼–ä»£ç ï¼Œå®ƒçš„å·¥ä½œæ˜¯æ£€æŸ¥è¯æ³•å’Œè¯­æ³•è§„åˆ™ï¼Œæ‰€ä»¥ï¼Œå¦‚æœç¨‹åºæ²¡æœ‰è¯æ³•æˆ–åˆ™è¯­æ³•é”™è¯¯ï¼Œé‚£ä¹ˆä¸ç®¡é€»è¾‘æ˜¯æ€æ ·é”™è¯¯çš„ï¼Œéƒ½ä¸ä¼šæŠ¥é”™ã€‚\nç¼–è¯‘ä¸æ˜¯æŒ‡ç¨‹åºä»æºæ–‡ä»¶åˆ°äºŒè¿›åˆ¶ç¨‹åºçš„å…¨éƒ¨è¿‡ç¨‹ï¼Œè€Œæ˜¯æŒ‡å°†ç»è¿‡é¢„å¤„ç†ä¹‹åçš„ç¨‹åºè½¬æ¢æˆç‰¹å®šæ±‡ç¼–ä»£ç (assembly code)çš„è¿‡ç¨‹\nstep3. æ±‡ç¼–é˜¶æ®µ ![[Pasted image 20241027002224.png]] å‘½ä»¤ï¼š\n1 g++ -c test.s -o test.o ä½œç”¨ï¼š\nå°† .s æ–‡ä»¶ï¼Œæ±‡ç¼–æˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ä¸å¯æ‰§è¡Œï¼‰ step4. é“¾æ¥é˜¶æ®µ ![[Pasted image 20241027002618.png]]\nå‘½ä»¤ï¼š\n1 gcc test.o -o test ä½œç”¨ï¼š\nå°†ç›®æ ‡æ–‡ä»¶ .oå’Œåº“æ–‡ä»¶é“¾æ¥ å…·ä½“è§£é‡Šï¼šCè¯­è¨€ä»£ç ç»è¿‡ç¼–è¯‘ä»¥åï¼Œå¹¶æ²¡æœ‰ç”Ÿæˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆ.exe æ–‡ä»¶ï¼‰ï¼Œè€Œæ˜¯ç”Ÿæˆäº†ä¸€ç§å«åšç›®æ ‡æ–‡ä»¶ï¼ˆObject Fileï¼‰çš„ä¸­é—´æ–‡ä»¶ï¼ˆæˆ–è€…è¯´ä¸´æ—¶æ–‡ä»¶ï¼‰ã€‚ç›®æ ‡æ–‡ä»¶ä¹Ÿæ˜¯äºŒè¿›åˆ¶å½¢å¼çš„ï¼Œå®ƒå’Œå¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼æ˜¯ä¸€æ ·çš„ã€‚å¯¹äº Visual C++ï¼Œç›®æ ‡æ–‡ä»¶çš„åç¼€æ˜¯.objï¼›å¯¹äº GCCï¼Œç›®æ ‡æ–‡ä»¶çš„åç¼€æ˜¯.oã€‚è¿™å°±æ˜¯ä¸€å¼€å§‹æ‰€è¯´çš„ç¼–è¯‘å®Œä¸€å †.objå’Œ.oæ–‡ä»¶çš„æ¥æºã€‚\nç›®æ ‡æ–‡ä»¶ç»è¿‡é“¾æ¥ï¼ˆLinkï¼‰ä»¥åæ‰èƒ½å˜æˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚æ—¢ç„¶ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼æ˜¯ä¸€æ ·çš„ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å†é“¾æ¥ä¸€æ¬¡å‘¢ï¼Œå› ä¸ºç¼–è¯‘åªæ˜¯å°†æˆ‘ä»¬è‡ªå·±å†™çš„ä»£ç å˜æˆäº†äºŒè¿›åˆ¶å½¢å¼ï¼Œå®ƒè¿˜éœ€è¦å’Œç³»ç»Ÿç»„ä»¶ï¼ˆæ¯”å¦‚æ ‡å‡†åº“ã€åŠ¨æ€é“¾æ¥åº“ç­‰ï¼‰ç»“åˆèµ·æ¥ï¼Œè¿™äº›ç»„ä»¶éƒ½æ˜¯ç¨‹åºè¿è¡Œæ‰€å¿…é¡»çš„ã€‚é“¾æ¥ï¼ˆLinkï¼‰å…¶å®å°±æ˜¯ä¸€ä¸ªâ€œæ‰“åŒ…â€çš„è¿‡ç¨‹ï¼Œå®ƒå°†æ‰€æœ‰äºŒè¿›åˆ¶å½¢å¼çš„ç›®æ ‡æ–‡ä»¶å’Œç³»ç»Ÿç»„ä»¶ç»„åˆæˆä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚å®Œæˆé“¾æ¥çš„è¿‡ç¨‹ä¹Ÿéœ€è¦ä¸€ä¸ªç‰¹æ®Šçš„è½¯ä»¶ï¼Œå«åšé“¾æ¥å™¨ï¼ˆLinkerï¼‰ã€‚\nC++ç¨‹åºç¼–è¯‘çš„æ—¶å€™å…¶å®åªè¯†åˆ«.cppæ–‡ä»¶ã€‚æ¯ä¸ªcppæ–‡ä»¶éƒ½ä¼šåˆ†åˆ«ç¼–è¯‘ä¸€æ¬¡ï¼Œç”Ÿæˆä¸€ä¸ª.oæˆ–è€….objæ–‡ä»¶ã€‚è¿™ä¸ªæ—¶å€™ï¼Œé“¾æ¥å™¨é™¤äº†å°†ç›®æ ‡æ–‡ä»¶å’Œç³»ç»Ÿç»„ä»¶ç»„åˆèµ·æ¥ï¼Œè¿˜éœ€è¦å°†ç¼–è¯‘å™¨ç”Ÿæˆçš„å¤šä¸ª.oæˆ–è€….objæ–‡ä»¶ç»„åˆèµ·æ¥ã€‚\ng++è‡ªåŠ¨é“¾æ¥äº†ç³»ç»Ÿç»„ä»¶ï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠè‡ªå®šä¹‰å‡½æ•°çš„ç›®æ ‡æ–‡ä»¶ä¸main.oé“¾æ¥å³å¯\né“¾æ¥çš„å…¶ä»–è¿‡ç¨‹ C/C++ç¼–è¯‘é“¾æ¥ - çŸ¥ä¹ (zhihu.com)(è¿›é˜¶)\nåˆå¹¶æ®µ ![[Pasted image 20241027092742.png]]\nè°ƒæ•´æ®µåç§» ![[Pasted image 20241027092757.png]]\nå¤šæ–‡ä»¶g++ç¼–è¯‘æŒ‡ä»¤ ![[Pasted image 20241027222011.png]]\n1 g++ src/cmake_leran.cpp tools/hello.cpp -I includes -o cmake_leran src/cmake_leran.cpp tools/hello.cpp æ˜¯åœ¨æŒ‡å®šå½“å‰ç›®å½•ä¸‹å“ªäº›æºæ–‡ä»¶éœ€è¦ç¼–è¯‘ -I includes æ˜¯ åº“æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•\n![[Pasted image 20241126230718.png]]\næ‚è°ˆ å…³äºåº“æ–‡ä»¶ ![[Pasted image 20241126224636.png]]\n![[Pasted image 20241126224803.png]]\nå…³äºå¯æ‰§è¡Œæ–‡ä»¶ ![[Pasted image 20241126225616.png]]\nå…³äºCä¸C++è”åˆç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ åœ¨C++ä¸­ï¼Œå‘Šè¯‰ç¼–è¯‘å™¨ä»¥Cçš„æ ‡å‡†è¿›è¡Œç¼–è¯‘ C/C++ä¸­çš„ extern å’Œexternâ€œCâ€œå…³é”®å­—çš„ç†è§£å’Œä½¿ç”¨ï¼ˆå¯¹æ¯”ä¸¤è€…çš„å¼‚åŒï¼‰_c extern c-CSDNåšå®¢\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 //å…³é”®å­— extern \u0026#34;C\u0026#34; //example #include\u0026lt;iostream\u0026gt; using namespace std; extern \u0026#34;C\u0026#34; void func() { //ç”¨ extern\u0026#34;C\u0026#34;ä¿®é¥° } extern \u0026#34;C\u0026#34; void func(int v) {//ç”¨ extern\u0026#34;C\u0026#34;ä¿®é¥° } int main() {\treturn 0; } 1 2 3 4 5 6 7 8 9 10 11 12 //å¦‚æœå½“å‰æ–‡ä»¶ä¸ºcppæ–‡ä»¶ï¼Œå°±ä¼šå‘Šè¯‰ç¼–è¯‘å™¨æŒ‰Cè¯­è¨€æ–¹å¼ç¼–è¯‘å’Œé“¾æ¥ //å¦‚æœä¸æ˜¯cppæ–‡ä»¶ï¼Œåˆ™ä¼šè¢«ç•¥è¿‡ #ifdef __cplusplus extern \u0026#34;C\u0026#34; { #endif \u0026lt;è¢«è°ƒç”¨å†…å®¹\u0026gt; #ifdef __cplusplus } #enddif å¦‚æœç¼–è¯‘å™¨æ˜¯ C++ ç¼–è¯‘å™¨ï¼Œ__cplusplusÂ å®ä¼šè¢«å®šä¹‰ï¼Œextern \u0026ldquo;C\u0026rdquo;Â å—å°†ä¼šè¢«åŒ…å«ï¼Œè¿™å‘Šè¯‰ç¼–è¯‘å™¨æŒ‰ç…§ C è¯­è¨€çš„è§„åˆ™æ¥å¤„ç†å‡½æ•°åç§°ï¼Œè€Œä¸æ˜¯ C++ çš„è§„åˆ™ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¿æŒä¸å·²ç»å­˜åœ¨çš„ C ä»£ç åº“çš„å…¼å®¹æ€§ï¼Œç‰¹åˆ«æ˜¯å½“ä½¿ç”¨ C++ ç¼–å†™æ–°ä»£ç æ—¶ã€‚\n__cpluspluså®å®šä¹‰ä½œç”¨ åœ¨ C++ ä¸­ï¼Œ__cplusplusÂ æ˜¯ä¸€ä¸ªé¢„å®šä¹‰çš„å®ï¼Œå®ƒç”¨äºç¡®å®šæ­£åœ¨ä½¿ç”¨çš„ C++ æ ‡å‡†çš„ç‰ˆæœ¬ã€‚è¿™ä¸ªå®çš„å­˜åœ¨ä½¿å¾— C++ ä»£ç èƒ½å¤Ÿä»¥æ ‡å‡† C å½¢å¼è¾“å‡ºï¼Œå³ä»¥ C çš„å½¢å¼è¢«è°ƒç”¨ï¼Œè¿™å¯¹äºè·¨å¹³å°ç¼–ç¨‹å’Œä¸ C è¯­è¨€çš„å…¼å®¹æ€§è‡³å…³é‡è¦ã€‚\nå®çš„å®šä¹‰å’Œä½¿ç”¨ __cplusplusÂ å®é€šå¸¸åœ¨ç¼–å†™æ¶‰åŠ C å’Œ C++ æ··åˆç¼–ç¨‹çš„å¤´æ–‡ä»¶æ—¶ä½¿ç”¨ã€‚å½“ C++ ä»£ç éœ€è¦è¢« C ç¼–è¯‘å™¨è°ƒç”¨æ—¶ï¼Œä½¿ç”¨è¿™ä¸ªå®å¯ä»¥ç¡®ä¿ C++ ä¸­çš„åç§°ä¿®é¥°ï¼ˆname manglingï¼‰ä¸ä¼šå‘ç”Ÿï¼Œä»è€Œå…è®¸ C ä»£ç å®‰å…¨åœ°è°ƒç”¨ C++ å‡½æ•°ã€‚ä¾‹å¦‚ï¼š\n1 2 3 4 5 6 7 8 9 #ifdefÂ __cplusplus externÂ \u0026#34;C\u0026#34;Â { #endif // C++ å‡½æ•°å£°æ˜ #ifdefÂ __cplusplus } #endif ![[Pasted image 20241213212614.png]]\nåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœç¼–è¯‘å™¨æ˜¯ C++ ç¼–è¯‘å™¨ï¼Œ__cplusplusÂ å®ä¼šè¢«å®šä¹‰ï¼Œextern \u0026ldquo;C\u0026rdquo;Â å—å°†ä¼šè¢«åŒ…å«ï¼Œè¿™å‘Šè¯‰ç¼–è¯‘å™¨æŒ‰ç…§ C è¯­è¨€çš„è§„åˆ™æ¥å¤„ç†å‡½æ•°åç§°ï¼Œè€Œä¸æ˜¯ C++ çš„è§„åˆ™ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†ä¿æŒä¸å·²ç»å­˜åœ¨çš„ C ä»£ç åº“çš„å…¼å®¹æ€§ï¼Œç‰¹åˆ«æ˜¯å½“ä½¿ç”¨ C++ ç¼–å†™æ–°ä»£ç æ—¶ã€‚\nå®çš„å€¼ __cplusplusÂ å®çš„å€¼è¡¨ç¤º C++ æ ‡å‡†çš„ç‰ˆæœ¬ï¼Œä¾‹å¦‚ï¼š\nC++98 æ ‡å‡†ï¼š199711L C++11 æ ‡å‡†ï¼š201103L C++14 æ ‡å‡†ï¼š201402L C++17 æ ‡å‡†ï¼š201703L C++20 æ ‡å‡†ï¼š202002L ä¸åŒçš„ç¼–è¯‘å™¨ï¼Œå¦‚ GCCã€Clang æˆ– Visual C++ï¼Œéƒ½éµå¾ªè¿™äº›æ ‡å‡†ï¼Œå¹¶åœ¨ç¼–è¯‘æ—¶å®šä¹‰ç›¸åº”çš„Â __cplusplusÂ å€¼ã€‚è¿™ä¸ªå®çš„å€¼å¯ä»¥ç”¨æ¥ç¡®å®šç¼–è¯‘å™¨æ”¯æŒçš„ C++ ç‰ˆæœ¬ï¼Œä»è€Œåœ¨ç¼–å†™ä»£ç æ—¶åšå‡ºç›¸åº”çš„å…¼å®¹æ€§å¤„ç†ã€‚ å®é™…åº”ç”¨ åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ__cplusplusÂ å®ç¡®ä¿äº† C++ ä»£ç å¯ä»¥ä¸ C ä»£ç æ— ç¼é›†æˆã€‚ä¾‹å¦‚ï¼Œå¦‚æœæœ‰ä¸€ä¸ªç”¨ C è¯­è¨€ç¼–å†™çš„åº“ï¼Œå®ƒçš„å¤´æ–‡ä»¶æ˜¯Â f.hï¼Œäº§ç”Ÿçš„åº“æ–‡ä»¶æ˜¯Â f.libï¼Œé‚£ä¹ˆåœ¨ C++ ä¸­ä½¿ç”¨è¿™ä¸ªåº“æ–‡ä»¶æ—¶ï¼Œéœ€è¦è¿™æ ·å†™ï¼š\n1 2 3 externÂ \u0026#34;C\u0026#34;Â { #includeÂ \u0026#34;f.h\u0026#34; } è¿™æ ·ï¼ŒC++ ç¼–è¯‘å™¨å°±ä¼šçŸ¥é“å¦‚ä½•æ­£ç¡®åœ°é“¾æ¥å’Œè°ƒç”¨ C è¯­è¨€ç¼–å†™çš„å‡½æ•°ã€‚å¦‚æœæ²¡æœ‰ä½¿ç”¨Â __cplusplusÂ å®ï¼Œå¯èƒ½ä¼šå‡ºç°é“¾æ¥é”™è¯¯ï¼Œå› ä¸º C++ ç¼–è¯‘å™¨å’Œ C ç¼–è¯‘å™¨å¯¹å‡½æ•°åç§°çš„å¤„ç†æ–¹å¼ä¸åŒã€‚\næ€»ç»“æ¥è¯´ï¼Œ__cplusplusÂ å®æ˜¯ C++ è¯­è¨€ä¸ºäº†å…¼å®¹ C è¯­è¨€å’Œæ”¯æŒæ··åˆç¼–ç¨‹è€Œæä¾›çš„ä¸€ä¸ªé‡è¦å·¥å…·ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨ä¿æŒ C++ åŠŸèƒ½çš„åŒæ—¶ï¼Œç¡®ä¿ä»£ç èƒ½å¤Ÿåœ¨ä¸åŒçš„ç¼–ç¨‹ç¯å¢ƒä¸­æ­£ç¡®è¿è¡Œã€‚\nå…³äºexternå…³é”®å­— C/C++ä¸­çš„ extern å’Œexternâ€œCâ€œå…³é”®å­—çš„ç†è§£å’Œä½¿ç”¨ï¼ˆå¯¹æ¯”ä¸¤è€…çš„å¼‚åŒï¼‰_c extern c-CSDNåšå®¢ ![[Pasted image 20241213212619.png]]\n","date":"2025-06-24T22:30:22+08:00","permalink":"https://NomadJoeviolet.github.io/p/cc-%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/","title":"C\u0026C++ ç¼–è¯‘è¿‡ç¨‹"},{"content":"STM32 halåº“ä¸²å£ç©ºé—²ä¸­æ–­æœ€æ–°ç”¨æ³• - STM32å›¢é˜Ÿ STæ„æ³•åŠå¯¼ä½“ä¸­æ–‡è®ºå›\nï¼ˆéå¸¸è¯¦ç»†ï¼‰ã€STM32ã€‘ DMAåŸç†ï¼Œæ­¥éª¤è¶…ç»†è¯¦è§£ï¼Œä¸€æ–‡çœ‹æ‡‚DMA-CSDNåšå®¢\nSTM32CubeIDE HALåº“DMAä¸UARTä¸å®šé•¿æ•°æ®æ¥æ”¶å®ç°ï¼šç©ºé—²ä¸­æ–­è¯¦è§£-ç‰©è”æ²ƒ-IOTWORDç‰©è”ç½‘\nSTM32 halåº“ä¸²å£ç©ºé—²ä¸­æ–­æœ€æ–°ç”¨æ³•_stm32halåº“ä¸²å£ç©ºé—²ä¸­æ–­-CSDNåšå®¢\nHALåº“ ä¸²å£ç©ºé—²ä¸­æ–­+DMAæ¥æ”¶ä¸å®šé•¿æ•°æ® è¯¦è§£åŠè¸©å‘_halåº“ä¸²å£ç©ºé—²ä¸­æ–­-CSDNåšå®¢\nï¼ˆå†™çš„éå¸¸å¥½ï¼Œéå¸¸æœ‰åŠ©äºæå‡åº•å±‚ç†è§£ï¼‰ï¼ˆstm32ä¹‹HALåº“ï¼‰UARTå·¥ä½œåœ¨DMAæ¨¡å¼è¦æ‰“å¼€ä¸²å£ä¸­æ–­å—ï¼Ÿ_hal uart dma-CSDNåšå®¢\nDMA DMAï¼Œå…¨ç§°ä¸ºDirect Memory Accessï¼Œç›´æ¥å†…å­˜è®¿é—®ï¼Œæœ¬è´¨æ˜¯å°†ä¼ è¾“æ•°æ®ä»ä¸€ä¸ªå†…å­˜ç©ºé—´æ¬è¿è‡³å¦ä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œå¯ä»¥ç”¨æ¥æä¾›å¤–è®¾å’Œå†…å­˜ï¼Œå†…å­˜å’Œå¤–è®¾ä¹‹é—´çš„é«˜é€Ÿæ•°æ®ä¼ è¾“\nåœ¨HALåº“ä¸­ç›´æ¥ä½¿ç”¨çš„HAL_UART_Transmit_DMAï¼ŒHAL_UART_Receive_DMAï¼ŒHAL_UARTEx_ReceiveToIdle_DMAç­‰éƒ½æœ‰ä¸­æ–­çš„å‚ä¸ï¼Œéœ€è¦åœ¨Cubeä¸­å¼€å¯ä¸­æ–­\nå¯¹å…·ä½“åº•å±‚åŸç†å’ŒDMAæ¨¡å¼å®ç°åº•å±‚ä¸ä¸­æ–­æ¨¡å¼åº•å±‚å®ç°åŒºåˆ«æ„Ÿå…´è¶£å¯å‚è€ƒä»¥ä¸‹åšå®¢ ï¼ˆstm32ä¹‹HALåº“ï¼‰UARTå·¥ä½œåœ¨DMAæ¨¡å¼è¦æ‰“å¼€ä¸²å£ä¸­æ–­å—ï¼Ÿ_hal uart dma-CSDNåšå®¢\nUSARTå‘é€ åœ¨æ™®é€šçš„è½®è¯¢USARTä¸­ï¼ŒCPUä¸€ç›´åœ¨ç­‰å¾…å¤–è®¾å‘é€æ•°æ®ï¼Œå¤–è®¾æ¯å‘é€ä¸€å¸§æ•°æ®ï¼ŒCPUå°±ä»å†…å­˜ä¸­ç§»åŠ¨ä¸€å¸§æ•°æ®åˆ°å¤–è®¾çš„å¯„å­˜å™¨\nåœ¨ä¸­æ–­çš„USARTä¸­ï¼Œå¤–è®¾æ¯ä»å¯„å­˜å™¨ä¸­å‘é€ä¸€å¸§æ•°æ®ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡å‘é€æ•°æ®å¯„å­˜å™¨ç©ºä¸­æ–­ï¼Œä½¿CPUå›æ¥å°†ä¸€å¸§æ•°æ®ä»å†…å­˜æ¬è¿è‡³å¤–è®¾çš„å¯„å­˜å™¨ä¸­\nUSARTçš„DMAå‘é€ æ²¡æœ‰DMAçš„è¯ï¼ŒCPUä¼šä½œä¸ºæ•°æ®å‘é€çš„ä¸­è½¬ç«™ï¼Œè€Œä½¿ç”¨DMAçš„è¯ï¼Œæ•´ä¸ªæ•°æ®ä¼ è¾“è¿‡ç¨‹ä¸éœ€è¦CPUçš„å‚ä¸ï¼Œç”±DMAä»£ç†æ‰§è¡Œï¼ŒDMAè´Ÿè´£å°†å†…å­˜æ•°æ®æ¬è¿è‡³å¤–è®¾çš„ä¼ è¾“å¯„å­˜å™¨\nåœ¨æ•´ä¸ªæ•°æ®å‘é€è¿‡åŠæ—¶ä¼šè§¦å‘ä¸€ä¸ªä¼ è¾“è¿‡åŠä¸­æ–­ï¼Œæ‰€æœ‰æ•°æ®ä¼ è¾“å®Œæˆåä¼šè°ƒç”¨ä¼ è¾“å®Œæˆä¸­æ–­å›è°ƒå‡½æ•°ï¼ˆHAL_UART_TxCpltCallbackï¼‰\n1 HAL_StatusTypeDef HAL_UART_Transmit_DMA(UART_HandleTypeDef *huart, const uint8_t *pData, uint16_t Size) HAL_UART_Transmit_DMAçš„ä¼ è¾“å®Œæˆä¸­æ–­å›è°ƒå‡½æ•°HAL_UART_TxCpltCallbackä»¥åŠä¼ è¾“è¿‡åŠä¸­æ–­å›è°ƒå‡½æ•°HAL_UART_TxHalfCpltCallbackï¼ˆè¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°åœ¨HAL_UART_Transmit_ITä¸­åŒæ ·æœ‰ï¼‰\nDMAå‘é€æ³¨æ„äº‹é¡¹ åœ¨ä¼ è¾“çš„è¿‡ç¨‹ä¸­ï¼Œå½“ä¼ è¾“ä¸€åŠçš„æ•°æ®åï¼ŒåŠä¼ è¾“æ ‡å¿—(HTIF)è¢«ç½®1ï¼Œå½“è®¾ç½®äº†å…è®¸åŠä¼ è¾“ä¸­æ–­ä½(HTIE)æ—¶ï¼Œå°†äº§ç”Ÿä¸€ä¸ªä¸­æ–­è¯·æ±‚ã€‚åœ¨æ•°æ®ä¼ è¾“ç»“æŸåï¼Œä¼ è¾“å®Œæˆæ ‡å¿—(TCIF)è¢«ç½®1ï¼Œå½“è®¾ç½®äº†å…è®¸ä¼ è¾“å®Œæˆä¸­æ–­ä½ (TCIE)æ—¶ï¼Œå°†äº§ç”Ÿä¸€ä¸ªä¸­æ–­è¯·æ±‚\nä¼šè§¦å‘çš„ä¸‰ä¸ªä¸­æ–­ï¼Œä¼ è¾“å®Œæˆä¸­æ–­ï¼Œä¼ è¾“è¿‡åŠä¸­æ–­ï¼Œé”™è¯¯ä¸­æ–­ åœ¨stm32f1xx_hal_uart.cçš„HAL_UART_Transmit_DMAå‡½æ•°ä¸­å¯ä»¥æŸ¥çœ‹åˆ°\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 HAL_StatusTypeDef HAL_UART_Transmit_DMA(UART_HandleTypeDef *huart, const uint8_t *pData, uint16_t Size) { . . . /* Set the UART DMA transfer complete callback */ huart-\u0026gt;hdmatx-\u0026gt;XferCpltCallback = UART_DMATransmitCplt; /* Set the UART DMA Half transfer complete callback */ huart-\u0026gt;hdmatx-\u0026gt;XferHalfCpltCallback = UART_DMATxHalfCplt; /* Set the DMA error callback */ huart-\u0026gt;hdmatx-\u0026gt;XferErrorCallback = UART_DMAError; . . . } } USARTæ¥æ”¶ åœ¨æ™®é€šçš„è½®è¯¢USARTä¸­ï¼ŒCPUä¸€ç›´åœ¨è¯¢é—®å¤–è®¾æ˜¯å¦æ¥æ”¶å®Œæ•°æ®ï¼Œå¤–è®¾æ¥æ”¶ä¸€å¸§æ•°æ®ï¼Œè¯¥ä½æ•°æ®ç”±CPUä»å¤–è®¾çš„æ•°æ®æ¥æ”¶å¯„å­˜å™¨è¿è¿›å†…å­˜ï¼ŒCPUå†æ¬¡è¯¢é—®å¤–è®¾æ˜¯å¦æ¥æ”¶å®Œæ•°æ®ï¼Œå†è¿ï¼Œç›´è‡³æ•´ä¸ªæ•°æ®æ¥æ”¶å®Œæˆ\nè€Œåœ¨ä¸­æ–­USARTä¸­ï¼Œå¤–è®¾æ¯æ¥æ”¶ä¸€å¸§æ•°æ®ï¼Œè§¦å‘ä¸€æ¬¡æ•°æ®æ¥æ”¶å¯„å­˜å™¨éç©ºä¸­æ–­ï¼ŒCPUè¿‡æ¥å°†æ•°æ®ä»å¯„å­˜å™¨æ¬è¿è‡³å†…å­˜ï¼Œæ‰€æœ‰æ•°æ®æ¥æ”¶å®Œæˆåï¼Œä¼šè°ƒç”¨æ¥æ”¶å®Œæˆä¸­æ–­å›è°ƒå‡½æ•°ï¼ˆHAL_UART_RxCpltCallbackï¼‰\nUSARTçš„DMAæ¥æ”¶ æ²¡æœ‰DMAçš„è¯ï¼ŒCPUä¼šä½œä¸ºæ•°æ®è½¬è¿çš„ä¸­è½¬ç«™ï¼Œè€Œä½¿ç”¨DMAçš„è¯ï¼Œæ•´ä¸ªæ•°æ®è½¬è¿è¿‡ç¨‹ä¸éœ€è¦CPUçš„å‚ä¸ï¼Œç”±DMAä»£ç†æ‰§è¡Œ\nåœ¨æ•´ä¸ªæ•°æ®æ¥æ”¶è¿‡åŠæ—¶ä¼šè§¦å‘ä¸€ä¸ªä¼ è¾“è¿‡åŠä¸­æ–­ï¼Œæ‰€æœ‰æ•°æ®æ¥æ”¶å®Œæˆåä¼šè°ƒç”¨ä¼ è¾“å®Œæˆä¸­æ–­å›è°ƒå‡½æ•°ï¼ˆHAL_UART_RxCpltCallbackï¼‰\n1 HAL_StatusTypeDef HAL_UART_Receive_DMA(UART_HandleTypeDef *huart, const uint8_t *pData, uint16_t Size) HAL_UART_Receive_DMAçš„æ¥æ”¶å®Œæˆä¸­æ–­å›è°ƒå‡½æ•°HAL_UART_RxCpltCallbackä»¥åŠæ¥æ”¶è¿‡åŠä¸­æ–­å›è°ƒå‡½æ•°HAL_UART_RxHalfCpltCallbackï¼ˆè¿™ä¸¤ä¸ªå›è°ƒå‡½æ•°åœ¨HAL_UART_Receive_ITä¸­åŒæ ·æœ‰ï¼‰\nDMAæ¥æ”¶æ³¨æ„äº‹é¡¹ åŒDMAå‘é€ï¼Œç±»æ¯”å³å¯\nHALåº“USARTä½¿ç”¨DMA å¦‚æœUSARTä¸²å£çš„DMAå‡ºç°é”™è¯¯ï¼Œä¼šè°ƒç”¨HAL_UART_ErrorCallback\nDMAå‘é€ 1 HAL_StatusTypeDef HAL_UART_Transmit_DMA(UART_HandleTypeDef *huart, const uint8_t *pData, uint16_t Size) ä¼šè§¦å‘ä¸­æ–­ï¼Œå¯¹åº”å›è°ƒå‡½æ•°ä¸º\nHAL_UART_TxCpltCallback HAL_UART_TxHalfCpltCallback DMAæ¥æ”¶ 1 HAL_StatusTypeDef HAL_UART_Receive_DMA(UART_HandleTypeDef *huart, const uint8_t *pData, uint16_t Size) ä¼šè§¦å‘çš„ä¸­æ–­ï¼Œå¯¹åº”çš„å›è°ƒå‡½æ•°ä¸º\nHAL_UART_RxCpltCallback HAL_UART_RxHalfCpltCallback DMAæ¨¡å¼ normalæ¨¡å¼ ä»¥æ¥æ”¶ä¸ºä¾‹ å•æ¬¡æ¥æ”¶ï¼Œæ¥æ”¶è‡³æ•°æ®ä¸Šé™ï¼Œå®Œæˆæ•´ä¸ªå›ºå®šæ•°æ®æ¥æ”¶ååœæ­¢ï¼Œå†æ¬¡æ¥æ”¶éœ€è¦å†æ¬¡å¼€å¯HAL_UART_Receive_DMA ï¼Œéœ€è¦è½¯ä»¶æ˜¾å¼é‡å¯ï¼Œè§¦å‘æ¥æ”¶è¿‡åŠå’Œæ¥æ”¶å®Œæˆä¸­æ–­\nsummaryï¼šå•æ¬¡ä¼ è¾“ï¼Œå®Œæˆååœæ­¢ï¼Œéœ€è¦è½¯ä»¶æ˜¾å¼é‡å¯ï¼Œæ¥æ”¶è¿‡åŠå’Œæ¥æ”¶å®Œæˆä¸­æ–­\ncircularæ¨¡å¼ ä»¥æ¥æ”¶ä¸ºä¾‹ æ— é™å¾ªç¯ï¼Œæ¥æ”¶è‡³æ•°æ®ä¸Šé™ä¸€åŠï¼Œè§¦å‘æ¥æ”¶è¿‡åŠä¸­æ–­ï¼Œæ¥å—è‡³æ•°æ®ä¸Šé™ï¼Œè§¦å‘æ¥æ”¶å®Œæˆä¸­æ–­ï¼ŒåŒæ—¶ä¼šç¡¬ä»¶è‡ªåŠ¨é‡å¯ï¼Œæ¥æ”¶å®Œæˆä¸­æ–­ä¼šè°ƒç”¨å¯¹åº”çš„æ¥æ”¶å®Œæˆä¸­æ–­å›è°ƒå‡½æ•°\nsummaryï¼šæ— é™å¾ªç¯ï¼Œç¡¬ä»¶è‡ªåŠ¨é‡å¯ï¼Œæ¥æ”¶è¿‡åŠå’Œæ¥æ”¶å®Œæˆä¸­æ–­\nç©ºé—²ä¸­æ–­ ç©ºé—²ä¸­æ–­å®šä¹‰ ç©ºé—²ä¸­æ–­ï¼ˆIDLE Interruptï¼‰Â æ˜¯UARTé€šä¿¡ä¸­çš„ä¸€ç§ç‰¹æ®Šä¸­æ–­ç±»å‹ï¼Œå®ƒåœ¨æ£€æµ‹åˆ°UARTæ¥æ”¶çº¿è·¯è¿ç»­ç©ºé—²è¶…è¿‡1ä¸ªå­—èŠ‚ä¼ è¾“æ—¶é—´æ—¶è§¦å‘çš„ä¸­æ–­ã€‚\u0026ldquo;ç©ºé—²\u0026quot;æŒ‡çº¿è·¯ä¿æŒé€»è¾‘1çŠ¶æ€ï¼ˆé«˜ç”µå¹³ï¼‰ï¼Œçº¿ä¸Šæ— æ•°æ®ä¼ è¾“\nHALåº“è‡ªå¸¦çš„ç©ºé—²ä¸­æ–­å®ç° ä½¿ç”¨çš„æ˜¯HALåº“æä¾›çš„æ‹“å±•å‡½æ•°ï¼ŒåŒæ—¶éƒ½éœ€è¦åœ¨Cubeä¸­å¼€å¯ä¸­æ–­\n1 2 //åœ¨é˜»å¡æ¨¡å¼ä¸‹æ¥æ”¶ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œç›´åˆ°æ¥æ”¶åˆ°é¢„æœŸæ•°é‡çš„æ•°æ®æˆ–å‘ç”Ÿç©ºé—²äº‹ä»¶ã€‚ HAL_StatusTypeDef HAL_UARTEx_ReceiveToIdle(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size, uint16_t *RxLen, uint32_t Timeout); 1 2 //åœ¨ä¸­æ–­æ¨¡å¼ä¸‹æ¥æ”¶ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œç›´åˆ°æ¥æ”¶åˆ°é¢„æœŸæ•°é‡çš„æ•°æ®æˆ–å‘ç”Ÿç©ºé—²äº‹ä»¶ã€‚ HAL_StatusTypeDef HAL_UARTEx_ReceiveToIdle_IT(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size); 1 2 //åœ¨DMAæ¨¡å¼ä¸‹æ¥æ”¶ä¸€å®šæ•°é‡çš„æ•°æ®ï¼Œç›´åˆ°æ¥æ”¶åˆ°é¢„æœŸæ•°é‡çš„æ•°æ®æˆ–å‘ç”Ÿç©ºé—²äº‹ä»¶ã€‚ HAL_StatusTypeDef HAL_UARTEx_ReceiveToIdle_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size); 1 2 //ä½¿ç”¨ç©ºé—²ä¸­æ–­æ—¶çš„æ¥æ”¶å›è°ƒå‡½æ•° void HAL_UARTEx_RxEventCallback(UART_HandleTypeDef *huart, uint16_t Size); åœ¨è§¦å‘ç©ºé—²ä¸­æ–­ï¼Œæ¥æ”¶å®Œæˆä¸­æ–­éƒ½ä¼šè°ƒç”¨HAL_UARTEx_RxEventCallbackå›è°ƒå‡½æ•°ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨F103c8t6å•ç‰‡æœºä»¥åŠå…¶ä»–stç³»åˆ—å•ç‰‡æœºä¸Šï¼Œä½¿ç”¨HAL_UARTEx_ReceiveToIdle_DMAæ—¶ï¼Œæ¥æ”¶è¿‡åŠä¸­æ–­ä¹Ÿä¼šå»è°ƒç”¨è¯¥å›è°ƒå‡½æ•°\næ¥æ”¶è¿‡åŠä¸­æ–­çš„å¤„ç† STM32CubeIDE HALåº“DMAä¸UARTä¸å®šé•¿æ•°æ®æ¥æ”¶å®ç°ï¼šç©ºé—²ä¸­æ–­è¯¦è§£-ç‰©è”æ²ƒ-IOTWORDç‰©è”ç½‘ HAL_UARTEx_RecceiveToIdle_DMAä¼šè°ƒç”¨UART_Start_Receive_DMA(huart, pData, Size)å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼šæŠŠDMAä¸­æ–­ä¼ è¾“å®Œæˆï¼ŒåŠä¼ è¾“ï¼Œä¼ è¾“é”™è¯¯å…¨éƒ¨å¼€å¯\n1 __HAL_DMA_ENABLE_IT(DMA_IT_TC | DMA_IT_HC | DMA_IT_TE) UART_Start_Receive_DMA(huart, pData, Size) è®¾ç½®æ¥æ”¶æ•°ç»„ç¼“å­˜åˆ°è¾¾æ•°ç»„ä¸€åŠæ—¶ä¼šæ‰§è¡Œä¸‹é¢çš„å›è°ƒå‡½æ•°\n1 2 /* Set the UART DMA Half transfer complete callback */ huart-\u0026gt;hdmarx-\u0026gt;XferHalfCpltCallback = UART_DMARxHalfCplt; åœ¨DMAçš„ä¸­æ–­å¤„ç†å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨huart-\u0026gt;hdmarx-\u0026gt;XferHalfCpltCallbackï¼Œæ­¤å¤„å³UART_DMARxHalfCplt\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 void HAL_DMA_IRQHandler(DMA_HandleTypeDef *hdma) { uint32_t flag_it = hdma-\u0026gt;DmaBaseAddress-\u0026gt;ISR; uint32_t source_it = hdma-\u0026gt;Instance-\u0026gt;CCR; /* Half Transfer Complete Interrupt management ******************************/ if (((flag_it \u0026amp; (DMA_FLAG_HT1 \u0026lt;\u0026lt; hdma-\u0026gt;ChannelIndex)) != RESET) \u0026amp;\u0026amp; ((source_it \u0026amp; DMA_IT_HT) != RESET)) { ...... if(hdma-\u0026gt;XferHalfCpltCallback != NULL) { /* Half transfer callback */ hdma-\u0026gt;XferHalfCpltCallback(hdma); } ...... } ...... } è€ŒUART_DMARxHalfCpltä¼šè°ƒç”¨HAL_UARTEx_RxEventCallback\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 static void UART_DMARxHalfCplt(DMA_HandleTypeDef *hdma) { UART_HandleTypeDef *huart = (UART_HandleTypeDef *)((DMA_HandleTypeDef *)hdma)-\u0026gt;Parent; /* Initialize type of RxEvent that correspond to RxEvent callback execution; In this case, Rx Event type is Half Transfer */ huart-\u0026gt;RxEventType = HAL_UART_RXEVENT_HT; /* Check current reception Mode : If Reception till IDLE event has been selected : use Rx Event callback */ if (huart-\u0026gt;ReceptionType == HAL_UART_RECEPTION_TOIDLE) { #if (USE_HAL_UART_REGISTER_CALLBACKS == 1) /*Call registered Rx Event callback*/ huart-\u0026gt;RxEventCallback(huart, huart-\u0026gt;RxXferSize / 2U); #else /*Call legacy weak Rx Event callback*/ HAL_UARTEx_RxEventCallback(huart, huart-\u0026gt;RxXferSize / 2U); #endif /* USE_HAL_UART_REGISTER_CALLBACKS */ } else { /* In other cases : use Rx Half Complete callback */ #if (USE_HAL_UART_REGISTER_CALLBACKS == 1) /*Call registered Rx Half complete callback*/ huart-\u0026gt;RxHalfCpltCallback(huart); #else /*Call legacy weak Rx Half complete callback*/ HAL_UART_RxHalfCpltCallback(huart); #endif /* USE_HAL_UART_REGISTER_CALLBACKS */ } } ä¸ºäº†é¿å…æ¥æ”¶è¿‡åŠä¸­æ–­çš„è°ƒç”¨ï¼Œéœ€è¦ä½¿ç”¨ä¸‹é¢çš„è¯­å¥\n1 __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx,DMA_IT_HT);//å…³é—­dmaæ¥æ”¶åŠæ»¡ä¸­æ–­å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ¥æ”¶ä¸€ç»„æ•°æ®æ—¶å°±ä¸ä¼šè§¦å‘åŠæ»¡ä¸­æ–­ï¼Œdmaå°±å¯ä»¥æ­£å¸¸æ¥æ”¶ä¸€ç»„æ•°æ® å¦å¤–åœ¨UART_DMAReceiveCpltå‡½æ•°ä¸­ä¹Ÿè°ƒç”¨äº†HAL_UARTEx_RxEventCallbackå‡½æ•°\n1 static void UART_DMAReceiveCplt(DMA_HandleTypeDef *hdma) DMA+ç©ºé—²ä¸­æ–­çš„å®ç°æ¥æ”¶ä¸å®šé•¿æ•°æ® æ–¹å¼1 è‡ªå®šä¹‰DMA+ç©ºé—²ä¸­æ–­\nå‰ç½®å†…å®¹ éœ€è¦è‡ªå·±å†™çš„å®å®šä¹‰\n1 2 #define __HAL_DMA_SET_COUNTERT(__HANDLE__,__COUNTER__) ((__HANDLE__)-\u0026gt;Instance-\u0026gt;CNDTR = (uint16_t)(__COUNTER__)) //é‡æ–°è®¾å®šè®¡æ•°å€¼ 1 2 //ç”¨æ³• __HAL_DMA_SET_COUNTERT(huart-\u0026gt;hdmarx,rxBufferLen); ç”¨åˆ°çš„å®å®šä¹‰\n1 2 __HAL_DMA_GET_COUNTER(huart-\u0026gt;hdmarx) //è·å–å‰©ä½™æœªä¼ è¾“çš„è®¡æ•°å€¼ ç”¨åˆ°çš„å…³äºä¸­æ–­çš„æ“ä½œ\n1 2 3 4 5 6 7 8 9 10 __HAL_DMA_DISABLE(huart-\u0026gt;hdmarx)//å…³é—­DMA __HAL_DMA_ENABLE(huart-\u0026gt;hdmarx)//å¼€å¯DMA //æ¸…é™¤ç©ºé—²æ ‡å¿—ä½ __HAL_UART_CLEAR_IDLEFLAG(\u0026amp;huart1) //å¼€å¯ç©ºé—²ä¸­æ–­ __HAL_UART_ENABLE_IT(\u0026amp;huart1 , UART_IT_IDLE ) //å…³é—­ç©ºé—²ä¸­æ–­ __HAL_UART_DISABLE_IT(\u0026amp;huart1, UART_IT_IDLE ) ä»£ç å®ç° 1 2 3 #define rxBufferLen 10 uint8_t rxBuffer[rxBufferLen]; uint8_t txBuffer[rxBufferLen]; 1 2 3 4 5 void UART_InitDMAReceive() { __HAL_UART_CLEAR_IDLEFLAG(\u0026amp;huart1);//æ¸…é™¤ç©ºé—²ä¸­æ–­æ ‡å¿—ä½ __HAL_UART_ENABLE_IT(\u0026amp;huart1 , UART_IT_IDLE );//ä½¿èƒ½ç©ºé—²ä¸­æ–­ HAL_UART_Receive_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen);//å¼€å¯DMAæ¥æ”¶ } éœ€è¦å…³é—­DMAæ‰èƒ½é‡è®¾DMAçš„COUNTER\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 //è‡ªå®šä¹‰çš„DMAç©ºé—²ä¸­æ–­å›è°ƒå‡½æ•° void UART_DMAIdleCallback(UART_HandleTypeDef *huart) { if (huart == \u0026amp;huart1 ) { __HAL_DMA_DISABLE(huart-\u0026gt;hdmarx);//å¤±èƒ½DMA int datalen = rxBufferLen - __HAL_DMA_GET_COUNTER(huart-\u0026gt;hdmarx); for(int i=0;i\u0026lt;datalen;i++) { char temp = rxBuffer[i]; txBuffer[i] = (temp \u0026gt;= \u0026#39;a\u0026#39; \u0026amp;\u0026amp; temp \u0026lt;= \u0026#39;z\u0026#39;) ? temp-32:temp; } HAL_UART_Transmit_DMA(\u0026amp;huart1,(uint8_t*)txBuffer,datalen); __HAL_DMA_SET_COUNTERT(huart-\u0026gt;hdmarx,rxBufferLen);//é‡ç½®DMAè®¡æ•° __HAL_DMA_ENABLE(huart-\u0026gt;hdmarx);//ä½¿èƒ½DMA } } 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 void USART1_IRQHandler(void) { /* USER CODE BEGIN USART1_IRQn 0 */ /* USER CODE END USART1_IRQn 0 */ HAL_UART_IRQHandler(\u0026amp;huart1); /* USER CODE BEGIN USART1_IRQn 1 */ //è§¦å‘ç©ºé—²ä¸­æ–­åï¼Œä¼šè¿›å…¥ä¸­æ–­è¯·æ±‚å¤„ç†å‡½æ•° if (__HAL_UART_GET_FLAG(\u0026amp;huart1 , UART_FLAG_IDLE) != RESET ) {//åœ¨æ­¤åˆ¤æ–­æ˜¯å¦ä¸ºç©ºé—²ä¸­æ–­ __HAL_UART_CLEAR_IDLEFLAG(\u0026amp;huart1);//æ¸…é™¤ç©ºé—²ä¸­æ–­æ ‡å¿—ä½ __HAL_UART_DISABLE_IT(\u0026amp;huart1, UART_IT_IDLE);//å¤±èƒ½ç©ºé—²ä¸­æ–­ UART_DMAIdleCallback(\u0026amp;huart1);//è°ƒç”¨è‡ªå®šä¹‰ä¸­æ–­å›è°ƒå‡½æ•° __HAL_UART_ENABLE_IT(\u0026amp;huart1, UART_IT_IDLE);//ä½¿èƒ½ç©ºé—²ä¸­æ–­ } /* USER CODE END USART1_IRQn 1 */ } å…³äºnormalå’Œcircularåœ¨æ–¹å¼1çš„ç©ºé—²ä¸­æ–­å®ç°çš„åŒºåˆ« normalæ¨¡å¼ åœ¨ä¸Šè¿°ç©ºé—²ä¸­æ–­å®ç°ä¸­ï¼Œå¦‚æœä½¿ç”¨normalæ¨¡å¼ï¼Œéœ€è¦æ³¨æ„æ¥æ”¶çš„æ•°æ®ä¸€å®šä¸èƒ½è¶…è¿‡rxBufferLenï¼Œä¸€æ—¦è¶…è¿‡ï¼ŒDMAæ¥æ”¶å°±ä¼šç»ˆæ­¢\næ‰§è¡Œæµç¨‹æ˜¯ï¼Œè§¦å‘ç©ºé—²ä¸­æ–­ï¼Œè¿›å…¥USART1_IRQHandlerï¼Œå†è¿›å…¥è‡ªå®šä¹‰ç©ºé—²ä¸­æ–­ï¼Œåœ¨é‡Œé¢é‡æ–°è®¾ç½®äº†DMAçš„è®¡æ•°å€¼ï¼ˆæŒ‡é’ˆä¹Ÿä¼šé‡æ–°è®¾ç½®ï¼Œé‡æ–°æŒ‡å‘rxBuffer[0]ï¼‰ï¼Œæœ€å¼€å§‹å¼€å¯çš„HAL_UART_Receive_DMAå§‹ç»ˆæ²¡æœ‰æ¥æ”¶å®Œ å®Œæ•´çš„æ•°æ®ï¼Œå°±ä¸ä¼šå…³é—­ï¼Œä¸€ç›´æ¥æ”¶\nä½†å¦‚æœæ¥æ”¶çš„æ•°æ®è¶…è¿‡rxBufferLenï¼Œä¼šè§¦å‘æ¥æ”¶è¿‡åŠå’Œæ¥æ”¶å®Œæˆä¸­æ–­ï¼ˆå¯¹åº”å›è°ƒå‡½æ•°æ²¡ä½¿ç”¨ï¼Œçº¦ç­‰äºç©ºå‡½æ•°ï¼‰ï¼ŒåŒæ—¶HAL_UART_Receive_DMAä¼šç»“æŸï¼Œéœ€è¦è½¯ä»¶æ˜¾å¼é‡å¯\nä¾‹å¦‚ï¼šrxBufferlen=10ï¼Œå‘é€12345678910ï¼Œä¼šå›å¤1234567891ï¼ŒéšåDMAç»ˆæ­¢ï¼Œå†å‘é€æ•°æ®æ— å›å¤\ncircularæ¨¡å¼ åœ¨ä¸Šè¿°ç©ºé—²ä¸­æ–­å®ç°ä¸­ï¼Œå¦‚æœä½¿ç”¨circularæ¨¡å¼ï¼Œåˆ™æ¥æ”¶çš„æ•°æ®å¯ä»¥è¶…è¿‡rxBufferLenï¼Œè¶…è¿‡åï¼ŒDMAæ¥æ”¶ä¼šè‡ªåŠ¨é‡å¯\næ‰§è¡Œæµç¨‹æ˜¯ï¼Œè§¦å‘ç©ºé—²ä¸­æ–­ï¼Œè¿›å…¥USART1_IRQHandlerï¼Œå†è¿›å…¥è‡ªå®šä¹‰ç©ºé—²ä¸­æ–­ï¼Œåœ¨é‡Œé¢é‡æ–°è®¾ç½®äº†DMAçš„è®¡æ•°å€¼ï¼ˆæŒ‡é’ˆä¹Ÿä¼šé‡æ–°è®¾ç½®ï¼Œé‡æ–°æŒ‡å‘rxBuffer[0]ï¼‰ï¼Œå°±ç®—æ¥æ”¶æ•°æ®è¶…è¿‡rxBufferLenï¼ŒHAL_UART_Receive_DMAä¹Ÿä¼šé‡æ–°å¯åŠ¨\nä½†æ˜¯éœ€è¦æ³¨æ„ï¼Œå¦‚æœè¾¾åˆ°rxBufferLen,ä¼šè§¦å‘æ¥æ”¶è¿‡åŠå’Œæ¥æ”¶å®Œæˆä¸­æ–­ï¼Œç„¶åç¡¬ä»¶é‡å¯ï¼Œé‡æ–°å›åˆ°rxBufferLen[0]çš„ä½ç½®è¯»æ•°æ®ï¼Œç›´è‡³å‘ç”Ÿç©ºé—²ä¸­æ–­\nä¾‹å¦‚ï¼šrxBufferlen=10ï¼Œå‘é€12345678910ï¼Œä¼šå›å¤0ï¼ŒéšåDMAä»ç„¶æ­£å¸¸å·¥ä½œ\næ–¹å¼2 ä½¿ç”¨HALåº“æä¾›çš„æ‹“å±•ç©ºé—²ä¸­æ–­ï¼Œä½¿ç”¨normalæ¨¡å¼\nè¯¥æ–¹å¼ä¸‹çš„ç©ºé—²ä¸­æ–­å›è°ƒå‡½æ•°ä¸ºHAL_UARTEx_RxEventCallback ï¼Œéœ€è¦æ³¨æ„æ¥æ”¶è¿‡åŠä¸­æ–­ä¹Ÿä¼šè°ƒç”¨HAL_UARTEx_RxEventCallbackçš„é—®é¢˜ï¼Œåœ¨æ¯æ¬¡å¼€å¯HAL_UARTEx_ReceiveToIdle_DMAåéƒ½éœ€è¦å…³é—­æ¥æ”¶è¿‡åŠä¸­æ–­\n1 __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx,DMA_IT_HT);//å…³é—­dmaæ¥æ”¶åŠæ»¡ä¸­æ–­å‡½æ•°ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨æ¥æ”¶ä¸€ç»„æ•°æ®æ—¶å°±ä¸ä¼šè§¦å‘åŠæ»¡ä¸­æ–­ï¼Œdmaå°±å¯ä»¥æ­£å¸¸æ¥æ”¶ä¸€ç»„æ•°æ® æ³¨æ„éœ€è¦æ·»åŠ \n1 2 3 extern UART_HandleTypeDef huart1; extern DMA_HandleTypeDef hdma_usart1_rx; extern DMA_HandleTypeDef hdma_usart1_tx; å½“æ¥æ”¶æ•°æ®è¶…è¿‡rxBufferLenæ—¶ï¼Œæ¥æ”¶å®Œæˆä¸­æ–­å‡½æ•°ä¼šè°ƒç”¨HAL_UARTEx_RxEventCallbackå›è°ƒå‡½æ•°ï¼Œç„¶åé‡æ–°å¼€å¯æ¥æ”¶\nä¾‹å¦‚ï¼šrxBufferLen=10ï¼Œæ¥æ”¶12345678910ï¼Œå‘é€1234567891ï¼ˆå°±æ˜¯å› ä¸ºæ¥æ”¶å®Œæˆä¸­æ–­å¯¼è‡´ï¼‰ï¼Œåé¢DMAç©ºé—²ä¸­æ–­æ¥æ”¶æ­£å¸¸å¼€å¯\nä»£ç å®ç° 1 2 3 4 5 6 7 extern UART_HandleTypeDef huart1; extern DMA_HandleTypeDef hdma_usart1_rx; extern DMA_HandleTypeDef hdma_usart1_tx; #define rxBufferLen 512 uint8_t rxBuffer[rxBufferLen]; uint8_t txBuffer[rxBufferLen]; 1 2 3 4 void Init_IdleDMA(void) {//åˆå§‹åŒ–ï¼Œå¼€å¯DMAç©ºé—²ä¸­æ–­æ¥æ”¶ HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen); __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx, DMA_IT_HT);//å…³é—­f103æ¿å­DMAçš„æ¥æ”¶è¿‡åŠä¸­æ–­ } 1 2 3 4 5 6 7 8 9 void HAL_UARTEx_RxEventCallback(UART_HandleTypeDef *huart, uint16_t Size) {//æ¥æ”¶å®Œæˆå’Œæ¥æ”¶è¿‡åŠï¼Œç©ºé—²ä¸­æ–­éƒ½ä¼šè°ƒç”¨è¯¥ä¸­æ–­å›è°ƒå‡½æ•° if (huart == \u0026amp;huart1 ) { memcpy(txBuffer, rxBuffer, Size); HAL_UART_Transmit(\u0026amp;huart1, (uint8_t*)txBuffer, Size,10); HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen);//normalæ¨¡å¼ï¼Œæ¥å—ä¸€æ¬¡åéœ€è¦é‡æ–°å¼€å¯ __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx, DMA_IT_HT);//å…³é—­f103æ¿å­DMAçš„æ¥æ”¶è¿‡åŠä¸­æ–­ } //Init_IdldeDMA(); } å…³äºnormalå’Œcircularåœ¨æ–¹å¼2ä¸‹çš„ç©ºé—²ä¸­æ–­å®ç°çš„åŒºåˆ« normalæ¨¡å¼ æ–¹å¼2ä¸­ï¼Œåœ¨æ•°æ®æ¥æ”¶è¿‡åŠï¼Œæ¥æ”¶å®Œæˆï¼Œç©ºé—²æ—¶ä¼šè§¦å‘å¯¹åº”ä¸­æ–­ï¼Œæœ€åè°ƒç”¨HAL_UARTEx_RxEventCallbackå›è°ƒå‡½æ•°ï¼Œåœ¨å›è°ƒå‡½æ•°ä¸­è½¯ä»¶æ˜¾å¼é‡å¯HAL_UARTEx_ReceiveToIdle_DMA\ncircularæ¨¡å¼ æ–¹å¼2ä¸­ï¼Œè‹¥ä½¿ç”¨circularæ¨¡å¼ï¼Œåˆ™æ•°æ®ä¼šä¸€ç›´ç§¯ç´¯ï¼Œåˆ°è¾¾rxBufferLenæ—¶ï¼Œä¼šç¡¬ä»¶é‡å¯ï¼ŒåŒæ—¶ä¹Ÿä¼šæœ‰æ•°æ®æ¥æ”¶è¿‡åŠï¼Œæ¥æ”¶å®Œæˆï¼Œç©ºé—²æ—¶ä¼šè§¦å‘å¯¹åº”ä¸­æ–­ï¼Œæœ€åè°ƒç”¨HAL_UARTEx_RxEventCallbackå›è°ƒå‡½æ•°\nä¾‹å¦‚ï¼š (1)å…³é—­æ¥æ”¶è¿‡åŠä¸­æ–­ rxBufferLen=10ï¼Œæ¥æ”¶123ï¼Œå‘é€123ï¼Œ å†æ¥æ”¶456ï¼Œå‘é€123456ï¼Œ å†æ¥æ”¶78910ï¼Œä¼šå…ˆå‘é€1234567891ï¼ˆæ¥æ”¶å®Œæˆï¼‰ï¼Œå†å‘é€0ï¼ˆç©ºé—²ä¸­æ–­ï¼‰ï¼Œ å†æ¥æ”¶111213ï¼Œå‘é€0111213\n(2)æœªå…³é—­æ¥æ”¶è¿‡åŠä¸­æ–­ rxBufferLen=10ï¼Œæ¥æ”¶123ï¼Œå‘é€123ï¼Œ å†æ¥æ”¶123ï¼Œä¼šå…ˆå‘é€12312ï¼ˆæ¥æ”¶è¿‡åŠä¸­æ–­ï¼‰ï¼Œå†å‘é€123123ç©ºé—²ä¸­æ–­ï¼Œ å†æ¥æ”¶12345ï¼Œä¼šå…ˆå‘é€1231231234ï¼ˆæ¥æ”¶å®Œæˆä¸­æ–­ï¼‰ï¼Œå†å‘é€5ç©ºé—²ä¸­æ–­\næ–¹å¼3 ä½¿ç”¨HALåº“æä¾›çš„ç©ºé—²ä¸­æ–­ï¼Œä½†æ˜¯ä½¿ç”¨circularæ¨¡å¼å®ç°\nåœ¨circuarè¦æƒ³å®ç°ä¸€å¸§ä¸€å¸§ä¸å®šé•¿æ•°æ®çš„æ¥æ”¶ä¸»è¦éœ€è¦è€ƒè™‘çš„å°±æ˜¯å¦‚ä½•å®ç°åœ¨æ¥æ”¶å®Œä¸€å¸§åè®©DMAçš„è®¡æ•°å€¼é‡ç½®\nå®ç°åŸç† å…³é—­ è¦å®ç°DMAè®¡æ•°å€¼çš„é‡ç½®ï¼Œéœ€è¦ä½¿ç”¨HAL_UART_DMAStop(\u0026amp;huart1)å‡½æ•°å°†DMAå…³é—­\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 HAL_StatusTypeDef HAL_UART_DMAStop(UART_HandleTypeDef *huart) { uint32_t dmarequest = 0x00U; /* The Lock is not implemented on this API to allow the user application to call the HAL UART API under callbacks HAL_UART_TxCpltCallback() / HAL_UART_RxCpltCallback(): when calling HAL_DMA_Abort() API the DMA TX/RX Transfer complete interrupt is generated and the correspond call back is executed HAL_UART_TxCpltCallback() / HAL_UART_RxCpltCallback() */ /* Stop UART DMA Tx request if ongoing */ dmarequest = HAL_IS_BIT_SET(huart-\u0026gt;Instance-\u0026gt;CR3, USART_CR3_DMAT); if ((huart-\u0026gt;gState == HAL_UART_STATE_BUSY_TX) \u0026amp;\u0026amp; dmarequest) { ATOMIC_CLEAR_BIT(huart-\u0026gt;Instance-\u0026gt;CR3, USART_CR3_DMAT); /* Abort the UART DMA Tx channel */ if (huart-\u0026gt;hdmatx != NULL) { HAL_DMA_Abort(huart-\u0026gt;hdmatx); } UART_EndTxTransfer(huart); } /* Stop UART DMA Rx request if ongoing */ dmarequest = HAL_IS_BIT_SET(huart-\u0026gt;Instance-\u0026gt;CR3, USART_CR3_DMAR); if ((huart-\u0026gt;RxState == HAL_UART_STATE_BUSY_RX) \u0026amp;\u0026amp; dmarequest) { ATOMIC_CLEAR_BIT(huart-\u0026gt;Instance-\u0026gt;CR3, USART_CR3_DMAR); /* Abort the UART DMA Rx channel */ if (huart-\u0026gt;hdmarx != NULL) { HAL_DMA_Abort(huart-\u0026gt;hdmarx); } UART_EndRxTransfer(huart); } return HAL_OK; } å…¶ä¸­ä¼šè°ƒç”¨HAL_DMA_Abort(huart-\u0026gt;hdmatx)ï¼Œä½†éƒ½ä¸ä¼šé‡ç½®DMAçš„è®¡æ•°å€¼\nå¼€å¯ åœ¨å…³é—­DMAåï¼Œéœ€è¦HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen)é‡æ–°å¼€å¯DMAä»¥åŠç©ºé—²ä¸­æ–­\nåœ¨HAL_UARTEx_ReceiveToIdle_DMAä¸­ï¼Œä¼šè¿›è¡Œåˆ¤æ–­if (huart-\u0026gt;RxState == HAL_UART_STATE_READY) ï¼Œåˆ¤æ–­RxStateæ˜¯å¦ä¸ºHAL_UART_STATE_READYï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¯´æ˜uartæ²¡æœ‰å¼€å¯ï¼Œä½†æ˜¯æ˜¯åœ¨é¢„å¤‡çŠ¶æ€ï¼Œéšåä¼šå»è°ƒç”¨UART_Start_Receive_DMA(huart, pData, Size)å¼€å¯uartä»¥åŠDMA\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 HAL_StatusTypeDef HAL_UARTEx_ReceiveToIdle_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size) { HAL_StatusTypeDef status; /* Check that a Rx process is not already ongoing */ if (huart-\u0026gt;RxState == HAL_UART_STATE_READY) { if ((pData == NULL) || (Size == 0U)) { return HAL_ERROR; } /* Set Reception type to reception till IDLE Event*/ huart-\u0026gt;ReceptionType = HAL_UART_RECEPTION_TOIDLE; huart-\u0026gt;RxEventType = HAL_UART_RXEVENT_TC; status = UART_Start_Receive_DMA(huart, pData, Size); /* Check Rx process has been successfully started */ if (huart-\u0026gt;ReceptionType == HAL_UART_RECEPTION_TOIDLE) { __HAL_UART_CLEAR_IDLEFLAG(huart); ATOMIC_SET_BIT(huart-\u0026gt;Instance-\u0026gt;CR1, USART_CR1_IDLEIE); } else { /* In case of errors already pending when reception is started, Interrupts may have already been raised and lead to reception abortion. (Overrun error for instance). In such case Reception Type has been reset to HAL_UART_RECEPTION_STANDARD. */ status = HAL_ERROR; } return status; } else { return HAL_BUSY; } } åœ¨UART_Start_Receive_DMAä¸­ä¼šå°†uartçš„RxStateè®¾ç½®ä¸ºHAL_UART_STATE_BUSY_RXï¼Œä¸­é—´è¿˜ä¼šå»è°ƒç”¨HAL_DMA_Start_IT\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 HAL_StatusTypeDef UART_Start_Receive_DMA(UART_HandleTypeDef *huart, uint8_t *pData, uint16_t Size) { uint32_t *tmp; huart-\u0026gt;pRxBuffPtr = pData; huart-\u0026gt;RxXferSize = Size; huart-\u0026gt;ErrorCode = HAL_UART_ERROR_NONE; huart-\u0026gt;RxState = HAL_UART_STATE_BUSY_RX; ...... HAL_DMA_Start_IT(huart-\u0026gt;hdmarx, (uint32_t)\u0026amp;huart-\u0026gt;Instance-\u0026gt;DR, *(uint32_t *)tmp, Size); ...... } åœ¨HAL_DMA_Start_ITä¼šè°ƒç”¨DMA_SetConfigå»å¯¹DMAè®¡æ•°å€¼ç­‰è¿›è¡Œé‡ç½®\n1 2 3 4 5 6 7 HAL_StatusTypeDef HAL_DMA_Start_IT(DMA_HandleTypeDef *hdma, uint32_t SrcAddress, uint32_t DstAddress, uint32_t DataLength) { ...... /* Configure the source, destination address and the data length \u0026amp; clear flags*/ DMA_SetConfig(hdma, SrcAddress, DstAddress, DataLength); ...... } åŸç†æ€»ç»“ 1.HAL_UARTEx_ReceiveToIdle_DMAå¦‚æœåˆ¤æ–­å‡ºhuart-\u0026gt;RxState == HAL_UART_STATE_READYä¼šè°ƒç”¨UART_Start_Receive_DMA\n2.UART_Start_Receive_DMAä¼šè°ƒç”¨HAL_DMA_Start_ITï¼ŒåŒæ—¶ä¼šå°†RxStateä¿®æ”¹ä¸ºBUSY huart-\u0026gt;RxState = HAL_UART_STATE_BUSY_RX\n3.HAL_DMA_Start_ITä¼šè°ƒç”¨DMA_SetConfigè¿›è¡ŒDMAè®¡æ•°å€¼ç­‰çš„é‡ç½®\nè€Œä½¿ç”¨HAL_UART_DMAStopå¯ä»¥ä¿è¯åœ¨å›è°ƒå‡½æ•°å¤„ç†æ•°æ®æ—¶åœæ­¢DMAæ¥æ”¶ï¼Œä¿è¯æ•°æ®ä¸ä¼šè¢«è¦†ç›–ï¼ŒåŒæ—¶å¯ä»¥å°†huart-\u0026gt;RxStateçŠ¶æ€è®¾ç½®ä¸ºHAL_UART_STATE_READYï¼Œéšåå†æ¬¡å¼€å¯DMAç©ºé—²ä¸­æ–­æ¥æ”¶å°±èƒ½é‡ç½®DMAè®¡æ•°å€¼\nä»è€Œå®ç°éå®šé•¿æ•°æ®çš„æ¥æ”¶\nä»£ç å®ç° åŒæ ·æ³¨æ„ï¼Œéœ€è¦å…³é—­æ¥æ”¶è¿‡åŠä¸­æ–­\n1 2 3 4 5 6 7 8 extern UART_HandleTypeDef huart1; extern DMA_HandleTypeDef hdma_usart1_rx; extern DMA_HandleTypeDef hdma_usart1_tx; #define rxBufferLen 512 uint8_t rxBuffer[rxBufferLen]; uint8_t txBuffer[rxBufferLen]; 1 2 3 4 5 //åˆå§‹åŒ– void Init_IdleDMA(void) { HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen); __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx, DMA_IT_HT);//å…³é—­DMAçš„æ¥æ”¶è¿‡åŠä¸­æ–­ } 1 2 3 4 5 6 7 8 9 10 11 12 //å›è°ƒå‡½æ•° void HAL_UARTEx_RxEventCallback(UART_HandleTypeDef *huart, uint16_t Size) {//æ¥æ”¶å®Œæˆå’Œæ¥æ”¶è¿‡åŠï¼Œç©ºé—²ä¸­æ–­éƒ½ä¼šè°ƒç”¨è¯¥ä¸­æ–­å›è°ƒå‡½æ•° if (huart == \u0026amp;huart1 ) { HAL_UART_DMAStop(\u0026amp;huart1);//ä¸ä¼šæ”¹å˜DMAçš„è®¡æ•°å€¼ memcpy(txBuffer, rxBuffer, Size); HAL_UART_Transmit(\u0026amp;huart1, (uint8_t*)txBuffer, Size,10); memset(txBuffer, 0, Size); HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen);//å¦‚æœæ˜¯normalæ¨¡å¼ï¼Œæ¥å—ä¸€æ¬¡åéœ€è¦é‡æ–°å¼€å¯ï¼Œå¦‚æœå…³é—­äº†DMAï¼Œä¹Ÿéœ€è¦é‡æ–°å¯åŠ¨ __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx, DMA_IT_HT);//å…³é—­f103æ¿å­DMAçš„æ¥æ”¶è¿‡åŠä¸­æ–­ } } å®éªŒæ£€éªŒ æˆ‘ä»¬è®¾ç½®cnt_iå»è®°å½•AL_UART_DMAStop(\u0026amp;huart1)å‰åä»¥åŠHAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen)å‰åçš„DMAè®¡æ•°å€¼å˜åŒ–\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 #define rxBufferLen 512 uint8_t rxBuffer[rxBufferLen]; uint8_t txBuffer[rxBufferLen]; void Init_IdleDMA(void) { HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen); __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx, DMA_IT_HT);//å…³é—­DMAçš„æ¥æ”¶è¿‡åŠä¸­æ–­ } void HAL_UARTEx_RxEventCallback(UART_HandleTypeDef *huart, uint16_t Size) {//æ¥æ”¶å®Œæˆå’Œæ¥æ”¶è¿‡åŠï¼Œç©ºé—²ä¸­æ–­éƒ½ä¼šè°ƒç”¨è¯¥ä¸­æ–­å›è°ƒå‡½æ•° if (huart == \u0026amp;huart1 ) { uint32_t cnt_1 = __HAL_DMA_GET_COUNTER(huart1.hdmarx); HAL_UART_DMAStop(\u0026amp;huart1);//ä¸ä¼šæ”¹å˜DMAçš„è®¡æ•°å€¼ uint32_t cnt_2 = __HAL_DMA_GET_COUNTER(huart1.hdmarx); memcpy(txBuffer, rxBuffer, Size); HAL_UART_Transmit(\u0026amp;huart1, (uint8_t*)txBuffer, Size,10); memset(txBuffer, 0, Size); HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen);//å¦‚æœæ˜¯normalæ¨¡å¼ï¼Œæ¥å—ä¸€æ¬¡åéœ€è¦é‡æ–°å¼€å¯ï¼Œå¦‚æœå…³é—­äº†DMAï¼Œä¹Ÿéœ€è¦é‡æ–°å¯åŠ¨ __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx, DMA_IT_HT);//å…³é—­f103æ¿å­DMAçš„æ¥æ”¶è¿‡åŠä¸­æ–­ uint32_t cnt_3 = __HAL_DMA_GET_COUNTER(huart1.hdmarx); sprintf(txBuffer, \u0026#34;\\ncnt_1=%d cnt_2=%d cnt_3=%d\\n\u0026#34;, cnt_1,cnt_2,cnt_3); HAL_UART_Transmit(\u0026amp;huart1, (uint8_t*)txBuffer, sizeof(txBuffer), 10); } } å®éªŒç»“æœ\n1 2 3 4 è¾“å…¥ï¼š123456789101112131415161718192021 è¾“å‡ºï¼š123456789101112131415161718192021 cnt_1=479Â cnt_2=479Â cnt_3=512 è¯æ˜æˆ‘ä»¬åœ¨é‡å¯DMAç©ºé—²ä¸­æ–­æ—¶å®ç°äº†DMAè®¡æ•°å€¼é‡ç½®\næ–¹å¼4 å†ä»”ç»†æƒ³ä¸€æƒ³ï¼Œåœ¨circuarè¦æƒ³å®ç°ä¸€å¸§ä¸€å¸§ä¸å®šé•¿æ•°æ®çš„æ¥æ”¶ä¸»è¦éœ€è¦è€ƒè™‘çš„å°±æ˜¯å¦‚ä½•å®ç°åœ¨æ¥æ”¶å®Œä¸€å¸§åè®©DMAçš„è®¡æ•°å€¼é‡ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´æ²¡æœ‰å¿…è¦ä¸ºæ­¤ä½¿ç”¨HAL_UART_DMAStopå†é‡å¯DMAç©ºé—²ä¸­æ–­æ¥æ”¶\nå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Œç»“åˆæ–¹å¼1çš„å®ç°å°±å¯ä»¥å¾—åˆ°ç­”æ¡ˆ\n1 2 3 __HAL_DMA_DISABLE(huart-\u0026gt;hdmarx);//éœ€è¦å…³é—­DMAæ‰èƒ½é‡è®¾DMAçš„COUNTER __HAL_DMA_SET_COUNTERT(huart-\u0026gt;hdmarx,rxBufferLen); __HAL_DMA_ENABLE(huart-\u0026gt;hdmarx);//éœ€è¦å…³é—­DMAæ‰èƒ½é‡è®¾DMAçš„COUNTER ä»£ç å®ç° 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 #define __HAL_DMA_SET_COUNTERT(__HANDLE__,__COUNTER__) ((__HANDLE__)-\u0026gt;Instance-\u0026gt;CNDTR = (uint16_t)(__COUNTER__)) //é‡æ–°è®¾å®šè®¡æ•°å€¼ extern UART_HandleTypeDef huart1; extern DMA_HandleTypeDef hdma_usart1_rx; extern DMA_HandleTypeDef hdma_usart1_tx; #define rxBufferLen 512 uint8_t rxBuffer[rxBufferLen]; uint8_t txBuffer[rxBufferLen]; void Init_IdleDMA(void) { HAL_UARTEx_ReceiveToIdle_DMA(\u0026amp;huart1, (uint8_t*)rxBuffer, rxBufferLen); __HAL_DMA_DISABLE_IT(\u0026amp;hdma_usart1_rx, DMA_IT_HT);//å…³é—­DMAçš„æ¥æ”¶è¿‡åŠä¸­æ–­ } void HAL_UARTEx_RxEventCallback(UART_HandleTypeDef *huart, uint16_t Size) { if (huart == \u0026amp;huart1 ) { __HAL_DMA_DISABLE(huart-\u0026gt;hdmarx);//éœ€è¦å…³é—­DMAæ‰èƒ½é‡è®¾DMAçš„COUNTER __HAL_DMA_SET_COUNTERT(huart-\u0026gt;hdmarx,rxBufferLen); memcpy(txBuffer, rxBuffer, Size); HAL_UART_Transmit(\u0026amp;huart1, (uint8_t*)txBuffer, Size,10); __HAL_DMA_ENABLE(huart-\u0026gt;hdmarx);//éœ€è¦å…³é—­DMAæ‰èƒ½é‡è®¾DMAçš„COUNTER } } ","date":"2025-06-18T19:52:33+08:00","permalink":"https://NomadJoeviolet.github.io/p/stm32dma%E4%BD%BF%E7%94%A8%E4%B8%8E%E7%A9%BA%E9%97%B2%E4%B8%AD%E6%96%AD/","title":"STM32â€”â€”DMAä½¿ç”¨ä¸ç©ºé—²ä¸­æ–­"},{"content":"åŸºäºèœé¸Ÿæ•™ç¨‹å†™çš„ä¸ªäººç¬”è®°\nstaticå®šä¹‰ staticæ˜¯C/C++ä¸­å¸¸ç”¨çš„ä¿®é¥°ç¬¦ï¼Œæ§åˆ¶å˜é‡çš„å­˜å‚¨æ–¹å¼å’Œå¯è§æ€§\nstatic-å‰ç½®-ç©ºé—´åˆ†é… åœ¨å‡½æ•°å†…éƒ¨å®šä¹‰çš„å˜é‡ï¼Œå½“ç¨‹åºæ‰§è¡Œåˆ°å…¶å®šä¹‰å¤„æ—¶æ²¡ç¼–è¯‘å™¨ä¼šä¸ºå®ƒåœ¨æ ˆä¸Šåˆ†é…ç©ºé—´ï¼Œå‡½æ•°åœ¨æ ˆä¸Šåˆ†é…çš„ç©ºé—´å†æ¬¡å‡½æ•°ç»“æŸæ—¶ä¼šé‡Šæ”¾æ‰\nå¦‚æœæƒ³å°†å‡½æ•°ä¸­æ­¤å˜é‡çš„å€¼ä¿å­˜è‡³ä¸‹ä¸€æ¬¡è°ƒç”¨ï¼š\nï¼ˆ1ï¼‰å°†è¯¥å˜é‡å®šä¹‰ä¸ºå…¨å±€å˜é‡ï¼Œä½†å¸¦æ¥è®¸å¤šç¼ºç‚¹ï¼Œä¾‹å¦‚ç ´åäº†æ­¤å˜é‡çš„è®¿é—®èŒƒå›´ï¼ˆåœ¨æ­¤å‡½æ•°ä¸­å®šä¹‰çš„å˜é‡ï¼Œä¸ä»…ä»…åªå—æ­¤å‡½æ•°çš„æ§åˆ¶ï¼‰\nï¼ˆ2ï¼‰ä½¿ç”¨staticå…³é”®è¯ä¿®é¥°\né™æ€æ•°æ®çš„å­˜å‚¨ å…¨å±€ï¼ˆé™æ€ï¼‰å­˜å‚¨åŒºï¼šåˆ†ä¸º DATA æ®µå’Œ BSS æ®µ DATA æ®µï¼ˆå…¨å±€åˆå§‹åŒ–åŒºï¼‰å­˜æ”¾åˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ BSS æ®µï¼ˆå…¨å±€æœªåˆå§‹åŒ–åŒºï¼‰å­˜æ”¾æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡ ç¨‹åºè¿è¡Œç»“æŸæ—¶è‡ªåŠ¨é‡Šæ”¾ BSSæ®µåœ¨ç¨‹åºæ‰§è¡Œå‰ä¼šè¢«ç³»ç»Ÿè‡ªåŠ¨æ¸…0ï¼Œæ‰€ä»¥æœªåˆå§‹åŒ–çš„å…¨å±€å˜é‡å’Œé™æ€å˜é‡åœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰å·²ç»ä¸º0ã€‚å­˜å‚¨åœ¨é™æ€æ•°æ®åŒºçš„å˜é‡ä¼šåœ¨ç¨‹åºåˆšå¼€å§‹è¿è¡Œæ—¶å°±å®Œæˆåˆå§‹åŒ–ï¼Œä¹Ÿæ˜¯å”¯ä¸€çš„ä¸€æ¬¡åˆå§‹åŒ–ã€‚\nåœ¨ C++ ä¸­ static çš„å†…éƒ¨å®ç°æœºåˆ¶ï¼šé™æ€æ•°æ®æˆå‘˜è¦åœ¨ç¨‹åºä¸€å¼€å§‹è¿è¡Œæ—¶å°±å¿…é¡»å­˜åœ¨ã€‚å› ä¸ºå‡½æ•°åœ¨ç¨‹åºè¿è¡Œä¸­è¢«è°ƒç”¨ï¼Œæ‰€ä»¥é™æ€æ•°æ®æˆå‘˜ä¸èƒ½åœ¨ä»»ä½•å‡½æ•°å†…åˆ†é…ç©ºé—´å’Œåˆå§‹åŒ–ã€‚\nåœ¨C/C++ä¸­staticçš„ä½œç”¨ General ï¼ˆ1ï¼‰åœ¨ä¿®é¥°å˜é‡æ—¶ï¼Œstaticä¿®é¥°çš„é™æ€å±€éƒ¨å˜é‡åªæ‰§è¡Œåˆå§‹åŒ–ä¸€æ¬¡ï¼Œè€Œä¸”å»¶é•¿äº†å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸï¼Œç›´åˆ°ç¨‹åºè¿è¡Œç»“æŸä»¥åæ‰é‡Šæ”¾ ï¼ˆ2ï¼‰staticä¿®é¥°å…¨å±€å˜é‡çš„æ—¶å€™ï¼Œè¿™ä¸ªå…¨å±€å˜é‡åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è®¿é—®ï¼Œä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶è°ƒç”¨ï¼Œå³ä½¿æ˜¯externå¤–éƒ¨å£°æ˜ä¹Ÿä¸å¯ä»¥ ï¼ˆ3ï¼‰static ä¿®é¥°çš„å˜é‡å­˜æ”¾åœ¨å…¨å±€æ•°æ®åŒºçš„é™æ€å˜é‡åŒºï¼ŒåŒ…æ‹¬å…¨å±€é™æ€å˜é‡å’Œå±€éƒ¨é™æ€å˜é‡ï¼Œéƒ½åœ¨å…¨å±€æ•°æ®åŒºåˆ†é…å†…å­˜ã€‚åˆå§‹åŒ–çš„æ—¶å€™è‡ªåŠ¨åˆå§‹åŒ–ä¸º 0 ï¼ˆ4ï¼‰staticä¿®é¥°ä¸€ä¸ªå‡½æ•°ï¼Œåˆ™è¿™ä¸ªå‡½æ•°çš„åªèƒ½åœ¨æœ¬æ–‡ä»¶ä¸­è°ƒç”¨ï¼Œä¸èƒ½è¢«å…¶ä»–æ–‡ä»¶è°ƒç”¨ ï¼ˆ5ï¼‰ä¸æƒ³è¢«é‡Šæ”¾çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨staticä¿®é¥°ã€‚æ¯”å¦‚ä¿®é¥°å‡½æ•°ä¸­å­˜æ”¾åœ¨æ ˆç©ºé—´çš„æ•°ç»„ã€‚å¦‚æœä¸æƒ³è®©è¿™ä¸ªæ•°ç»„åœ¨å‡½æ•°è°ƒç”¨ç»“æŸé‡Šæ”¾å¯ä»¥ä½¿ç”¨ static ä¿®é¥° ï¼ˆ6ï¼‰è€ƒè™‘åˆ°æ•°æ®å®‰å…¨æ€§ï¼ˆå½“ç¨‹åºæƒ³è¦ä½¿ç”¨å…¨å±€å˜é‡çš„æ—¶å€™åº”è¯¥å…ˆè€ƒè™‘ä½¿ç”¨ staticï¼‰\nå…³äºé™æ€å˜é‡ä¸æ™®é€šå˜é‡ é™æ€å…¨å±€å˜é‡ ï¼ˆ1ï¼‰é™æ€å˜é‡éƒ½åœ¨å…¨å±€æ•°æ®åŒºåˆ†é…å†…å­˜ ï¼ˆ2ï¼‰æœªç»åˆå§‹åŒ–çš„é™æ€å…¨å±€å˜é‡ä¼šè¢«ç¨‹åºè‡ªåŠ¨åˆå§‹åŒ–ä¸º0 ï¼ˆ3ï¼‰é™æ€å…¨å±€å˜é‡åœ¨å£°æ˜å®ƒçš„æ•´ä¸ªæ–‡ä»¶éƒ½æ˜¯å¯è§çš„ï¼Œè€Œåœ¨æ–‡ä»¶ä¹‹å¤–æ˜¯ä¸å¯è§çš„\nï¼ˆ1ï¼‰å…¨å±€å˜é‡å’Œå…¨å±€é™æ€å˜é‡çš„åŒºåˆ«\n1ï¼‰å…¨å±€å˜é‡æ˜¯ä¸æ˜¾å¼ç”¨ static ä¿®é¥°çš„å…¨å±€å˜é‡ï¼Œå…¨å±€å˜é‡é»˜è®¤æ˜¯æœ‰å¤–éƒ¨é“¾æ¥æ€§çš„ï¼Œä½œç”¨åŸŸæ˜¯æ•´ä¸ªå·¥ç¨‹ï¼Œåœ¨ä¸€ä¸ªæ–‡ä»¶å†…å®šä¹‰çš„å…¨å±€å˜é‡ï¼Œåœ¨å¦ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œé€šè¿‡ extern å…¨å±€å˜é‡åçš„å£°æ˜ï¼Œå°±å¯ä»¥ä½¿ç”¨å…¨å±€å˜é‡ã€‚ 2ï¼‰å…¨å±€é™æ€å˜é‡æ˜¯æ˜¾å¼ç”¨ static ä¿®é¥°çš„å…¨å±€å˜é‡ï¼Œä½œç”¨åŸŸæ˜¯å£°æ˜æ­¤å˜é‡æ‰€åœ¨çš„æ–‡ä»¶ï¼Œå…¶ä»–çš„æ–‡ä»¶å³ä½¿ç”¨ extern å£°æ˜ä¹Ÿä¸èƒ½ä½¿ç”¨ã€‚ é™æ€å±€éƒ¨å˜é‡ ï¼ˆ1ï¼‰è¯¥å˜é‡åœ¨å…¨å±€æ•°æ®åŒºåˆ†é…å†…å­˜ ï¼ˆ2ï¼‰é™æ€å±€éƒ¨å˜é‡åœ¨ç¨‹åºæ‰§è¡Œåˆ°è¯¥å¯¹è±¡çš„å£°æ˜å¤„æ—¶è¢«é¦–æ¬¡åˆå§‹åŒ–ï¼ŒåŠä»¥åçš„å‡½æ•°è°ƒç”¨ä¸ä¼šå†è¿›è¡Œåˆå§‹åŒ– ï¼ˆ3ï¼‰é™æ€å±€éƒ¨å˜é‡ä¸€èˆ¬åœ¨å£°æ˜å¤„åˆå§‹åŒ–ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºåˆå§‹åŒ–ï¼Œä¼šè¢«ç¨‹åºè‡ªåŠ¨åˆå§‹åŒ–ä¸º0 ï¼ˆ4ï¼‰å®ƒå§‹ç»ˆé©»ç•™åœ¨å…¨å±€æ•°æ®åŒºï¼Œç›´åˆ°ç¨‹åºè¿è¡Œç»“æŸã€‚ä½†å…¶ä½œç”¨åŸŸä¸ºå±€éƒ¨ä½œç”¨åŸŸï¼Œå½“å®šä¹‰å®ƒçš„å‡½æ•°æˆ–è¯­å¥å—ç»“æŸæ—¶ï¼Œå…¶ä½œç”¨åŸŸéšä¹‹ç»“æŸ\nä¸€èˆ¬ç¨‹åºæŠŠæ–°äº§ç”Ÿçš„åŠ¨æ€æ•°æ®å­˜æ”¾åœ¨å †åŒºï¼Œå‡½æ•°å†…éƒ¨çš„è‡ªåŠ¨å˜é‡å­˜æ”¾åœ¨æ ˆåŒºã€‚è‡ªåŠ¨å˜é‡ä¸€èˆ¬ä¼šéšç€å‡½æ•°çš„é€€å‡ºè€Œé‡Šæ”¾ç©ºé—´ï¼Œé™æ€æ•°æ®ï¼ˆå³ä½¿æ˜¯å‡½æ•°å†…éƒ¨çš„é™æ€å±€éƒ¨å˜é‡ï¼‰ä¹Ÿå­˜æ”¾åœ¨å…¨å±€æ•°æ®åŒºã€‚å…¨å±€æ•°æ®åŒºçš„æ•°æ®å¹¶ä¸ä¼šå› ä¸ºå‡½æ•°çš„é€€å‡ºè€Œé‡Šæ”¾ç©ºé—´ã€‚\nstaticç”¨æ³• åœ¨C++ä¸­ staticåœ¨ç±»ä¸­çš„ä½œç”¨ï¼š è¢« static ä¿®é¥°çš„å˜é‡ã€è¢« static ä¿®é¥°çš„æ–¹æ³•ç»Ÿä¸€å±äºç±»çš„é™æ€èµ„æºï¼Œæ˜¯ç±»å®ä¾‹ä¹‹é—´å…±äº«çš„ï¼Œæ¢è¨€ä¹‹ï¼Œä¸€å¤„å˜ã€å¤„å¤„å˜\nåœ¨ C++ ä¸­ï¼Œé™æ€æˆå‘˜æ˜¯å±äºæ•´ä¸ªç±»çš„è€Œä¸æ˜¯æŸä¸ªå¯¹è±¡ï¼Œé™æ€æˆå‘˜å˜é‡åªå­˜å‚¨ä¸€ä»½ä¾›æ‰€æœ‰å¯¹è±¡å…±ç”¨ã€‚æ‰€ä»¥åœ¨æ‰€æœ‰å¯¹è±¡ä¸­éƒ½å¯ä»¥å…±äº«å®ƒã€‚ä½¿ç”¨é™æ€æˆå‘˜å˜é‡å®ç°å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„æ•°æ®å…±äº«ä¸ä¼šç ´åéšè—çš„åŸåˆ™ï¼Œä¿è¯äº†å®‰å…¨æ€§è¿˜å¯ä»¥èŠ‚çœå†…å­˜\né™æ€æˆå‘˜çš„å®šä¹‰æˆ–å£°æ˜è¦åŠ ä¸ªå…³é”® staticã€‚é™æ€æˆå‘˜å¯ä»¥é€šè¿‡åŒå†’å·æ¥ä½¿ç”¨ å³Â \u0026lt;ç±»å\u0026gt;::\u0026lt;é™æ€æˆå‘˜å\u0026gt;\nç»“è®ºï¼š\nä¸èƒ½é€šè¿‡ç±»åæ¥è°ƒç”¨ç±»çš„éé™æ€æˆå‘˜å‡½æ•°ï¼Œå¯ä»¥é€šè¿‡ç±»çš„å¯¹è±¡è°ƒç”¨é™æ€æˆå‘˜å‡½æ•°å’Œéé™æ€æˆå‘˜å‡½æ•° ç±»çš„é™æ€æˆå‘˜å‡½æ•°ä¸å¯ä»¥ä½¿ç”¨ç±»çš„éé™æ€å‡½æ•° åœ¨ç±»çš„éé™æ€æˆå‘˜å‡½æ•°ä¸­å¯ä»¥ä½¿ç”¨ç±»çš„é™æ€æˆå‘˜ï¼ˆå‡½æ•°ï¼Œå˜é‡ï¼‰ï¼Œéé™æ€æˆå‘˜å‡½æ•°åœ¨è°ƒç”¨é™æ€æˆå‘˜å˜é‡æ—¶ï¼Œé™æ€æˆå‘˜å˜é‡å¿…é¡»åœ¨ä½¿ç”¨å‰åˆå§‹åŒ– å› ä¸ºé™æ€æˆå‘˜å‡½æ•°å±äºæ•´ä¸ªç±»ï¼Œåœ¨ç±»å®ä¾‹åŒ–å¯¹è±¡ä¹‹å‰å°±å·²ç»åˆ†é…ç©ºé—´äº†ï¼Œè€Œç±»çš„éé™æ€æˆå‘˜å‡½æ•°å¿…é¡»åœ¨ç±»å®ä¾‹åŒ–å¯¹è±¡åæ‰æœ‰å†…å­˜ç©ºé—´\nç±»çš„é™æ€æˆå‘˜å˜é‡å¿…é¡»å…ˆåˆå§‹åŒ–å†ä½¿ç”¨ ä¸€äº›è§£é‡Šï¼š 1ï¼‰é™æ€æ–¹æ³•èƒ½ä¸èƒ½å¼•ç”¨éé™æ€èµ„æºï¼Ÿä¸èƒ½ï¼Œå®ä¾‹åŒ–å¯¹è±¡çš„æ—¶å€™æ‰ä¼šäº§ç”Ÿçš„ä¸œè¥¿ï¼Œå¯¹äºåˆå§‹åŒ–åå°±å­˜åœ¨çš„é™æ€èµ„æºæ¥è¯´ï¼Œæ ¹æœ¬ä¸è®¤è¯†å®ƒã€‚ 2ï¼‰é™æ€æ–¹æ³•é‡Œé¢èƒ½ä¸èƒ½å¼•ç”¨é™æ€èµ„æºï¼Ÿå¯ä»¥ï¼Œå› ä¸ºéƒ½æ˜¯ç±»åˆå§‹åŒ–çš„æ—¶å€™åŠ è½½çš„ï¼Œå¤§å®¶ç›¸äº’éƒ½è®¤è¯†ã€‚ 3ï¼‰éé™æ€æ–¹æ³•é‡Œé¢èƒ½ä¸èƒ½å¼•ç”¨é™æ€èµ„æºï¼Ÿå¯ä»¥ï¼Œéé™æ€æ–¹æ³•å°±æ˜¯å®ä¾‹æ–¹æ³•ï¼Œé‚£æ˜¯å®ä¾‹åŒ–å¯¹è±¡ä¹‹åæ‰äº§ç”Ÿçš„ï¼Œé‚£ä¹ˆå±äºç±»çš„å†…å®¹å®ƒéƒ½è®¤è¯†\nSummary:\nï¼ˆ1ï¼‰é™æ€æˆå‘˜å‡½æ•°ä¸­ä¸èƒ½è°ƒç”¨éé™æ€æˆå‘˜ ï¼ˆ2ï¼‰éé™æ€æˆå‘˜å‡½æ•°ä¸­å¯ä»¥è°ƒç”¨é™æ€æˆå‘˜ã€‚å› ä¸ºé™æ€æˆå‘˜å±äºç±»æœ¬èº«ï¼Œåœ¨ç±»çš„å¯¹è±¡äº§ç”Ÿä¹‹å‰å°±å·²ç»å­˜åœ¨äº†ï¼Œæ‰€ä»¥åœ¨éé™æ€æˆå‘˜å‡½æ•°ä¸­æ˜¯å¯ä»¥è°ƒç”¨é™æ€æˆå‘˜çš„ ï¼ˆ3ï¼‰é™æ€æˆå‘˜å˜é‡ä½¿ç”¨å‰å¿…é¡»å…ˆåˆå§‹åŒ–(å¦‚Â int MyClass::m_nNumber = 0;)ï¼Œå¦åˆ™ä¼šåœ¨ linker æ—¶å‡ºé”™ é™æ€æ•°æ®æˆå‘˜ ï¼ˆ1ï¼‰é™æ€æ•°æ®æˆå‘˜å¯ä»¥å®ç°å¤šä¸ªå¯¹è±¡ä¹‹é—´çš„æ•°æ®å…±äº«ï¼Œå®ƒæ˜¯ç±»çš„æ‰€æœ‰å¯¹è±¡çš„å…±äº«æˆå‘˜ï¼Œå®ƒåœ¨å†…å­˜ä¸­åªå ä¸€ä»½ç©ºé—´ï¼Œå¦‚æœæ”¹å˜å®ƒçš„å€¼ï¼Œåˆ™å„å¯¹è±¡ä¸­è¿™ä¸ªæ•°æ®æˆå‘˜çš„å€¼éƒ½è¢«æ”¹å˜ ï¼ˆ2ï¼‰é™æ€æ•°æ®æˆå‘˜æ˜¯åœ¨ç¨‹åºå¼€å§‹è¿è¡Œæ—¶è¢«åˆ†é…ç©ºé—´ï¼Œåˆ°ç¨‹åºç»“æŸä¹‹åæ‰é‡Šæ”¾ï¼Œåªè¦ç±»ä¸­æŒ‡å®šäº†é™æ€æ•°æ®æˆå‘˜ï¼Œå³ä½¿ä¸å®šä¹‰å¯¹è±¡ï¼Œä¹Ÿä¼šä¸ºé™æ€æ•°æ®æˆå‘˜åˆ†é…ç©ºé—´ ï¼ˆ3ï¼‰é™æ€æ•°æ®æˆå‘˜å¯ä»¥è¢«åˆå§‹åŒ–ï¼Œä½†æ˜¯åªèƒ½åœ¨ç±»ä½“å¤–è¿›è¡Œåˆå§‹åŒ–ï¼Œè‹¥æœªå¯¹é™æ€æ•°æ®æˆå‘˜èµ‹åˆå€¼ï¼Œåˆ™ç¼–è¯‘å™¨ä¼šè‡ªåŠ¨ä¸ºå…¶åˆå§‹åŒ–ä¸º 0 ï¼ˆ4ï¼‰é™æ€æ•°æ®æˆå‘˜æ—¢å¯ä»¥é€šè¿‡å¯¹è±¡åå¼•ç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ç±»åå¼•ç”¨ é™æ€æˆå‘˜å‡½æ•° ï¼ˆ1ï¼‰é™æ€æˆå‘˜å‡½æ•°å’Œé™æ€æ•°æ®æˆå‘˜ä¸€æ ·ï¼Œä»–ä»¬éƒ½å±äºç±»çš„é™æ€æˆå‘˜ï¼Œè€Œä¸æ˜¯å¯¹è±¡æˆå‘˜ ï¼ˆ2ï¼‰éé™æ€æˆå‘˜å‡½æ•°æœ‰ this æŒ‡é’ˆï¼Œè€Œé™æ€æˆå‘˜å‡½æ•°æ²¡æœ‰ this æŒ‡é’ˆ ï¼ˆ3ï¼‰é™æ€æˆå‘˜å‡½æ•°ä¸»è¦ç”¨æ¥fè®¿é—®é™æ€æ•°æ®æˆå‘˜è€Œä¸èƒ½è®¿é—®éé™æ€æˆå‘˜ ","date":"2025-01-13T16:24:31+08:00","permalink":"https://NomadJoeviolet.github.io/p/cc-statiic/","title":"C\u0026C++ Statiic"},{"content":"ã€å…³äºCå’ŒC++æ··åˆç¼–ç¨‹ä¸­ç¼–è¯‘å’Œé“¾æ¥çš„é—®é¢˜ã€‘https://www.bilibili.com/video/BV1Zm4y1E7nm?vd_source=5a0790755035f26a67935abfbfcdfd5b extern \u0026ldquo;c\u0026quot;çš„ç”¨æ³•ï¼šcä¸c++çš„äº’ç›¸è°ƒç”¨ - é’å±±ç‰§äº‘äºº - åšå®¢å›­ C++\u0026ndash;åå­—ä¿®é¥°_c++çš„å‡½æ•°åä¿®é¥°æ˜¯åœ¨å“ªä¸ªé˜¶æ®µè¿›è¡Œçš„-CSDNåšå®¢ C/C++ å‡½æ•°ç­¾åä¸åå­—ä¿®é¥°ï¼ˆç¬¦å·ä¿®é¥°ï¼‰-CSDNåšå®¢ C/C++ä¸­çš„ extern å’Œexternâ€œCâ€œå…³é”®å­—çš„ç†è§£å’Œä½¿ç”¨ï¼ˆå¯¹æ¯”ä¸¤è€…çš„å¼‚åŒï¼‰_c extern c-CSDNåšå®¢\nç¬¦å·ä¿®é¥° åœ¨C/C++ä¸­ï¼Œä¸€ä¸ªç¨‹åºè¦è¿è¡Œèµ·æ¥ï¼Œéœ€è¦ç»å†ä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼šé¢„å¤„ç†ã€ç¼–è¯‘ã€æ±‡ç¼–ã€é“¾æ¥ã€‚\nåå­—ä¿®é¥°ï¼ˆName Manglingï¼‰æ˜¯ä¸€ç§åœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­ï¼Œå°†å‡½æ•°ã€å˜é‡çš„åç§°é‡æ–°æ”¹ç¼–çš„æœºåˆ¶ï¼Œç®€å•æ¥è¯´å°±æ˜¯ç¼–è¯‘å™¨ä¸ºäº†åŒºåˆ†å„ä¸ªå‡½æ•°ï¼Œå°†å‡½æ•°é€šè¿‡ä¸€å®šç®—æ³•ï¼Œé‡æ–°ä¿®é¥°ä¸ºä¸€ä¸ªå…¨å±€å”¯ä¸€çš„åç§°ã€‚\nç”±äºC++å’ŒCçš„åå­—ä¿®é¥°è§„åˆ™ä¸åŒï¼ˆä¸åŒæ“ä½œç³»ç»Ÿä¸‹çš„ç¼–è¯‘å™¨çš„åå­—ä¿®é¥°æ–¹å¼ä¹Ÿä¼šä¸åŒï¼‰ï¼Œå¯¼è‡´C++å¯ä»¥æ”¯æŒå‡½æ•°é‡è½½ï¼Œè€ŒCä¸æ”¯æŒå‡½æ•°é‡è½½\nå¯ä»¥ç®€å•ç†è§£ï¼Œc++ä¸­æ”¯æŒå‡½æ•°é‡è½½ï¼Œcè¯­è¨€ä¸æ”¯æŒå‡½æ•°é‡è½½ï¼Œè¿™é€ æˆäº†c++å’Œcè¯­è¨€çš„å‡½æ•°åè§£æä¸åŒï¼ˆåå­—ä¿®é¥°/ç¬¦å·ä¿®é¥°ï¼‰ã€‚cè¯­è¨€å‡½æ•°åå°±æ˜¯å‡½æ•°åï¼Œc++çš„å‡½æ•°åæ˜¯å‡½æ•°å+å‚æ•°ç»„åˆèµ·æ¥çš„ã€‚\nCä¸C++ç¬¦å·ä¿®é¥°çš„å®ä¾‹ extern \u0026ldquo;c\u0026quot;çš„ç”¨æ³•ï¼šcä¸c++çš„äº’ç›¸è°ƒç”¨ - é’å±±ç‰§äº‘äºº - åšå®¢å›­ ï¼ˆç›´æ¥copyè‡ªè¯¥åšå®¢ï¼‰\næ¯”å¦‚ï¼Œå‡½æ•°void func(double a)Â åœ¨Cå’ŒC++ä¸­çš„ç¼–è¯‘é˜¶æ®µå‡½æ•°åç§°ä¼šè¢«è§£ææˆä»€ä¹ˆå‘¢ï¼Ÿ\nåœ¨Cè¯­è¨€ä¸­ï¼Œç”±äºæ²¡æœ‰åç§°ä¿®é¥°ï¼Œæ‰€ä»¥åœ¨ç¼–è¯‘æ—¶å‡½æ•°åç§°ä»ç„¶æ˜¯funcï¼Œä¸ä¼šå› ä¸ºå‚æ•°ç±»å‹æˆ–æ•°é‡è€Œæ”¹å˜ã€‚\nåœ¨C++ä¸­ï¼Œç”±äºåç§°ä¿®é¥°çš„å­˜åœ¨ï¼Œå‡½æ•°åç§°åœ¨ç¼–è¯‘é˜¶æ®µä¼šè¢«ç¼–è¯‘å™¨è½¬æ¢æˆä¸€ä¸ªåŒ…å«å‡½æ•°åŸå‹ä¿¡æ¯çš„å”¯ä¸€æ ‡è¯†ç¬¦ã€‚é€šå¸¸ä¼šæ¶‰åŠå‡½æ•°è¿”å›ç±»å‹ã€å‚æ•°ç±»å‹ä»¥åŠå‚æ•°æ•°é‡ã€‚ä»¥GCC(GNU Compiler Collection)ä¸ºä¾‹ï¼Œfunc(double a)ä¼šè¢«è½¬æ¢æˆ_Z4funcdÂ ï¼Œè¿™é‡Œï¼š\n_Zï¼šæ˜¯GCCç”¨æ¥è¡¨ç¤ºä¿®é¥°åç§°çš„å‰ç¼€ 4ï¼šè¡¨ç¤ºå‡½æ•°åç§°funcçš„çš„å­—ç¬¦æ•° dï¼šæ˜¯doubleç±»å‹çš„ç¼–ç  å› æ­¤ï¼Œç”¨c++çš„æ–¹å¼å»å¯»æ‰¾cè¯­è¨€çš„ç¬¦å·æ˜¯æ— æ³•å¯»æ‰¾åˆ°çš„ã€‚extern \u0026quot;C\u0026quot;ä¸ºä½•å¯ä»¥åšåˆ°ï¼Ÿ\nextern \u0026quot;C\u0026quot;çš„ä½œç”¨å°±æ˜¯ä¿®æ”¹äº†ç¬¦å·è¡¨çš„ç”Ÿæˆæ–¹å¼ï¼Œå°†c++ç¬¦å·çš„ç”Ÿæˆæ–¹å¼æ¢æˆäº†cçš„ç”Ÿæˆæ–¹å¼ã€‚\nå³cåº“ä¸­ç”Ÿæˆçš„ç¬¦å·æ˜¯cç¼–è¯‘å™¨çš„ç¬¦å·ï¼Œ å› æ­¤cè¯­è¨€å¯ä»¥ç›´æ¥é“¾æ¥ã€‚è€Œc++ç¨‹åºéœ€è¦ä½¿ç”¨extern \u0026quot;C\u0026quot;è®©ç¼–è¯‘å™¨ä½¿ç”¨cçš„ç¬¦å·å‘½åæ–¹å¼å»è¿›è¡Œé“¾æ¥ï¼Œè¿™æ ·æ‰èƒ½æ‰¾åˆ°å¯¹åº”çš„ç¬¦å·ã€‚\nextern \u0026ldquo;C\u0026rdquo; C/C++ä¸­çš„ extern å’Œexternâ€œCâ€œå…³é”®å­—çš„ç†è§£å’Œä½¿ç”¨ï¼ˆå¯¹æ¯”ä¸¤è€…çš„å¼‚åŒï¼‰_c extern c-CSDNåšå®¢\nçœ‹è¿™ä¸€ç¯‡å°±å¤Ÿäº† çœ‹å®ä¾‹\ncppè°ƒç”¨cï¼Œcppç¼–è¯‘æ—¶ä¼šæœ‰C++çš„ç¬¦å·ä¿®é¥°ï¼Œå¯¼è‡´é“¾æ¥Cåº“çš„å‡½æ•°æ‰¾ä¸åˆ°ï¼Œéœ€è¦ç”¨extern \u0026ldquo;C\u0026quot;å‘Šè¯‰g++ç¼–è¯‘å™¨ä»¥Cè¯­è¨€çš„é£æ ¼è¿›è¡Œç¼–è¯‘ cè°ƒç”¨cppï¼ˆä¸æ¶‰åŠC++çš„ç±»å’Œæˆå‘˜å‡½æ•°ï¼‰ï¼Œè®¾è®¡ä¸€ä¸ªCçš„æ¥å£ï¼Œæ¥å£çš„å®ç°åœ¨cppä¸­ï¼Œæ¥å£å‡½æ•°å†…éƒ¨å»ä½¿ç”¨C++çš„ç‰¹æ€§ cä¸­è°ƒç”¨c++æˆå‘˜å‡½æ•°ï¼Œéœ€è¦ä¸€ä¸ªæ¥å£å‡½æ•° arm-none-eabiçš„ç¬¦å·ä¿®é¥° åœ¨åµŒå…¥å¼å¼€å‘ä¸­ï¼Œarm-none-eabiÂ å·¥å…·é“¾ï¼ˆé’ˆå¯¹ ARM æ¶æ„çš„è£¸æœº / åµŒå…¥å¼äº¤å‰ç¼–è¯‘å·¥å…·ï¼‰çš„ç¬¦å·ä¿®é¥°ï¼ˆName Manglingï¼‰Â ä¸»è¦ç”±ç¼–è¯‘å™¨ï¼ˆé€šå¸¸æ˜¯ GCCï¼‰æ ¹æ®è¯­è¨€ç‰¹æ€§ï¼ˆC/C++ï¼‰å’Œç›®æ ‡ ABIï¼ˆåº”ç”¨ç¨‹åºäºŒè¿›åˆ¶æ¥å£ï¼‰å†³å®šï¼Œç›®çš„æ˜¯ç”Ÿæˆå”¯ä¸€çš„ç¬¦å·åï¼Œä»¥æ”¯æŒå‡½æ•°é‡è½½ã€å‘½åç©ºé—´ã€ç±»å‹ä¿¡æ¯ç­‰ç‰¹æ€§ã€‚\n1. C è¯­è¨€çš„ç¬¦å·ä¿®é¥° C è¯­è¨€ä¸æ”¯æŒå‡½æ•°é‡è½½å’Œå‘½åç©ºé—´ï¼Œå› æ­¤ç¬¦å·ä¿®é¥°éå¸¸ç®€å•ï¼Œé€šå¸¸ä»…åœ¨å‡½æ•°åå‰æ·»åŠ ä¸‹åˆ’çº¿ï¼ˆ_ï¼‰ï¼Œæˆ–ç›´æ¥ä½¿ç”¨åŸå‡½æ•°åï¼Œå…·ä½“å–å†³äºç›®æ ‡ ABIï¼ˆå¦‚ ARM çš„ APCSã€EABI ç­‰ï¼‰ã€‚\nç¤ºä¾‹ï¼š\nC å‡½æ•°Â void foo(int a)Â ç»è¿‡Â arm-none-eabi-gccÂ ç¼–è¯‘åï¼Œç¬¦å·é€šå¸¸ä¸ºÂ foo è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆåœ¨æ±‡ç¼–ä¸­è°ƒç”¨ C å‡½æ•°æ—¶ï¼Œé€šå¸¸éœ€è¦å¼•ç”¨å¸¦ä¸‹åˆ’çº¿çš„ç¬¦å· 2. C++ çš„ç¬¦å·ä¿®é¥°ï¼ˆå‘½åç²‰ç¢ï¼‰ C++ æ”¯æŒå‡½æ•°é‡è½½ã€ç±»ã€å‘½åç©ºé—´ã€æ¨¡æ¿ç­‰ç‰¹æ€§ï¼Œå› æ­¤éœ€è¦æ›´å¤æ‚çš„ç¬¦å·ä¿®é¥°è§„åˆ™ï¼ˆç§°ä¸º â€œå‘½åç²‰ç¢â€ï¼‰ï¼Œä»¥ç¡®ä¿æ¯ä¸ªé‡è½½å‡½æ•° / æ–¹æ³•ç”Ÿæˆå”¯ä¸€çš„ç¬¦å·ã€‚arm-none-eabi-g++Â éµå¾ª GCC çš„ C++ ç¬¦å·ä¿®é¥°è§„åˆ™ï¼ŒåŸºæœ¬æ ¼å¼ä¸ºï¼š\n_Z[å‘½åç©ºé—´/ç±»å‰ç¼€][å‡½æ•°åé•¿åº¦][å‡½æ•°å][å‚æ•°ç±»å‹ç¼–ç ]\nå…³é”®è§„åˆ™è§£æï¼š _Zï¼šå›ºå®šå‰ç¼€ï¼Œæ ‡è¯† C++ ç¬¦å·ã€‚ å‘½åç©ºé—´ / ç±»ï¼šè‹¥å‡½æ•°å±äºå‘½åç©ºé—´æˆ–ç±»ï¼Œä¼šåœ¨å‰ç¼€ä¸­ç¼–ç ï¼ˆå¦‚Â NÂ è¡¨ç¤ºå‘½åç©ºé—´å¼€å§‹ï¼ŒEÂ è¡¨ç¤ºç»“æŸï¼‰ã€‚ å‡½æ•°åé•¿åº¦ï¼šç´§è·Ÿåœ¨å‘½åç©ºé—´ / ç±»ä¹‹åï¼Œç”¨æ•°å­—è¡¨ç¤ºå‡½æ•°åçš„å­—ç¬¦æ•°ã€‚ å‚æ•°ç±»å‹ç¼–ç ï¼šç”¨ç®€å†™å­—æ¯è¡¨ç¤ºå‚æ•°ç±»å‹ï¼ˆå¦‚Â i=intï¼Œf=floatï¼Œp= æŒ‡é’ˆï¼Œv=void ç­‰ï¼‰ã€‚ ç¤ºä¾‹ï¼š å…¨å±€å‡½æ•°Â void foo(int)\nä¿®é¥°åç¬¦å·ï¼š_Z3fooi\nè§£æï¼š_Zï¼ˆC++ ç¬¦å·ï¼‰ +Â 3ï¼ˆfooÂ é•¿åº¦ä¸º 3ï¼‰ +Â fooï¼ˆå‡½æ•°åï¼‰ +Â iï¼ˆå‚æ•° intï¼‰ã€‚ é‡è½½å‡½æ•°Â void foo(float)\nä¿®é¥°åç¬¦å·ï¼š_Z3foofï¼ˆå‚æ•°Â fÂ è¡¨ç¤º floatï¼Œä¸ä¸Šä¾‹åŒºåˆ†ï¼‰ã€‚ ç±»æˆå‘˜å‡½æ•°Â class A { void bar(double); }\nä¿®é¥°åç¬¦å·ï¼š_ZN1A3barEd\nè§£æï¼š_ZÂ +Â Nï¼ˆç±» / å‘½åç©ºé—´å¼€å§‹ï¼‰ +Â 1Aï¼ˆç±»åÂ AÂ é•¿åº¦ä¸º 1ï¼‰ +Â 3barï¼ˆå‡½æ•°åÂ barÂ é•¿åº¦ä¸º 3ï¼‰ +Â Eï¼ˆç±»ç»“æŸï¼‰ +Â dï¼ˆå‚æ•° doubleï¼‰ã€‚ å‘½åç©ºé—´å†…å‡½æ•°Â namespace ns { int add(int, int); }\nä¿®é¥°åç¬¦å·ï¼š_ZN2ns3addii\nè§£æï¼š_ZÂ +Â Nï¼ˆå‘½åç©ºé—´å¼€å§‹ï¼‰ +Â 2nsï¼ˆå‘½åç©ºé—´Â nsÂ é•¿åº¦ä¸º 2ï¼‰ +Â 3addï¼ˆå‡½æ•°åÂ addÂ é•¿åº¦ä¸º 3ï¼‰ +Â Eï¼ˆå‘½åç©ºé—´ç»“æŸï¼‰ +Â iiï¼ˆä¸¤ä¸ª int å‚æ•°ï¼‰ã€‚ 3. C å’Œ C++ æ··åˆç¼–ç¨‹çš„ç¬¦å·å…¼å®¹ å½“ C++ ä»£ç è°ƒç”¨ C å‡½æ•°ï¼ˆæˆ–åä¹‹ï¼‰æ—¶ï¼Œéœ€ä½¿ç”¨Â extern \u0026quot;C\u0026quot;Â å£°æ˜ï¼Œä»¥ç¦ç”¨ C++ çš„ç¬¦å·ä¿®é¥°ï¼Œç¡®ä¿é“¾æ¥æ—¶åŒ¹é… C é£æ ¼çš„ç¬¦å·ã€‚\nç¤ºä¾‹ï¼š 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 // Cå¤´æ–‡ä»¶ï¼ˆéœ€å…¼å®¹C++ï¼‰ #ifdef __cplusplus extern \u0026#34;C\u0026#34; { #endif void c_function(int a); // Cå‡½æ•°ï¼Œç¬¦å·ä¸º _c_function #ifdef __cplusplus } #endif // C++ä»£ç ä¸­è°ƒç”¨ void cpp_func() { c_function(10); // æ­£ç¡®å¼•ç”¨Cç¬¦å· _c_function } ``` ","date":"2025-01-13T16:17:46+08:00","permalink":"https://NomadJoeviolet.github.io/p/c-%E7%9A%84%E5%90%8D%E5%AD%97%E4%BF%AE%E9%A5%B0%E7%AC%A6%E5%8F%B7%E4%BF%AE%E9%A5%B0/","title":"C++ çš„åå­—ä¿®é¥°ï¼ˆç¬¦å·ä¿®é¥°ï¼‰"},{"content":"ä½œç”¨ å¦‚æœä¸€ä¸ªå˜é‡è¢«constä¿®é¥°ï¼Œé‚£ä¹ˆå®ƒçš„å€¼å°±ä¸èƒ½å†è¢«æ”¹å˜\nconstçš„ä¼˜ç‚¹ ï¼ˆ1ï¼‰å¯ä»¥ä¿æŠ¤è¢«ä¿®é¥°çš„ä¸œè¥¿ï¼Œé˜²æ­¢æ„å¤–ä¿®æ”¹ï¼Œå¢å¼ºç¨‹åºçš„å¥å£®æ€§\nï¼ˆ2ï¼‰ç¼–è¯‘å™¨é€šå¸¸ä¸ä¸ºæ™®é€šconstå¸¸é‡åˆ†é…å­˜å‚¨ç©ºé—´ï¼Œè€Œæ˜¯å°†å®ƒä»¬ä¿å­˜åœ¨ç¬¦å·è¡¨ä¸­ï¼Œè¿™ä½¿å¾—å®ƒæˆä¸ºä¸€ä¸ªç¼–è¯‘æœŸé—´çš„å¸¸é‡ï¼Œæ²¡æœ‰äº†å­˜å‚¨ä¸è¯»å†…å­˜çš„æ“ä½œï¼Œä½¿å¾—å®ƒçš„æ•ˆç‡ä¹Ÿå¾ˆé«˜\nconstä¿®é¥°å±€éƒ¨å˜é‡ 1 2 const int n=5; int const n=5; è¿™ä¸¤ç§å†™æ³•æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯è¡¨ç¤ºå˜é‡nçš„å€¼ä¸èƒ½è¢«æ”¹å˜äº†ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”¨constä¿®é¥°å˜é‡æ—¶ï¼Œä¸€å®šè¦ç»™å˜è„¸åˆå§‹åŒ–ï¼Œå¦åˆ™ä¹‹åå°±ä¸èƒ½å†è¿›è¡Œèµ‹å€¼\nconst ä¿®é¥°æŒ‡é’ˆ 1.å¸¸é‡æŒ‡é’ˆ å¸¸é‡æŒ‡é’ˆæ˜¯æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹æ˜¯å¸¸é‡ï¼Œå¯ä»¥æœ‰ä¸€ä¸‹ä¸¤ç§å®šä¹‰æ–¹å¼\n1 2 const int * n; int const * n; æ³¨æ„ï¼š ï¼ˆ1ï¼‰å¸¸é‡æŒ‡é’ˆè¯´çš„æ˜¯ä¸èƒ½é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ”¹å˜å˜é‡çš„å€¼ï¼Œä½†æ˜¯è¿˜æ˜¯å¯ä»¥é€šè¿‡å…¶ä»–çš„å¼•ç”¨æ¥æ”¹å˜å˜é‡çš„å€¼çš„\nï¼ˆ2ï¼‰å¸¸é‡æŒ‡é’ˆæŒ‡å‘çš„å€¼ä¸èƒ½æ”¹å˜ï¼Œä½†æ˜¯è¿™å¹¶ä¸æ˜¯æ„å‘³ç€æŒ‡é’ˆæœ¬èº«ä¸èƒ½æ”¹å˜ï¼Œå¸¸é‡æŒ‡é’ˆå¯ä»¥æŒ‡å‘å…¶ä»–çš„åœ°å€\n2.æŒ‡é’ˆå¸¸é‡ æŒ‡é’ˆå¸¸é‡æ˜¯æŒ‡æŒ‡é’ˆæœ¬èº«æ˜¯ä¸ªå¸¸é‡ï¼Œä¸èƒ½å†æŒ‡å‘å…¶ä»–çš„åœ°å€\n1 int *const n; éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒæŒ‡é’ˆå¸¸é‡æŒ‡å‘çš„åœ°å€ä¸èƒ½æ”¹å˜ï¼Œä½†æ˜¯åœ°å€ä¸­ä¿å­˜çš„æ•°å€¼æ˜¯å¯ä»¥æ”¹å˜çš„ï¼Œå¯ä»¥é€šè¿‡å…¶ä»–æŒ‡å‘æ”¹åœ°å€çš„æŒ‡é’ˆæ¥ä¿®æ”¹\n3.æŒ‡å‘å¸¸é‡çš„å¸¸æŒ‡é’ˆ æŒ‡å‘å¸¸é‡çš„å¸¸æŒ‡é’ˆæ˜¯ä»¥ä¸Šä¸¤ç§çš„ç»“åˆï¼ŒæŒ‡é’ˆæŒ‡å‘çš„ä½ç½®ä¸èƒ½æ”¹å˜å¹¶ä¸”ä¹Ÿä¸èƒ½é€šè¿‡è¿™ä¸ªæŒ‡é’ˆæ”¹å˜å˜é‡çš„å€¼ï¼Œä½†æ˜¯ä¾ç„¶å¯ä»¥é€šè¿‡å…¶ä»–çš„æ™®é€šæŒ‡é’ˆæ”¹å˜å˜é‡çš„å€¼\n1 const int* const p; constä¿®é¥°å‡½æ•°çš„å‚æ•° 1.é˜²æ­¢ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„å†…å®¹\n1 void StringCopy(char *strDestination, const char *strSource); å…¶ä¸­ strSource æ˜¯è¾“å…¥å‚æ•°ï¼ŒstrDestination æ˜¯è¾“å‡ºå‚æ•° ç»™ strSource åŠ ä¸Š const ä¿®é¥°åï¼Œå¦‚æœå‡½æ•°ä½“å†…çš„è¯­å¥è¯•å›¾æ”¹åŠ¨ strSource çš„å†…å®¹ï¼Œç¼–è¯‘å™¨å°†æŒ‡å‡ºé”™è¯¯\n2.é˜²æ­¢ä¿®æ”¹æŒ‡é’ˆæŒ‡å‘çš„åœ°å€\n1 void swap ( int * const p1 , int * const p2 ) æŒ‡é’ˆp1å’ŒæŒ‡é’ˆp2æŒ‡å‘çš„åœ°å€éƒ½ä¸èƒ½ä¿®æ”¹\n","date":"2025-01-08T18:08:42+08:00","permalink":"https://NomadJoeviolet.github.io/p/cc-const/","title":"C\u0026C++ const"},{"content":"åŸºäºèœé¸Ÿæ•™ç¨‹å†™çš„ä¸ªäººç¬”è®°\nå­˜å‚¨ç±» å­˜å‚¨ç±»å®šä¹‰äº†Cç¨‹åºä¸­å˜é‡/å‡½æ•°çš„å­˜å‚¨ä½ç½®ï¼Œç”Ÿå‘½å‘¨æœŸï¼Œä½œç”¨åŸŸ\nauto register static extern 1.autoå­˜å‚¨ç±» autoå­˜å‚¨ç±»æ˜¯æ‰€æœ‰å±€éƒ¨å˜é‡é»˜è®¤çš„å­˜å‚¨ç±» å®šä¹‰åœ¨å‡½æ•°ä¸­çš„å˜é‡éƒ½é»˜è®¤ä¸ºautoå­˜å‚¨ç±» å®ƒä»¬åœ¨å‡½æ•°å¼€å§‹æ—¶è¢«åˆ›å»ºï¼Œåœ¨å‡½æ•°ç»“æŸæ—¶è¢«é”€æ¯\n1 2 3 4 { int month ; auto int month ; } autoåªèƒ½ä¿®é¥°å±€éƒ¨å˜é‡\n2.registerå­˜å‚¨ç±» registerå­˜å‚¨ç±»ç”¨äºå®šä¹‰å­˜å‚¨åœ¨å¯„å­˜å™¨ä¸Šï¼Œè€Œä¸æ˜¯RAMä¸­çš„å±€éƒ¨å˜é‡ registerå­˜å‚¨ç±»å®šä¹‰å­˜å‚¨åœ¨å¯„å­˜å™¨ï¼Œå˜é‡è®¿é—®é€Ÿåº¦æ›´å¿«ï¼Œä¸èƒ½ç›´æ¥åœ°å–åœ°å€ï¼ˆå› ä¸ºå®ƒå­˜å‚¨åœ¨RAMä¸­ï¼‰\n1 2 3 { register int miles ï¼› } å¯„å­˜å™¨ä¸€èˆ¬ç”¨äºéœ€è¦å¿«é€Ÿè®¿é—®çš„å˜é‡\n3.staticå­˜å‚¨ç±» ï¼ˆ1ï¼‰staticä½œç”¨äºå±€éƒ¨å˜é‡ a.ä½¿å±€éƒ¨å˜é‡åœ¨ç¨‹åºç”Ÿå‘½å‘¨æœŸå†…éƒ½å­˜åœ¨ï¼Œä¸éœ€è¦æ¯æ¬¡è¿›å…¥å’Œç¦»å¼€å…¶ä½œç”¨åŸŸï¼ˆå‡½æ•°ï¼‰çš„æ—¶å€™åˆ›å»ºï¼ˆé‡æ–°åˆ†é…å†…å­˜ï¼‰å’Œé”€æ¯ã€‚ b.ä½¿ç”¨staticä¿®é¥°å±€éƒ¨å˜é‡å¯ä»¥åœ¨å‡½æ•°è°ƒç”¨ä¹‹é—´ä¿æŒå±€éƒ¨å˜é‡çš„å€¼\nstaticä½œç”¨çš„å˜é‡ï¼Œé™æ€å±€éƒ¨å˜é‡å­˜å‚¨åœ¨é™æ€ï¼ˆå…¨å±€ï¼‰å­˜å‚¨åŒº\nï¼ˆ2ï¼‰staticä½œç”¨äºå…¨å±€å˜é‡ å½“staticä¿®é¥°å…¨å±€å˜é‡æ—¶ï¼Œä¼šä½¿å˜é‡çš„ä½œç”¨åŸŸé™åˆ¶åœ¨å£°æ˜å®ƒçš„æ–‡ä»¶å†…\nï¼ˆ3ï¼‰é™æ€å˜é‡çš„ç‰¹æ€§ é™æ€å˜é‡åœ¨ç¨‹åºä¸­åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå³ä½¿å‡½æ•°è¢«è°ƒç”¨å¤šæ¬¡ï¼Œè¯¥å˜é‡çš„å€¼ä¹Ÿä¸ä¼šé‡ç½®\nä»£ç ç¤ºä¾‹ 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 #include \u0026lt;stdio.h\u0026gt; /* å‡½æ•°å£°æ˜ */ void func1(void); static int count=10; /* å…¨å±€å˜é‡ - static æ˜¯é»˜è®¤çš„ */ int main() { while (count--) { func1(); } return 0; } void func1(void) { /* \u0026#39;thingy\u0026#39; æ˜¯ \u0026#39;func1\u0026#39; çš„å±€éƒ¨å˜é‡ - åªåˆå§‹åŒ–ä¸€æ¬¡ * æ¯æ¬¡è°ƒç”¨å‡½æ•° \u0026#39;func1\u0026#39; \u0026#39;thingy\u0026#39; å€¼ä¸ä¼šè¢«é‡ç½®ã€‚ */ static int thingy=5; thingy++; printf(\u0026#34; thingy ä¸º %d ï¼Œ count ä¸º %d\\n\u0026#34;, thingy, count); } å®ä¾‹ä¸­ count ä½œä¸ºå…¨å±€å˜é‡å¯ä»¥åœ¨å‡½æ•°å†…ä½¿ç”¨ï¼Œthingy ä½¿ç”¨ static ä¿®é¥°åï¼Œä¸ä¼šåœ¨æ¯æ¬¡è°ƒç”¨æ—¶é‡ç½®\nå½“ä¸Šé¢çš„ä»£ç è¢«ç¼–è¯‘å’Œæ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š\n1 2 3 4 5 6 7 8 9 10 thingy ä¸º 6 ï¼Œ count ä¸º 9 thingy ä¸º 7 ï¼Œ count ä¸º 8 thingy ä¸º 8 ï¼Œ count ä¸º 7 thingy ä¸º 9 ï¼Œ count ä¸º 6 thingy ä¸º 10 ï¼Œ count ä¸º 5 thingy ä¸º 11 ï¼Œ count ä¸º 4 thingy ä¸º 12 ï¼Œ count ä¸º 3 thingy ä¸º 13 ï¼Œ count ä¸º 2 thingy ä¸º 14 ï¼Œ count ä¸º 1 thingy ä¸º 15 ï¼Œ count ä¸º 0 4.externå­˜å‚¨ç±» externå­˜å‚¨ç±»ç”¨äºå®šä¹‰åœ¨å…¶ä»–æ–‡ä»¶ä¸­å£°æ˜çš„å…¨å±€å˜é‡æˆ–å‡½æ•° å½“ä½¿ç”¨externå…³é”®å­—æ—¶ï¼Œä¸ä¼šä¸ºå˜é‡åˆ†é…ä»»ä½•å­˜å‚¨ç©ºé—´ï¼Œè€Œåªæ˜¯æŒ‡ç¤ºç¼–è¯‘å™¨è¯¥å˜é‡åœ¨å…¶ä»–æ–‡ä»¶ä¸­å®šä¹‰\nexternÂ å­˜å‚¨ç±»ç”¨äºæä¾›ä¸€ä¸ªå…¨å±€å˜é‡çš„å¼•ç”¨ï¼Œå…¨å±€å˜é‡å¯¹æ‰€æœ‰çš„ç¨‹åºæ–‡ä»¶éƒ½æ˜¯å¯è§çš„ã€‚å½“æ‚¨ä½¿ç”¨Â externÂ æ—¶ï¼Œå¯¹äºæ— æ³•åˆå§‹åŒ–çš„å˜é‡ï¼Œä¼šæŠŠå˜é‡åæŒ‡å‘ä¸€ä¸ªä¹‹å‰å®šä¹‰è¿‡çš„å­˜å‚¨ä½ç½®ã€‚\nextern ä¿®é¥°ç¬¦é€šå¸¸ç”¨äºå½“æœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶å…±äº«ç›¸åŒçš„å…¨å±€å˜é‡æˆ–å‡½æ•°çš„æ—¶å€™ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\nç¬¬ä¸€ä¸ªæ–‡ä»¶ 1 2 3 4 5 6 7 8 9 10 #include \u0026lt;stdio.h\u0026gt; int count ; extern void write_extern(); int main() { count = 5; write_extern(); } ç¬¬äºŒä¸ªæ–‡ä»¶ 1 2 3 4 5 6 7 8 #include \u0026lt;stdio.h\u0026gt; extern int count; void write_extern(void) { printf(\u0026#34;count is %d\\n\u0026#34;, count); } ç»“æœ åœ¨è¿™é‡Œï¼Œç¬¬äºŒä¸ªæ–‡ä»¶ä¸­çš„Â externÂ å…³é”®å­—ç”¨äºå£°æ˜å·²ç»åœ¨ç¬¬ä¸€ä¸ªæ–‡ä»¶ main.c ä¸­å®šä¹‰çš„Â countã€‚ç°åœ¨ ï¼Œç¼–è¯‘è¿™ä¸¤ä¸ªæ–‡ä»¶ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š\n1 $ gcc main.c support.c è¿™ä¼šäº§ç”ŸÂ a.outÂ å¯æ‰§è¡Œç¨‹åºï¼Œå½“ç¨‹åºè¢«æ‰§è¡Œæ—¶ï¼Œå®ƒä¼šäº§ç”Ÿä¸‹åˆ—ç»“æœï¼š\n1 count is 5 ","date":"2025-01-08T18:08:42+08:00","permalink":"https://NomadJoeviolet.github.io/p/c%E5%AD%98%E5%82%A8%E7%B1%BB/","title":"Cå­˜å‚¨ç±»"}]